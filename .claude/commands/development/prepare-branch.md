---
description: "新機能開発を開始（必要に応じてブランチ作成）"
allowed-tools: ["Bash", "TodoWrite", "AskUserQuestion"]
---

# Prepare Branch

新しい機能開発を開始するコマンドです。メインブランチにいる場合は、新しい作業用ブランチを自動作成してから開発を始めます。

## 実行内容

1. **現在のブランチ確認**
   ```bash
   !git branch --show-current
   !git status
   ```

2. **メインブランチにいる場合の処理**
   - ブランチ名を決定（引数で指定されていない場合はユーザーに質問）
   - 最新情報の取得
     ```bash
     !git fetch origin
     !git pull origin main
     ```
   - 新規ブランチ作成と切り替え
     ```bash
     !git checkout -b $BRANCH_NAME
     ```
   - ブランチ作成確認
     ```bash
     !git branch --show-current
     ```

3. **作業ブランチにいる場合**
   - 現在のブランチ名を表示
   - 作業を継続することを確認

## 使用方法

### ブランチ名を指定して使用
```
/prepare-branch feature/new-settings-page
```

### ブランチ名を指定せずに使用
```
/prepare-branch
```
メインブランチにいる場合、新しいブランチ名を質問します。
作業ブランチにいる場合は、そのまま作業を継続します。

## 引数

- `$1` (オプション): 新しいブランチ名
  - メインブランチにいて、この引数が指定されていない場合は対話式で質問
  - 既に作業ブランチにいる場合は不要

## ブランチ命名規則

推奨されるブランチ名のプレフィックス：
- `feature/` - 新機能追加
- `fix/` - バグ修正
- `refactor/` - リファクタリング
- `docs/` - ドキュメント更新
- `test/` - テスト追加・修正
- `chore/` - その他の作業

## 動作フロー

```
現在のブランチを確認
    ↓
メインブランチ？
    ↓YES → ブランチ名取得（引数 or 質問）→ 新ブランチ作成 → 開発開始
    ↓NO  → 現在のブランチで継続 → 開発開始
```

## 例

### パターン1: メインブランチから新機能開始
```bash
$ git branch --show-current
main

$ /prepare-branch feature/user-preferences
# → feature/user-preferences ブランチを作成して切り替え
```

### パターン2: 既に作業ブランチにいる場合
```bash
$ git branch --show-current
feature/settings-page

$ /prepare-branch
# → 現在の feature/settings-page ブランチで作業継続を確認
```

### パターン3: 対話式でブランチ名を決定
```bash
$ git branch --show-current
main

$ /prepare-branch
# → ブランチ名を質問
# → 入力されたブランチ名でブランチ作成
```

## 安全性チェック

このコマンドは以下の安全性チェックを実行します：
- 現在のブランチ名の確認
- メインブランチの場合のみブランチ作成を実行
- 作業ツリーがクリーンかどうかの確認
- リモートとの同期状況の確認
- ブランチ名の重複チェック（既存の場合はエラー）

## 事前要件

- 現在のディレクトリがGitリポジトリである
- リモートリポジトリ `origin` が設定されている
- 新しいブランチを作成する場合は、作業ツリーがクリーンであることを推奨

## 注意事項

- 未コミットの変更がある場合は、事前にコミットまたはスタッシュすることを推奨
- ブランチ名に日本語や特殊文字は使用しない
- リモートリポジトリとの同期を確認してから実行することを推奨
