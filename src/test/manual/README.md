# 手動テストスクリプト

## ウィンドウ移動テスト

既に開いているウィンドウに対して位置・サイズ設定を実行し、結果を検証するテストスクリプトです。

### 使い方

#### 1. テスト対象のウィンドウを開く

例: Microsoft To Do、メモ帳、エクスプローラーなど

#### 2. コマンドを実行

```bash
npm run test:window-move "ウィンドウタイトル" [x] [y] [width] [height] [desktopNumber]
```

### 実行例

#### ウィンドウ検索のみ

```bash
npm run test:window-move "Microsoft To Do"
```

#### 位置・サイズを設定

```bash
npm run test:window-move "Microsoft To Do" 100 100 800 600
```

- x座標: 100
- y座標: 100
- 幅: 800
- 高さ: 600

#### 位置・サイズ + 仮想デスクトップ移動

```bash
npm run test:window-move "Microsoft To Do" 1273 1 1293 1397 2
```

- x座標: 1273
- y座標: 1
- 幅: 1293
- 高さ: 1397
- 仮想デスクトップ: 2

#### 一部のパラメータのみ設定

位置のみ変更（サイズは変更しない）:

```bash
npm run test:window-move "メモ帳" 100 100
```

### テストの流れ

1. **ウィンドウ検索**: タイトルに一致するウィンドウを検索
2. **現在状態取得**: ウィンドウの現在位置・サイズ、デスクトップ番号を取得
3. **デスクトップ切り替えなし**: ユーザーのデスクトップは変更しない
4. **位置・サイズ設定**: SetWindowPos() を直接実行（最大3回リトライ）
5. **デスクトップ復元なし**: デスクトップ切り替えをしていないため不要
6. **仮想デスクトップ移動**: 指定されている場合、ウィンドウを目的のデスクトップに移動

**重要**: このテストはデスクトップ切り替えやウィンドウ移動を行わず、直接 SetWindowPos() を実行します。別の仮想デスクトップにあるウィンドウに対して位置・サイズ設定が正しく動作するかを検証します。

### 出力例

```
============================================================
ウィンドウ移動テスト
============================================================

[1/6] ウィンドウを検索中: "Microsoft To Do"
✓ ウィンドウが見つかりました (hwnd: 12345)

[2/6] 現在の状態を取得中...
✓ ユーザーデスクトップ: 1
✓ 現在位置: x=735, y=278, w=1293, h=1397
✓ ウィンドウのデスクトップ: 2

[3/6] デスクトップ切り替えなし（直接SetWindowPosを実行）

[4/6] 位置・サイズを設定中...
目標位置: x=1273, y=1, w=1293, h=1397

  試行 1/3...
  実際位置: x=1273, y=1, w=1293, h=1397
  ✓ 位置・サイズ設定成功

[5/6] デスクトップ復元なし

[6/6] ウィンドウをデスクトップ 2 に移動中...
✓ デスクトップ移動完了確認 (0ms)

============================================================
テスト結果
============================================================
ステータス: ✓ 成功
メッセージ: テスト成功

詳細:
{
  "windowFound": true,
  "originalDesktop": 1,
  "originalBounds": {
    "x": 735,
    "y": 278,
    "width": 1293,
    "height": 1397
  },
  "targetBounds": {
    "x": 1273,
    "y": 1,
    "width": 1293,
    "height": 1397
  },
  "actualBounds": {
    "x": 1273,
    "y": 1,
    "width": 1293,
    "height": 1397
  },
  "targetDesktop": 2,
  "boundsMatch": true,
  "desktopSwitched": true
}
```

### トラブルシューティング

#### ウィンドウが見つからない

- ウィンドウタイトルが正確か確認してください
- タイトルバーに表示されているテキストと完全一致する必要があります
- 例: `"メモ帳"` ではなく `"無題 - メモ帳"` など

#### 位置・サイズが設定されない

- テストの詳細出力を確認してください
- デスクトップ切り替えが正しく行われているか確認
- actualBounds と targetBounds の差分を確認

#### デスクトップ移動が失敗する

- 指定したデスクトップ番号が存在するか確認（1から開始）
- VirtualDesktopAccessor.dll が正しく読み込まれているか確認

### デバッグ情報

テストスクリプトは各ステップで詳細な情報を出力します:

- ウィンドウハンドル (hwnd)
- 現在のデスクトップ番号
- ウィンドウの現在位置・サイズ
- 目標位置・サイズ
- 実際に設定された位置・サイズ
- リトライ回数と結果
- デスクトップ切り替えの成否
