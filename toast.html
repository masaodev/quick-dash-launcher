<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Toast</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', 'Yu Gothic UI', 'Meiryo UI', sans-serif;
      background: transparent;
      overflow: hidden;
      -webkit-app-region: no-drag;
    }

    .toast-container {
      display: flex;
      align-items: flex-start;
      padding: 12px 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      max-width: 400px;
      min-height: 80px;
      background: #ffffff;
      color: #333;
    }

    .toast-container.show {
      opacity: 1;
      transform: translateY(0);
    }

    .toast-container.hide {
      opacity: 0;
      transform: translateY(-10px);
    }

    /* ã‚¢ã‚¤ã‚³ãƒ³éƒ¨åˆ† */
    .toast-icon-wrapper {
      flex-shrink: 0;
      width: 40px;
      height: 40px;
      margin-right: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f5f5f5;
      border-radius: 6px;
    }

    .toast-icon-wrapper img {
      width: 28px;
      height: 28px;
      border-radius: 4px;
      object-fit: contain;
    }

    .toast-icon-wrapper .default-icon {
      font-size: 24px;
      line-height: 1;
    }

    /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„éƒ¨åˆ† */
    .toast-content {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .toast-title {
      font-size: 14px;
      font-weight: 600;
      line-height: 1.3;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: #333;
    }

    .toast-path {
      font-size: 11px;
      line-height: 1.3;
      margin-top: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: #666;
    }

    .toast-separator {
      height: 1px;
      background: #e0e0e0;
      margin: 6px 0;
    }

    .toast-action {
      font-size: 12px;
      line-height: 1.3;
      color: #666;
    }

    /* ã‚°ãƒ«ãƒ¼ãƒ—ã‚¢ã‚¤ãƒ†ãƒ åãƒªã‚¹ãƒˆ */
    .toast-items {
      font-size: 11px;
      line-height: 1.3;
      margin-top: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: #666;
    }

    /* å¾“æ¥ã®ã‚·ãƒ³ãƒ—ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ï¼ˆéæ¨å¥¨: æ–°è¦è¿½åŠ æ™‚ã¯ itemType + displayName ã®ãƒªãƒƒãƒå½¢å¼ã‚’ä½¿ã†ã“ã¨ï¼‰ */
    .toast-simple {
      display: flex;
      align-items: center;
      min-height: 48px;
    }

    .toast-simple-icon {
      margin-right: 10px;
      font-size: 18px;
      flex-shrink: 0;
      color: #0078d4;
    }

    .toast-simple-message {
      font-size: 13px;
      line-height: 1.4;
      word-break: break-word;
      color: #666;
    }
  </style>
</head>
<body>
  <div id="toast" class="toast-container"></div>

  <script>
    // ã‚¿ã‚¤ãƒ—åˆ¥è¨­å®šï¼ˆã‚¢ã‚¤ã‚³ãƒ³ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ–‡è¨€ã‚’çµ±åˆç®¡ç†ï¼‰
    const itemTypeConfig = {
      url:               { icon: 'ğŸŒ', action: 'URLã‚’é–‹ã„ã¦ã„ã¾ã™...' },
      app:               { icon: 'âš™ï¸', action: 'ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ä¸­...' },
      file:              { icon: 'ğŸ“„', action: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ã„ã¾ã™...' },
      folder:            { icon: 'ğŸ“', action: 'ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’é–‹ã„ã¦ã„ã¾ã™...' },
      customUri:         { icon: 'ğŸ”—', action: 'èµ·å‹•ä¸­...' },
      group:             { icon: 'ğŸ“¦', action: null },
      windowOperation:   { icon: 'ğŸªŸ', action: 'ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ“ä½œã‚’å®Ÿè¡Œã—ã¾ã™' },
      windowActivate:    { icon: 'ğŸ”„', action: 'ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã—ã¾ã—ãŸ' },
      windowClose:       { icon: 'âœ–ï¸', action: 'ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã¾ã—ãŸ' },
      windowPin:         { icon: 'ğŸ“Œ', action: 'ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’å…¨ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã«å›ºå®šã—ã¾ã—ãŸ' },
      windowUnpin:       { icon: 'ğŸ”“', action: 'ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®å›ºå®šã‚’è§£é™¤ã—ã¾ã—ãŸ' },
      windowMoveDesktop: { icon: 'â¡ï¸', action: null },
      workspaceAdd:      { icon: 'â­', action: 'ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«è¿½åŠ ã—ã¾ã—ãŸ' },
      clipboard:         { icon: 'ğŸ“‹', action: 'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«å¾©å…ƒã—ã¦ã„ã¾ã™...' },
      bookmarkImport:    { icon: 'ğŸ”–', action: null }
    };

    const DEFAULT_ICON = 'ğŸ“‹';

    // å¾“æ¥ã®ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ï¼‰
    const legacyIcons = {
      success: 'âœ“',
      error: 'âœ•',
      info: 'â„¹',
      warning: 'âš '
    };

    function getDefaultIcon(itemType) {
      const config = itemTypeConfig[itemType];
      return config ? config.icon : DEFAULT_ICON;
    }

    function getActionText(itemType) {
      const config = itemTypeConfig[itemType];
      return config ? config.action : 'èµ·å‹•ä¸­...';
    }

    // ãƒ‘ã‚¹çœç•¥ï¼ˆ40æ–‡å­—è¶…ã§ä¸­é–“çœç•¥ï¼‰
    function truncatePath(path, maxLength = 40) {
      if (!path || path.length <= maxLength) return path;
      return path.substring(0, 15) + '...' + path.substring(path.length - 20);
    }

    // ã‚°ãƒ«ãƒ¼ãƒ—ã‚¢ã‚¤ãƒ†ãƒ åã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    function formatGroupItems(itemNames, itemCount) {
      if (!itemNames || itemNames.length === 0) {
        return `${itemCount || 0}ä»¶ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’èµ·å‹•ã—ã¾ã™`;
      }
      const displayNames = itemNames.slice(0, 3).join(', ');
      const remaining = (itemCount || itemNames.length) - 3;
      if (remaining > 0) {
        return `${displayNames}... ä»–${remaining}ä»¶`;
      }
      return displayNames;
    }

    // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ã‚¢ã‚¤ã‚³ãƒ³HTMLç”Ÿæˆ
    function buildIconHtml(icon, itemType) {
      const fallback = getDefaultIcon(itemType);
      if (icon) {
        return `<img src="${escapeHtml(icon)}" alt="" onerror="this.parentElement.innerHTML='<span class=\\'default-icon\\'>${fallback}</span>'" />`;
      }
      return `<span class="default-icon">${fallback}</span>`;
    }

    // æ–°å½¢å¼ãƒˆãƒ¼ã‚¹ãƒˆã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„éƒ¨åˆ†ã‚’ç”Ÿæˆ
    function buildItemContent(data) {
      const { itemType, displayName, path, itemCount, itemNames, message } = data;
      let html = `<div class="toast-title">${escapeHtml(displayName)}</div>`;

      if (itemType === 'group') {
        const count = itemCount || (itemNames ? itemNames.length : 0);
        html += `<div class="toast-items">${escapeHtml(formatGroupItems(itemNames, itemCount))}</div>`;
        html += '<div class="toast-separator"></div>';
        html += `<div class="toast-action">${count}ä»¶ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’èµ·å‹•ã—ã¾ã™</div>`;
      } else {
        if (path) {
          html += `<div class="toast-path">${escapeHtml(truncatePath(path))}</div>`;
        }
        html += '<div class="toast-separator"></div>';
        // messageãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°itemTypeã‹ã‚‰å–å¾—
        const actionText = message || getActionText(itemType);
        html += `<div class="toast-action">${escapeHtml(actionText)}</div>`;
      }

      return html;
    }

    // IPCçµŒç”±ã§ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚‹
    if (window.electronAPI && window.electronAPI.onShowToast) {
      window.electronAPI.onShowToast((data) => {
        showToast(data);
      });
    }

    function showToast(data) {
      const {
        message,
        type = 'success',
        duration = 2500,
        itemType,
        displayName
      } = data;

      const toast = document.getElementById('toast');
      toast.className = 'toast-container ' + type;

      if (itemType && displayName) {
        // ãƒªãƒƒãƒå½¢å¼ï¼ˆæ¨å¥¨: æ–°è¦è¿½åŠ æ™‚ã¯ã“ã¡ã‚‰ã‚’ä½¿ã†ã“ã¨ï¼‰
        toast.innerHTML =
          '<div class="toast-icon-wrapper">' + buildIconHtml(data.icon, itemType) + '</div>' +
          '<div class="toast-content">' + buildItemContent(data) + '</div>';
      } else {
        // æ—§å½¢å¼ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆéæ¨å¥¨: ç¾åœ¨ä½¿ç”¨ç®‡æ‰€ãªã—ï¼‰
        toast.innerHTML =
          '<div class="toast-simple">' +
            `<span class="toast-simple-icon">${legacyIcons[type] || legacyIcons.success}</span>` +
            `<span class="toast-simple-message">${escapeHtml(message || '')}</span>` +
          '</div>';
      }

      requestAnimationFrame(() => {
        toast.classList.add('show');
      });

      setTimeout(() => {
        toast.classList.remove('show');
        toast.classList.add('hide');
      }, duration);
    }
  </script>
</body>
</html>
