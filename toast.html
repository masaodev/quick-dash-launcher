<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Toast</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', 'Yu Gothic UI', 'Meiryo UI', sans-serif;
      background: transparent;
      overflow: hidden;
      -webkit-app-region: no-drag;
    }

    .toast-container {
      display: flex;
      align-items: flex-start;
      padding: 12px 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      max-width: 400px;
      min-height: 80px;
      background: #ffffff;
      color: #333;
    }

    .toast-container.show {
      opacity: 1;
      transform: translateY(0);
    }

    .toast-container.hide {
      opacity: 0;
      transform: translateY(-10px);
    }

    /* ã™ã¹ã¦ã®ã‚¿ã‚¤ãƒ—ã§åŒã˜ç™½èƒŒæ™¯ã‚’ä½¿ç”¨ */
    .toast-container.success,
    .toast-container.error,
    .toast-container.info,
    .toast-container.warning {
      background: #ffffff;
      color: #333;
    }

    /* ã‚¢ã‚¤ã‚³ãƒ³éƒ¨åˆ† */
    .toast-icon-wrapper {
      flex-shrink: 0;
      width: 40px;
      height: 40px;
      margin-right: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f5f5f5;
      border-radius: 6px;
    }

    .toast-icon-wrapper img {
      width: 28px;
      height: 28px;
      border-radius: 4px;
      object-fit: contain;
    }

    .toast-icon-wrapper .default-icon {
      font-size: 24px;
      line-height: 1;
    }

    /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„éƒ¨åˆ† */
    .toast-content {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .toast-title {
      font-size: 14px;
      font-weight: 600;
      line-height: 1.3;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: #333;
    }

    .toast-path {
      font-size: 11px;
      line-height: 1.3;
      margin-top: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: #666;
    }

    .toast-separator {
      height: 1px;
      background: #e0e0e0;
      margin: 6px 0;
    }

    .toast-action {
      font-size: 12px;
      line-height: 1.3;
      color: #666;
    }

    /* ã‚°ãƒ«ãƒ¼ãƒ—ã‚¢ã‚¤ãƒ†ãƒ åãƒªã‚¹ãƒˆ */
    .toast-items {
      font-size: 11px;
      line-height: 1.3;
      margin-top: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: #666;
    }

    /* å¾“æ¥ã®ã‚·ãƒ³ãƒ—ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ */
    .toast-simple {
      display: flex;
      align-items: center;
      min-height: 48px;
    }

    .toast-simple-icon {
      margin-right: 10px;
      font-size: 18px;
      flex-shrink: 0;
      color: #0078d4;
    }

    .toast-simple-message {
      font-size: 13px;
      line-height: 1.4;
      word-break: break-word;
      color: #666;
    }
  </style>
</head>
<body>
  <div id="toast" class="toast-container"></div>

  <script>
    // ã‚¿ã‚¤ãƒ—åˆ¥ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¤ã‚³ãƒ³
    const defaultIcons = {
      url: 'ğŸŒ',
      app: 'âš™ï¸',
      file: 'ğŸ“„',
      folder: 'ğŸ“',
      customUri: 'ğŸ”—',
      group: 'ğŸ“¦',
      windowOperation: 'ğŸªŸ'
    };

    // ã‚¿ã‚¤ãƒ—åˆ¥ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ–‡è¨€
    const actionTexts = {
      url: 'ã‚’é–‹ãã¾ã™',
      app: 'ã‚’é–‹ãã¾ã™',
      file: 'ã‚’é–‹ãã¾ã™',
      folder: 'ã‚’é–‹ãã¾ã™',
      customUri: 'ã‚’é–‹ãã¾ã™',
      group: null, // ç‰¹æ®Šå‡¦ç†
      windowOperation: 'ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ“ä½œã‚’å®Ÿè¡Œã—ã¾ã™'
    };

    // å¾“æ¥ã®ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ï¼‰
    const legacyIcons = {
      success: 'âœ“',
      error: 'âœ•',
      info: 'â„¹',
      warning: 'âš '
    };

    // ãƒ‘ã‚¹çœç•¥é–¢æ•°ï¼ˆ40æ–‡å­—è¶…ã§ä¸­é–“çœç•¥ï¼‰
    function truncatePath(path, maxLength = 40) {
      if (!path || path.length <= maxLength) return path;
      const prefixLen = 15;
      const suffixLen = 20;
      return path.substring(0, prefixLen) + '...' + path.substring(path.length - suffixLen);
    }

    // ã‚°ãƒ«ãƒ¼ãƒ—ã‚¢ã‚¤ãƒ†ãƒ åã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    function formatGroupItems(itemNames, itemCount) {
      if (!itemNames || itemNames.length === 0) {
        return `${itemCount || 0}ä»¶ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’èµ·å‹•ã—ã¾ã™`;
      }
      const displayNames = itemNames.slice(0, 3).join(', ');
      const remaining = (itemCount || itemNames.length) - 3;
      if (remaining > 0) {
        return `${displayNames}... ä»–${remaining}ä»¶`;
      }
      return displayNames;
    }

    // IPCçµŒç”±ã§ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚‹
    if (window.electronAPI && window.electronAPI.onShowToast) {
      window.electronAPI.onShowToast((data) => {
        showToast(data);
      });
    }

    function showToast(data) {
      const {
        message,
        type = 'success',
        duration = 2500,
        itemType,
        displayName,
        path,
        icon,
        itemCount,
        itemNames
      } = data;

      const toast = document.getElementById('toast');

      // ã‚¯ãƒ©ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
      toast.className = 'toast-container ' + type;

      // æ–°å½¢å¼ï¼ˆã‚¢ã‚¤ãƒ†ãƒ æƒ…å ±ã‚ã‚Šï¼‰ã‹å¾“æ¥å½¢å¼ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿ï¼‰ã‹åˆ¤å®š
      if (itemType && displayName) {
        // æ–°å½¢å¼ã®ãƒˆãƒ¼ã‚¹ãƒˆ
        let html = '';

        // ã‚¢ã‚¤ã‚³ãƒ³éƒ¨åˆ†
        html += '<div class="toast-icon-wrapper">';
        if (icon) {
          html += `<img src="${escapeHtml(icon)}" alt="" onerror="this.parentElement.innerHTML='<span class=\\'default-icon\\'>${defaultIcons[itemType] || 'ğŸ“‹'}</span>'" />`;
        } else {
          html += `<span class="default-icon">${defaultIcons[itemType] || 'ğŸ“‹'}</span>`;
        }
        html += '</div>';

        // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„éƒ¨åˆ†
        html += '<div class="toast-content">';
        html += `<div class="toast-title">${escapeHtml(displayName)}</div>`;

        if (itemType === 'group') {
          // ã‚°ãƒ«ãƒ¼ãƒ—èµ·å‹•
          html += `<div class="toast-items">${escapeHtml(formatGroupItems(itemNames, itemCount))}</div>`;
          html += '<div class="toast-separator"></div>';
          html += `<div class="toast-action">${itemCount || (itemNames ? itemNames.length : 0)}ä»¶ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’èµ·å‹•ã—ã¾ã™</div>`;
        } else if (itemType === 'windowOperation') {
          // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ“ä½œ
          html += '<div class="toast-separator"></div>';
          html += `<div class="toast-action">${actionTexts.windowOperation}</div>`;
        } else {
          // é€šå¸¸ã‚¢ã‚¤ãƒ†ãƒ 
          if (path) {
            html += `<div class="toast-path">${escapeHtml(truncatePath(path))}</div>`;
          }
          html += '<div class="toast-separator"></div>';
          html += `<div class="toast-action">${escapeHtml(displayName)}${actionTexts[itemType] || 'ã‚’é–‹ãã¾ã™'}</div>`;
        }

        html += '</div>';
        toast.innerHTML = html;
      } else {
        // å¾“æ¥å½¢å¼ã®ã‚·ãƒ³ãƒ—ãƒ«ãƒˆãƒ¼ã‚¹ãƒˆ
        toast.innerHTML = `
          <div class="toast-simple">
            <span class="toast-simple-icon">${legacyIcons[type] || legacyIcons.success}</span>
            <span class="toast-simple-message">${escapeHtml(message || '')}</span>
          </div>
        `;
      }

      // è¡¨ç¤ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
      requestAnimationFrame(() => {
        toast.classList.add('show');
      });

      // éè¡¨ç¤ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
      setTimeout(() => {
        toast.classList.remove('show');
        toast.classList.add('hide');
      }, duration);
    }

    // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  </script>
</body>
</html>
