# メインウィンドウ仕様書

## 関連ドキュメント

- [画面一覧](screen-list.md) - 全画面構成の概要
- [ブックマークインポートモーダル](bookmark-import-modal.md) - インポート機能詳細
- [編集モード](../features/edit-mode.md) - 編集機能の詳細

## 1. 概要

メインウィンドウは、QuickDashLauncherの中核となる検索・ランチャー画面です。グローバルホットキー（Ctrl+Alt+W）で呼び出され、アプリケーション、ファイル、フォルダ、URLに素早くアクセスできます。

**キーボードショートカット**: 
- Ctrl+Alt+W: ウィンドウ表示/非表示
- Ctrl+E: アイテム管理ウィンドウへ切り替え
- Enter: 選択項目を開く
- Shift+Enter: 選択項目の親フォルダを開く
- Arrow Keys: 項目選択の移動

### 主要機能
- **リアルタイム検索**: 入力に応じてアイテムをリアルタイムフィルタリング
- **キーボードナビゲーション**: 矢印キーとEnterキーでアイテム選択・実行
- **コンテキストメニュー**: 右クリックでアイテム操作メニューを表示
- **ドラッグ&ドロップ登録**: ファイルやフォルダをドロップして簡単登録
- **ウィンドウ固定化**: 📌ボタンでフォーカスアウト時も非表示にならない設定
- **アイコン管理**: ファビコン取得・アイコン抽出機能
- **進捗表示**: アイコン処理中の進捗バー表示

## 2. 基本情報

| 項目 | 内容 |
|------|------|
| **ファイル名** | `src/renderer/App.tsx` |
| **コンポーネント名** | `App` |
| **表示条件** | グローバルホットキー（Ctrl+Alt+W）押下時 |
| **画面タイプ** | メインウィンドウ |
| **親画面** | なし（ルートコンポーネント） |

## 3. 画面項目一覧

| エリア | 項目名 | 内容・説明 | 表示条件 | 機能詳細 |
|--------|--------|------------|----------|----------|
| **ヘッダー** | 検索入力欄 | アイテム検索用のテキスト入力欄 | 常時表示 | [4.1. 検索機能](#41-検索機能) |
| **ヘッダー** | 更新ボタン（🔄） | データ再読み込み・アイコン取得メニュー | 常時表示 | [4.2. 更新アクションメニュー](#42-更新アクションメニュー) |
| **ヘッダー** | └ 📋 データ再読み込み | データファイルの再読み込み | ドロップダウン展開時 | [4.2. 更新アクションメニュー](#42-更新アクションメニュー) |
| **ヘッダー** | └ 🎨 アイコン取得 | 未取得アイコンの取得 | ドロップダウン展開時 | [4.2. 更新アクションメニュー](#42-更新アクションメニュー) |
| **ヘッダー** | └ 🔄 完全リフレッシュ | データ再読み込み＋全アイコン強制取得 | ドロップダウン展開時 | [4.2. 更新アクションメニュー](#42-更新アクションメニュー) |
| **ヘッダー** | 固定ボタン（📌） | ウィンドウ固定状態の切り替え | 常時表示 | [4.3. ウィンドウ固定機能](#43-ウィンドウ固定機能) |
| **ヘッダー** | 設定ボタン（⚙） | 設定・管理メニューへのアクセス | 常時表示 | [4.4. 設定メニュー](#44-設定メニュー) |
| **ヘッダー** | └ ⚙️ 基本設定 | 管理ウィンドウの設定タブを開く | ドロップダウン展開時 | [4.4. 設定メニュー](#44-設定メニュー) |
| **ヘッダー** | └ ✏️ アイテム管理 | 管理ウィンドウの編集タブを開く | ドロップダウン展開時 | [4.4. 設定メニュー](#44-設定メニュー) |
| **ヘッダー** | └ 📋 JSON出力 | アイテムデータをクリップボードにコピー | ドロップダウン展開時 | [4.4. 設定メニュー](#44-設定メニュー) |
| **ヘッダー** | └ ──────────── | 区切り線 | ドロップダウン展開時 | - |
| **ヘッダー** | └ 🚪 アプリを終了 | アプリケーションを終了 | ドロップダウン展開時 | [4.4. 設定メニュー](#44-設定メニュー) |
| **メイン** | アイテムリスト | フィルタリングされたアイテム一覧表示 | 常時表示 | [4.5. アイテムリスト表示](#45-アイテムリスト表示) |
| **メイン** | 選択ハイライト | 現在選択中のアイテムをハイライト表示 | アイテム存在時 | [4.6. キーボードナビゲーション](#46-キーボードナビゲーション) |
| **メイン** | コンテキストメニュー | 右クリック時に表示されるアイテムメニュー | 右クリック時 | [4.13. コンテキストメニュー](#413-コンテキストメニュー) |
| **メイン** | 進捗バー | アイコン処理の進捗表示 | 処理実行中 | [4.7. 進捗表示](#47-進捗表示) |
| **オーバーレイ** | 登録モーダル | ドラッグ&ドロップ時の登録用モーダル | ドロップ時 | [4.8. ドラッグ&ドロップ登録](#48-ドラッグドロップ登録) |
| **オーバーレイ** | ドラッグオーバーレイ | ドラッグ中の視覚的フィードバック | ドラッグ中 | [4.9. ドラッグビジュアルフィードバック](#49-ドラッグビジュアルフィードバック) |

## 4. 機能詳細

### 4.1. 検索機能

#### 処理フロー
1. **リアルタイム検索**: 入力値変更時に`handleSearch`実行
2. **フィルタリング実行**: `filterItems`関数でアイテムをフィルタリング
3. **選択インデックス初期化**: 検索時は`selectedIndex`を0にリセット
4. **検索ボックスフォーカス**: ウィンドウ表示時に自動フォーカス

#### フィルタリング条件
- **対象フィールド**: アイテム名（name）
- **検索方式**: 部分一致
- **大文字小文字**: 区別なし

### 4.2. 更新アクションメニュー

#### メニュー項目
- **📋 データ再読み込み**: データファイルの再読み込み（`onReload`）
- **🎨 アイコン取得**: 未取得アイコンの取得（ファビコン・アイコン抽出）
- **🔄 完全リフレッシュ**: データ再読み込み＋全アイコン強制取得

#### 処理フロー
- **ドロップダウン表示**: RefreshActionsDropdownコンポーネントで実装
- **メニュー外クリック**: 自動的にメニューを閉じる
- **実行後処理**: メニュー選択後は自動的に閉じる

### 4.3. ウィンドウ固定機能

#### 機能概要
- **トグル動作**: クリックで固定/固定解除を切り替え
- **視覚的フィードバック**: 固定時は`pinned`クラスを適用
- **ツールチップ**: 現在の状態に応じたツールチップ表示

#### 処理内容
- **状態管理**: `isPinned`ステートで固定状態を管理
- **IPC通信**: `window.electronAPI.setWindowPinState`で状態を設定
- **初期化**: ウィンドウ表示時に`getWindowPinState`で状態を取得

### 4.4. 設定メニュー

#### メニュー項目
- **⚙️ 基本設定**: 管理ウィンドウの設定タブを開く
- **✏️ アイテム管理**: 管理ウィンドウの編集タブを開く
- **📁 設定フォルダを開く**: 設定フォルダをエクスプローラーで開く
- **📄 設定ファイルを開く**: data.txtをテキストエディタで開く
- **📋 JSON出力**: アイテムデータをクリップボードにコピー
- **🚪 アプリを終了**: アプリケーションを終了

#### 処理フロー
- **ドロップダウン表示**: SettingsDropdownコンポーネントで実装
- **タブ指定**: `openEditWindowWithTab`でタブを指定して開く
- **JSON出力**: 全アイテムデータをJSON形式でクリップボードにコピー

### 4.5. アイテムリスト表示

#### 表示内容
- **アイコン**: アイテム種別に応じたアイコン表示
- **名前**: アイテム名
- **パス情報**: ファイルパスまたはURL

#### アイコン取得
1. **キャッシュから取得**: 既存アイコンキャッシュから取得
2. **実行時抽出**: .exeファイルからアイコン抽出
3. **ファビコン取得**: URLからファビコン取得
4. **デフォルトアイコン**: 種別に応じたデフォルトアイコン使用

### 4.6. キーボードナビゲーション

#### キーボード操作
- **Enter**: 選択アイテムを開く
- **Shift+Enter**: 選択アイテムの親フォルダを開く
- **ArrowUp**: 前の項目を選択（循環）
- **ArrowDown**: 次の項目を選択（循環）
- **Ctrl+E**: 編集モードウィンドウを開く

#### エラーハンドリング
- **アイテム不存在**: アイテムが存在しない場合は何も実行しない
- **選択範囲外**: インデックスが範囲外の場合は先頭または末尾にループ

### 4.7. 進捗表示

#### 表示内容
- **進捗バー**: アイコン処理の進行状況を視覚的に表示
- **パーセント表示**: 処理済み/全体の割合を表示
- **処理中メッセージ**: 現在処理中の項目名を表示

#### 実装詳細
- **コンポーネント**: `IconProgressBar`コンポーネント
- **フック**: `useIconProgress`でグローバル進捗状態を管理
- **表示条件**: `progressState.isActive && progressState.progress`

### 4.8. ドラッグ&ドロップ登録

#### 処理フロー
1. **ドロップ検出**: `handleDrop`イベントでファイル取得
2. **パス抽出**: `window.electronAPI.getPathForFile`でファイルパス取得
3. **パス配列作成**: 複数ファイルの場合は配列に格納
4. **モーダル表示**: `RegisterModal`を開いて登録フローへ

#### エラーハンドリング
- **パス取得失敗**: アラートで「ファイルパスを取得できませんでした」表示
- **ファイル不存在**: エクスプローラーから直接ドラッグするよう案内

### 4.9. ドラッグビジュアルフィードバック

#### 視覚的表現
- **オーバーレイ表示**: ドラッグ中は半透明オーバーレイを表示
- **メッセージ表示**: 「ファイルをドロップして登録」メッセージ
- **スタイル変更**: `dragging-over`クラスでアプリ全体のスタイル変更

#### 状態管理
- **ドラッグ開始**: `setIsDraggingOver(true)`
- **ドラッグ終了**: ドロップまたはリーブ時に`setIsDraggingOver(false)`

### 4.10. アイテム実行機能

#### 実行方法
- **クリック実行**: アイテムクリック時に`handleItemClick`実行
- **キーボード実行**: Enterキー押下時に実行
- **親フォルダ実行**: Shift+Enterで親フォルダを開く

#### 処理内容
- **メイン実行**: `window.electronAPI.openItem(item)`でアイテムを開く
- **親フォルダ実行**: `window.electronAPI.openParentFolder(item)`で親フォルダを開く

### 4.11. アイコン管理機能

#### ファビコン取得
- **未取得のみ**: `handleFetchMissingIcons`で未取得URLのファビコンを取得
- **強制取得**: `handleRefreshAll`で全URLのファビコンを再取得
- **進捗表示**: `fetchFaviconsWithProgress`で進捗を表示

#### アイコン抽出
- **対象**: 実行ファイル（.exe）等のアイコンを抽出
- **未取得のみ**: アイコンが設定されていないアイテムのみ処理
- **強制抽出**: 全アイテムのアイコンを再抽出

### 4.12. データ管理機能

#### 初期化処理
1. **データファイル読み込み**: `window.electronAPI.loadDataFiles()`
2. **パース処理**: `parseDataFiles`でアイテム配列に変換
3. **アイコン読み込み**: キャッシュされたアイコンを適用
4. **状態設定**: メイン・一時アイテムの状態を更新

#### リロード処理
- **手動リロード**: リロードボタン押下時に`loadItems`実行
- **登録後リロード**: アイテム登録後に自動リロード実行

### 4.13. コンテキストメニュー

#### 表示条件
- **右クリック**: アイテムを右クリックした位置にメニューを表示
- **位置調整**: 画面端の場合は表示位置を自動調整

#### メニュー項目
- **📋 パスをコピー**: 選択したアイテムのパス（ファイルパス・URL等）をクリップボードにコピー

#### 操作方法
- **メニュー外クリック**: メニューを閉じる
- **Escapeキー**: メニューを閉じる
- **メニュー項目クリック**: 対応する機能を実行してメニューを閉じる

#### 実装詳細
- **コンポーネント**: `ContextMenu`コンポーネント
- **IPC通信**: `copyToClipboard`でクリップボードにコピー
- **エラーハンドリング**: コピー失敗時にアラート表示