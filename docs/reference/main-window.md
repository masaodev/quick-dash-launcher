# メインウィンドウ仕様書

## 関連ドキュメント

- [画面一覧](screen-list.md) - 全画面構成の概要
- [ブックマークインポートモーダル](bookmark-import-modal.md) - インポート機能詳細
- [アイテム管理](../features/item-management.md) - 編集機能の詳細

## 1. 概要

メインウィンドウは、QuickDashLauncherの中核となる検索・ランチャー画面です。グローバルホットキー（Ctrl+Alt+W）で呼び出され、アプリケーション、ファイル、フォルダ、URLに素早くアクセスできます。

**キーボードショートカット**: 
- Ctrl+Alt+W: ウィンドウ表示/非表示
- Ctrl+E: アイテム管理ウィンドウへ切り替え
- Enter: 選択項目を開く
- Shift+Enter: 選択項目の親フォルダを開く
- Arrow Keys: 項目選択の移動

### 主要機能
- **リアルタイム検索**: 入力に応じてアイテムをリアルタイムフィルタリング
- **キーボードナビゲーション**: 矢印キーとEnterキーでアイテム選択・実行
- **コンテキストメニュー**: 右クリックでアイテム操作メニューを表示
- **ドラッグ&ドロップ登録**: ファイルやフォルダをドロップして簡単登録
- **ウィンドウ固定化**: 📌ボタンでフォーカスアウト時も非表示にならない設定
- **アイコン管理**: ファビコン取得・アイコン抽出機能
- **進捗表示**: アイコン処理中の進捗バー表示

## 2. 基本情報

| 項目 | 内容 |
|------|------|
| **ファイル名** | `src/renderer/App.tsx` |
| **コンポーネント名** | `App` |
| **表示条件** | グローバルホットキー（Ctrl+Alt+W）押下時 |
| **画面タイプ** | メインウィンドウ |
| **親画面** | なし（ルートコンポーネント） |

## 3. 画面項目一覧

| エリア | 項目名 | 内容・説明 | 表示条件 | 機能詳細 |
|--------|--------|------------|----------|----------|
| **ヘッダー** | 検索入力欄 | アイテム検索用のテキスト入力欄、クリアボタン付き | 常時表示 | [4.1](#41-検索入力欄への文字入力) |
| **ヘッダー** | 更新ボタン（🔄） | データ再読み込み・アイコン取得メニュー | 常時表示 | [4.3](#43-更新メニュー操作) |
| **ヘッダー** | └ 📋 データ再読み込み | データファイルの再読み込み | ドロップダウン展開時 | [4.3](#43-更新メニュー操作) |
| **ヘッダー** | └ 🎨 アイコン取得 | 未取得アイコンの取得 | ドロップダウン展開時 | [4.3](#43-更新メニュー操作) |
| **ヘッダー** | └ 🔄 完全リフレッシュ | データ再読み込み＋全アイコン強制取得 | ドロップダウン展開時 | [4.3](#43-更新メニュー操作) |
| **ヘッダー** | 固定ボタン（📌） | ウィンドウ固定状態の切り替え | 常時表示 | [4.4](#44-固定ボタン押下) |
| **ヘッダー** | 設定ボタン（⚙） | 設定・管理メニューへのアクセス | 常時表示 | [4.5](#45-設定メニュー操作) |
| **ヘッダー** | └ ⚙️ 基本設定 | 管理ウィンドウの設定タブを開く | ドロップダウン展開時 | [4.5](#45-設定メニュー操作) |
| **ヘッダー** | └ ✏️ アイテム管理 | 管理ウィンドウの編集タブを開く | ドロップダウン展開時 | [4.5](#45-設定メニュー操作) |
| **ヘッダー** | └ 📋 JSON出力 | アイテムデータをクリップボードにコピー | ドロップダウン展開時 | [4.5](#45-設定メニュー操作) |
| **ヘッダー** | └ ──────────── | 区切り線 | ドロップダウン展開時 | - |
| **ヘッダー** | └ 🚪 アプリを終了 | アプリケーションを終了 | ドロップダウン展開時 | [4.5](#45-設定メニュー操作) |
| **メイン** | アイテムリスト | フィルタリングされたアイテム一覧表示 | 常時表示 | [4.6](#46-アイテムをクリック) |
| **メイン** | 選択ハイライト | 現在選択中のアイテムをハイライト表示 | アイテム存在時 | [4.7](#47-検索入力欄で-enter-キー押下) |
| **メイン** | コンテキストメニュー | 右クリック時に表示されるアイテムメニュー | 右クリック時 | [4.10](#410-アイテムを右クリック) |
| **メイン** | 進捗バー | アイコン処理の進捗表示 | 処理実行中 | - |
| **オーバーレイ** | 登録モーダル | ドラッグ&ドロップ時の登録用モーダル | ドロップ時 | [4.12](#412-ドラッグドロップ操作) |
| **オーバーレイ** | ドラッグオーバーレイ | ドラッグ中の視覚的フィードバック | ドラッグ中 | [4.12](#412-ドラッグドロップ操作) |

## 4. アクション一覧

| No | アクション名 | トリガー | 主な処理内容 | 詳細 |
|----|------------|---------|------------|------|
| 4.1 | 検索入力欄への文字入力 | テキスト入力 | アイテムのリアルタイムフィルタリング | [詳細](#41-検索入力欄への文字入力) |
| 4.2 | 検索入力欄のクリアボタン押下 | クリアボタン（×）クリック | 入力内容をクリア、全アイテム表示 | [詳細](#42-検索入力欄のクリアボタン押下) |
| 4.3 | 更新メニュー操作 | 更新ボタン（🔄）クリック / メニュー選択 | データ再読み込み、アイコン取得、完全リフレッシュ | [詳細](#43-更新メニュー操作) |
| 4.4 | 固定ボタン押下 | 固定ボタン（📌）クリック | ウィンドウ固定状態の切り替え | [詳細](#44-固定ボタン押下) |
| 4.5 | 設定メニュー操作 | 設定ボタン（⚙）クリック / メニュー選択 / Ctrl+E | 基本設定、アイテム管理、JSON出力、終了 | [詳細](#45-設定メニュー操作) |
| 4.6 | アイテムをクリック | アイテムクリック | 選択アイテムの実行（開く） | [詳細](#46-アイテムをクリック) |
| 4.7 | 検索入力欄で Enter キー押下 | Enterキー | 選択中のアイテムを開く | [詳細](#47-検索入力欄で-enter-キー押下) |
| 4.8 | 検索入力欄で Shift+Enter キー押下 | Shift+Enterキー | 選択中のアイテムの親フォルダを開く | [詳細](#48-検索入力欄で-shiftenter-キー押下) |
| 4.9 | 検索入力欄で ArrowUp/ArrowDown キー押下 | ArrowUp/ArrowDownキー | アイテム選択の移動（循環） | [詳細](#49-検索入力欄で-arrowuparrowdown-キー押下) |
| 4.10 | アイテムを右クリック | アイテム右クリック | コンテキストメニュー表示 | [詳細](#410-アイテムを右クリック) |
| 4.11 | コンテキストメニューから「パスをコピー」選択 | メニュー項目選択 | アイテムパスをクリップボードにコピー | [詳細](#411-コンテキストメニューからパスをコピー選択) |
| 4.12 | コンテキストメニューから「親フォルダーのパスをコピー」選択 | メニュー項目選択 | アイテムの親フォルダーパスをクリップボードにコピー | [詳細](#412-コンテキストメニューから親フォルダーのパスをコピー選択) |
| 4.13 | ドラッグ&ドロップ操作 | ドラッグ / ドロップ操作 | ファイル・フォルダの登録 | [詳細](#413-ドラッグドロップ操作) |
| 4.14 | ウィンドウ表示時の初期化 | Ctrl+Alt+W（ホットキー） | データ読み込み、アイコン適用、画面初期化 | [詳細](#414-ウィンドウ表示時の初期化) |

## 5. 機能詳細

### 4.1. 検索入力欄への文字入力

#### アクション
- 検索入力欄に文字を入力

#### 処理フロー
1. 入力値変更時に`handleSearch`を実行
2. `filterItems`関数でアイテムをフィルタリング（アイテム名の部分一致、大文字小文字区別なし）
3. `selectedIndex`を0にリセット（最初のアイテムを選択）
4. フィルタリングされたアイテムリストを表示

#### 関連アクション
- ウィンドウ表示時に検索入力欄に自動フォーカス

### 4.2. 検索入力欄のクリアボタン押下

#### アクション
- 検索入力欄の「×」ボタンをクリック

#### 処理フロー
1. 入力内容をクリア
2. 全アイテムを表示
3. `selectedIndex`を0にリセット

#### 表示条件
- テキストが入力されている時のみ「×」ボタンを表示

### 4.3. 更新メニュー操作

#### アクション
- ヘッダーの更新ボタン（🔄）をクリックしてメニューを開き、メニュー項目を選択

#### メニュー項目と処理フロー

**📋 データ再読み込み:**
1. データファイル（data.txt）を再読み込み
2. パースしてアイテム配列に変換
3. アイコンキャッシュを適用
4. アイテムリストを更新
5. メニューを閉じる

**🎨 アイコン取得:**
1. アイコンが未取得のアイテムを検索
2. URLアイテムのファビコン取得を実行
3. 実行ファイル（.exe）のアイコン抽出を実行
4. 進捗バーで処理状況を表示
5. 完了後、メニューを閉じる

**🔄 完全リフレッシュ:**
1. データファイルを再読み込み
2. すべてのアイテムのアイコンを強制再取得（既存キャッシュを無視）
3. 進捗バーで処理状況を表示
4. 完了後、メニューを閉じる

#### 各メニュー項目の違い
- **データ再読み込み**: アイコンには影響せず、データファイルのみ再読み込み
- **アイコン取得**: データは再読み込みせず、未取得アイコンのみ取得
- **完全リフレッシュ**: データ再読み込み＋すべてのアイコンを強制再取得（最も包括的）

#### 共通動作
- メニュー外をクリックすると自動的にメニューを閉じる
- メニュー項目選択後は自動的にメニューを閉じる

### 4.4. 固定ボタン（📌）押下

#### アクション
- ヘッダーの固定ボタン（📌）をクリック

#### 処理フロー
1. 現在の固定状態を反転（固定 ⇔ 固定解除）
2. `window.electronAPI.setWindowPinState`でメインプロセスに状態を送信
3. ボタンに`pinned`クラスを適用/解除
4. ツールチップを更新（「ウィンドウ固定を解除」⇔「ウィンドウを固定」）

#### 動作
- **固定時**: フォーカスアウトしてもウィンドウが非表示にならない
- **固定解除時**: フォーカスアウトするとウィンドウが自動的に非表示になる

### 4.5. 設定メニュー操作

#### アクション
- ヘッダーの設定ボタン（⚙）をクリックしてメニューを開き、メニュー項目を選択
- または、Ctrl+Eキーを押下（アイテム管理へのショートカット）

#### メニュー項目と処理フロー

**⚙️ 基本設定:**
1. `openEditWindowWithTab('settings')`を実行
2. 管理ウィンドウを「設定」タブで開く
3. メニューを閉じる

**✏️ アイテム管理:**
1. `openEditWindowWithTab('edit')`を実行
2. 管理ウィンドウを「編集」タブで開く
3. メニューを閉じる
- **ショートカット**: Ctrl+Eキーでも同じ動作

**📋 JSON出力:**
1. 全アイテムデータをJSON形式にシリアライズ
2. `window.electronAPI.copyToClipboard`でクリップボードにコピー
3. 成功通知を表示
4. メニューを閉じる

**🚪 アプリを終了:**
1. `window.electronAPI.quitApp`を実行
2. アプリケーションを終了

#### 各メニュー項目の違い
- **基本設定**: ホットキー、ウィンドウサイズ等の設定変更
- **アイテム管理**: data.txtの内容を直接編集
- **JSON出力**: データのバックアップやエクスポート用
- **アプリを終了**: アプリケーションの終了

#### 共通動作
- メニュー外をクリックすると自動的にメニューを閉じる
- メニュー項目選択後は自動的にメニューを閉じる（アプリ終了を除く）

### 4.6. アイテムをクリック

#### アクション
- アイテムリスト内のアイテムをクリック

#### 処理フロー
1. `window.electronAPI.openItem(item)`を実行
2. アイテムの種別に応じて実行：
   - URL: デフォルトブラウザで開く
   - ファイル: 関連付けられたアプリで開く
   - フォルダ: エクスプローラーで開く
   - アプリケーション: 実行ファイルを起動
3. ウィンドウを非表示（固定されていない場合）

### 4.7. 検索入力欄で Enter キー押下

#### アクション
- 検索入力欄でEnterキーを押下

#### 処理フロー
1. 現在選択中のアイテム（`selectedIndex`）を取得
2. アイテムが存在する場合、`window.electronAPI.openItem(item)`を実行
3. アイテムの種別に応じて実行（4.6と同様）
4. ウィンドウを非表示（固定されていない場合）

#### エラーハンドリング
- アイテムが存在しない場合は何も実行しない

### 4.8. 検索入力欄で Shift+Enter キー押下

#### アクション
- 検索入力欄でShift+Enterキーを押下

#### 処理フロー
1. 現在選択中のアイテム（`selectedIndex`）を取得
2. `window.electronAPI.openParentFolder(item)`を実行
3. アイテムの親フォルダをエクスプローラーで開く
4. ウィンドウを非表示（固定されていない場合）

### 4.9. 検索入力欄で ArrowUp/ArrowDown キー押下

#### アクション
- 検索入力欄でArrowUpキーまたはArrowDownキーを押下

#### 処理フロー

**ArrowUpキー押下時:**
1. `selectedIndex`を1減らす
2. インデックスが0未満の場合、末尾のアイテムにループ
3. 選択中のアイテムをハイライト表示
4. 必要に応じてスクロール

**ArrowDownキー押下時:**
1. `selectedIndex`を1増やす
2. インデックスが末尾を超える場合、先頭のアイテムにループ
3. 選択中のアイテムをハイライト表示
4. 必要に応じてスクロール

#### 動作の違い
- **ArrowUp**: 選択を**上方向（前のアイテム）**に移動。先頭で押下すると末尾にループ
- **ArrowDown**: 選択を**下方向（次のアイテム）**に移動。末尾で押下すると先頭にループ

#### 共通動作
- どちらのキーも循環選択をサポート（リストの端に到達すると反対側にループ）
- 選択されたアイテムは自動的にビュー内にスクロール
- ハイライト表示により現在選択中のアイテムが視覚的に明確

### 4.10. アイテムを右クリック

#### アクション
- アイテムリスト内のアイテムを右クリック

#### 処理フロー
1. クリック位置（マウス座標）を取得
2. 画面端の場合は表示位置を自動調整
3. コンテキストメニューを表示
4. 以下のメニュー項目を表示：
   - 📋 パスをコピー
   - 📁 親フォルダーのパスをコピー

#### メニューを閉じる操作
- メニュー外をクリック
- Escapeキーを押下
- メニュー項目選択後は自動的に閉じる

### 4.11. コンテキストメニューから「パスをコピー」選択

#### アクション
- コンテキストメニューから「📋 パスをコピー」を選択

#### 処理フロー
1. 選択中のアイテムのパス（ファイルパス・URL等）を取得
2. `window.electronAPI.copyToClipboard`でクリップボードにコピー
3. 成功通知を表示
4. メニューを閉じる

#### エラーハンドリング
- コピー失敗時はアラート表示

### 4.12. コンテキストメニューから「親フォルダーのパスをコピー」選択

#### アクション
- コンテキストメニューから「📁 親フォルダーのパスをコピー」を選択

#### 処理フロー
1. 選択中のアイテムのタイプを確認
2. URLまたはカスタムURIの場合はエラーアラートを表示（親フォルダーが存在しないため）
3. ファイル、フォルダ、アプリケーションの場合：
   - アイテムのパスから最後のスラッシュ/バックスラッシュを検索
   - 親ディレクトリパスを抽出
   - `window.electronAPI.copyToClipboard`でクリップボードにコピー
   - 成功通知を表示
4. メニューを閉じる

#### 対応アイテムタイプ
- **対応**: ファイル、フォルダ、アプリケーション
- **非対応**: URL、カスタムURI（警告メッセージを表示）

#### コピー例
- `C:\Users\username\Documents\file.txt` → `C:\Users\username\Documents`
- `/home/user/files/app.exe` → `/home/user/files`

#### エラーハンドリング
- URLまたはカスタムURIの場合: 「URLおよびカスタムURIには親フォルダーがありません」と表示
- 親フォルダーパスの取得失敗時: 「親フォルダーのパスを取得できませんでした」と表示
- コピー失敗時: アラート表示

### 4.13. ドラッグ&ドロップ操作

#### アクション
- ファイルまたはフォルダをウィンドウにドラッグ&ドロップしてアイテム登録

#### 処理フロー

**ドラッグ中（ドロップ前）:**
1. `setIsDraggingOver(true)`で状態を更新
2. 半透明オーバーレイを表示
3. 「ファイルをドロップして登録」メッセージを表示
4. `dragging-over`クラスをアプリ全体に適用

**ドロップ時:**
1. `handleDrop`イベントでファイルを取得
2. `window.electronAPI.getPathForFile`でファイルパスを取得
3. 複数ファイルの場合はパス配列を作成
4. `RegisterModal`を開いて登録フローへ
5. `setIsDraggingOver(false)`でオーバーレイを非表示

#### 動作の違い
- **ドラッグ中**: 視覚的フィードバック（オーバーレイ・メッセージ）の表示
- **ドロップ時**: 実際の登録処理の開始

#### エラーハンドリング
- パス取得失敗時: アラート「ファイルパスを取得できませんでした」を表示

### 4.14. ウィンドウ表示時の初期化

#### アクション
- グローバルホットキー（Ctrl+Alt+W）でウィンドウを表示

#### 処理フロー
1. データファイル（data.txt）を読み込み
2. `parseDataFiles`でアイテム配列に変換
3. アイコンキャッシュを適用
4. アイテムリストを表示
5. 検索入力欄に自動フォーカス
6. `window.electronAPI.getWindowPinState`で固定状態を取得
7. 固定ボタンの状態を反映