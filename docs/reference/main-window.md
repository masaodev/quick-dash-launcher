# メインウィンドウ仕様書

## 関連ドキュメント

- [画面一覧](screen-list.md) - 全画面構成の概要
- [ブックマークインポートモーダル](bookmark-import-modal.md) - インポート機能詳細
- [編集モード](../features/edit-mode.md) - 編集機能の詳細

## 1. 概要

メインウィンドウは、QuickDashLauncherの中核となる検索・ランチャー画面です。グローバルホットキー（Ctrl+Alt+W）で呼び出され、アプリケーション、ファイル、フォルダ、URLに素早くアクセスできます。

**キーボードショートカット**: 
- Ctrl+Alt+W: ウィンドウ表示/非表示
- Ctrl+E: 編集モードへ切り替え
- Enter: 選択項目を開く
- Shift+Enter: 選択項目の親フォルダを開く
- Arrow Keys: 項目選択の移動

### 主要機能
- **リアルタイム検索**: 入力に応じてアイテムをリアルタイムフィルタリング
- **キーボードナビゲーション**: 矢印キーとEnterキーでアイテム選択・実行
- **タブ切り替え**: メインタブと一時タブでアイテム分類管理
- **ドラッグ&ドロップ登録**: ファイルやフォルダをドロップして簡単登録
- **ウィンドウ固定化**: 📌ボタンでフォーカスアウト時も非表示にならない設定

## 2. 基本情報

| 項目 | 内容 |
|------|------|
| **ファイル名** | `src/renderer/App.tsx` |
| **コンポーネント名** | `App` |
| **表示条件** | グローバルホットキー（Ctrl+Alt+W）押下時 |
| **画面タイプ** | メインウィンドウ |
| **親画面** | なし（ルートコンポーネント） |

## 3. 画面項目一覧

| エリア | 項目名 | 内容・説明 | 表示条件 | 機能詳細 |
|--------|--------|------------|----------|----------|
| **ヘッダー** | 検索入力欄 | アイテム検索用のテキスト入力欄 | 常時表示 | [4.1. 検索機能](#41-検索機能) |
| **ヘッダー** | アクションボタン群 | 各種操作ボタンを含むボタン群 | 常時表示 | [4.2. アクションボタン群](#42-アクションボタン群) |
| **ヘッダー** | タブコントロール | メインタブ・一時タブの切り替え | 常時表示 | [4.3. タブ切り替え](#43-タブ切り替え) |
| **メイン** | アイテムリスト | フィルタリングされたアイテム一覧表示 | 常時表示 | [4.4. アイテムリスト表示](#44-アイテムリスト表示) |
| **メイン** | 選択ハイライト | 現在選択中のアイテムをハイライト表示 | アイテム存在時 | [4.5. キーボードナビゲーション](#45-キーボードナビゲーション) |
| **オーバーレイ** | 登録モーダル | ドラッグ&ドロップ時の登録用モーダル | ドロップ時 | [4.6. ドラッグ&ドロップ登録](#46-ドラッグドロップ登録) |
| **オーバーレイ** | ドラッグオーバーレイ | ドラッグ中の視覚的フィードバック | ドラッグ中 | [4.7. ドラッグビジュアルフィードバック](#47-ドラッグビジュアルフィードバック) |

## 4. 機能詳細

### 4.1. 検索機能

#### 処理フロー
1. **リアルタイム検索**: 入力値変更時に`handleSearch`実行
2. **フィルタリング実行**: `filterItems`関数でアイテムをフィルタリング
3. **選択インデックス初期化**: 検索時は`selectedIndex`を0にリセット
4. **検索ボックスフォーカス**: ウィンドウ表示時に自動フォーカス

#### フィルタリング条件
- **対象フィールド**: アイテム名（name）
- **検索方式**: 部分一致
- **大文字小文字**: 区別なし

### 4.2. アクションボタン群

#### 含まれるボタン
- **ファビコン取得**: URLアイテムのファビコンを一括取得
- **アイコン抽出**: 実行ファイル等のアイコンを一括抽出
- **一時追加**: 検索クエリを一時アイテムとして追加
- **リロード**: データファイルの再読み込み
- **設定フォルダ**: 設定フォルダを開く
- **データファイル**: データファイルを開く
- **固定ピン**: ウィンドウ固定状態の切り替え
- **JSON出力**: アイテムデータをJSONでクリップボードに出力
- **編集モード**: 編集モードウィンドウへ切り替え

### 4.3. タブ切り替え

#### タブ種類
- **メインタブ**: `data.txt`と`data2.txt`のアイテム
- **一時タブ**: `tempdata.txt`のアイテム

#### 切り替え処理
- **状態管理**: `activeTab`ステートで現在のタブを管理
- **アイテム取得**: タブに応じて表示するアイテム配列を切り替え
- **選択状態リセット**: タブ切り替え時に`selectedIndex`を0に初期化

### 4.4. アイテムリスト表示

#### 表示内容
- **アイコン**: アイテム種別に応じたアイコン表示
- **名前**: アイテム名
- **パス情報**: ファイルパスまたはURL

#### アイコン取得
1. **キャッシュから取得**: 既存アイコンキャッシュから取得
2. **実行時抽出**: .exeファイルからアイコン抽出
3. **ファビコン取得**: URLからファビコン取得
4. **デフォルトアイコン**: 種別に応じたデフォルトアイコン使用

### 4.5. キーボードナビゲーション

#### キーボード操作
- **Enter**: 選択アイテムを開く
- **Shift+Enter**: 選択アイテムの親フォルダを開く
- **ArrowUp**: 前の項目を選択（循環）
- **ArrowDown**: 次の項目を選択（循環）
- **Ctrl+E**: 編集モードウィンドウを開く

#### エラーハンドリング
- **アイテム不存在**: アイテムが存在しない場合は何も実行しない
- **選択範囲外**: インデックスが範囲外の場合は先頭または末尾にループ

### 4.6. ドラッグ&ドロップ登録

#### 処理フロー
1. **ドロップ検出**: `handleDrop`イベントでファイル取得
2. **パス抽出**: `window.electronAPI.getPathForFile`でファイルパス取得
3. **パス配列作成**: 複数ファイルの場合は配列に格納
4. **モーダル表示**: `RegisterModal`を開いて登録フローへ

#### エラーハンドリング
- **パス取得失敗**: アラートで「ファイルパスを取得できませんでした」表示
- **ファイル不存在**: エクスプローラーから直接ドラッグするよう案内

### 4.7. ドラッグビジュアルフィードバック

#### 視覚的表現
- **オーバーレイ表示**: ドラッグ中は半透明オーバーレイを表示
- **メッセージ表示**: 「ファイルをドロップして登録」メッセージ
- **スタイル変更**: `dragging-over`クラスでアプリ全体のスタイル変更

#### 状態管理
- **ドラッグ開始**: `setIsDraggingOver(true)`
- **ドラッグ終了**: ドロップまたはリーブ時に`setIsDraggingOver(false)`

### 4.8. アイテム実行機能

#### 実行方法
- **クリック実行**: アイテムクリック時に`handleItemClick`実行
- **キーボード実行**: Enterキー押下時に実行
- **親フォルダ実行**: Shift+Enterで親フォルダを開く

#### 処理内容
- **メイン実行**: `window.electronAPI.openItem(item)`でアイテムを開く
- **親フォルダ実行**: `window.electronAPI.openParentFolder(item)`で親フォルダを開く

### 4.9. 一時アイテム追加機能

#### 実行条件
- 検索クエリが空でないこと

#### 処理フロー
1. **アイテム作成**: 検索クエリから新しい`LauncherItem`を作成
2. **種別判定**: URLパターン（://含む）の場合は'url'、それ以外は'file'
3. **配列更新**: 一時アイテム配列に追加
4. **ファイル保存**: `window.electronAPI.saveTempData`で永続化
5. **状態初期化**: 検索クエリをクリア

### 4.10. データ管理機能

#### 初期化処理
1. **データファイル読み込み**: `window.electronAPI.loadDataFiles()`
2. **パース処理**: `parseDataFiles`でアイテム配列に変換
3. **アイコン読み込み**: キャッシュされたアイコンを適用
4. **状態設定**: メイン・一時アイテムの状態を更新

#### リロード処理
- **手動リロード**: リロードボタン押下時に`loadItems`実行
- **登録後リロード**: アイテム登録後に自動リロード実行