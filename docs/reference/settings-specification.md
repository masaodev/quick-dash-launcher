# アプリケーション設定仕様

QuickDashLauncherの設定項目の完全な仕様です。

## 設定ファイル

### 保存場所

- **Windows**: `%APPDATA%/quick-dash-launcher/config/settings.json`
- **形式**: JSON
- **文字エンコーディング**: UTF-8

### 設定の適用タイミング

**v1.0.0以降**: すべての設定変更が「保存」ボタンなしで即座に反映されます。

- 設定項目を変更すると自動的に`settings.json`に保存されます
- `settings-changed`イベントが全ウィンドウに送信され、設定が即座に反映されます
- 再起動は不要です
- 例外: 一部のシステム統合設定（自動起動など）はOS再起動が必要な場合があります

## 設定項目一覧

### グローバルホットキー

| 項目 | 値 |
|------|-----|
| **キー** | `hotkey` |
| **型** | `string` |
| **デフォルト値** | `''` (空文字列) |
| **形式** | `<修飾キー>+<修飾キー>+<キー>` |
| **初回起動時** | 初回設定画面でユーザーが設定 |

#### 対応可能なキー

**修飾キー**:
- `Ctrl`
- `Alt`
- `Shift`
- `CmdOrCtrl`
- `Command`
- `Cmd`

**通常キー**:
- `A-Z` (アルファベット)
- `0-9` (数字)
- `F1-F12` (ファンクションキー)

#### 組み合わせ例

```
Alt+Space
Ctrl+Alt+Q
Ctrl+Shift+L
Alt+F1
Ctrl+Alt+0
```

#### バリデーションルール

- **必須**: 最低1つの修飾キーが必要
- **禁止**: システム予約キー（例: `Ctrl+Alt+Del`）
- **競合チェック**: 他のアプリケーションで使用中のキー組み合わせは登録不可

### ウィンドウサイズ設定

#### 通常時のウィンドウサイズ

| 項目 | 値 |
|------|-----|
| **幅キー** | `windowWidth` |
| **高さキー** | `windowHeight` |
| **型** | `number` |
| **幅デフォルト** | `600` |
| **高さデフォルト** | `400` |
| **幅範囲** | `400` ～ `2000` (px) |
| **高さ範囲** | `300` ～ `1200` (px) |

#### アイテム管理時のウィンドウサイズ

| 項目 | 値 |
|------|-----|
| **幅キー** | `editWindowWidth` |
| **高さキー** | `editWindowHeight` |
| **型** | `number` |
| **幅デフォルト** | `1000` |
| **高さデフォルト** | `700` |
| **幅範囲** | `800` ～ `2000` (px) |
| **高さ範囲** | `600` ～ `1200` (px) |

### 起動設定

#### 自動起動

| 項目 | 値 |
|------|-----|
| **キー** | `autoLaunch` |
| **型** | `boolean` |
| **デフォルト値** | `false` |
| **説明** | Windowsログイン時に自動起動 |

### バックアップ設定

#### バックアップ機能を有効にする

| 項目 | 値 |
|------|-----|
| **キー** | `backup.enabled` |
| **型** | `boolean` |
| **デフォルト値** | `false` |
| **説明** | バックアップ機能全体のON/OFF |

#### アプリ起動時にバックアップを作成

| 項目 | 値 |
|------|-----|
| **キー** | `backup.onStartup` |
| **型** | `boolean` |
| **デフォルト値** | `false` |
| **説明** | アプリ起動時に`data.txt`と`data2.txt`をバックアップ |

#### データ編集時にバックアップを作成

| 項目 | 値 |
|------|-----|
| **キー** | `backup.onEdit` |
| **型** | `boolean` |
| **デフォルト値** | `false` |
| **説明** | アイテム管理や生データ編集でデータ変更時にバックアップを作成 |

#### 最小バックアップ間隔

| 項目 | 値 |
|------|-----|
| **キー** | `backup.minInterval` |
| **型** | `number` |
| **デフォルト値** | `5` |
| **範囲** | `1` ～ `60` (分) |
| **説明** | 同一ファイルのバックアップ作成間隔の制限 |

#### バックアップ保存件数

| 項目 | 値 |
|------|-----|
| **キー** | `backup.maxCount` |
| **型** | `number` |
| **デフォルト値** | `20` |
| **範囲** | `1` ～ `100` (件) |
| **説明** | 各ファイルごとの最大保存件数。上限を超えると古いバックアップから削除 |

### タブ表示設定

複数のデータファイル（data.txt, data2.txt, data3.txt...）をタブで切り替える機能の設定です。

#### タブ表示の有効化

| 項目 | 値 |
|------|-----|
| **キー** | `showDataFileTabs` |
| **型** | `boolean` |
| **デフォルト値** | `false` |
| **説明** | メインウィンドウで複数データファイルをタブ表示するかどうか |

- **`true`**: メインウィンドウに各データファイルのタブが表示され、クリックで切り替え可能
- **`false`**: data.txtのみが表示される（従来の動作）

#### デフォルトタブ

| 項目 | 値 |
|------|-----|
| **キー** | `defaultFileTab` |
| **型** | `string` |
| **デフォルト値** | `'data.txt'` |
| **説明** | アプリ起動時に最初に表示するタブのファイル名 |

- タブ表示が有効な場合のみ使用されます
- 指定したファイルが存在しない場合は、自動的にdata.txtが選択されます
- 存在しないファイル名を指定しても、エラーにはなりません（フォールバック処理が動作）

#### データファイルタブの設定

| 項目 | 値 |
|------|-----|
| **キー** | `dataFileTabs` |
| **型** | `DataFileTab[]` (配列) |
| **デフォルト値** | `[{ file: 'data.txt', name: 'メイン' }]` |
| **説明** | データファイルのタブ名と表示順序を管理 |

**型定義:**
```typescript
interface DataFileTab {
  file: string;  // データファイル名（例: 'data.txt', 'data2.txt'）
  name: string;  // タブに表示する名前（例: 'メイン', 'サブ1'）
}
```

**設定例:**
```json
{
  "dataFileTabs": [
    { "file": "data.txt", "name": "仕事用" },
    { "file": "data2.txt", "name": "プライベート" },
    { "file": "data3.txt", "name": "学習" }
  ]
}
```

**動作仕様:**
- **配列の順序 = 表示順序**: 配列内の要素の順序がそのままタブの表示順序になります
- **タブ表示の基準**: `dataFileTabs`配列に含まれるファイル名のみがタブとして表示されます
- **物理ファイルとの関係**:
  - 配列に含まれているファイル名の物理ファイルが存在しない場合、自動的に作成されます
  - 物理ファイルが存在しても、`dataFileTabs`配列に含まれていない場合はタブに表示されません
- **デフォルトタブ名**:
  - `name`フィールドが空文字列の場合、ファイル名に応じたデフォルト名が表示されます
    - `data.txt` → 「メイン」
    - `data2.txt` → 「サブ1」
    - `data3.txt` → 「サブ2」
    - `data4.txt` → 「サブ3」（以降同様）

**即座反映**:
- タブ名や順序を変更すると自動的に保存され、`settings-changed`イベントが送信されます
- メインウィンドウが開いている場合、タブ名と順序がリアルタイムに更新されます

**ファイル管理との連携**:
- データファイル追加時: 新しい`{ file, name }`エントリが配列に自動的に追加されます
- データファイル削除時: 該当するエントリが配列から自動的に削除されます
- タブ順序変更時: 設定画面の▲▼ボタンで配列内の要素順序を変更できます

### 初回起動判定

初回起動かどうかは、`hotkey`設定項目が空文字列または未設定かどうかで判定されます。

#### 判定ロジック
- **`hotkey`が空または未設定**: 初回起動と判定 → 初回設定画面を表示
- **`hotkey`に値がある**: 通常起動と判定 → メインウィンドウを表示

#### 実装詳細
```typescript
// src/main/main.ts
const hotkey = await settingsService.get('hotkey');
isFirstLaunch = !hotkey || hotkey.trim() === '';
```

#### 開発者向け情報
- 以前のバージョンでは`firstLaunchCompleted`フラグを使用していましたが、v0.2.9以降は`hotkey`の有無で判定するように変更されました
- 初回設定画面をスキップしたい場合は、`hotkey`に任意の値を設定してください

### バックアップファイル

#### 保存場所

- **Windows**: `%APPDATA%/quick-dash-launcher/config/backup/`

#### ファイル名形式

```
<元ファイル名>_<タイムスタンプ>.txt
```

**例**:
```
data_2024-01-01T12-00-00.txt
data2_2024-01-01T12-00-00.txt
```

#### タイムスタンプ形式

- **形式**: ISO 8601準拠
- **パターン**: `YYYY-MM-DDTHH-mm-ss`
- **タイムゾーン**: ローカル時刻

## バリデーションルール

### ホットキー

1. **形式チェック**: `<修飾キー>+<キー>` の形式に準拠
2. **修飾キー必須**: 最低1つの修飾キーが含まれている
3. **利用可能性チェック**: システムレベルでの登録可否を確認
4. **競合チェック**: 既存のアプリケーションとの重複を検出

### 数値範囲

各数値設定項目は指定された範囲内に収まる必要があります。範囲外の値は保存時にエラーとなります。

| 設定項目 | 最小値 | 最大値 |
|---------|-------|-------|
| `windowWidth` | 400 | 2000 |
| `windowHeight` | 300 | 1200 |
| `editWindowWidth` | 800 | 2000 |
| `editWindowHeight` | 600 | 1200 |
| `backup.minInterval` | 1 | 60 |
| `backup.maxCount` | 1 | 100 |

## 設定ファイルのサンプル

```json
{
  "hotkey": "Alt+Space",
  "windowWidth": 600,
  "windowHeight": 400,
  "editModeWidth": 1200,
  "editModeHeight": 700,
  "autoLaunch": false,
  "backupEnabled": false,
  "backupOnStart": false,
  "backupOnEdit": false,
  "backupInterval": 5,
  "backupRetention": 20,
  "showDataFileTabs": false,
  "defaultFileTab": "data.txt",
  "dataFileTabs": [
    { "file": "data.txt", "name": "仕事用" },
    { "file": "data2.txt", "name": "プライベート" }
  ]
}
```

**注**:
- 初回起動時は`hotkey`が空文字列（`""`）で保存されています。初回設定画面で設定すると、デフォルトでは`"Alt+Space"`が設定されます。
- タブ表示関連の設定は、`showDataFileTabs`が`true`の場合のみ有効です。
- **v1.0.0以降**: すべての設定変更は自動保存され、「保存」ボタンは不要です。

## 関連ドキュメント

- **[アプリケーション設定](../manual/app-settings.md)** - 設定方法とトラブルシューティング
- **[キーボードショートカット](keyboard-shortcuts.md)** - 利用可能なショートカット一覧
