# フォルダ取込オプションエディタ仕様書

## 関連ドキュメント

- [画面一覧](./README.md) - 全画面構成の概要
- [アイテム登録・編集モーダル](./register-modal.md) - 親モーダル
- [フォルダ取込](../features/folder-import.md) - フォルダ取込機能の詳細

## 1. 概要

フォルダ取込オプションエディタ（DirOptionsEditor）は、フォルダ取込アイテムの詳細設定を行うためのフォームコンポーネントです。RegisterModalで種別「🗂️ フォルダ取込」を選択したときに表示されます。

### 主要機能
- **階層深度設定**: サブディレクトリをどこまで探索するかを指定
- **取得タイプ設定**: ファイルのみ、フォルダーのみ、両方を選択
- **フィルター設定**: ワイルドカードでファイル名をフィルタリング
- **除外パターン設定**: 特定のパターンを除外
- **表示名カスタマイズ**: プレフィックス、サフィックスを追加

## 2. 基本情報

| 項目 | 内容 |
|------|------|
| **ファイル名** | `src/renderer/components/DirOptionsEditor.tsx` |
| **コンポーネント名** | `DirOptionsEditor` |
| **表示条件** | RegisterModalで種別「フォルダ取込」選択時 |
| **コンポーネントタイプ** | インラインフォーム |
| **親画面** | RegisterModal |

## 3. Props

| プロパティ | 型 | 必須 | 説明 |
|-----------|------|:----:|------|
| `dirOptions` | `RegisterItem['dirOptions']` | ○ | 現在のオプション値 |
| `onChange` | `(newDirOptions: RegisterItem['dirOptions']) => void` | ○ | オプション変更時のコールバック |

### dirOptions型

```typescript
interface DirOptions {
  depth: number;           // 階層深度（0: 現在のみ、-1: 無制限）
  types: 'file' | 'folder' | 'both';  // 取得タイプ
  filter?: string;         // フィルターパターン
  exclude?: string;        // 除外パターン
  prefix?: string;         // プレフィックス
  suffix?: string;         // サフィックス
}
```

## 4. 画面項目一覧

| 項目名 | ラベル表記 | 入力タイプ | デフォルト | 説明 | 機能詳細 |
|--------|-----------|-----------|-----------|------|----------|
| 階層深度 | 階層深度: | ドロップダウン | 0 | サブディレクトリの探索深度 | [4.1](#41-階層深度を変更) |
| 取得タイプ | 取得タイプ: | ドロップダウン | both | 取得するアイテムの種類 | [4.2](#42-取得タイプを変更) |
| フィルター | フィルター (例: *.txt): | テキスト入力 | なし | ファイル名のフィルターパターン | [4.3](#43-フィルターを入力) |
| 除外パターン | 除外パターン (例: temp*): | テキスト入力 | なし | 除外するファイル名パターン | [4.4](#44-除外パターンを入力) |
| プレフィックス | プレフィックス (例: 仕事): | テキスト入力 | なし | アイテム名の前に付ける文字列 | [4.5](#45-プレフィックスを入力) |
| サフィックス | サフィックス (例: Dev): | テキスト入力 | なし | アイテム名の後に付ける文字列 | [4.6](#46-サフィックスを入力) |

## 5. 機能詳細

### 4.1. 階層深度を変更

#### アクション
- 階層深度ドロップダウンで選択肢を変更

#### 選択肢

| 値 | 表示 | 説明 |
|-----|------|------|
| `0` | 現在のフォルダのみ | 指定フォルダ直下のみ |
| `1` | 1階層下まで | サブフォルダー1階層まで |
| `2` | 2階層下まで | サブフォルダー2階層まで |
| `3` | 3階層下まで | サブフォルダー3階層まで |
| `-1` | 無制限 | 全てのサブフォルダー |

#### 処理フロー
1. 選択値を数値に変換
2. 階層深度の設定を更新

### 4.2. 取得タイプを変更

#### アクション
- 取得タイプドロップダウンで選択肢を変更

#### 選択肢

| 値 | 表示 | 説明 |
|------|------|------|
| `file` | ファイルのみ | ファイルのみを取得 |
| `folder` | フォルダーのみ | フォルダーのみを取得 |
| `both` | ファイルとフォルダー | 両方を取得 |

#### 処理フロー
1. 選択値を取得
2. 取得タイプの設定を更新

### 4.3. フィルターを入力

#### アクション
- フィルター入力欄にテキストを入力

#### 入力形式
- ワイルドカードパターン（例: `*.txt`, `*.exe`, `readme*`）

#### プレースホルダー
- 「ワイルドカードパターン」

#### 処理フロー
1. 入力値を取得
2. 空文字の場合は設定なしとして扱う
3. フィルター設定を更新

#### 使用例
- `*.txt` - テキストファイルのみ
- `*.exe` - 実行ファイルのみ
- `doc*` - docで始まるファイル

### 4.4. 除外パターンを入力

#### アクション
- 除外パターン入力欄にテキストを入力

#### 入力形式
- ワイルドカードパターン（例: `temp*`, `*.bak`, `~*`）

#### プレースホルダー
- 「除外するパターン」

#### 処理フロー
1. 入力値を取得
2. 空文字の場合は設定なしとして扱う
3. 除外パターン設定を更新

#### 使用例
- `temp*` - tempで始まるファイルを除外
- `*.bak` - バックアップファイルを除外
- `~*` - 一時ファイルを除外

### 4.5. プレフィックスを入力

#### アクション
- プレフィックス入力欄にテキストを入力

#### 説明
- 展開されるアイテムの表示名の前に付ける文字列

#### プレースホルダー
- 「アイテム名の前に付ける文字」

#### 処理フロー
1. 入力値を取得
2. 空文字の場合は設定なしとして扱う
3. プレフィックス設定を更新

#### 使用例
- `仕事` → 「仕事: ファイル名」として表示
- `[重要]` → 「[重要]ファイル名」として表示

### 4.6. サフィックスを入力

#### アクション
- サフィックス入力欄にテキストを入力

#### 説明
- 展開されるアイテムの表示名の後に付ける文字列

#### プレースホルダー
- 「アイテム名の後に付ける文字」

#### 処理フロー
1. 入力値を取得
2. 空文字の場合は設定なしとして扱う
3. サフィックス設定を更新

#### 使用例
- `_Dev` → 「ファイル名_Dev」として表示
- ` (開発用)` → 「ファイル名 (開発用)」として表示

## 6. 表示条件

コンポーネントは`dirOptions`がnullまたはundefinedの場合、何も表示しません。

```typescript
if (!dirOptions) return null;
```

## 7. スタイル

### 主要なCSSクラス

| クラス名 | 説明 |
|---------|------|
| `.dir-options` | オプションエディタのコンテナ |
| `.form-group` | 各入力項目のグループ |

### レイアウト

- 各入力項目は縦に並べて配置
- ラベルと入力フィールドは縦並び
- RegisterModalの他のフォーム項目と同じスタイルを使用

## 8. データ形式との対応

### data.txtでの表記

フォルダ取込アイテムは以下の形式でdata.txtに保存されます:

```
dir,パス[,オプション...]
```

### オプションの変換

| UIフィールド | data.txt形式 |
|-------------|-------------|
| 階層深度 | `depth=数値` |
| 取得タイプ | `types=file\|folder\|both` |
| フィルター | `filter=パターン` |
| 除外パターン | `exclude=パターン` |
| プレフィックス | `prefix=文字列` |
| サフィックス | `suffix=文字列` |

### 例

```
dir,C:\Projects,depth=1,types=file,filter=*.txt,prefix=仕事
```

この設定は:
- `C:\Projects`フォルダーを対象
- 1階層下まで探索
- ファイルのみ取得
- .txtファイルのみフィルター
- 表示名に「仕事: 」プレフィックスを付加

## 9. 使用例

```tsx
<DirOptionsEditor
  dirOptions={{
    depth: 1,
    types: 'both',
    filter: '*.txt',
    exclude: 'temp*',
    prefix: '仕事',
    suffix: undefined,
  }}
  onChange={(newOptions) => {
    // オプションが変更された
    console.log(newOptions);
  }}
/>
```
