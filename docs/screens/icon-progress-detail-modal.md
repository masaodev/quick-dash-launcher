# アイコン取得進捗詳細モーダル仕様書

## 関連ドキュメント

- [画面一覧](./README.md) - 全画面構成の概要
- [メインウィンドウ](./main-window.md) - メイン画面の詳細仕様
- [アイコンシステム](../features/icons.md) - アイコン機能の詳細

## 1. 概要

アイコン取得進捗詳細モーダル（IconProgressDetailModal）は、アイコン一括取得の結果を詳細に表示するためのモーダルダイアログです。成功したアイテムとエラーが発生したアイテムを確認できます。

### 主要機能
- **結果サマリー表示**: 成功件数、エラー件数、全体件数を一目で確認
- **フィルター機能**: すべて/成功/エラーで結果を絞り込み
- **詳細結果リスト**: 各アイテムの処理結果を一覧表示
- **エラーメッセージ表示**: エラー発生時の原因を確認

## 2. 基本情報

| 項目 | 内容 |
|------|------|
| **ファイル名** | `src/renderer/components/IconProgressDetailModal.tsx` |
| **コンポーネント名** | `IconProgressDetailModal` |
| **スタイル** | `src/renderer/styles/components/IconProgressDetailModal.css` |
| **表示条件** | アイコン一括取得完了後、進捗バーのクリックまたは詳細ボタン |
| **モーダルタイプ** | オーバーレイ型モーダル |
| **親画面** | メインウィンドウ |

## 3. Props

| プロパティ | 型 | 必須 | 説明 |
|-----------|------|:----:|------|
| `isOpen` | `boolean` | ○ | モーダルの表示状態 |
| `onClose` | `() => void` | ○ | 閉じる時のコールバック |
| `results` | `IconProgressResult[]` | ○ | アイコン取得結果の配列 |

### IconProgressResult型

```typescript
interface IconProgressResult {
  itemName: string;    // アイテム名（複数行の場合あり）
  success: boolean;    // 成功/失敗
  errorMessage?: string; // エラーメッセージ（失敗時のみ）
}
```

## 4. 画面項目一覧

| エリア | 項目名 | 内容・説明 | 表示条件 | 機能詳細 |
|--------|--------|------------|----------|----------|
| **ヘッダー** | タイトル | 「アイコン取得結果」 | 常時表示 | - |
| **ヘッダー** | 閉じるボタン（×） | モーダルを閉じる | 常時表示 | [4.1](#41-閉じるボタンをクリック) |
| **サマリー** | 成功件数 | 成功したアイテムの件数 | 常時表示 | - |
| **サマリー** | エラー件数 | 失敗したアイテムの件数 | 常時表示 | - |
| **サマリー** | 全体件数 | 処理した全アイテムの件数 | 常時表示 | - |
| **フィルター** | すべてボタン | 全結果を表示 | 常時表示 | [4.2](#42-フィルターボタンをクリック) |
| **フィルター** | 成功ボタン | 成功結果のみ表示 | 常時表示 | [4.2](#42-フィルターボタンをクリック) |
| **フィルター** | エラーボタン | エラー結果のみ表示 | 常時表示 | [4.2](#42-フィルターボタンをクリック) |
| **リスト** | 結果一覧 | フィルター適用後の結果リスト | 常時表示 | - |
| **リスト** | 結果アイテム（成功） | 成功アイコン（✓）+ アイテム名 | 成功結果 | - |
| **リスト** | 結果アイテム（エラー） | エラーアイコン（✗）+ アイテム名 + エラーメッセージ | エラー結果 | - |
| **リスト** | 空結果メッセージ | 「結果がありません」 | 結果が0件の場合 | - |
| **フッター** | 閉じるボタン | モーダルを閉じる | 常時表示 | [4.1](#41-閉じるボタンをクリック) |

## 5. アクション一覧

| No | アクション名 | トリガー | 主な処理内容 | 詳細 |
|----|------------|---------|------------|------|
| 4.1 | 閉じるボタンをクリック | ボタンクリック/オーバーレイクリック | モーダルを閉じる | [詳細](#41-閉じるボタンをクリック) |
| 4.2 | フィルターボタンをクリック | フィルターボタンクリック | 結果のフィルタリング | [詳細](#42-フィルターボタンをクリック) |

## 6. 機能詳細

### 4.1. 閉じるボタンをクリック

#### アクション
- ヘッダーの「×」ボタン、フッターの「閉じる」ボタン、またはオーバーレイをクリック

#### 処理フロー
1. モーダルを閉じる
2. ウィンドウサイズを元に戻す

### 4.2. フィルターボタンをクリック

#### アクション
- 「すべて」「成功」「エラー」のいずれかのフィルターボタンをクリック

#### 処理フロー
1. クリックしたボタンに応じてフィルター状態を更新
2. フィルター適用後の結果を表示

#### フィルターロジック
- 「すべて」: 全結果を表示
- 「成功」: 成功結果のみ表示
- 「エラー」: エラー結果のみ表示

#### ボタン表示
各ボタンには件数が表示されます:
- 「すべて (N)」
- 「成功 (N)」
- 「エラー (N)」

## 7. ウィンドウサイズ

### モーダル表示時のサイズ調整

モーダルが開かれたとき、十分な結果を表示できるようウィンドウサイズが自動的に拡大されます。

| 状態 | 幅 | 高さ |
|------|-----|------|
| モーダル表示時 | 800px | 700px |
| モーダル閉じた後 | 設定値に復帰 | 設定値に復帰 |

## 8. スタイル

### 主要なCSSクラス

| クラス名 | 説明 |
|---------|------|
| `.icon-detail-modal` | モーダルコンテナ |
| `.modal-header` | ヘッダーエリア |
| `.modal-close-btn` | 閉じるボタン（×） |
| `.modal-summary` | サマリー表示エリア |
| `.summary-item` | サマリー項目 |
| `.summary-item.success` | 成功件数 |
| `.summary-item.error` | エラー件数 |
| `.summary-item.total` | 全体件数 |
| `.filter-buttons` | フィルターボタンエリア |
| `.filter-btn` | フィルターボタン |
| `.filter-btn.active` | 選択中のフィルターボタン |
| `.results-list` | 結果リストエリア |
| `.result-item` | 結果アイテム |
| `.result-item.success` | 成功アイテム |
| `.result-item.error` | エラーアイテム |
| `.result-icon` | 結果アイコン（✓/✗） |
| `.result-content` | 結果内容 |
| `.result-name` | アイテム名 |
| `.result-error` | エラーメッセージ |
| `.no-results` | 空結果メッセージ |

### 閉じるボタン（×）のスタイル

```css
.modal-close-btn {
  background: none;
  border: none;
  color: var(--text-muted);
  font-size: 24px;
  font-weight: bold; /* 太字で視認性向上 */
  line-height: 1;
  cursor: pointer;
  padding: var(--spacing-xs);
  border-radius: 50%; /* 丸いボタン */
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.modal-close-btn:hover {
  background-color: var(--color-gray-600);
  color: var(--color-white);
  transform: scale(1.1); /* ホバー時に拡大 */
}

.modal-close-btn:active {
  background-color: var(--color-gray-700);
  transform: scale(0.95); /* クリック時に縮小 */
}
```

**デザインの特徴:**
- 丸いボタンデザインで他の×ボタンと統一
- ホバー時に背景色が変化してスケールアップ
- クリック時の視覚的フィードバック
- グレー系の色で削除系ボタンと区別

詳細は **[CSSデザインシステム - 閉じる・削除ボタンクラス](../architecture/css-design.md#閉じる削除ボタンクラス)** を参照してください。

### 結果アイテムの表示

#### 成功アイテム
- 緑色系の背景
- 「✓」アイコン
- アイテム名のみ表示

#### エラーアイテム
- 赤色系の背景
- 「✗」アイコン
- アイテム名とエラーメッセージを表示

### アイテム名の改行対応

アイテム名に改行が含まれる場合、適切に改行して表示されます。

## 9. 使用例

```tsx
<IconProgressDetailModal
  isOpen={showDetail}
  onClose={() => setShowDetail(false)}
  results={[
    { itemName: 'Google', success: true },
    { itemName: 'Twitter', success: true },
    { itemName: '無効なURL', success: false, errorMessage: 'ファビコンの取得に失敗しました' },
  ]}
/>
```

## 10. 関連処理

### アイコン一括取得との連携

アイコン一括取得処理（メインウィンドウの🔄メニュー）の完了後、このモーダルで結果を確認できます。

1. アイコン一括取得を実行
2. 進捗バーが表示され、処理が進行
3. 完了後、詳細ボタンまたは進捗バーをクリック
4. IconProgressDetailModalが表示される
