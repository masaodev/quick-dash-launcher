# アイテム登録・編集モーダル仕様書

## 関連ドキュメント

- [画面一覧](./README.md) - 全画面構成の概要
- [メインウィンドウ](./main-window.md) - メイン画面の詳細仕様
- [管理ウィンドウ](./admin-window.md) - 管理画面の詳細仕様
- [グループ起動](../features/group-launch.md) - グループ機能の詳細
- [フォルダ取込](../features/folder-import.md) - フォルダ取込機能の詳細

## 1. 概要

アイテム登録・編集モーダル（RegisterModal）は、ランチャーに新しいアイテムを追加したり、既存アイテムを編集するためのモーダルダイアログです。単一アイテム、フォルダ取込、グループの3種類のアイテムを扱うことができます。

**キーボードショートカット**: Escapeキーでモーダルを閉じることができます（編集中の内容は破棄されます）。

### 主要機能
- **アイテム登録**: ファイル、URL、フォルダ、カスタムURIなどを新規登録
- **アイテム編集**: 既存アイテムの名前、パス、引数、保存先を変更
- **種別切り替え**: 単一アイテム、フォルダ取込、グループの3種類を選択
- **ドラッグ&ドロップ対応**: ファイルやフォルダのドロップで自動登録
- **カスタムアイコン**: アイテムごとにカスタムアイコンを設定可能
- **保存先タブ選択**: 複数タブ環境で保存先を指定

## 2. 基本情報

| 項目 | 内容 |
|------|------|
| **ファイル名** | `src/renderer/components/RegisterModal.tsx` |
| **コンポーネント名** | `RegisterModal` |
| **スタイル** | `src/renderer/styles/components/RegisterModal.css` |
| **表示条件** | 下記トリガーのいずれか |
| **モーダルタイプ** | オーバーレイ型モーダル |
| **親画面** | メインウィンドウ、管理ウィンドウ（EditModeView） |

### 表示トリガー

| トリガー | モード | 説明 |
|----------|--------|------|
| ➕ボタンクリック（メインウィンドウ） | 登録モード | 空のフォームを表示 |
| ファイル/フォルダをドラッグ&ドロップ | 登録モード | ドロップ内容で初期化 |
| ✏️ボタンクリック（管理ウィンドウ） | 編集モード | 既存アイテムで初期化 |
| コンテキストメニュー「編集」 | 編集モード | 既存アイテムで初期化 |

## 3. 画面項目一覧

| エリア | 項目名 | 内容・説明 | 表示条件 | 機能詳細 |
|--------|--------|------------|----------|----------|
| **ヘッダー** | タイトル | 登録モード:「アイテムの登録」<br>編集モード:「アイテムの編集」 | 常時表示 | - |
| **アイテムヘッダー** | アイコンプレビュー | アイテムのアイコンを表示 | アイコンがある場合 | - |
| **フォーム** | 種別ドロップダウン | 📄単一アイテム / 🗂️フォルダ取込 / 📦グループ | 常時表示 | [4.1](#41-種別を変更) |
| **フォーム** | 名前入力欄 | アイテムの表示名を入力 | 種別が単一アイテムまたはグループの場合 | [4.2](#42-名前を入力) |
| **フォーム** | パス入力欄 | ファイルパス、URL、カスタムURIを入力 | 種別が単一アイテムまたはフォルダ取込の場合 | [4.3](#43-パスを入力) |
| **フォーム** | 引数入力欄 | コマンドライン引数を入力 | 種別が単一アイテムの場合 | [4.4](#44-引数を入力) |
| **フォーム** | ウィンドウ設定セクション | ウィンドウ検索・位置・サイズの設定 | 種別が単一アイテムの場合 | [4.5](#45-ウィンドウ設定を入力) |
| **フォーム** | フォルダ取込オプション | DirOptionsEditorコンポーネント | 種別がフォルダ取込の場合 | [4.6](#46-フォルダ取込オプションを設定) |
| **フォーム** | グループアイテムリスト | 選択されたアイテム名のチップリスト | 種別がグループの場合 | [4.6](#46-グループアイテムを管理) |
| **フォーム** | 「+ アイテムを追加」ボタン | グループアイテム選択モーダルを開く | 種別がグループの場合 | [4.7](#47-グループアイテムを追加) |
| **フォーム** | 保存先タブドロップダウン | 保存先のタブを選択 | 常時表示 | [4.8](#48-保存先タブを変更) |
| **フォーム** | 保存先ファイルドロップダウン | 保存先のファイルを選択 | タブに複数ファイルがある場合 | [4.9](#49-保存先ファイルを変更) |
| **フォーム** | カスタムアイコンセクション | アイコンプレビュー、選択/削除ボタン | 種別がフォルダ取込以外の場合 | [4.10](#410-カスタムアイコンを設定) |
| **フッター** | キャンセルボタン | モーダルを閉じる | 常時表示 | [4.11](#411-キャンセルボタンをクリック) |
| **フッター** | 登録/更新ボタン | 登録モード:「登録」<br>編集モード:「更新」 | 常時表示 | [4.12](#412-登録更新ボタンをクリック) |
| **エラー表示** | エラーメッセージ | バリデーションエラーを各項目下に表示 | エラーがある場合 | - |

## 4. アクション一覧

| No | アクション名 | トリガー | 主な処理内容 | 詳細 |
|----|------------|---------|------------|------|
| 4.1 | 種別を変更 | 種別ドロップダウン変更 | フォーム項目の表示切り替え | [詳細](#41-種別を変更) |
| 4.2 | 名前を入力 | テキスト入力 | アイテム名の更新 | [詳細](#42-名前を入力) |
| 4.3 | パスを入力 | テキスト入力 | パス/URL/URIの更新、タイプ自動検出 | [詳細](#43-パスを入力) |
| 4.4 | 引数を入力 | テキスト入力 | コマンドライン引数の更新 | [詳細](#44-引数を入力) |
| 4.5 | ウィンドウ設定を入力 | テキスト/数値入力、ボタンクリック | ウィンドウ制御設定の更新 | [詳細](#45-ウィンドウ設定を入力) |
| 4.6 | フォルダ取込オプションを設定 | オプション変更 | dirOptionsの更新 | [詳細](#46-フォルダ取込オプションを設定) |
| 4.7 | グループアイテムを管理 | 削除ボタンクリック | グループメンバーの削除 | [詳細](#47-グループアイテムを管理) |
| 4.8 | グループアイテムを追加 | 追加ボタンクリック | 選択モーダルを開く | [詳細](#48-グループアイテムを追加) |
| 4.9 | 保存先タブを変更 | ドロップダウン変更 | 保存先タブの更新 | [詳細](#49-保存先タブを変更) |
| 4.10 | 保存先ファイルを変更 | ドロップダウン変更 | 保存先ファイルの更新 | [詳細](#410-保存先ファイルを変更) |
| 4.11 | カスタムアイコンを設定 | ファイル選択/削除 | カスタムアイコンの管理 | [詳細](#411-カスタムアイコンを設定) |
| 4.12 | キャンセルボタンをクリック | ボタンクリック | モーダルを閉じる | [詳細](#412-キャンセルボタンをクリック) |
| 4.13 | 登録/更新ボタンをクリック | ボタンクリック | バリデーションと登録/更新処理 | [詳細](#413-登録更新ボタンをクリック) |

## 5. 機能詳細

### 4.1. 種別を変更

#### アクション
- 種別ドロップダウンで「📄 単一アイテム」「🗂️ フォルダ取込」「📦 グループ」のいずれかを選択

#### 処理フロー
1. 選択した種別に応じてフォーム項目を切り替え
2. 種別固有の初期値を設定

#### 種別ごとの表示項目

| 項目 | 単一アイテム | フォルダ取込 | グループ |
|------|:-----------:|:-----------:|:--------:|
| 名前 | ○ | - | ○ |
| パス | ○ | ○ | - |
| 引数 | ○ | - | - |
| フォルダ取込オプション | - | ○ | - |
| グループアイテムリスト | - | - | ○ |
| カスタムアイコン | ○ | - | ○ |

#### 種別変更時の初期化処理

**フォルダ取込に変更時:**
- フォルダ処理モードを「展開」に設定
- フォルダ取込オプションをデフォルト値で初期化
- グループ関連の情報をクリア

**グループに変更時:**
- グループアイテムリストを空で初期化
- フォルダ取込関連の情報をクリア

**単一アイテムに変更時:**
- フォルダ取込関連の情報をクリア
- グループ関連の情報をクリア

### 4.2. 名前を入力

#### アクション
- 名前入力欄にテキストを入力

#### 処理フロー
1. 入力値を取得
2. アイテムの名前を更新
3. 入力時にエラー状態をクリア

#### プレースホルダー
- 単一アイテム: 「表示名を入力」
- グループ: 「グループ名を入力」

#### バリデーション
- **単一アイテム**: 必須（空の場合「名前を入力してください」）
- **グループ**: 必須（空の場合「グループ名を入力してください」）
- **フォルダ取込**: 不要（表示されない）

### 4.3. パスを入力

#### アクション
- パス入力欄にファイルパス、URL、カスタムURIを入力

#### 処理フロー
1. 入力値を取得
2. アイテムのパスを更新
3. アイテムタイプを自動検出
4. タイプに応じてデフォルト値を設定
5. 入力時にエラー状態をクリア

#### アイテムタイプの自動検出
| 入力パターン | 検出タイプ |
|-------------|-----------|
| `http://` または `https://` | `url` |
| `C:\` などのローカルパス（フォルダ） | `folder` |
| `C:\` などのローカルパス（ファイル） | `file` |
| `*.exe` ファイル | `exe` |
| `obsidian://` などカスタムURI | `custom-uri` |

#### フォルダ検出時の追加処理
- フォルダ処理モードを「フォルダを開く」に設定（`folderProcessing: 'folder'`）
- フォルダ取込オプションをデフォルト値で初期化

#### folderProcessingの値

| 値 | 説明 | 対応する種別 |
|----|------|-------------|
| `'folder'` | フォルダを開く（単一アイテムとして登録） | 単一アイテム |
| `'expand'` | フォルダ取込（フォルダ内容を展開して取得） | フォルダ取込 |

#### プレースホルダー
- 「ファイルパス、URL、またはカスタムURIを入力」

#### 読み取り専用条件
- ドラッグ&ドロップで開いた場合、パスは読み取り専用（編集不可）

#### バリデーション
- **単一アイテム/フォルダ取込**: 必須（空の場合「パスを入力してください」）
- **グループ**: 不要（表示されない）

### 4.4. 引数を入力

#### アクション
- 引数入力欄にコマンドライン引数を入力

#### 処理フロー
1. 入力値を取得
2. アイテムの引数を更新
3. 保存時に自動的にCSVエスケープ処理が実行される

#### プレースホルダー
- 「コマンドライン引数（実行ファイルやアプリの場合のみ有効）」

#### CSVエスケープの自動処理
引数フィールドに入力された内容は、保存時に自動的にCSVエスケープ処理が行われます。ダブルクォートやカンマを含む引数も、通常の文字列として入力するだけで正しく保存されます。

**入力例:**
- `-p "Git Bash" -d "C:\Projects"`
- `--new-window "C:\My Projects"`
- `--options value1,value2`

これらの入力は、保存時にデータファイル内で適切にエスケープされ、読み込み時には元の形式で表示されます。ユーザーはエスケープ処理を意識する必要はありません。

詳細は **[CSV形式のエスケープルール](../architecture/data-format.md#csv形式のエスケープルール)** を参照してください。

#### バリデーション
- 任意項目（バリデーションなし）

### 4.5. ウィンドウ設定を入力

#### アクション
- ウィンドウ設定セクションで以下の項目を入力：
  - ウィンドウタイトル
  - X座標
  - Y座標
  - 幅
  - 高さ
- 「ウィンドウから取得」ボタンをクリックして実行中ウィンドウから情報を自動取得

#### 処理フロー（手動入力）
1. 各入力欄に値を入力
2. アイテムのwindowConfigを更新
3. 保存時に適切な形式（文字列またはJSON）でデータファイルに記録

#### 処理フロー（ウィンドウから取得）
1. 「ウィンドウから取得」ボタンをクリック
2. ウィンドウ選択モーダルが開く
3. 実行中のウィンドウ一覧が表示される
4. ウィンドウを選択
5. 選択したウィンドウの情報が自動的に入力される：
   - ウィンドウタイトル
   - 現在のX座標
   - 現在のY座標
   - 現在の幅
   - 現在の高さ

#### 入力項目詳細

| 項目 | 説明 | プレースホルダー |
|------|------|-----------------|
| **ウィンドウタイトル** | ウィンドウ検索用の文字列（部分一致） | 「ウィンドウタイトル（部分一致）」 |
| **X座標** | ウィンドウのX座標（仮想スクリーン座標系） | 「X座標（省略時は変更なし）」 |
| **Y座標** | ウィンドウのY座標（仮想スクリーン座標系） | 「Y座標（省略時は変更なし）」 |
| **幅** | ウィンドウの幅（ピクセル） | 「幅（省略時は変更なし）」 |
| **高さ** | ウィンドウの高さ（ピクセル） | 「高さ（省略時は変更なし）」 |

#### ウィンドウ選択モーダル（WindowSelectorModal）

**表示内容:**
- 実行中のウィンドウ一覧（タイトル、位置、サイズ、プロセス名）
- 各ウィンドウのアイコン
- フィルター機能（タイトルまたはプロセス名で絞り込み）

**操作:**
- ウィンドウをクリックして選択
- 選択後、自動的にモーダルが閉じて情報が入力される

詳細は **[ウィンドウ選択モーダル仕様](#ウィンドウ選択モーダル)** を参照してください。

#### 動作仕様

**アイテム起動時の挙動:**
1. ウィンドウタイトルで既存ウィンドウを検索
2. **ウィンドウが見つかった場合:**
   - ウィンドウをアクティブ化（前面に表示）
   - 位置・サイズが設定されている場合は、ウィンドウを移動・リサイズ
   - 通常起動は実行しない
3. **ウィンドウが見つからない場合:**
   - 通常通りアイテムを起動

**マルチモニタ対応:**
- 座標系は仮想スクリーン座標（Virtual Screen Coordinates）
- プライマリモニターの左上が原点 (0, 0)
- セカンダリモニターは相対位置に配置

詳細は **[データファイル形式 - ウィンドウ設定](../architecture/data-format.md#ウィンドウ設定フィールドの記述方法)** を参照してください。

#### データ保存形式

**タイトルのみの場合（文字列形式）:**
```
名前,パス,引数,カスタムアイコン,ウィンドウタイトル
```

**位置・サイズありの場合（JSON形式）:**
```
名前,パス,引数,カスタムアイコン,"{""title"":""タイトル"",""x"":100,""y"":200,""width"":800,""height"":600}"
```

#### バリデーション
- すべて任意項目（バリデーションなし）
- ただし、位置・サイズを指定する場合は、タイトルも必須

### 4.6. フォルダ取込オプションを設定

#### アクション
- DirOptionsEditorコンポーネントでオプションを編集

#### 処理フロー
1. DirOptionsEditorでオプションを変更
2. アイテムのフォルダ取込オプションを更新

#### 設定可能なオプション
| オプション | 説明 | デフォルト |
|-----------|------|-----------|
| `depth` | サブディレクトリの深さ（0=現在のみ、-1=無制限） | 0 |
| `types` | 取得タイプ（file/folder/both） | both |
| `filter` | ファイル名フィルター（例: *.txt） | なし |
| `exclude` | 除外パターン（例: temp*） | なし |
| `prefix` | 表示名プレフィックス | なし |
| `suffix` | 表示名サフィックス | なし |

#### 関連ドキュメント
- [dir-options-editor.md](./dir-options-editor.md) - フォルダ取込オプションエディタの詳細仕様

### 4.7. グループアイテムを管理

#### アクション
- グループアイテムリスト内の「×」ボタンをクリックしてアイテムを削除

#### 処理フロー
1. 削除対象のインデックスを取得
2. グループアイテムリストから対象を削除
3. UIを更新

#### 表示内容
- 選択されたアイテム名がチップ形式で表示
- 各チップに「×」削除ボタンを表示
- アイテムがない場合「アイテムが追加されていません」と表示

### 4.8. グループアイテムを追加

#### アクション
- 「+ アイテムを追加」ボタンをクリック

#### 処理フロー
1. 編集中のアイテムインデックスを記録
2. グループアイテム選択モーダルを開く
3. ユーザーがアイテムを選択
4. 選択アイテムをグループに追加
5. エラー状態をクリア

#### GroupItemSelectorModalへの引数
- `targetFile`: 保存先ファイル（同じファイル内のアイテムのみ選択可能）
- `excludeNames`: 既に選択済みのアイテム名（重複選択防止）

#### 関連ドキュメント
- [group-item-selector-modal.md](./group-item-selector-modal.md) - グループアイテム選択モーダルの詳細仕様

### 4.9. 保存先タブを変更

#### アクション
- 保存先タブドロップダウンで対象タブを選択

#### 処理フロー
1. 選択したタブを取得
2. 保存先タブを更新
3. タブに複数ファイルがある場合、最初のファイルを保存先ファイルに設定

#### 選択肢の生成
- 設定ファイルのタブ情報から取得
- 各タブの名前を表示
- タブの最初のファイルが保存先となる

#### targetTabフィールドの値

`targetTab`フィールドには、**データファイル名**（ファイルパス）が格納されます。

| 例 | 説明 |
|----|------|
| `data.txt` | デフォルトのデータファイル |
| `data2.txt` | 追加のデータファイル |

**注意**: 複数ファイルを持つタブの場合、`targetTab`にはそのタブの`files[0]`（最初のファイル）が設定されます。実際に保存するファイルを指定する場合は`targetFile`を使用します。

### 4.10. 保存先ファイルを変更

#### アクション
- 保存先ファイルドロップダウンでファイルを選択

#### 表示条件
- 選択されているタブに複数のファイルがある場合のみ表示

#### 処理フロー
1. 選択したファイルを取得
2. 保存先ファイルを更新

### 4.11. カスタムアイコンを設定

#### アクション
- 「ファイルから選択」ボタンでアイコンファイルを選択
- 「削除」ボタンでカスタムアイコンを削除

#### 処理フロー（選択時）
1. ファイル選択ダイアログを開く
2. ユーザーが画像ファイルを選択
3. アイコンファイルを設定フォルダにコピー
4. プレビュー用にアイコンを読み込み
5. アイテムのカスタムアイコンを更新

#### 処理フロー（削除時）
1. アイコンファイルを削除
2. プレビューをクリア
3. アイテムのカスタムアイコンをクリア

#### FilePickerDialogの設定
- タイトル: 「カスタムアイコンを選択」
- ファイルタイプ: 画像ファイル（image）
- 説明: 「アイコンとして使用する画像ファイルを選択してください。」

#### 関連ドキュメント
- [dialogs.md](./dialogs.md) - FilePickerDialogの詳細仕様

### 4.12. キャンセルボタンをクリック

#### アクション
- 「キャンセル」ボタンをクリック、またはEscapeキーを押下

#### 処理フロー
1. アイテム状態をクリア
2. モーダルを閉じる

#### 注意
- 編集中の内容は保存されずに破棄される
- 確認ダイアログは表示されない

### 4.13. 登録/更新ボタンをクリック

#### アクション
- 「登録」または「更新」ボタンをクリック

#### バリデーション処理
1. 全アイテムに対してバリデーションを実行
2. エラーがある場合は`errors`状態を更新して処理中止

#### バリデーションルール

| 種別 | 項目 | ルール | エラーメッセージ |
|------|------|--------|-----------------|
| 単一アイテム | 名前 | 必須 | 「名前を入力してください」 |
| 単一アイテム | パス | 必須 | 「パスを入力してください」 |
| フォルダ取込 | パス | 必須 | 「パスを入力してください」 |
| グループ | 名前 | 必須 | 「グループ名を入力してください」 |
| グループ | アイテムリスト | 1件以上 | 「グループアイテムを追加してください」 |

#### 登録処理フロー
1. バリデーション成功
2. 登録/更新処理を実行
3. モーダルを閉じる

## 6. 初期化処理

### モーダルオープン時の初期化

モーダルが開かれた際、状況に応じて異なる初期化処理が実行されます。

#### 編集モードの場合（editingItemあり）
1. 既存アイテムの情報をRegisterItem形式に変換
2. カスタムアイコンがある場合はプレビューを読み込み
3. 保存先タブ/ファイルを現在の設定から取得

#### ドラッグ&ドロップの場合（droppedPathsあり）
1. 各パスに対してアイテム情報を自動検出
2. アイコンを取得（存在する場合）
3. 現在のタブを保存先として設定
4. パスフィールドを読み取り専用に設定

#### 手動登録の場合（どちらもなし）
1. 空のテンプレートアイテムを1つ作成
2. 現在のタブを保存先として設定
3. デフォルト値で初期化

### ウィンドウサイズの調整

モーダル内容に応じてウィンドウサイズが動的に調整されます。

| 条件 | 幅 | 高さ |
|------|-----|------|
| フォルダ取込アイテムあり | 900px | 1000px |
| その他 | 800px | 1000px |

## 7. キーボード操作

### モーダル内のキー制御

| キー | 動作 |
|------|------|
| Escape | モーダルを閉じる（GroupItemSelectorModal表示中は除く） |
| Tab | フォーカス移動（モーダル内で循環） |
| Shift+Tab | フォーカス逆移動（モーダル内で循環） |
| 入力フィールド内の編集キー | 通常の入力操作として許可 |

### フォーカストラップ
- モーダル内でTabキーによるフォーカス移動が循環
- 最後の要素でTabを押すと最初の要素に移動
- 最初の要素でShift+Tabを押すと最後の要素に移動

## 8. 子コンポーネント

### 使用コンポーネント一覧

| コンポーネント | 用途 | 表示条件 |
|---------------|------|----------|
| `WindowConfigEditor` | ウィンドウ設定の編集（タイトル・位置・サイズ） | 種別が単一アイテム |
| `CustomIconEditor` | カスタムアイコンの選択・削除 | 種別がフォルダ取込以外 |
| `DirOptionsEditor` | フォルダ取込オプションの編集 | 種別がフォルダ取込 |
| `GroupItemSelectorModal` | グループメンバーの選択 | 追加ボタンクリック時 |
| `FilePickerDialog` | カスタムアイコンファイルの選択 | アイコン選択時 |
| `WindowSelectorModal` | 実行中ウィンドウの選択 | 「ウィンドウから取得」ボタンクリック時 |

### 子コンポーネント詳細

#### WindowConfigEditor

ウィンドウ設定（タイトル・位置・サイズ）を編集するためのコンポーネントです。

**ファイル:** `src/renderer/components/WindowConfigEditor.tsx`

**Props:**
```typescript
interface WindowConfigEditorProps {
  windowConfig?: WindowConfig;
  onChange: (windowConfig: WindowConfig) => void;
  onGetWindowClick: () => void;
}
```

**提供する機能:**
- ウィンドウタイトル入力
- X座標・Y座標・幅・高さの数値入力
- 「ウィンドウから取得」ボタン（WindowSelectorModalを開く）

**入力検証:**
- すべての項目が任意（省略可能）
- 位置・サイズを指定する場合はタイトルも推奨

#### CustomIconEditor

カスタムアイコンの選択・削除を行うコンポーネントです。

**ファイル:** `src/renderer/components/CustomIconEditor.tsx`

**Props:**
```typescript
interface CustomIconEditorProps {
  customIconPreview?: string;
  onSelectClick: () => void;
  onDeleteClick: () => void;
}
```

**提供する機能:**
- アイコンプレビュー表示
- 「ファイルから選択」ボタン（FilePickerDialogを開く）
- 「削除」ボタン（カスタムアイコンを削除）

**表示パターン:**
- アイコンあり: プレビュー画像と削除ボタンを表示
- アイコンなし: 「カスタムアイコン未設定」メッセージを表示

### ウィンドウ選択モーダル（WindowSelectorModal）

ウィンドウ設定セクションの「ウィンドウから取得」ボタンをクリックすると表示されるモーダルです。

#### 基本情報

| 項目 | 内容 |
|------|------|
| **ファイル名** | `src/renderer/components/WindowSelectorModal.tsx` |
| **コンポーネント名** | `WindowSelectorModal` |
| **スタイル** | `src/renderer/components/WindowSelectorModal.css` |

#### 表示内容

**ヘッダー:**
- タイトル: 「ウィンドウを選択」
- 閉じるボタン（×）

**フィルターセクション:**
- 絞り込み入力欄（タイトルまたはプロセス名で絞り込み）

**ウィンドウリスト:**
- 実行中のウィンドウを一覧表示
- 各ウィンドウの表示項目：
  - アイコン（実行ファイルのアイコン）
  - ウィンドウタイトル
  - 位置: (X, Y)
  - サイズ: 幅 × 高さ
  - プロセス名（実行ファイル名）

**フッター:**
- キャンセルボタン

#### 操作

1. ウィンドウ一覧から選択したいウィンドウをクリック
2. 選択したウィンドウの情報がRegisterModalのウィンドウ設定セクションに自動入力される
3. モーダルが自動的に閉じる

#### データ取得

ウィンドウ情報は以下のIPCチャンネルから取得されます：

- `get-all-windows`: 実行中のすべてのウィンドウ情報を取得

**取得される情報:**
```typescript
interface WindowInfo {
  hwnd: number | bigint;        // ウィンドウハンドル
  title: string;                // ウィンドウタイトル
  x: number;                    // X座標
  y: number;                    // Y座標
  width: number;                // 幅
  height: number;               // 高さ
  processId: number;            // プロセスID
  isVisible: boolean;           // 表示状態
  executablePath?: string;      // 実行ファイルのパス
  icon?: string;                // アイコン（base64エンコードされたデータURL）
}
```

詳細は **[IPCチャンネル - ウィンドウ情報取得](../architecture/ipc-channels.md)** を参照してください。

## 9. 内部機能

### フォーム状態管理

**管理される状態:**
- 編集中のアイテム配列
- 読み込み中フラグ
- バリデーションエラー
- 利用可能なタブ一覧
- グループアイテム選択モーダルの表示状態
- 編集中のアイテムインデックス

**提供される機能:**
- アイテムの値を変更
- バリデーションと登録
- キャンセル処理
- グループアイテムの追加・選択・削除
- 保存先タブの変更

### カスタムアイコン管理

**管理される状態:**
- アイコンプレビューのBase64データ
- ファイル選択ダイアログの状態

**提供される機能:**
- アイコン選択ダイアログを開く/閉じる
- ファイル選択時の処理
- カスタムアイコンの削除
- プレビューの読み込み

## 10. エラーハンドリング

### バリデーションエラー

- 各入力項目の下にエラーメッセージを表示
- エラーのある入力欄には`error`クラスを適用（赤枠表示）
- 入力変更時に該当項目のエラーをクリア

### カスタムアイコンエラー

- アイコン保存失敗時: アラートを表示
- アイコン削除失敗時: アラートを表示
- エラー内容をコンソールに出力

## 11. スタイル

### 主要なCSSクラス

| クラス名 | 説明 |
|---------|------|
| `.register-modal` | モーダルコンテナ |
| `.register-items` | アイテムリストコンテナ |
| `.register-item` | 個々のアイテムフォーム |
| `.item-header` | アイテムヘッダー（アイコン表示） |
| `.form-group` | フォームグループ |
| `.custom-icon-section` | カスタムアイコンセクション |
| `.group-item-list` | グループアイテムリスト |
| `.item-chip` | グループアイテムチップ |
| `.remove-group-item-btn` | グループアイテム削除ボタン（×） |
| `.error` | エラー状態の入力欄 |
| `.error-message` | エラーメッセージ |
| `.readonly` | 読み取り専用入力欄 |

### グループアイテム削除ボタン（×）のスタイル

```css
.remove-group-item-btn {
  background-color: transparent;
  border: none;
  color: var(--color-danger);
  font-size: var(--font-size-xl);
  font-weight: bold; /* 太字で視認性向上 */
  cursor: pointer;
  padding: var(--spacing-xxs) var(--spacing-xs);
  line-height: 1;
  border-radius: 50%; /* 丸いボタン */
  transition: all var(--transition-fast);
  flex-shrink: 0;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.remove-group-item-btn:hover {
  color: var(--color-white);
  background-color: var(--color-danger);
  transform: scale(1.1); /* ホバー時に拡大 */
}

.remove-group-item-btn:active {
  transform: scale(0.95); /* クリック時に縮小 */
}
```

**デザインの特徴:**
- 丸いボタンデザインで他の×ボタンと統一
- 赤色（削除系）で用途を明確化
- ホバー時に背景が赤色に変化して×が白色になる
- クリック時の視覚的フィードバック

詳細は **[CSSデザインシステム - 閉じる・削除ボタンクラス](../architecture/css-design.md#閉じる削除ボタンクラス)** を参照してください。
