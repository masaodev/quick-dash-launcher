# アイテム登録・編集モーダル仕様書

## 関連ドキュメント

- [画面一覧](./README.md) - 全画面構成の概要
- [メインウィンドウ](./main-window.md) - メイン画面の詳細仕様
- [管理ウィンドウ](./admin-window.md) - 管理画面の詳細仕様
- [グループ起動](../features/group-launch.md) - グループ機能の詳細

## 1. 概要

アイテム登録・編集モーダル（RegisterModal）は、ランチャーに新しいアイテムを追加したり、既存アイテムを編集するためのモーダルダイアログです。単一アイテム、フォルダ取込、グループ、ウィンドウ操作の4種類のアイテムを扱うことができます。

**キーボードショートカット**: Escapeキーでモーダルを閉じることができます（編集中の内容は破棄されます）。

### 主要機能
- **アイテム登録**: ファイル、URL、フォルダ、カスタムURIなどを新規登録
- **アイテム編集**: 既存アイテムの名前、パス、引数、保存先を変更
- **種別切り替え**: 単一アイテム、フォルダ取込、グループ、ウィンドウ操作の4種類を選択
- **ドラッグ&ドロップ対応**: ファイルやフォルダのドロップで自動登録
- **カスタムアイコン**: アイテムごとにカスタムアイコンを設定可能
- **保存先タブ選択**: 複数タブ環境で保存先を指定

## 2. 基本情報

| 項目 | 内容 |
|------|------|
| **ファイル名** | `src/renderer/components/RegisterModal.tsx` |
| **コンポーネント名** | `RegisterModal` |
| **スタイル** | `src/renderer/styles/components/RegisterModal.css` |
| **表示条件** | 下記トリガーのいずれか |
| **モーダルタイプ** | オーバーレイ型モーダル |
| **親画面** | メインウィンドウ、管理ウィンドウ（AdminItemManagerView） |

### 表示トリガー

| トリガー | モード | 説明 |
|----------|--------|------|
| ➕ボタンクリック（メインウィンドウ） | 登録モード | 空のフォームを表示 |
| ファイル/フォルダをドラッグ&ドロップ | 登録モード | ドロップ内容で初期化 |
| ✏️ボタンクリック（管理ウィンドウ） | 編集モード | 既存アイテムで初期化 |
| コンテキストメニュー「編集」 | 編集モード | 既存アイテムで初期化 |

## 3. 画面項目一覧

| エリア | 項目名 | 内容・説明 | 表示条件 | 機能詳細 |
|--------|--------|------------|----------|----------|
| **ヘッダー** | タイトル | 登録モード:「アイテムの登録」<br>編集モード:「アイテムの編集」 | 常時表示 | - |
| **アイテムヘッダー** | アイコンプレビュー | アイテムのアイコンを表示 | アイコンがある場合 | - |
| **フォーム** | 種別ドロップダウン | 📄単一アイテム / 🗂️フォルダ取込 / 📦グループ / 🪟ウィンドウ操作 | 常時表示 | [4.1](#41-種別を変更) |
| **フォーム** | 名前入力欄 | アイテムの表示名を入力 | 種別が単一アイテム、グループ、またはウィンドウ操作の場合 | [4.2](#42-名前を入力) |
| **フォーム** | パス入力欄 | ファイルパス、URL、カスタムURIを入力 | 種別が単一アイテムまたはフォルダ取込の場合 | [4.3](#43-パスを入力) |
| **フォーム** | 引数入力欄 | コマンドライン引数を入力 | 種別が単一アイテムの場合 | [4.4](#44-引数を入力) |
| **フォーム** | ウィンドウ設定セクション | ウィンドウ検索・位置・サイズの設定 | 種別が単一アイテムの場合 | [4.5](#45-ウィンドウ設定を入力) |
| **フォーム** | ウィンドウ操作設定セクション | ウィンドウタイトル・位置・サイズ・仮想デスクトップの設定 | 種別がウィンドウ操作の場合 | [4.7](#47-ウィンドウ操作設定を入力) |
| **フォーム** | フォルダ取込オプション | DirOptionsEditorコンポーネント | 種別がフォルダ取込の場合 | [4.6](#46-フォルダ取込オプションを設定) |
| **フォーム** | グループアイテムリスト | 選択されたアイテム名のチップリスト | 種別がグループの場合 | [4.8](#48-グループアイテムを管理) |
| **フォーム** | 「+ アイテムを追加」ボタン | グループアイテム選択モーダルを開く | 種別がグループの場合 | [4.9](#49-グループアイテムを追加) |
| **フォーム** | 保存先タブドロップダウン | 保存先のタブを選択 | 常時表示 | [4.10](#410-保存先タブを変更) |
| **フォーム** | 保存先ファイルドロップダウン | 保存先のファイルを選択 | タブに複数ファイルがある場合 | [4.11](#411-保存先ファイルを変更) |
| **フォーム** | カスタムアイコンセクション | アイコンプレビュー、選択/削除ボタン | 種別がフォルダ取込以外の場合 | [4.12](#412-カスタムアイコンを設定) |
| **フッター** | ⚡ 試しに実行ボタン | 保存せずにアイテムを実行 | グループ・フォルダ取込以外 | [4.15](#415-試しに実行ボタンをクリック) |
| **フッター** | キャンセルボタン | モーダルを閉じる | 常時表示 | [4.13](#413-キャンセルボタンをクリック) |
| **フッター** | 登録/更新ボタン | 登録モード:「登録」<br>編集モード:「更新」 | 常時表示 | [4.14](#414-登録更新ボタンをクリック) |
| **エラー表示** | エラーメッセージ | バリデーションエラーを各項目下に表示 | エラーがある場合 | - |

## 4. アクション一覧

| No | アクション名 | トリガー | 主な処理内容 | 詳細 |
|----|------------|---------|------------|------|
| 4.1 | 種別を変更 | 種別ドロップダウン変更 | フォーム項目の表示切り替え | [詳細](#41-種別を変更) |
| 4.2 | 名前を入力 | テキスト入力 | アイテム名の更新 | [詳細](#42-名前を入力) |
| 4.3 | パスを入力 | テキスト入力 | パス/URL/URIの更新、タイプ自動検出 | [詳細](#43-パスを入力) |
| 4.4 | 引数を入力 | テキスト入力 | コマンドライン引数の更新 | [詳細](#44-引数を入力) |
| 4.5 | ウィンドウ設定を入力 | テキスト/数値入力、ボタンクリック | ウィンドウ制御設定の更新 | [詳細](#45-ウィンドウ設定を入力) |
| 4.6 | フォルダ取込オプションを設定 | オプション変更 | dirOptionsの更新 | [詳細](#46-フォルダ取込オプションを設定) |
| 4.7 | ウィンドウ操作設定を入力 | テキスト/数値入力、ボタンクリック | ウィンドウ操作設定の更新 | [詳細](#46-ウィンドウ操作設定を入力) |
| 4.8 | グループアイテムを管理 | 削除ボタンクリック | グループメンバーの削除 | [詳細](#47-グループアイテムを管理) |
| 4.9 | グループアイテムを追加 | 追加ボタンクリック | 選択モーダルを開く | [詳細](#48-グループアイテムを追加) |
| 4.10 | 保存先タブを変更 | ドロップダウン変更 | 保存先タブの更新 | [詳細](#49-保存先タブを変更) |
| 4.11 | 保存先ファイルを変更 | ドロップダウン変更 | 保存先ファイルの更新 | [詳細](#410-保存先ファイルを変更) |
| 4.12 | カスタムアイコンを設定 | ファイル選択/削除 | カスタムアイコンの管理 | [詳細](#411-カスタムアイコンを設定) |
| 4.13 | キャンセルボタンをクリック | ボタンクリック | モーダルを閉じる | [詳細](#412-キャンセルボタンをクリック) |
| 4.14 | 登録/更新ボタンをクリック | ボタンクリック | バリデーションと登録/更新処理 | [詳細](#413-登録更新ボタンをクリック) |
| 4.15 | 試しに実行ボタンをクリック | ボタンクリック | 保存せずにアイテムを実行（ピンモード一時変更） | [詳細](#415-試しに実行ボタンをクリック) |

## 5. 機能詳細

### 4.1. 種別を変更

#### アクション
- 種別ドロップダウンで「📄 単一アイテム」「🗂️ フォルダ取込」「📦 グループ」「🪟 ウィンドウ操作」のいずれかを選択

#### 処理フロー
1. 選択した種別に応じてフォーム項目を切り替え
2. 種別固有の初期値を設定

#### 種別ごとの表示項目

| 項目 | 単一アイテム | フォルダ取込 | グループ | ウィンドウ操作 |
|------|:-----------:|:-----------:|:--------:|:--------------:|
| 名前 | ○ | - | ○ | ○ |
| パス | ○ | ○ | - | - |
| 引数 | ○ | - | - | - |
| ウィンドウ操作設定 | - | - | - | ○ |
| フォルダ取込オプション | - | ○ | - | - |
| グループアイテムリスト | - | - | ○ | - |
| カスタムアイコン | ○ | - | ○ | ○ |

#### 種別変更時の初期化処理

**フォルダ取込に変更時:**
- フォルダ処理モードを「展開」に設定
- フォルダ取込オプションをデフォルト値で初期化
- グループ関連の情報をクリア

**グループに変更時:**
- グループアイテムリストを空で初期化
- フォルダ取込関連の情報をクリア

**単一アイテムに変更時:**
- フォルダ取込関連の情報をクリア
- グループ関連の情報をクリア

**ウィンドウ操作に変更時:**
- ウィンドウ操作設定を初期化
- フォルダ取込関連の情報をクリア
- グループ関連の情報をクリア

### 4.2. 名前を入力

#### アクション
- 名前入力欄にテキストを入力

#### 処理フロー
1. 入力値を取得
2. アイテムの名前を更新
3. 入力時にエラー状態をクリア

#### プレースホルダー
- 単一アイテム: 「表示名を入力」
- グループ: 「グループ名を入力」
- ウィンドウ操作: 「アイテムリストでの表示名を入力」

#### バリデーション
- **単一アイテム**: 必須（空の場合「名前を入力してください」）
- **グループ**: 必須（空の場合「グループ名を入力してください」）
- **ウィンドウ操作**: 必須（空の場合「表示名を入力してください」）
- **フォルダ取込**: 不要（表示されない）

### 4.3. パスを入力

#### アクション
- パス入力欄にファイルパス、URL、カスタムURIを入力

#### 処理フロー
1. 入力値を取得
2. アイテムのパスを更新
3. アイテムタイプを自動検出
4. タイプに応じてデフォルト値を設定
5. 入力時にエラー状態をクリア

#### アイテムタイプの自動検出
| 入力パターン | 検出タイプ |
|-------------|-----------|
| `http://` または `https://` | `url` |
| `C:\` などのローカルパス（フォルダ） | `folder` |
| `C:\` などのローカルパス（ファイル） | `file` |
| `*.exe` ファイル | `exe` |
| `obsidian://` などカスタムURI | `custom-uri` |

#### フォルダ検出時の追加処理
- フォルダ処理モードを「フォルダを開く」に設定（`folderProcessing: 'folder'`）
- フォルダ取込オプションをデフォルト値で初期化

#### folderProcessingの値

| 値 | 説明 | 対応する種別 |
|----|------|-------------|
| `'folder'` | フォルダを開く（単一アイテムとして登録） | 単一アイテム |
| `'expand'` | フォルダ取込（フォルダ内容を展開して取得） | フォルダ取込 |

#### プレースホルダー
- 「ファイルパス、URL、またはカスタムURIを入力」

#### 読み取り専用条件
- ドラッグ&ドロップで開いた場合、パスは読み取り専用（編集不可）

#### バリデーション
- **単一アイテム/フォルダ取込**: 必須（空の場合「パスを入力してください」）
- **グループ**: 不要（表示されない）

### 4.4. 引数を入力

#### アクション
- 引数入力欄にコマンドライン引数を入力

#### 処理フロー
1. 入力値を取得
2. アイテムの引数を更新

#### プレースホルダー
- 「コマンドライン引数（実行ファイルやアプリの場合のみ有効）」

#### バリデーション
- 任意項目（バリデーションなし）

### 4.5. ウィンドウ設定を入力

#### アクション
- ウィンドウ設定セクションで以下の項目を入力：
  - **ウィンドウ検索設定**:
    - ウィンドウタイトル
  - **ウィンドウ動作設定**:
    - ウィンドウをアクティブ化（既定: ON）
    - 仮想デスクトップを移動（既定: OFF）
  - **ウィンドウ位置・サイズ設定**:
    - アクティブモニター中央に移動（既定: OFF）
    - X座標（アクティブモニター中央移動がONの場合は無効化）
    - Y座標（アクティブモニター中央移動がONの場合は無効化）
    - 幅
    - 高さ
- 「ウィンドウから取得」ボタンをクリックして実行中ウィンドウから情報を自動取得

#### 処理フロー（手動入力）
1. 各入力欄に値を入力
2. アイテムのwindowConfigを更新
3. 保存時に適切な形式（文字列またはJSON）でデータファイルに記録

#### 処理フロー（ウィンドウから取得）
1. 「ウィンドウから取得」ボタンをクリック
2. ウィンドウ選択モーダルが開く
3. 実行中のウィンドウ一覧が表示される
4. ウィンドウを選択
5. 選択したウィンドウの情報が自動的に入力される：
   - ウィンドウタイトル
   - 現在のX座標
   - 現在のY座標
   - 現在の幅
   - 現在の高さ

#### 入力項目詳細

**ウィンドウ検索設定:**
| 項目 | 説明 | プレースホルダー |
|------|------|-----------------|
| **ウィンドウタイトル** | ウィンドウ検索用の文字列（部分一致） | 「ウィンドウタイトル（部分一致）」 |

**ウィンドウ動作設定:**
| 項目 | 説明 | 既定値 |
|------|------|--------|
| **ウィンドウをアクティブ化** | ウィンドウを前面に表示してフォーカス | ON |
| **仮想デスクトップを移動** | ウィンドウが異なる仮想デスクトップにある場合、そのデスクトップに移動 | OFF |

**ウィンドウ位置・サイズ設定:**
| 項目 | 説明 | プレースホルダー / 既定値 |
|------|------|-----------------|
| **アクティブモニター中央に移動** | マウスカーソルがあるモニターの中央にウィンドウを移動（ONの場合、X/Y座標は無視される） | OFF |
| **X座標** | ウィンドウのX座標（仮想スクリーン座標系）※アクティブモニター中央移動がONの場合は無効化 | 「X座標（省略時は変更なし）」 |
| **Y座標** | ウィンドウのY座標（仮想スクリーン座標系）※アクティブモニター中央移動がONの場合は無効化 | 「Y座標（省略時は変更なし）」 |
| **幅** | ウィンドウの幅（ピクセル） | 「幅（省略時は変更なし）」 |
| **高さ** | ウィンドウの高さ（ピクセル） | 「高さ（省略時は変更なし）」 |

#### ウィンドウ選択モーダル（WindowSelectorModal）

**表示内容:**
- 実行中のウィンドウ一覧（タイトル、位置、サイズ、プロセス名）
- 各ウィンドウのアイコン
- フィルター機能（タイトルまたはプロセス名で絞り込み）

**操作:**
- ウィンドウをクリックして選択
- 選択後、自動的にモーダルが閉じて情報が入力される

詳細は **[ウィンドウ選択モーダル仕様](#ウィンドウ選択モーダル)** を参照してください。

#### 動作仕様

**アイテム起動時の挙動:**
1. ウィンドウタイトルで既存ウィンドウを検索
2. **ウィンドウが見つかった場合:**
   - 「仮想デスクトップを移動」がONの場合、ウィンドウの仮想デスクトップに移動
   - 「ウィンドウをアクティブ化」がONの場合、ウィンドウを前面に表示してフォーカス
   - 位置・サイズが設定されている場合は、ウィンドウを移動・リサイズ
   - 通常起動は実行しない
3. **ウィンドウが見つからない場合:**
   - 通常通りアイテムを起動

**オプションの組み合わせ:**
| ウィンドウをアクティブ化 | 仮想デスクトップを移動 | 動作 |
|---------------------|------------------|------|
| ON | OFF | 現在のデスクトップでウィンドウをアクティブ化（ウィンドウを現在のデスクトップに移動） |
| ON | ON | ウィンドウの仮想デスクトップに移動してからアクティブ化 |
| OFF | OFF | ウィンドウの位置・サイズのみ変更（アクティブ化しない） |
| OFF | ON | ウィンドウの仮想デスクトップに移動（アクティブ化しない） |

**マルチモニタ対応:**
- 座標系は仮想スクリーン座標（Virtual Screen Coordinates）
- プライマリモニターの左上が原点 (0, 0)
- セカンダリモニターは相対位置に配置

詳細は **[データファイル形式 - ウィンドウ設定](../architecture/file-formats/data-format.md#ウィンドウ設定フィールドの記述方法)** を参照してください。

#### データ保存形式

**タイトルのみの場合（文字列形式）:**
```
名前,パス,引数,カスタムアイコン,ウィンドウタイトル
```

**位置・サイズありの場合（JSON形式）:**
```
名前,パス,引数,カスタムアイコン,"{""title"":""タイトル"",""x"":100,""y"":200,""width"":800,""height"":600}"
```

#### バリデーション
- すべて任意項目（バリデーションなし）
- ただし、位置・サイズを指定する場合は、タイトルも必須

### 4.6. フォルダ取込オプションを設定

#### アクション
- DirOptionsEditorコンポーネントでオプションを編集

#### 処理フロー
1. DirOptionsEditorでオプションを変更
2. アイテムのフォルダ取込オプションを更新

#### 設定可能なオプション
| オプション | 説明 | デフォルト |
|-----------|------|-----------|
| `depth` | サブディレクトリの深さ（0=現在のみ、-1=無制限） | 0 |
| `types` | 取得タイプ（file/folder/both） | both |
| `filter` | ファイル名フィルター（例: *.txt） | なし |
| `exclude` | 除外パターン（例: temp*） | なし |
| `prefix` | 表示名プレフィックス | なし |
| `suffix` | 表示名サフィックス | なし |

#### 関連ドキュメント
- [dir-options-editor.md](./dir-options-editor.md) - フォルダ取込オプションエディタの詳細仕様

### 4.7. ウィンドウ操作設定を入力

#### アクション
- ウィンドウ操作設定セクションで以下の項目を入力：
  - **ウィンドウ検索設定**:
    - ウィンドウタイトル
  - **ウィンドウが見つかった場合の動作**:
    - 位置・サイズ調整（アクティブモニター中央移動、X座標、Y座標、幅、高さ）
    - 仮想デスクトップ移動（デスクトップ番号）
    - アクティブ化（ウィンドウをアクティブにする）
- 「ウィンドウから取得」ボタンをクリックして実行中ウィンドウから情報を自動取得

#### 処理フロー（手動入力）
1. 各入力欄に値を入力
2. アイテムのwindowOperationConfigを更新
3. 保存時に適切な形式でデータファイルに記録

#### 処理フロー（ウィンドウから取得）
1. 「ウィンドウから取得」ボタンをクリック
2. ウィンドウ選択モーダルが開く
3. 実行中のウィンドウ一覧が表示される
4. ウィンドウを選択
5. 選択したウィンドウの情報が自動的に入力される：
   - ウィンドウタイトル
   - 現在のX座標
   - 現在のY座標
   - 現在の幅
   - 現在の高さ

#### 入力項目詳細

**ウィンドウ検索設定:**
| 項目 | 説明 | プレースホルダー |
|------|------|-----------------|
| **ウィンドウタイトル** | ウィンドウ検索用の文字列（部分一致） | 「ウィンドウタイトル（部分一致）」 |

**ウィンドウが見つかった場合の動作:**

1. **位置・サイズ調整:**
   | 項目 | 説明 | プレースホルダー / 既定値 |
   |------|------|-----------------|
   | **アクティブモニター中央に移動** | マウスカーソルがあるモニターの中央にウィンドウを移動（ONの場合、X/Y座標は無視される） | OFF |
   | **X座標** | ウィンドウのX座標（仮想スクリーン座標系）※アクティブモニター中央移動がONの場合は無効化 | 「X座標」 |
   | **Y座標** | ウィンドウのY座標（仮想スクリーン座標系）※アクティブモニター中央移動がONの場合は無効化 | 「Y座標」 |
   | **幅** | ウィンドウの幅（ピクセル） | 「幅」 |
   | **高さ** | ウィンドウの高さ（ピクセル） | 「高さ」 |

2. **仮想デスクトップ移動:**
   | 項目 | 説明 | プレースホルダー |
   |------|------|-----------------|
   | **デスクトップ番号** | 仮想デスクトップ番号（1から開始） | 「1から開始」 |

3. **アクティブ化:**
   | 項目 | 説明 | 既定値 |
   |------|------|--------|
   | **ウィンドウをアクティブにする** | ウィンドウを前面に表示してフォーカス | ON |
   
   - チェックを外すと、位置・サイズ調整や仮想デスクトップ移動のみ実行

#### UI表示の特徴

ウィンドウ操作アイテムでは、設定項目が**最初から展開されて表示**されます：

- **折りたたみトグルなし**: 「オプション設定」の折りたたみボタンは表示されません
- **常時表示**: すべての設定項目が常に表示され、すぐに操作できます
- **専用ヘルプ**: 「ウィンドウ操作機能」として説明が表示されます
  - ① ウィンドウタイトルで既存ウィンドウを検索
  - ② 見つかれば → 設定に従って制御

※ 単一アイテムのウィンドウ設定では折りたたみ表示されますが、ウィンドウ操作アイテムでは常に展開表示されます。

#### 動作仕様

**アイテム起動時の挙動:**
1. ウィンドウタイトルで既存ウィンドウを検索
2. **ウィンドウが見つかった場合:**
   - 「デスクトップ番号」が指定されていれば仮想デスクトップを移動
   - 「ウィンドウをアクティブにする」がONの場合、ウィンドウを前面に表示してフォーカス
   - 位置・サイズが設定されている場合は、ウィンドウを移動・リサイズ
3. **ウィンドウが見つからない場合:**
   - 警告ログを出力（何も実行しない）

#### バリデーション
- **ウィンドウタイトル**: 必須（空の場合エラー）
- **その他の項目**: すべて任意項目（バリデーションなし）

#### JSON形式の検証とエラー表示

#### JSON形式でのデータ保存

ウィンドウ操作アイテムは内部的にJSON形式でデータを保存します（v0.5.10以降はJSON形式専用）。

**データ形式:**
```
window,{"name":"表示名","windowTitle":"ウィンドウタイトル","x":100,"y":100,...}
```

**管理画面での編集制限:**

v0.5.10以降、管理画面（AdminItemManagerList）では、JSON文字列の破損を防ぐため、**ウィンドウ操作アイテムのインライン編集はできません**：

- パス列（JSON文字列部分）はクリックしても編集できません（読み取り専用）
- セル上に「✏️ボタンから詳細編集を開いてください」というツールチップが表示されます
- 編集する場合は、必ず✏️ボタンから詳細編集モーダル（RegisterModal）を開く必要があります

**インライン編集を禁止する理由:**
- JSON文字列を直接編集すると、データ形式の破損が発生する可能性
- 詳細編集モーダルでは、JSON形式の構築が正しく処理される

**編集方法:**
1. 管理画面で該当行の「✏️」ボタンをクリック
2. RegisterModalでウィンドウ操作設定を入力
3. 「更新」ボタンをクリックすると、自動的に正しいJSON形式で保存される

詳細は **[ウィンドウ制御システム](../architecture/window-control.md)** および **[データファイル形式](../architecture/file-formats/data-format.md#ウィンドウ操作アイテム行の詳細)** を参照してください。

### 4.8. グループアイテムを管理

#### アクション
- グループアイテムリスト内の「×」ボタンをクリックしてアイテムを削除

#### 処理フロー
1. 削除対象のインデックスを取得
2. グループアイテムリストから対象を削除
3. UIを更新

#### 表示内容
- 選択されたアイテム名がチップ形式で表示
- 各チップに「×」削除ボタンを表示
- アイテムがない場合「アイテムが追加されていません」と表示

### 4.9. グループアイテムを追加

#### アクション
- 「+ アイテムを追加」ボタンをクリック

#### 処理フロー
1. 編集中のアイテムインデックスを記録
2. グループアイテム選択モーダルを開く
3. ユーザーがアイテムを選択
4. 選択アイテムをグループに追加
5. エラー状態をクリア

#### GroupItemSelectorModalへの引数
- `targetFile`: 保存先ファイル（同じファイル内のアイテムのみ選択可能）
- `excludeNames`: 既に選択済みのアイテム名（重複選択防止）

#### 関連ドキュメント
- [group-item-selector-modal.md](./group-item-selector-modal.md) - グループアイテム選択モーダルの詳細仕様

### 4.10. 保存先タブを変更

#### アクション
- 保存先タブドロップダウンで対象タブを選択

#### 処理フロー
1. 選択したタブを取得
2. 保存先タブを更新
3. タブに複数ファイルがある場合、最初のファイルを保存先ファイルに設定

#### 選択肢の生成
- 設定ファイルのタブ情報から取得
- 各タブの名前を表示
- タブの最初のファイルが保存先となる

#### targetTabフィールドの値

`targetTab`フィールドには、**データファイル名**（ファイルパス）が格納されます。

| 例 | 説明 |
|----|------|
| `data.json` | デフォルトのデータファイル |
| `data2.json` | 追加のデータファイル |

**注意**: 複数ファイルを持つタブの場合、`targetTab`にはそのタブの`files[0]`（最初のファイル）が設定されます。実際に保存するファイルを指定する場合は`targetFile`を使用します。

### 4.11. 保存先ファイルを変更

#### アクション
- 保存先ファイルドロップダウンでファイルを選択

#### 表示条件
- 選択されているタブに複数のファイルがある場合のみ表示

#### 処理フロー
1. 選択したファイルを取得
2. 保存先ファイルを更新

### 4.12. カスタムアイコンを設定

#### アクション
- 「ファイルから選択」ボタンでアイコンファイルを選択
- 「削除」ボタンでカスタムアイコンを削除

#### 処理フロー（選択時）
1. ファイル選択ダイアログを開く
2. ユーザーが画像ファイルを選択
3. アイコンファイルを設定フォルダにコピー
4. プレビュー用にアイコンを読み込み
5. アイテムのカスタムアイコンを更新

#### 処理フロー（削除時）
1. アイコンファイルを削除
2. プレビューをクリア
3. アイテムのカスタムアイコンをクリア

#### FilePickerDialogの設定
- タイトル: 「カスタムアイコンを選択」
- ファイルタイプ: 画像ファイル（image）
- 説明: 「アイコンとして使用する画像ファイルを選択してください。」

#### 関連ドキュメント
- [dialogs.md](./dialogs.md) - FilePickerDialogの詳細仕様

### 4.13. キャンセルボタンをクリック

#### アクション
- 「キャンセル」ボタンをクリック、またはEscapeキーを押下

#### 処理フロー
1. アイテム状態をクリア
2. モーダルを閉じる

#### 注意
- 編集中の内容は保存されずに破棄される
- 確認ダイアログは表示されない

### 4.14. 登録/更新ボタンをクリック

#### アクション
- 「登録」または「更新」ボタンをクリック

#### バリデーション処理
1. 全アイテムに対してバリデーションを実行
2. エラーがある場合は`errors`状態を更新して処理中止

#### バリデーションルール

| 種別 | 項目 | ルール | エラーメッセージ |
|------|------|--------|-----------------|
| 単一アイテム | 名前 | 必須 | 「名前を入力してください」 |
| 単一アイテム | パス | 必須 | 「パスを入力してください」 |
| フォルダ取込 | パス | 必須 | 「パスを入力してください」 |
| グループ | 名前 | 必須 | 「グループ名を入力してください」 |
| グループ | アイテムリスト | 1件以上 | 「グループアイテムを追加してください」 |
| ウィンドウ操作 | 名前 | 必須 | 「表示名を入力してください」 |
| ウィンドウ操作 | ウィンドウタイトル | 必須 | ウィンドウタイトルは4.7のバリデーションで確認 |

#### 登録処理フロー
1. バリデーション成功
2. 登録/更新処理を実行
3. モーダルを閉じる

### 4.15. 試しに実行ボタンをクリック

#### アクション
- 「⚡ 試しに実行」ボタンをクリック

#### 表示条件
- グループアイテムとフォルダ取込アイテムでは非表示
- 単一アイテムおよびウィンドウ操作アイテムのみ表示

#### 処理フロー
1. 一時的にピンモードを変更（モーダルが閉じないようにする）
   - 現在のピンモードが`normal`の場合、一時的に`alwaysOnTop`に変更
2. アイテムを実行
   - **ウィンドウ操作アイテム**: `executeWindowOperation`でウィンドウを操作
   - **単一アイテム**: `openItem`でアイテムを起動
3. ピンモードを元に戻す
   - 一時変更した場合のみ、元の`normal`に戻す

#### 実行内容

**単一アイテムの場合:**
- 現在の入力内容（名前、パス、引数、カスタムアイコン、ウィンドウ設定）で`openItem`を実行
- アイテムは保存されない（試しに実行のみ）

**ウィンドウ操作アイテムの場合:**
- 現在の入力内容（ウィンドウタイトル、位置・サイズ、仮想デスクトップ、アクティブ化）で`executeWindowOperation`を実行
- アイテムは保存されない（試しに実行のみ）

#### ピンモード変更の理由
- デフォルト設定では、アイテム実行時にメインウィンドウとモーダルが自動的に非表示になる
- 試しに実行後もモーダルで編集を続けられるよう、一時的にピンモード（常に最前面表示）に変更
- 実行完了後、元のピンモードに戻す

#### 注意事項
- グループアイテムとフォルダ取込アイテムは直接実行できないため、ボタンは表示されない
- 実行エラーが発生した場合、コンソールにエラーが出力される

## 6. 初期化処理

### モーダルオープン時の初期化

モーダルが開かれた際、状況に応じて異なる初期化処理が実行されます。

#### 編集モードの場合（editingItemあり）
1. 既存アイテムの情報をRegisterItem形式に変換
2. カスタムアイコンがある場合はプレビューを読み込み
3. 保存先タブ/ファイルを現在の設定から取得

#### ドラッグ&ドロップの場合（droppedPathsあり）
1. 各パスに対してアイテム情報を自動検出
2. アイコンを取得（存在する場合）
3. 現在のタブを保存先として設定
4. パスフィールドを読み取り専用に設定

#### 手動登録の場合（どちらもなし）
1. 空のテンプレートアイテムを1つ作成
2. 現在のタブを保存先として設定
3. デフォルト値で初期化

### ウィンドウサイズの調整

モーダル内容に応じてウィンドウサイズが動的に調整されます。

| 条件 | 幅 | 高さ |
|------|-----|------|
| フォルダ取込アイテムあり | 900px | 1000px |
| その他 | 800px | 1000px |

## 7. キーボード操作

### モーダル内のキー制御

| キー | 動作 |
|------|------|
| Escape | モーダルを閉じる（GroupItemSelectorModal表示中は除く） |
| Tab | フォーカス移動（モーダル内で循環） |
| Shift+Tab | フォーカス逆移動（モーダル内で循環） |
| 入力フィールド内の編集キー | 通常の入力操作として許可 |

### フォーカストラップ
- モーダル内でTabキーによるフォーカス移動が循環
- 最後の要素でTabを押すと最初の要素に移動
- 最初の要素でShift+Tabを押すと最後の要素に移動

## 8. 子コンポーネント

### 使用コンポーネント一覧

| コンポーネント | 用途 | 表示条件 |
|---------------|------|----------|
| `WindowConfigEditor` | ウィンドウ設定の編集（タイトル・位置・サイズ・仮想デスクトップ・アクティブ化） | 種別が単一アイテムまたはウィンドウ操作 |
| `CustomIconEditor` | カスタムアイコンの選択・削除 | 種別がフォルダ取込以外 |
| `DirOptionsEditor` | フォルダ取込オプションの編集 | 種別がフォルダ取込 |
| `GroupItemSelectorModal` | グループメンバーの選択 | 追加ボタンクリック時 |
| `FilePickerDialog` | カスタムアイコンファイルの選択 | アイコン選択時 |
| `WindowSelectorModal` | 実行中ウィンドウの選択 | 「ウィンドウから取得」ボタンクリック時 |

### 子コンポーネント詳細

#### WindowConfigEditor

ウィンドウ設定（タイトル・位置・サイズ）を編集するためのコンポーネントです。

**ファイル:** `src/renderer/components/WindowConfigEditor.tsx`

**Props:**
```typescript
interface WindowConfigEditorProps {
  windowConfig?: WindowConfig;
  onChange: (windowConfig: WindowConfig) => void;
  onGetWindowClick: () => void;
  defaultExpanded?: boolean;  // 初期状態で展開するか（デフォルト: false）
  showToggle?: boolean;       // 折りたたみトグルを表示するか（デフォルト: true）
}
```

**提供する機能:**
- ウィンドウタイトル入力
- 位置・サイズ調整（X座標・Y座標・幅・高さの数値入力）
- 仮想デスクトップ移動（デスクトップ番号入力）
- アクティブ化制御（チェックボックス）
- 「ウィンドウから取得」ボタン（WindowSelectorModalを開く）

**表示モード:**
- **単一アイテム**: `showToggle={true}`（デフォルト）で折りたたみ表示
  - 「オプション設定（ウィンドウ切り替え）」という折りたたみボタンが表示されます
  - ヘルプテキスト: 「既存ウィンドウの再利用機能」
  - 説明: ウィンドウが見つからない場合は新規実行
- **ウィンドウ操作アイテム**: `showToggle={false}`で常に展開表示
  - 折りたたみボタンは表示されず、すべての設定が最初から表示されます
  - ヘルプテキスト: 「ウィンドウ操作機能」
  - 説明: ウィンドウが見つからない場合は何も実行しない（警告ログのみ）

**入力検証:**
- **ウィンドウタイトル**: アイテムカテゴリが'window'の場合は必須
- **その他の項目**: すべて任意（省略可能）

#### CustomIconEditor

カスタムアイコンの選択・削除を行うコンポーネントです。

**ファイル:** `src/renderer/components/CustomIconEditor.tsx`

**Props:**
```typescript
interface CustomIconEditorProps {
  customIconPreview?: string;
  onSelectClick: () => void;
  onDeleteClick: () => void;
}
```

**提供する機能:**
- アイコンプレビュー表示
- 「ファイルから選択」ボタン（FilePickerDialogを開く）
- 「削除」ボタン（カスタムアイコンを削除）

**表示パターン:**
- アイコンあり: プレビュー画像と削除ボタンを表示
- アイコンなし: 「カスタムアイコン未設定」メッセージを表示

### ウィンドウ選択モーダル（WindowSelectorModal）

ウィンドウ設定セクションの「ウィンドウから取得」ボタンをクリックすると表示されるモーダルです。

#### 基本情報

| 項目 | 内容 |
|------|------|
| **ファイル名** | `src/renderer/components/WindowSelectorModal.tsx` |
| **コンポーネント名** | `WindowSelectorModal` |
| **スタイル** | `src/renderer/styles/components/WindowSelectorModal.css` |

#### 表示内容

**ヘッダー:**
- タイトル: 「ウィンドウを選択」
- 閉じるボタン（×）

**フィルターセクション:**
- 絞り込み入力欄（タイトルまたはプロセス名で絞り込み）

**ウィンドウリスト:**
- 実行中のウィンドウを一覧表示
- 各ウィンドウの表示項目：
  - アイコン（実行ファイルのアイコン）
  - ウィンドウタイトル
  - 位置: (X, Y)
  - サイズ: 幅 × 高さ
  - プロセス名（実行ファイル名）

**フッター:**
- キャンセルボタン

#### 操作

1. ウィンドウ一覧から選択したいウィンドウをクリック
2. 選択したウィンドウの情報がRegisterModalのウィンドウ設定セクションに自動入力される
3. モーダルが自動的に閉じる

#### データ取得

ウィンドウ情報は以下のIPCチャンネルから取得されます：

- `get-all-windows`: 実行中のすべてのウィンドウ情報を取得

**取得される情報:**
```typescript
interface WindowInfo {
  hwnd: number | bigint;        // ウィンドウハンドル
  title: string;                // ウィンドウタイトル
  x: number;                    // X座標
  y: number;                    // Y座標
  width: number;                // 幅
  height: number;               // 高さ
  processId: number;            // プロセスID
  isVisible: boolean;           // 表示状態
  executablePath?: string;      // 実行ファイルのパス
  icon?: string;                // アイコン（base64エンコードされたデータURL）
}
```

詳細は **[IPCチャンネル - ウィンドウ情報取得](../architecture/ipc-channels.md)** を参照してください。

## 9. 内部機能

### フォーム状態管理

**管理される状態:**
- 編集中のアイテム配列
- 読み込み中フラグ
- バリデーションエラー
- 利用可能なタブ一覧
- グループアイテム選択モーダルの表示状態
- 編集中のアイテムインデックス

**提供される機能:**
- アイテムの値を変更
- バリデーションと登録
- キャンセル処理
- グループアイテムの追加・選択・削除
- 保存先タブの変更

### カスタムアイコン管理

**管理される状態:**
- アイコンプレビューのBase64データ
- ファイル選択ダイアログの状態

**提供される機能:**
- アイコン選択ダイアログを開く/閉じる
- ファイル選択時の処理
- カスタムアイコンの削除
- プレビューの読み込み

## 10. エラーハンドリング

### バリデーションエラー

- 各入力項目の下にエラーメッセージを表示
- エラーのある入力欄には`error`クラスを適用（赤枠表示）
- 入力変更時に該当項目のエラーをクリア

### カスタムアイコンエラー

- アイコン保存失敗時: アラートを表示
- アイコン削除失敗時: アラートを表示
- エラー内容をコンソールに出力

## 11. スタイル

### 主要なCSSクラス

| クラス名 | 説明 |
|---------|------|
| `.register-modal` | モーダルコンテナ |
| `.register-items` | アイテムリストコンテナ |
| `.register-item` | 個々のアイテムフォーム |
| `.item-header` | アイテムヘッダー（アイコン表示） |
| `.form-group` | フォームグループ |
| `.custom-icon-section` | カスタムアイコンセクション |
| `.group-item-list` | グループアイテムリスト |
| `.item-chip` | グループアイテムチップ |
| `.remove-group-item-btn` | グループアイテム削除ボタン（×） |
| `.error` | エラー状態の入力欄 |
| `.error-message` | エラーメッセージ |
| `.readonly` | 読み取り専用入力欄 |

### グループアイテム削除ボタン（×）のスタイル

```css
.remove-group-item-btn {
  background-color: transparent;
  border: none;
  color: var(--color-danger);
  font-size: var(--font-size-xl);
  font-weight: bold; /* 太字で視認性向上 */
  cursor: pointer;
  padding: var(--spacing-xxs) var(--spacing-xs);
  line-height: 1;
  border-radius: 50%; /* 丸いボタン */
  transition: all var(--transition-fast);
  flex-shrink: 0;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.remove-group-item-btn:hover {
  color: var(--color-white);
  background-color: var(--color-danger);
  transform: scale(1.1); /* ホバー時に拡大 */
}

.remove-group-item-btn:active {
  transform: scale(0.95); /* クリック時に縮小 */
}
```

**デザインの特徴:**
- 丸いボタンデザインで他の×ボタンと統一
- 赤色（削除系）で用途を明確化
- ホバー時に背景が赤色に変化して×が白色になる
- クリック時の視覚的フィードバック

詳細は **[CSSデザインシステム - 閉じる・削除ボタンクラス](../architecture/css-design.md#閉じる削除ボタンクラス)** を参照してください。

---

## 6. フォルダ取込アイテムの詳細

フォルダ取込アイテムは、指定したディレクトリ内のファイルやフォルダを動的にインポートする機能です。

### 6.1. データファイル形式

フォルダ取込アイテムの詳細な構文とオプションについては、**[データファイル形式仕様 - フォルダ取込アイテム行の詳細](../architecture/file-formats/data-format.md#フォルダ取込アイテム行の詳細)** を参照してください。

### 6.2. 使用例

#### 基本的な使用
```
// Documents フォルダ直下の全てのファイルとフォルダをインポート
dir,C:\Users\Username\Documents
```

#### 拡張子でフィルタリング
```
// PowerShellスクリプトのみをインポート
dir,C:\Scripts,filter=*.ps1

// 複数の拡張子を指定
dir,C:\Documents,filter=*.{doc,docx,pdf}
```

#### サブディレクトリを含める
```
// 2階層下までの全てのファイルをインポート
dir,C:\Projects,depth=2,types=file

// 全てのサブディレクトリを再帰的にスキャン
dir,C:\Source,depth=-1
```

#### 除外パターンの使用
```
// node_modulesフォルダを除外
dir,C:\Projects,exclude=node_modules,depth=2

// 一時ファイルを除外
dir,C:\Work,exclude=*.{tmp,temp,bak}
```

#### プレフィックスの追加
```
// "Work: " プレフィックスを追加
dir,C:\WorkProjects,prefix=Work

// フィルターと組み合わせ
dir,C:\Tools,filter=*.exe,prefix=Tool
```

#### サフィックスの追加
```
// " (Dev)" サフィックスを追加
dir,C:\Projects,suffix=Dev

// プレフィックスとサフィックスの組み合わせ
dir,C:\Tools,prefix=Work,suffix=Tool
# 結果: "Work: ToolName (Tool)"
```

#### 複雑な組み合わせ
```
// Projectsフォルダから、node_modulesを除外し、
// .jsと.tsファイルのみを2階層下まで検索し、
// "Src: "プレフィックスと" (Dev)"サフィックスを追加
dir,C:\Projects,depth=2,types=file,filter=*.{js,ts},exclude=node_modules,prefix=Src,suffix=Dev
# 結果: "Src: filename.js (Dev)"
```

### 6.3. 特殊な処理

#### ショートカットファイル（.lnk）
`.lnk`ファイルは自動的に解析され、ターゲットのパスと引数が抽出されます。

#### 実行可能ファイル
`.exe`、`.bat`、`.cmd`、`.com`ファイルは`app`タイプとして認識されます。

**注:** `.bat`、`.cmd`、`.com`ファイルは、アイコン取得時に拡張子ベースのアイコン取得方式が使用されます（ファイル自体にアイコンリソースがないため）。

### 6.4. フォルダ取込アイテムの確認方法

メインウィンドウで、フォルダ取込から展開されたアイテムにマウスをホバーすると、ツールチップで以下の情報が確認できます：

- **取込元**: フォルダ取込アイテムの元ディレクトリパス
- **設定**: フォルダ取込時に指定されたオプション情報（深さ、タイプ、フィルター等）

#### ツールチップの表示例

```
C:\Work\projects\myproject\readme.pdf

データファイル: data.json
ID: abc123
取込元: C:\Work\projects
設定: 深さ:2, タイプ:ファイルのみ, フィルター:*.pdf
```

この機能により、どのフォルダ取込アイテムから展開されたかを簡単に確認できます。

### 6.5. 注意事項

1. **パフォーマンス**: 深い階層や大量のファイルを含むディレクトリをスキャンする場合、処理時間が長くなる可能性があります。
2. **アクセス権限**: アクセス権限のないディレクトリやファイルはスキップされます。
3. **重複**: 複数のフォルダ取込アイテムで同じファイルがインポートされた場合、パスベースで重複が除去されます。

---

## 7. ウィンドウ操作アイテムの詳細

ウィンドウ操作アイテムは、指定したウィンドウを特定の位置・サイズに配置し、仮想デスクトップを切り替える機能を提供します。

### 7.1. 概要

ウィンドウ操作アイテムを実行すると、以下の操作が可能です：

- ウィンドウタイトルでウィンドウを検索
- 指定した座標・サイズにウィンドウを配置
- 指定した仮想デスクトップに移動
- ウィンドウをアクティブ化（フォーカス）

### 7.2. data.jsonでの記述形式

ウィンドウ操作アイテムは、`data.json`に以下の形式で記述します：

```json
{
  "id": "a1B2c3D4",
  "type": "window",
  "name": "表示名",
  "windowTitle": "ウィンドウタイトル",
  "x": 100,
  "y": 200
}
```

#### 重要な注意点

- **JSON形式のみサポート**：v0.6.0以降はJSON形式専用です

### 7.3. JSON形式の仕様

#### 必須フィールド

| フィールド名 | 型 | 説明 |
|------------|------|------|
| `name` | string | Quick Dash Launcherで表示される名前 |
| `windowTitle` | string | 操作対象のウィンドウタイトル（部分一致または完全一致） |

#### オプションフィールド

| フィールド名 | 型 | 説明 | デフォルト |
|------------|------|------|-----------|
| `exactMatch` | boolean | ウィンドウタイトルの完全一致で検索するか | `false`（部分一致） |
| `processName` | string | プロセス名で検索（部分一致、例: "chrome"） | 指定なし |
| `x` | number | ウィンドウのX座標（左端） | 現在位置を維持 |
| `y` | number | ウィンドウのY座標（上端） | 現在位置を維持 |
| `width` | number | ウィンドウの幅（ピクセル） | 現在サイズを維持 |
| `height` | number | ウィンドウの高さ（ピクセル） | 現在サイズを維持 |
| `virtualDesktopNumber` | number | 仮想デスクトップ番号（1始まり） | 現在のデスクトップ |
| `activateWindow` | boolean | ウィンドウをアクティブ化するか | `true` |

#### 記述例

**基本的な例（必須フィールドのみ）**

```
window,"{""name"":""Chrome"",""windowTitle"":""Google Chrome""}"
```

**表示名**: `Chrome`
**動作**: 「Google Chrome」を含むウィンドウを検索してアクティブ化

**すべてのフィールドを含む例**

```
window,"{""name"":""TODOキャンパス"",""windowTitle"":""Obsidian"",""x"":2565,""y"":0,""width"":1990,""height"":1392,""virtualDesktopNumber"":2,""activateWindow"":false}"
```

**表示名**: `TODOキャンパス`
**動作**:
- 「Obsidian」を含むウィンドウを検索
- 座標 (2565, 0) に移動
- サイズを 1990x1392 に変更
- 仮想デスクトップ2に移動
- ウィンドウをアクティブ化しない（`activateWindow: false`）

**位置のみ指定（サイズは変更しない）**

```
window,"{""name"":""MS To DO"",""windowTitle"":""Microsoft To Do"",""x"":1273,""y"":1,""virtualDesktopNumber"":2,""activateWindow"":false}"
```

**動作**: ウィンドウを指定位置に移動するが、サイズは現在のまま維持

**完全一致で検索**

```
window,"{""name"":""Google Chrome"",""windowTitle"":""Google Chrome"",""exactMatch"":true}"
```

**動作**: ウィンドウタイトルが正確に「Google Chrome」であるウィンドウのみを検索（部分一致では「Google Chrome - タブ名」などもマッチするが、完全一致では除外される）

**プロセス名で検索**

```
window,"{""name"":""Chromeプロセス"",""windowTitle"":"""",""processName"":""chrome""}"
```

**動作**: プロセス名に「chrome」を含むウィンドウ（例: chrome.exe）を検索してアクティブ化

**ウィンドウタイトルとプロセス名の複合条件**

```
window,"{""name"":""Chrome開発者ツール"",""windowTitle"":""DevTools"",""processName"":""chrome""}"
```

**動作**: ウィンドウタイトルに「DevTools」を含み、かつプロセス名に「chrome」を含むウィンドウを検索（AND条件）

### 7.4. 別の仮想デスクトップのウィンドウ操作（v0.5.12以降）

#### 概要

v0.5.12以降、ウィンドウが別の仮想デスクトップにある場合でも、**デスクトップを切り替えることなく**位置・サイズを設定できます。これにより、現在の作業を中断することなく、他のデスクトップのウィンドウを整理できます。

#### 主な機能

- **全仮想デスクトップからウィンドウを自動検索**
  - 現在のデスクトップだけでなく、すべての仮想デスクトップからウィンドウを検索
  - cloaked window（別デスクトップの非表示ウィンドウ）も検索対象

- **デスクトップ切り替えなしで設定**
  - 別デスクトップのウィンドウに対して、デスクトップを切り替えずに位置・サイズを直接設定
  - ユーザーの現在の作業を中断しない

- **確実な設定反映**
  - リトライロジック（最大3回、50ms間隔）で確実に設定を反映

#### 使用例

**デスクトップ2のObsidianウィンドウを設定（デスクトップ1から実行）**

```
window,"{""name"":""TODOキャンパス"",""windowTitle"":""Obsidian"",""x"":2565,""y"":0,""width"":1990,""height"":1392,""virtualDesktopNumber"":2}"
```

**動作**:
1. 現在デスクトップ1にいる状態で実行
2. すべての仮想デスクトップから「Obsidian」を検索
3. デスクトップ2で見つかったObsidianウィンドウの位置・サイズを設定
4. **デスクトップ1のまま処理完了**（デスクトップ2には切り替わらない）

#### 技術詳細

- **実装場所**:
  - `src/main/utils/windowActivator.ts`
  - `src/main/utils/virtualDesktopControl.ts`

- **検索パラメータ**: `includeAllVirtualDesktops: true`で全デスクトップ検索

- **設定方法**: `SetWindowPos()` Win32 APIで直接位置・サイズを設定

- **リトライ**: 最大3回（50ms間隔）で確実に設定を反映

#### 従来の動作との違い

| 項目 | v0.5.11以前 | v0.5.12以降 |
|-----|-----------|-----------|
| **検索範囲** | 現在のデスクトップのみ | すべての仮想デスクトップ |
| **デスクトップ切り替え** | ウィンドウのデスクトップに切り替え | 切り替えなし（現在のデスクトップを維持） |
| **位置・サイズ設定** | デスクトップ移動後に設定 | 直接設定（移動不要） |
| **ユーザー体験** | 画面が一瞬切り替わる | 作業を中断しない |

#### 注意事項

- ウィンドウのアクティブ化（フォーカス）は、現在のデスクトップにあるウィンドウのみ可能です
- 別デスクトップのウィンドウに対して`activateWindow: true`を指定しても、フォーカスは移りません（位置・サイズのみ設定されます）

### 7.5. アイテムの登録・編集方法

#### 新規登録

1. メイン画面で「登録」タブを開く
2. 「ウィンドウ操作」を選択
3. 各フィールドに値を入力
   - **表示名**: Quick Dash Launcherで表示される名前
   - **ウィンドウタイトル**: 操作対象のウィンドウタイトル（部分一致）
   - **X座標、Y座標、幅、高さ**: オプション（未入力の場合は現在値を維持）
   - **仮想デスクトップ番号**: オプション（未入力の場合は現在のデスクトップ）
   - **ウィンドウをアクティブ化**: チェックを外すとフォーカスを移さない

#### 編集方法

**方法1: 詳細編集モーダル（推奨）**

1. メイン画面でアイテムを右クリック → 「編集」
2. または、管理画面で✏️ボタンをクリック
3. 各フィールドを編集して「更新」

**方法2: 管理画面での直接編集（名前のみ）**

- 管理画面の「名前」列をダブルクリックして編集可能
- **注意**: 「パス・引数」列は編集不可（詳細編集モーダルを使用してください）

#### data.jsonを直接編集する場合

**推奨しません**が、直接編集する場合は以下に注意してください：

1. JSON形式を厳密に守る（カンマ、クォートの位置）
2. 編集後、アプリを再起動して変更を反映

### 7.6. よくあるエラーと対処法

#### エラー1: 「ウィンドウ操作アイテムのJSON形式が不正です」

**原因**: JSON構文エラー（閉じ括弧忘れ、カンマの位置ミス等）

**対処法**:
```json
❌ {"name":"表示名"  （閉じ括弧なし）
❌ {"name":"表示名","windowTitle":"Chrome",}  （末尾カンマ）
✅ {"name":"表示名","windowTitle":"Chrome"}
```

#### エラー2: 編集後にアイテムが表示されない

**原因**: data.jsonの該当行が破損している

**対処法**:
1. data.jsonをテキストエディタで開く
2. 該当行のJSON形式を確認
3. JSON構文を修正
4. アプリを再起動

#### エラー3: ウィンドウが見つからない

**原因**: `windowTitle`がウィンドウの実際のタイトルと一致していない

**対処法**:
1. PowerShellで以下のコマンドを実行し、正確なウィンドウタイトルを確認:
   ```powershell
   Get-Process | Where-Object {$_.MainWindowTitle -ne ""} | Select-Object MainWindowTitle
   ```
2. `windowTitle`フィールドに部分一致する文字列を設定

### 7.7. 実装上の注意点

#### コード内での処理

ウィンドウ操作アイテムは以下のように処理されます：

1. **パース**: JSON形式として解析
2. **検証**: 必須フィールド（`name`, `windowTitle`）の存在を確認
3. **実行**: Mainプロセスで`WindowManager`クラスがウィンドウ操作を実行

#### パース時のエラーハンドリング

JSON解析はエラー時にthrowするため、必ずtry-catchで囲んでください：

```typescript
try {
  const config = JSON.parse(jsonString);
  // 処理を続行
} catch (error) {
  console.error('JSON形式が不正です:', error);
  // ユーザーにエラーメッセージを表示
  alert(error instanceof Error ? error.message : 'JSON形式が不正です');
}
```

#### 関連ドキュメント

- **[データ形式仕様](../architecture/file-formats/data-format.md)** - data.jsonの全体的な形式仕様
- **[ウィンドウ制御](../architecture/window-control.md)** - ウィンドウ操作の内部実装

#### 変更履歴

- **v0.6.0以降**: JSON形式のみをサポート
