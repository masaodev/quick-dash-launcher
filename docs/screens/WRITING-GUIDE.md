# 画面仕様書 執筆ガイドライン

このドキュメントは、画面仕様書を執筆する際のルールとベストプラクティスを定義します。

## 基本方針

### 目的
画面仕様書は**機能・挙動を主眼**とした記載にする。

**重要**: メソッド名を消すこと自体が目的ではない。説明の主体を「何をするか（機能・挙動）」に置くことが目的。

### 主眼とすべき記載
- **ユーザー操作に対する動作**（何が起こるか）
- **画面の状態遷移**（どう変わるか）
- **表示条件・表示内容**（何が見えるか）
- **エラー時の挙動**（何が表示されるか）

---

## 書くべきこと

### 1. ユーザー視点の動作説明

```
Good: アイテムを実行（開く）
Good: 選択を先頭にリセット
Good: 入力に応じてアイテムをフィルタリング
Good: ウィンドウを非表示にする
```

### 2. 具体的な処理フロー

```
Good:
1. データファイル（data.txt）を読み込み
2. パースしてアイテム配列に変換
3. アイコンキャッシュを適用
4. アイテムリストを表示
```

### 3. 表示条件・状態遷移

```
Good:
- 録画中：入力フィールドのスタイルが変化（`.recording`クラス）
- 無効時：グレーアウト（`.disabled`クラス）
```

### 4. エラーハンドリング

```
Good:
- コピー失敗時はAlertDialogでエラー表示
- パス取得失敗時: 「ファイルパスを取得できませんでした」を表示
```

---

## 避けるべきこと

### 1. API呼び出しの直接記載

```
Bad:  `window.electronAPI.openItem(item)`を実行
Good: アイテムを実行（開く）

Bad:  `window.electronAPI.copyToClipboard(path)`でコピー
Good: クリップボードにコピー
```

### 2. 状態更新関数の記載

```
Bad:  `setSelectedIndex(0)`で選択をリセット
Good: 選択を先頭にリセット

Bad:  `setIsRecording(true)`で録画モードに入る
Good: 録画モードを開始
```

### 3. イベントハンドラ名の記載

```
Bad:  `handleItemClick`を実行
Good: クリックしたアイテムを開く

Bad:  `handleToggleSelection`で選択状態を切り替え
Good: 選択状態を切り替え
```

### 4. 処理フロー内のTypeScriptコードブロック

```
Bad:
1. 以下のコードでフィルタリング
   ```typescript
   const filtered = items.filter(item =>
     item.name.toLowerCase().includes(query)
   );
   ```

Good:
1. 入力文字列でアイテム名を部分一致フィルタリング（大文字小文字区別なし）
```

---

## メソッド名の扱い

メソッド名は**補足として括弧書き**で残すことは許容される。

```
OK: アイテムを実行する（`openItem`）
OK: データを読み込み（`parseDataFiles`）
OK: フィルタリングされたアイテムリストを表示
```

ただし、メソッド名がなくても意味が通じる場合は省略を推奨。

```
Better: アイテムを実行（開く）
Better: データファイルを読み込み
```

---

## 維持するもの

### 1. 使用例セクションのコード

コンポーネントの使用例は、そのままTypeScript/JSXコードで記載してよい。

```tsx
// これはOK - 使用例セクション
<HotkeyInput
  value={hotkey}
  onChange={setHotkey}
  onValidationChange={(isValid, reason) => {
    setValidationError(isValid ? undefined : reason);
  }}
/>
```

### 2. Props定義の型情報

Props定義は表形式で型情報を含めて記載する。

| プロパティ | 型 | 必須 | 説明 |
|-----------|------|:----:|------|
| `value` | `string` | ○ | 現在のホットキー値 |
| `onChange` | `(hotkey: string) => void` | ○ | 変更時のコールバック |

### 3. CSSクラス名

スタイルセクションでのCSSクラス名は記載してよい。

| クラス名 | 説明 |
|---------|------|
| `.hotkey-input` | 入力フィールド |
| `.hotkey-input.recording` | 録画中の入力フィールド |

---

## 変換パターン集

### パターン1: API呼び出し → 機能説明

```
Before: `window.electronAPI.openItem(item)`を実行
After:  アイテムを実行（開く）
```

### パターン2: 状態更新 → 挙動説明

```
Before: `setSelectedIndex(0)`で選択をリセット
After:  選択を先頭にリセット
```

### パターン3: 関数呼び出し → 動作説明

```
Before: `filterItems`関数でアイテムをフィルタリング
After:  入力に応じてアイテムをフィルタリング
```

### パターン4: 条件分岐 → 表示条件

```
Before: `if (item.type === 'url')` の場合
After:  URLアイテムの場合
```

### パターン5: 複合処理

```
Before:
1. `window.electronAPI.readDataFile()`でデータを読み込み
2. `parseItems(data)`でパース
3. `setItems(parsed)`で状態を更新

After:
1. データファイルを読み込み
2. パースしてアイテム配列に変換
3. アイテムリストを更新
```

---

## セクション構成ガイド

### 必須セクション
- 関連ドキュメント
- 概要（主要機能含む）
- 基本情報
- 画面項目一覧
- 機能詳細

### 条件付きセクション
- **Props**: コンポーネントの場合のみ
- **アクション一覧**: 大きな画面（多くのアクションがある場合）のみ
- **キーボード操作**: キーボード操作がある場合のみ
- **スタイル**: スタイル定義が重要な場合のみ
- **使用例**: コンポーネントの場合のみ

---

## 関連ドキュメント

- [テンプレート](./TEMPLATE.md) - 新規作成時のテンプレート
- [画面一覧](./README.md) - 全画面構成の概要
