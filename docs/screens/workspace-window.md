# ワークスペースウィンドウ 仕様書

## 関連ドキュメント

- [画面一覧](./README.md) - 全画面構成の概要
- [ワークスペース機能](../features/workspace.md) - 機能の使い方
- [データファイル形式](../architecture/data-format.md) - workspace.json形式
- [IPC通信](../architecture/ipc-channels.md) - ワークスペース関連のIPCチャンネル
- [管理ウィンドウ仕様書](./admin-window.md) - アーカイブタブの詳細

## 1. 概要

よく使うアイテムを登録して、画面右端の専用ウィンドウで素早くアクセスできる機能です。グループ化、名前変更、並び替えに対応し、実行履歴も表示します。

**キーボードショートカット**: `Ctrl+Alt+W` (表示/非表示切り替え)

### 主要機能
- **アイテム管理**: メイン画面からアイテムを追加・削除・名前変更
- **グループ管理**: アイテムをグループに分類して整理
- **ドラッグ&ドロップ**: アイテムの並び替えやグループ間移動
- **実行履歴**: 直近10件の実行履歴を表示・再起動
- **コンテキストメニュー**: 右クリックで各種操作
- **アーカイブ**: グループ単位でアーカイブ・復元
- **ピン留め**: ウィンドウを最前面に固定表示
- **ペースト機能**: クリップボードからファイル・フォルダ・URLを追加（v0.5.1以降）

## 2. 基本情報

| 項目 | 内容 |
|------|------|
| **ファイル名** | `src/renderer/WorkspaceApp.tsx` |
| **コンポーネント名** | `WorkspaceApp` |
| **スタイル** | `src/renderer/styles/components/WorkspaceWindow.css` |
| **表示条件** | `Ctrl+Alt+W`または、システムトレイメニューから「ワークスペースを表示」 |
| **画面タイプ** | ウィンドウ（AlwaysOnTop、フレームレス） |
| **ウィンドウサイズ** | 幅380px × 画面の高さに合わせて自動調整 |
| **配置位置** | 画面右端に固定 |

## 3. 画面項目一覧

| エリア | 項目名 | 内容・説明 | 表示条件 | 機能詳細 |
|--------|--------|------------|----------|----------|
| **ヘッダー** | タイトル | 「Workspace」の表示 | 常時表示 | - |
| **ヘッダー** | 全て展開ボタン（🔽） | すべてのグループと未分類・実行履歴セクションを展開 | 常時表示 | [4.1](#41-全て展開ボタンをクリック) |
| **ヘッダー** | 全て閉じるボタン（🔼） | すべてのグループと未分類・実行履歴セクションを折りたたむ | 常時表示 | [4.2](#42-全て閉じるボタンをクリック) |
| **ヘッダー** | グループ追加ボタン（➕） | 新しいグループを追加 | 常時表示 | [4.3](#43-グループ追加ボタンをクリック) |
| **ヘッダー** | アーカイブボタン（📦） | 管理ウィンドウのアーカイブタブを開く | 常時表示 | [4.4](#44-アーカイブボタンをクリック) |
| **ヘッダー** | ピン留めボタン（📌） | ウィンドウを最前面に固定 | 常時表示 | [4.5](#45-ピン留めボタンをクリック) |
| **ヘッダー** | 閉じるボタン（×） | ウィンドウを非表示 | 常時表示 | [4.6](#46-閉じるボタンをクリック) |
| **グループ** | グループヘッダー | グループ名と操作ボタン | グループ存在時 | [4.7](#47-グループヘッダー操作) |
| **グループ** | └ 折りたたみボタン（▼/▶） | グループの折りたたみ/展開 | グループ存在時 | [4.7.1](#471-折りたたみボタンをクリック) |
| **グループ** | └ グループ名 | グループ名（ダブルクリックで編集可能） | グループ存在時 | [4.7.2](#472-グループ名をダブルクリック) |
| **グループ** | └ 編集ボタン（✏️） | グループ名を編集モードに | グループ存在時 | [4.7.3](#473-編集ボタンをクリック) |
| **グループ** | └ 色変更ボタン（🎨） | グループの色を変更 | グループ存在時 | [4.7.4](#474-色変更ボタンをクリック) |
| **グループ** | └ アーカイブボタン（📦） | グループとアイテムをアーカイブに移動 | グループ存在時 | [4.7.5](#475-アーカイブボタンをクリック) |
| **グループ** | └ 削除ボタン（🗑️） | グループを削除（アイテムは未分類に移動） | グループ存在時 | [4.7.6](#476-削除ボタンをクリック) |
| **グループ** | アイテムカード | グループ内のアイテム一覧 | グループ内にアイテム存在時 | [4.8](#48-アイテムカード操作) |
| **未分類** | 未分類セクション | グループに所属していないアイテム | 未分類アイテム存在時 | [4.9](#49-未分類セクション操作) |
| **実行履歴** | 実行履歴セクション | 直近10件の実行履歴 | 実行履歴存在時 | [4.10](#410-実行履歴セクション操作) |
| **全体** | コンテキストメニュー | 右クリック時の操作メニュー | 右クリック時 | [4.11](#411-コンテキストメニュー操作) |
| **全体** | ドラッグ&ドロップオーバーレイ | ドラッグ中の視覚的フィードバック | ドラッグ中 | [4.12](#412-ドラッグドロップ操作) |

## 4. アクション一覧

| No | アクション名 | トリガー | 主な処理内容 | 詳細 |
|----|------------|---------|------------|------|
| 4.1 | 全て展開ボタンをクリック | 🔽ボタンクリック | すべてのグループと未分類・実行履歴セクションを展開 | [詳細](#41-全て展開ボタンをクリック) |
| 4.2 | 全て閉じるボタンをクリック | 🔼ボタンクリック | すべてのグループと未分類・実行履歴セクションを折りたたむ | [詳細](#42-全て閉じるボタンをクリック) |
| 4.3 | グループ追加ボタンをクリック | ➕ボタンクリック | 新しいグループを追加して編集モードに入る | [詳細](#43-グループ追加ボタンをクリック) |
| 4.4 | アーカイブボタンをクリック | 📦ボタンクリック | 管理ウィンドウのアーカイブタブを開く | [詳細](#44-アーカイブボタンをクリック) |
| 4.5 | ピン留めボタンをクリック | 📌ボタンクリック | ウィンドウを最前面に固定/解除 | [詳細](#45-ピン留めボタンをクリック) |
| 4.6 | 閉じるボタンをクリック | ×ボタンクリック | ウィンドウを非表示 | [詳細](#46-閉じるボタンをクリック) |
| 4.7 | グループヘッダー操作 | グループヘッダーの各種ボタンクリック | グループの折りたたみ、編集、色変更、アーカイブ、削除 | [詳細](#47-グループヘッダー操作) |
| 4.7.1 | 折りたたみボタンをクリック | ▼/▶ボタンクリック | グループの折りたたみ/展開 | [詳細](#471-折りたたみボタンをクリック) |
| 4.7.2 | グループ名をダブルクリック | グループ名ダブルクリック | グループ名を編集モードに | [詳細](#472-グループ名をダブルクリック) |
| 4.7.3 | 編集ボタンをクリック | ✏️ボタンクリック | グループ名を編集モードに | [詳細](#473-編集ボタンをクリック) |
| 4.7.4 | 色変更ボタンをクリック | 🎨ボタンクリック | グループの色を変更 | [詳細](#474-色変更ボタンをクリック) |
| 4.7.5 | アーカイブボタンをクリック | 📦ボタンクリック | グループとアイテムをアーカイブに移動 | [詳細](#475-アーカイブボタンをクリック) |
| 4.7.6 | 削除ボタンをクリック | 🗑️ボタンクリック | グループを削除（アイテムは未分類に移動） | [詳細](#476-削除ボタンをクリック) |
| 4.8 | アイテムカード操作 | アイテムカードの各種操作 | アイテムの起動、名前変更、削除 | [詳細](#48-アイテムカード操作) |
| 4.8.1 | アイテムをクリック | アイテムクリック | アイテムを起動 | [詳細](#481-アイテムをクリック) |
| 4.8.2 | アイテム名をダブルクリック | アイテム名ダブルクリック | アイテム名を編集モードに | [詳細](#482-アイテム名をダブルクリック) |
| 4.8.3 | 削除ボタンをクリック | ×ボタンクリック | アイテムをワークスペースから削除 | [詳細](#483-削除ボタンをクリック) |
| 4.8.4 | アイテムにマウスホバー | アイテムにホバー | ツールチップで詳細情報を表示 | [詳細](#484-アイテムにマウスホバー) |
| 4.9 | 未分類セクション操作 | 未分類セクションの各種操作 | 未分類アイテムの折りたたみ/展開 | [詳細](#49-未分類セクション操作) |
| 4.10 | 実行履歴セクション操作 | 実行履歴セクションの各種操作 | 実行履歴の折りたたみ/展開、再起動、コピー | [詳細](#410-実行履歴セクション操作) |
| 4.11 | コンテキストメニュー操作 | 右クリック / メニュー項目選択 | 右クリックメニューの表示と各種操作 | [詳細](#411-コンテキストメニュー操作) |
| 4.12 | ドラッグ&ドロップ操作 | ドラッグ / ドロップ操作 | アイテムの並び替え、グループ間移動、ネイティブファイル追加 | [詳細](#412-ドラッグドロップ操作) |
| 4.13 | Ctrl+Vでペースト | Ctrl+Vキー押下 | クリップボードからファイル・フォルダ・URLを追加 | [詳細](#413-ctrlvでペースト) |
| 4.14 | グループ名を編集 | 編集モード時のテキスト入力 / Enterキー | グループ名の変更を確定 | [詳細](#414-グループ名を編集) |
| 4.15 | アイテム名を編集 | 編集モード時のテキスト入力 / Enterキー | アイテム名の変更を確定 | [詳細](#415-アイテム名を編集) |
| 4.16 | 編集モードでEscapeキー押下 | Escapeキー | 編集をキャンセル | [詳細](#416-編集モードでescapeキー押下) |

## 5. 機能詳細

### 4.1. 全て展開ボタンをクリック

#### アクション
- ヘッダーの「🔽」ボタンをクリック

#### 処理フロー
1. すべてのグループセクションを展開
2. 未分類セクションを展開
3. 実行履歴セクションを展開
4. 各セクションのアイテムが表示される

### 4.2. 全て閉じるボタンをクリック

#### アクション
- ヘッダーの「🔼」ボタンをクリック

#### 処理フロー
1. すべてのグループセクションを折りたたむ
2. 未分類セクションを折りたたむ
3. 実行履歴セクションを折りたたむ
4. 各セクションのアイテムが非表示になる

### 4.3. グループ追加ボタンをクリック

#### アクション
- ヘッダーの「➕」ボタンをクリック

#### 処理フロー
1. 新しいグループを作成
2. グループ名をデフォルト値（「新しいグループ」）で初期化
3. グループ名の編集モードに入る
4. グループをリストの末尾に追加
5. データを保存

#### 表示条件
- ボタンは常時表示

### 4.4. アーカイブボタンをクリック

#### アクション
- ヘッダーの「📦」ボタンをクリック

#### 処理フロー
1. 管理ウィンドウを開く
2. アーカイブタブを選択状態で表示
3. アーカイブされたグループ一覧を表示

#### 関連ドキュメント
- [管理ウィンドウ仕様書 - アーカイブタブ](./admin-window.md#アーカイブ)

### 4.5. ピン留めボタンをクリック

#### アクション
- ヘッダーの「📌」ボタンをクリック

#### 処理フロー
1. ピン留め状態を切り替え
2. ピン留めON時：
   - ウィンドウを常に最前面に固定
   - ボタンのスタイルを「pinnedクラス」に変更
   - ツールチップを「ピン留めを解除」に変更
3. ピン留めOFF時：
   - 通常の表示レイヤーに戻す
   - ボタンのスタイルを通常に戻す
   - ツールチップを「ピン留めして最前面に固定」に変更
4. 状態を保存

### 4.6. 閉じるボタンをクリック

#### アクション
- ヘッダーの「×」ボタンをクリック

#### 処理フロー
1. ウィンドウを非表示にする
2. ワークスペースデータは保持される

### 4.7. グループヘッダー操作

グループヘッダーには以下のボタンがあります：
- 折りたたみボタン（▼/▶）
- 編集ボタン（✏️）
- 色変更ボタン（🎨）
- アーカイブボタン（📦）
- 削除ボタン（🗑️）

#### 4.7.1. 折りたたみボタンをクリック

##### アクション
- グループヘッダーの「▼」または「▶」ボタンをクリック

##### 処理フロー
1. グループの折りたたみ状態を切り替え
2. 折りたたみON時：
   - グループ内のアイテムを非表示
   - ボタンを「▶」に変更
3. 折りたたみOFF時：
   - グループ内のアイテムを表示
   - ボタンを「▼」に変更

#### 4.7.2. グループ名をダブルクリック

##### アクション
- グループヘッダーのグループ名をダブルクリック

##### 処理フロー
1. グループ名の編集モードに入る
2. テキスト入力フィールドに変更
3. 現在のグループ名を選択状態で表示
4. フォーカスを入力フィールドに移動

#### 4.7.3. 編集ボタンをクリック

##### アクション
- グループヘッダーの「✏️」ボタンをクリック

##### 処理フロー
1. グループ名の編集モードに入る（4.7.2と同様）
2. テキスト入力フィールドに変更
3. 現在のグループ名を選択状態で表示
4. フォーカスを入力フィールドに移動

#### 4.7.4. 色変更ボタンをクリック

##### アクション
- グループヘッダーの「🎨」ボタンをクリック

##### 処理フロー
1. 色選択メニューを表示
2. 以下の色から選択可能：
   - 青（デフォルト）
   - 緑
   - 黄
   - 赤
   - 紫
   - ピンク
   - オレンジ
   - 水色
3. 色を選択
4. グループヘッダーの背景色を変更
5. データを保存

#### 4.7.5. アーカイブボタンをクリック

##### アクション
- グループヘッダーの「📦」ボタンをクリック

##### 処理フロー
1. 確認ダイアログを表示：「グループ「{グループ名}」と{N}個のアイテムをアーカイブしますか？」
2. OKの場合：
   - グループとその中のすべてのアイテムをアーカイブに移動
   - ワークスペースから削除
   - アーカイブデータを保存
3. キャンセルの場合：処理を中止

#### 4.7.6. 削除ボタンをクリック

##### アクション
- グループヘッダーの「🗑️」ボタンをクリック

##### 処理フロー
1. 確認ダイアログを表示：「グループ「{グループ名}」を削除しますか？グループ内のアイテムは未分類に移動します。」
2. OKの場合：
   - グループを削除
   - グループ内のアイテムを未分類に移動
   - データを保存
3. キャンセルの場合：処理を中止

### 4.8. アイテムカード操作

アイテムカードには以下の機能があります：
- クリックで起動
- ダブルクリックで名前編集
- ×ボタンで削除
- マウスホバーで詳細表示

#### 4.8.1. アイテムをクリック

##### アクション
- アイテムカードをクリック

##### 処理フロー
1. アイテムを起動（開く）
2. アイテムの種別に応じて実行：
   - URL: デフォルトブラウザで開く
   - ファイル: 関連付けられたアプリで開く
   - フォルダ: エクスプローラーで開く
   - アプリケーション: 実行ファイルを起動
3. 実行履歴に記録（ExecutionHistoryItem）

#### 4.8.2. アイテム名をダブルクリック

##### アクション
- アイテムカードのアイテム名をダブルクリック

##### 処理フロー
1. アイテム名の編集モードに入る
2. テキスト入力フィールドに変更
3. 現在のアイテム名を選択状態で表示
4. フォーカスを入力フィールドに移動

#### 4.8.3. 削除ボタンをクリック

##### アクション
- アイテムカードの「×」ボタンをクリック（ホバー時に表示）

##### 処理フロー
1. アイテムをワークスペースから削除
2. データを保存

#### 4.8.4. アイテムにマウスホバー

##### アクション
- アイテムカードにマウスカーソルをホバー

##### 処理フロー
1. ツールチップを表示
2. ツールチップには以下の情報を表示：
   - パス
   - リンク先（ショートカットの場合）
   - 引数（設定されている場合）
   - 元の名前（変更している場合）
   - 追加日時

##### ツールチップ表示例

**通常のアイテム:**
```
C:\Users\Desktop\myapp.exe

追加日時: 2025-12-18 10:30:45
```

**名前変更済みアイテム:**
```
C:\Users\Desktop\myapp.exe

元の名前: My Application
追加日時: 2025-12-18 10:30:45
```

**引数付きアイテム:**
```
C:\Program Files\Code\Code.exe --new-window

追加日時: 2025-12-18 10:30:45
```

**ショートカットファイル:**
```
リンク先: C:\Program Files\App\app.exe

追加日時: 2025-12-18 10:30:45
```

### 4.9. 未分類セクション操作

#### アクション
- 未分類セクションヘッダーの「▼」または「▶」ボタンをクリック

#### 処理フロー
1. 未分類セクションの折りたたみ状態を切り替え
2. 折りたたみON時：
   - 未分類アイテムを非表示
   - ボタンを「▶」に変更
3. 折りたたみOFF時：
   - 未分類アイテムを表示
   - ボタンを「▼」に変更

#### 表示条件
- 未分類アイテムが存在する場合のみ表示

### 4.10. 実行履歴セクション操作

#### アクション
実行履歴セクションでの操作

#### 処理フロー

**折りたたみボタンをクリック:**
1. 実行履歴セクションの折りたたみ状態を切り替え
2. 折りたたみON時：
   - 実行履歴アイテムを非表示
   - ボタンを「▶」に変更
3. 折りたたみOFF時：
   - 実行履歴アイテムを表示
   - ボタンを「▼」に変更

**実行履歴アイテムをクリック:**
1. アイテムを再起動
2. 新しい実行履歴として記録
3. 実行時刻を更新

**実行履歴アイテムをドラッグ&ドロップ:**
1. 実行履歴アイテムをグループまたは未分類セクションにドラッグ
2. ドロップ先にアイテムをコピー
3. ワークスペースアイテムとして追加
4. 元の実行履歴は保持される

#### 実行履歴アイテムのツールチップ

実行履歴アイテムにマウスホバーすると、以下の情報を表示：

**引数なし:**
```
C:\Program Files\App\app.exe

実行日時: 2025-12-18 15:45:30
```

**引数あり:**
```
C:\Program Files\Code\Code.exe --new-window
引数: --new-window

実行日時: 2025-12-18 15:45:30
```

#### 表示条件
- 実行履歴が存在する場合のみ表示
- 最大10件まで保持（古いものから自動削除）

### 4.11. コンテキストメニュー操作

#### アクション
- アイテムを右クリック

#### 処理フロー
1. クリック位置（マウス座標）を取得
2. 画面端の場合は表示位置を自動調整
3. コンテキストメニューを表示
4. アイテムの種類に応じてメニュー項目を動的に生成

#### メニュー項目

| メニュー項目 | 説明 | 表示条件 |
|------------|------|----------|
| **✏️ 名前を変更** | アイテム名を編集モードに | 全アイテム |
| **🚀 起動** | アイテムを起動 | 全アイテム |
| **──────────────** | 区切り線 | 全アイテム |
| **📋 パスをコピー** | アイテムのパスをクリップボードにコピー | 全アイテム |
| **📁 親フォルダーのパスをコピー** | 親フォルダーのパスをコピー | ファイル・アプリ・フォルダ |
| **📂 親フォルダーを開く** | 親フォルダーをエクスプローラーで開く | ファイル・アプリ・フォルダ |
| **──────────────** | 区切り線 | .lnkファイルのみ |
| **📋 リンク先のパスをコピー** | ショートカットのリンク先パスをコピー | .lnkファイルのみ |
| **📁 リンク先の親フォルダーのパスをコピー** | リンク先の親フォルダーのパスをコピー | .lnkファイルのみ |
| **📂 リンク先の親フォルダーを開く** | リンク先の親フォルダーを開く | .lnkファイルのみ |
| **──────────────** | 区切り線 | グループ所属アイテムのみ |
| **📤 グループから削除** | グループから削除して未分類に移動 | グループ所属アイテムのみ |
| **──────────────** | 区切り線 | 全アイテム |
| **🗑️ ワークスペースから削除** | ワークスペースから完全に削除 | 全アイテム |

#### メニューを閉じる操作
- メニュー外をクリック
- Escapeキーを押下
- メニュー項目選択後は自動的に閉じる

#### 各メニュー項目の処理

**名前を変更:**
- アイテム名の編集モードに入る（4.8.2と同様）

**起動:**
- アイテムを起動（4.8.1と同様）

**パスをコピー:**
- アイテムのパス（引数含む）をクリップボードにコピー
- 成功通知を表示

**親フォルダーのパスをコピー:**
- 親ディレクトリパスをクリップボードにコピー
- 成功通知を表示

**親フォルダーを開く:**
- エクスプローラーで親フォルダーを開き、アイテムを選択状態で表示

**リンク先のパスをコピー (.lnkファイルのみ):**
- ショートカットのリンク先パスをクリップボードにコピー
- 成功通知を表示

**リンク先の親フォルダーのパスをコピー (.lnkファイルのみ):**
- リンク先の親ディレクトリパスをクリップボードにコピー
- 成功通知を表示

**リンク先の親フォルダーを開く (.lnkファイルのみ):**
- リンク先の親フォルダーをエクスプローラーで開き、リンク先ファイル/フォルダーを選択状態で表示

**グループから削除:**
- アイテムのgroupIdをnullに設定
- アイテムを未分類セクションに移動
- データを保存

**ワークスペースから削除:**
- アイテムをワークスペースから完全に削除（4.8.3と同様）

### 4.12. ドラッグ&ドロップ操作

ワークスペースウィンドウでは以下のドラッグ&ドロップ操作が可能です：
- アイテムの並び替え（同じグループ内）
- アイテムのグループ間移動
- グループの並び替え
- ネイティブファイル・フォルダ・URLの追加
- 実行履歴からワークスペースへコピー

#### 4.12.1. アイテムの並び替え（同じグループ内）

##### アクション
- 同じグループ内でアイテムをドラッグ&ドロップ

##### 処理フロー
1. アイテムをドラッグ開始
2. ドラッグ中の視覚的フィードバックを表示
3. ドロップ先のアイテムにホバー時、挿入位置を表示
4. ドロップ時：
   - アイテムの順序を変更
   - データを保存
5. ドラッグを終了

##### 制限
- 同じグループ内でのみ並び替えが可能
- 異なるグループ間での並び替えは不可（グループ間移動として扱われる）

#### 4.12.2. アイテムのグループ間移動

##### アクション
- アイテムを別のグループヘッダーまたはグループ内にドラッグ&ドロップ

##### 処理フロー
1. アイテムをドラッグ開始
2. ドラッグ中の視覚的フィードバックを表示
3. ドロップ先のグループにホバー時、グループをハイライト表示
4. ドロップ時：
   - アイテムのgroupIdを更新
   - ドロップ先のグループにアイテムを移動
   - データを保存
5. ドラッグを終了

##### ドロップ先の種類
- **グループヘッダー**: グループの末尾に追加
- **グループ内のアイテム**: そのアイテムの前に挿入
- **未分類セクションヘッダー**: 未分類に移動（groupIdをnullに設定）

#### 4.12.3. グループの並び替え

##### アクション
- グループヘッダー（名前部分以外）をドラッグ&ドロップ

##### 処理フロー
1. グループヘッダーをドラッグ開始
2. ドラッグ中の視覚的フィードバックを表示
3. ドロップ先のグループにホバー時、挿入位置を表示
4. ドロップ時：
   - グループの順序を変更
   - データを保存
5. ドラッグを終了

##### 注意
- グループ名部分をドラッグすると編集モードに入る可能性があるため、グループ名以外の部分をドラッグしてください

#### 4.12.4. ネイティブファイル・フォルダ・URLの追加

##### アクション
- エクスプローラーからファイル・フォルダをドラッグ&ドロップ
- ブラウザからURLをドラッグ&ドロップ

##### 処理フロー

**ドラッグ中（ドロップ前）:**
1. ドラッグ状態を更新
2. 半透明オーバーレイを表示
3. ドラッグ中の視覚効果を適用

**ドロップ時:**
1. ドロップされたファイル・フォルダ・URLを取得
2. ドロップ先を判定：
   - グループヘッダーまたはグループ内：そのグループに追加
   - 未分類セクション：未分類に追加
   - その他：未分類に追加
3. WorkspaceItemとして作成：
   - パス、名前、追加日時を設定
   - groupIdを設定（該当する場合）
4. ワークスペースに追加
5. データを保存
6. ドラッグ状態を解除してオーバーレイを非表示

##### 対応形式
- **ファイル**: .exe, .lnk, .pdf, .docx, など全てのファイル
- **フォルダ**: ディレクトリ
- **URL**: http://, https://, およびカスタムURIスキーマ（obsidian://, vscode://, など）

#### 4.12.5. 実行履歴からワークスペースへコピー

##### アクション
- 実行履歴アイテムをグループまたは未分類セクションにドラッグ&ドロップ

##### 処理フロー
1. 実行履歴アイテムをドラッグ開始
2. ドラッグ中の視覚的フィードバックを表示
3. ドロップ先のグループまたは未分類セクションにホバー時、ハイライト表示
4. ドロップ時：
   - ExecutionHistoryItemからWorkspaceItemを作成
   - ドロップ先のグループまたは未分類に追加
   - データを保存
5. ドラッグを終了

##### 注意
- 元の実行履歴アイテムは保持される（コピー操作）
- ドラッグエフェクトは「copy」

### 4.13. Ctrl+Vでペースト

#### アクション
- Ctrl+Vキーを押下（v0.5.1以降）

#### 処理フロー
1. クリップボードの内容を取得
2. クリップボードの種類を判定：
   - ファイル・フォルダパス
   - URL（テキスト形式）
3. WorkspaceItemとして作成：
   - パス、名前、追加日時を設定
   - groupIdはnull（未分類に追加）
4. ワークスペースに追加
5. データを保存

#### 対応形式
- **ファイル・フォルダ**: エクスプローラーでコピーしたファイル・フォルダ
- **URL**: ブラウザでコピーしたURL（テキスト形式）

#### 制限
- ペースト先は常に未分類セクション
- 特定のグループにペーストする場合は、ドラッグ&ドロップを使用してください

### 4.14. グループ名を編集

#### アクション
- 編集モード時にテキストを入力し、Enterキーを押下

#### 処理フロー
1. 入力されたグループ名を取得
2. バリデーション：
   - 空文字列の場合は元の名前を保持
3. グループ名を更新
4. データを保存
5. 編集モードを終了

### 4.15. アイテム名を編集

#### アクション
- 編集モード時にテキストを入力し、Enterキーを押下

#### 処理フロー
1. 入力されたアイテム名（displayName）を取得
2. バリデーション：
   - 空文字列の場合は元の名前を保持
3. アイテムのdisplayNameを更新
4. データを保存
5. 編集モードを終了

### 4.16. 編集モードでEscapeキー押下

#### アクション
- 編集モード時にEscapeキーを押下

#### 処理フロー
1. 入力内容を破棄
2. 編集モードを終了
3. 元の名前を表示

## 6. キーボード操作

| キー | 動作 |
|------|------|
| `Ctrl+Alt+W` | ワークスペースウィンドウの表示/非表示切り替え |
| `Ctrl+V` | クリップボードからファイル・フォルダ・URLをペーストして追加（v0.5.1以降） |
| `Enter` | 編集モードで名前を確定 |
| `Escape` | 編集モードをキャンセル |

## 7. スタイル

### 主要なCSSクラス

| クラス名 | 説明 |
|---------|------|
| `.workspace-window` | ウィンドウコンテナ |
| `.workspace-header` | ヘッダーエリア |
| `.workspace-header-controls` | ヘッダーのコントロールボタン群 |
| `.workspace-control-btn` | ヘッダーのコントロールボタン |
| `.workspace-pin-btn` | ピン留めボタン |
| `.workspace-pin-btn.pinned` | ピン留め状態のピン留めボタン |
| `.workspace-close-btn` | 閉じるボタン |
| `.workspace-items` | アイテムリストエリア |
| `.workspace-group` | グループセクション |
| `.workspace-group-header` | グループヘッダー |
| `.workspace-group-header-btn` | グループヘッダーのアクションボタン |
| `.workspace-item-card` | アイテムカード |
| `.workspace-item-delete-btn` | アイテム削除ボタン（×） |
| `.execution-history` | 実行履歴セクション |
| `.execution-history-item` | 実行履歴アイテムカード |

### グループ色のCSS変数

グループヘッダーの色は、以下のCSS変数で定義されています：

```css
/* 青（デフォルト） */
--color-group-blue: #3b82f6;

/* 緑 */
--color-group-green: #10b981;

/* 黄 */
--color-group-yellow: #f59e0b;

/* 赤 */
--color-group-red: #ef4444;

/* 紫 */
--color-group-purple: #8b5cf6;

/* ピンク */
--color-group-pink: #ec4899;

/* オレンジ */
--color-group-orange: #f97316;

/* 水色 */
--color-group-cyan: #06b6d4;
```

詳細は **[CSSデザインシステム](../architecture/css-design.md)** を参照してください。

## 8. コンポーネント構成

ワークスペースウィンドウはカスタムフックとコンポーネント分離により、保守性と可読性を向上させています。

### 主要コンポーネント

| コンポーネント | ファイル | 役割 |
|--------------|---------|------|
| **WorkspaceApp** | `WorkspaceApp.tsx` | メインコンポーネント（444行→216行にリファクタリング） |
| **WorkspaceHeader** | `components/WorkspaceHeader.tsx` | ヘッダー（タイトル、展開/折りたたみ、ピン留め、アーカイブボタン） |
| **WorkspaceGroupedList** | `components/WorkspaceGroupedList.tsx` | アイテムリスト（460行→385行にリファクタリング） |
| **WorkspaceGroupHeader** | `components/WorkspaceGroupHeader.tsx` | グループヘッダー（編集、色変更、アーカイブ、削除ボタン） |
| **WorkspaceItemCard** | `components/WorkspaceItemCard.tsx` | ワークスペースアイテムカード |
| **ExecutionHistoryItemCard** | `components/ExecutionHistoryItemCard.tsx` | 実行履歴アイテムカード |
| **WorkspaceContextMenu** | `components/WorkspaceContextMenu.tsx` | 右クリックメニュー |

### カスタムフック

| フック | ファイル | 責務 |
|-------|---------|------|
| **useWorkspaceData** | `hooks/useWorkspaceData.ts` | データ読み込みと状態管理 |
| **useWorkspaceActions** | `hooks/useWorkspaceActions.ts` | アクション処理の統合 |
| **useNativeDragDrop** | `hooks/useNativeDragDrop.ts` | ネイティブドラッグ&ドロップ処理 |
| **useClipboardPaste** | `hooks/useClipboardPaste.ts` | クリップボードからのペースト処理 |
| **useCollapsibleSections** | `hooks/useCollapsibleSections.ts` | 折りたたみ状態管理 |
| **useWorkspaceItemGroups** | `hooks/useWorkspaceItemGroups.ts` | アイテムグループ化ロジック |
| **useWorkspaceContextMenu** | `hooks/useWorkspaceContextMenu.ts` | コンテキストメニュー管理 |
| **useWorkspaceDragDrop** | `hooks/useWorkspaceDragDrop.ts` | 型安全なドラッグ&ドロップヘルパー |
| **useWorkspaceResize** | `hooks/useWorkspaceResize.ts` | ウィンドウのサイズ変更処理 |
| **useFileOperations** | `hooks/useFileOperations.ts` | ファイルとURL操作の共通ユーティリティ |

**リファクタリングの効果:**
- **WorkspaceApp.tsx**: 51%のコード削減（444行→216行）- 複雑なロジックをカスタムフックに分離
- **WorkspaceGroupedList.tsx**: 16%のコード削減（460行→385行）- Props構造を改善（24個→3つのオブジェクト）
- **useWorkspaceContextMenu**: 6つのパス操作ハンドラーを1つのジェネリック関数`handlePathOperation`に統合
- **重複コード削減**: useNativeDragDropとuseClipboardPasteの共通ロジックをuseFileOperationsに抽出
- 責務の明確化と再利用性の向上
- 型安全性の向上（DragItemData型による型安全なドラッグ&ドロップ）

## 9. データ保存

ワークスペースのデータは以下のファイルに保存されます：

| ファイル | 内容 | 形式 |
|---------|------|------|
| **workspace.json** | ワークスペースアイテムとグループ | JSON（electron-store） |
| **execution-history.json** | 実行履歴（最大10件） | JSON（electron-store） |
| **workspace-archive.json** | アーカイブされたグループとアイテム | JSON（electron-store） |

### 保存場所

```
%APPDATA%/quick-dash-launcher/config/
├── workspace.json
├── execution-history.json
└── workspace-archive.json
```

### データ形式

詳細なデータ形式は[データファイル形式](../architecture/data-format.md#ワークスペースデータ)を参照してください。

## 10. 関連ドキュメント

- **[ワークスペース機能](../features/workspace.md)** - 機能の詳細な使い方
- **[データファイル形式](../architecture/data-format.md)** - workspace.json/execution-history.json形式
- **[IPC通信](../architecture/ipc-channels.md)** - ワークスペース関連のIPCチャンネル
- **[キーボードショートカット](../features/keyboard-shortcuts.md)** - 全ショートカット一覧
- **[CSSデザインシステム](../architecture/css-design.md)** - スタイルガイドライン
- **[管理ウィンドウ仕様書](./admin-window.md)** - アーカイブタブの詳細
