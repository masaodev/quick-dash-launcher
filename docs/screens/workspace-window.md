# ワークスペースウィンドウ 仕様書

## 関連ドキュメント

- [画面一覧](./README.md) - 全画面構成の概要
- [ワークスペース機能](../features/workspace.md) - 機能の使い方
- [データファイル形式](../architecture/file-formats/data-format.md) - workspace.json形式
- [IPC通信](../architecture/ipc-channels.md) - ワークスペース関連のIPCチャンネル
- [管理ウィンドウ仕様書](./admin-window.md) - アーカイブタブの詳細

## 1. 概要

よく使うアイテムを登録して、画面右端の専用ウィンドウで素早くアクセスできる機能です。グループ化、名前変更、並び替えに対応します。

**キーボードショートカット**: `Ctrl+W` (表示/非表示切り替え)

### 主要機能
- **アイテム管理**: メイン画面からアイテムを追加・削除・名前変更
- **クリップボードペースト**: Ctrl+VでURL、ファイルパス、ファイルを直接追加
- **グループ管理**: アイテムをグループに分類して整理
- **ドラッグ&ドロップ**: アイテムの並び替えやグループ間移動
- **キーワードフィルタ**: キーワード検索+スコープ選択（全て/グループ/アイテム）でアイテムを絞り込み
- **コンテキストメニュー**: 右クリックでグループ操作・アイテム操作
- **ウィンドウカスタマイズ**: 透過度調整、サイズ変更、ピン留め
- **アーカイブ**: グループ単位でアーカイブ・復元
- **ペースト機能**: クリップボードからファイル・フォルダ・URLを追加（v0.5.1以降）

## 2. 基本情報

| 項目 | 内容 |
|------|------|
| **ファイル名** | `src/renderer/WorkspaceApp.tsx` |
| **コンポーネント名** | `WorkspaceApp` |
| **スタイル** | `src/renderer/styles/components/WorkspaceWindow.css` |
| **表示条件** | `Ctrl+W`または、システムトレイメニューから「ワークスペースを表示」 |
| **画面タイプ** | ウィンドウ（AlwaysOnTop切り替え可能、フレームレス） |
| **初期サイズ** | 幅380px × 画面の高さに合わせて自動調整 |
| **サイズ変更** | 8方向のハンドルで自由にリサイズ可能（最小: 300x400px） |
| **配置位置** | 画面右端に固定（初期配置）、ドラッグで移動可能 |
| **透過機能** | 0-100%の透過度調整、背景のみ透過モード |

## 3. 画面項目一覧

| エリア | 項目名 | 内容・説明 | 表示条件 | 機能詳細 |
|--------|--------|------------|----------|----------|
| **ヘッダー** | タイトル | 「Workspace」の表示 | 常時表示 | - |
| **ヘッダー** | フィルタボタン（🔍） | フィルタバーの表示/非表示を切り替え | 常時表示 | [4.0](#40-フィルタを変更) |
| **ヘッダー** | 全て展開ボタン（🔽） | すべてのグループと未分類セクションを展開 | 常時表示 | [4.1](#41-全て展開ボタンをクリック) |
| **ヘッダー** | 全て閉じるボタン（🔼） | すべてのグループと未分類セクションを折りたたむ | 常時表示 | [4.2](#42-全て閉じるボタンをクリック) |
| **ヘッダー** | グループ追加ボタン（➕） | 新しいグループを追加 | 常時表示 | [4.3](#43-グループ追加ボタンをクリック) |
| **ヘッダー** | アーカイブボタン（📦） | 管理ウィンドウのアーカイブタブを開く | 常時表示 | [4.4](#44-アーカイブボタンをクリック) |
| **ヘッダー** | ピン留めボタン（📌） | ウィンドウを最前面に固定 | 常時表示 | [4.5](#45-ピン留めボタンをクリック) |
| **ヘッダー** | 設定ボタン（⚙️） | 基本設定を開く / ウィンドウ配置モードを変更するメニューを表示 | 常時表示 | - |
| **ヘッダー** | 閉じるボタン（×） | ウィンドウを非表示 | 常時表示 | [4.6](#46-閉じるボタンをクリック) |
| **フィルタバー** | キーワード入力欄 | フィルタテキストを入力（プレースホルダー: 「フィルタ...」） | フィルタバー表示時 | [4.0](#40-フィルタを変更) |
| **フィルタバー** | スコープ選択（全て/グループ/アイテム） | フィルタの適用範囲を選択 | フィルタバー表示時 | [4.0](#40-フィルタを変更) |
| **フィルタバー** | フィルタ閉じるボタン（×） | フィルタバーを閉じる | フィルタバー表示時 | [4.0](#40-フィルタを変更) |
| **グループ** | グループヘッダー | グループ名・アイテム数バッジ（折りたたみ/展開、右クリックでコンテキストメニュー） | グループ存在時 | [4.7](#47-グループヘッダー操作) |
| **グループ** | └ 折りたたみアイコン（▼） | グループの折りたたみ/展開状態を表示 | グループ存在時 | [4.7.1](#471-折りたたみボタンをクリック) |
| **グループ** | └ グループ名 | グループ名（右クリック→名前を変更で編集可能） | グループ存在時 | [4.7.3](#473-グループを右クリックして名前を変更) |
| **グループ** | └ アイテム数バッジ | グループ内のアイテム数を表示（例: 「3個」） | グループ存在時 | - |
| **グループ** | アイテムカード | グループ内のアイテム一覧 | グループ内にアイテム存在時 | [4.8](#48-アイテムカード操作) |
| **未分類** | 未分類セクション | グループに所属していないアイテム | 未分類アイテム存在時 | [4.9](#49-未分類セクション操作) |
| **全体** | コンテキストメニュー | 右クリック時の操作メニュー（グループ操作・アイテム操作） | 右クリック時 | [4.11](#411-コンテキストメニュー操作) |
| **全体** | ドラッグ&ドロップオーバーレイ | ドラッグ中の視覚的フィードバック | ドラッグ中 | [4.12](#412-ドラッグドロップ操作) |

## 4. アクション一覧

| No | アクション名 | トリガー | 主な処理内容 | 詳細 |
|----|------------|---------|------------|------|
| 4.0 | フィルタを変更 | 🔍ボタンクリック → キーワード入力/スコープ選択 | キーワード+スコープでフィルタリング | [詳細](#40-フィルタを変更) |
| 4.1 | 全て展開ボタンをクリック | 🔽ボタンクリック | すべてのグループと未分類セクションを展開 | [詳細](#41-全て展開ボタンをクリック) |
| 4.2 | 全て閉じるボタンをクリック | 🔼ボタンクリック | すべてのグループと未分類セクションを折りたたむ | [詳細](#42-全て閉じるボタンをクリック) |
| 4.3 | グループ追加ボタンをクリック | ➕ボタンクリック | 新しいグループを追加して編集モードに入る | [詳細](#43-グループ追加ボタンをクリック) |
| 4.4 | アーカイブボタンをクリック | 📦ボタンクリック | 管理ウィンドウのアーカイブタブを開く | [詳細](#44-アーカイブボタンをクリック) |
| 4.5 | ピン留めボタンをクリック | 📌ボタンクリック | ウィンドウを最前面に固定/解除 | [詳細](#45-ピン留めボタンをクリック) |
| 4.6 | 閉じるボタンをクリック | ×ボタンクリック | ウィンドウを非表示 | [詳細](#46-閉じるボタンをクリック) |
| 4.7 | グループヘッダー操作 | ヘッダークリック / 右クリックコンテキストメニュー | グループの折りたたみ、編集、色変更、アーカイブ、削除 | [詳細](#47-グループヘッダー操作) |
| 4.7.1 | グループヘッダーをクリック | ヘッダークリック | グループの折りたたみ/展開 | [詳細](#471-折りたたみボタンをクリック) |
| 4.7.2 | 右クリック→名前を変更 | 右クリック → 名前を変更 | グループ名を編集モードに | [詳細](#472-グループを右クリックして名前を変更) |
| 4.7.3 | 右クリック→色を変更 | 右クリック → 色を変更 | グループの色を変更 | [詳細](#473-グループを右クリックして色を変更) |
| 4.7.4 | 右クリック→アーカイブ | 右クリック → アーカイブ | グループとアイテムをアーカイブに移動 | [詳細](#474-グループを右クリックしてアーカイブ) |
| 4.7.5 | 右クリック→削除 | 右クリック → 削除 | グループを削除（アイテムは未分類に移動） | [詳細](#475-グループを右クリックして削除) |
| 4.8 | アイテムカード操作 | アイテムカードの各種操作 | アイテムの起動、名前変更、削除 | [詳細](#48-アイテムカード操作) |
| 4.8.1 | アイテムをクリック | アイテムクリック | アイテムを起動 | [詳細](#481-アイテムをクリック) |
| 4.8.2 | アイテム名をダブルクリック | アイテム名ダブルクリック | アイテム名を編集モードに | [詳細](#482-アイテム名をダブルクリック) |
| 4.8.3 | 削除ボタンをクリック | ×ボタンクリック | アイテムをワークスペースから削除 | [詳細](#483-削除ボタンをクリック) |
| 4.8.4 | アイテムにマウスホバー | アイテムにホバー | ツールチップで詳細情報を表示 | [詳細](#484-アイテムにマウスホバー) |
| 4.9 | 未分類セクション操作 | 未分類セクションの各種操作 | 未分類アイテムの折りたたみ/展開 | [詳細](#49-未分類セクション操作) |
| 4.10 | 実行履歴セクション操作 | (未実装) | - | [詳細](#410-実行履歴セクション操作) |
| 4.11 | コンテキストメニュー操作 | 右クリック / メニュー項目選択 | 右クリックメニューの表示と各種操作 | [詳細](#411-コンテキストメニュー操作) |
| 4.12 | ドラッグ&ドロップ操作 | ドラッグ / ドロップ操作 | アイテムの並び替え、グループ間移動、ネイティブファイル追加 | [詳細](#412-ドラッグドロップ操作) |
| 4.13 | Ctrl+Vでペースト | Ctrl+Vキー押下 | クリップボードからファイル・フォルダ・URLを追加 | [詳細](#413-ctrlvでペースト) |
| 4.14 | グループ名を編集 | 編集モード時のテキスト入力 / Enterキー | グループ名の変更を確定 | [詳細](#414-グループ名を編集) |
| 4.15 | アイテム名を編集 | 編集モード時のテキスト入力 / Enterキー | アイテム名の変更を確定 | [詳細](#415-アイテム名を編集) |
| 4.16 | 編集モードでEscapeキー押下 | Escapeキー | 編集をキャンセル | [詳細](#416-編集モードでescapeキー押下) |

## 5. 機能詳細

### 4.0. フィルタを変更

#### アクション
- ヘッダーの「🔍」ボタンをクリックしてフィルタバーを表示し、キーワードを入力してアイテムを絞り込む

#### コンポーネント
- `WorkspaceFilterBar` コンポーネント

#### 処理フロー
1. ヘッダーの「🔍」ボタンをクリックするとフィルタバーが表示される
2. フィルタバーのキーワード入力欄にテキストを入力（フォーカスは自動的に入力欄に移動）
3. スコープ選択ドロップダウンで検索対象を選択：
   - **全て**: グループ名・アイテム名の両方を検索
   - **グループ**: グループ名のみを検索
   - **アイテム**: アイテム名のみを検索
4. 入力したキーワードに一致するアイテム・グループが表示される
5. Escapeキーでキーワードをクリア（キーワードがなければフィルタバーを閉じる）
6. フィルタバーの「×」ボタンでフィルタバーを閉じる

#### 注意
- フィルタはグループ化されたアイテムと未分類アイテムの両方に適用される
- キーワードをクリアすると全アイテムが再表示される

### 4.1. 全て展開ボタンをクリック

#### アクション
- ヘッダーの「🔽」ボタンをクリック

#### 処理フロー
1. すべてのグループセクションを展開
2. 未分類セクションを展開
3. 各セクションのアイテムが表示される

### 4.2. 全て閉じるボタンをクリック

#### アクション
- ヘッダーの「🔼」ボタンをクリック

#### 処理フロー
1. すべてのグループセクションを折りたたむ
2. 未分類セクションを折りたたむ
3. 各セクションのアイテムが非表示になる

### 4.3. グループ追加ボタンをクリック

#### アクション
- ヘッダーの「➕」ボタンをクリック

#### 処理フロー
1. 新しいグループを作成
2. グループ名をデフォルト値（「新しいグループ」）で初期化
3. グループ名の編集モードに入る
4. グループをリストの末尾に追加
5. データを保存

#### 表示条件
- ボタンは常時表示

### 4.4. アーカイブボタンをクリック

#### アクション
- ヘッダーの「📦」ボタンをクリック

#### 処理フロー
1. 管理ウィンドウを開く
2. アーカイブタブを選択状態で表示
3. アーカイブされたグループ一覧を表示

#### 関連ドキュメント
- [管理ウィンドウ仕様書 - アーカイブタブ](./admin-window.md#アーカイブ)

### 4.5. ピン留めボタンをクリック

#### アクション
- ヘッダーの「📌」ボタンをクリック

#### 処理フロー
1. ピン留め状態を切り替え
2. ピン留めON時：
   - ウィンドウを常に最前面に固定
   - ボタンのスタイルを「pinnedクラス」に変更
   - ツールチップを「ピン留めを解除」に変更
3. ピン留めOFF時：
   - 通常の表示レイヤーに戻す
   - ボタンのスタイルを通常に戻す
   - ツールチップを「ピン留めして最前面に固定」に変更
4. 状態を保存

### 4.6. 閉じるボタンをクリック

#### アクション
- ヘッダーの「×」ボタンをクリック

#### 処理フロー
1. ウィンドウを非表示にする
2. ワークスペースデータは保持される

### 4.7. グループヘッダー操作

グループヘッダーに対する操作は以下の2つです：

- **ヘッダークリック**: グループの折りたたみ/展開を切り替え
- **右クリックコンテキストメニュー**: 編集・色変更・アーカイブ・削除などの操作

> グループヘッダー上にインライン操作ボタン（✏️🎨📦🗑️）は表示されません。これらの操作はすべて右クリックコンテキストメニューから実行します。

#### 4.7.1. 折りたたみボタンをクリック

##### アクション
- グループヘッダーをクリック（折りたたみアイコン▼をクリック、またはヘッダー全体をクリック）

##### 処理フロー
1. グループの折りたたみ状態を切り替え
2. 折りたたみON時：
   - グループ内のアイテムを非表示
   - 折りたたみアイコンが `collapsed` クラスで表示
3. 折りたたみOFF時：
   - グループ内のアイテムを表示
   - 折りたたみアイコンが通常表示

#### 4.7.2. グループを右クリックして「名前を変更」

##### アクション
- グループヘッダーを右クリック → コンテキストメニューから「名前を変更」を選択

##### 処理フロー
1. グループ名の編集モードに入る
2. テキスト入力フィールドに変更
3. 現在のグループ名を選択状態で表示
4. フォーカスを入力フィールドに移動

#### 4.7.3. グループを右クリックして「色を変更」

##### アクション
- グループヘッダーを右クリック → コンテキストメニューから「色を変更」を選択

##### 処理フロー
1. 色選択サブメニューを表示
2. 以下の色から選択可能：
   - 青（デフォルト）
   - 緑
   - 黄
   - 赤
   - 紫
   - ピンク
   - オレンジ
   - 水色
3. 色を選択
4. グループヘッダーの背景色を変更（インラインスタイル `--group-color` CSS変数で適用）
5. データを保存

#### 4.7.4. グループを右クリックして「アーカイブ」

##### アクション
- グループヘッダーを右クリック → コンテキストメニューから「アーカイブ」を選択

##### 処理フロー
1. 確認ダイアログを表示：「グループ「{グループ名}」と{N}個のアイテムをアーカイブしますか？」
2. OKの場合：
   - グループとその中のすべてのアイテムをアーカイブに移動
   - ワークスペースから削除
   - アーカイブデータを保存
3. キャンセルの場合：処理を中止

#### 4.7.5. グループを右クリックして「削除」

##### アクション
- グループヘッダーを右クリック → コンテキストメニューから「削除」を選択

##### 処理フロー
1. 確認ダイアログを表示：「グループ「{グループ名}」を削除しますか？グループ内のアイテムは未分類に移動します。」
2. OKの場合：
   - グループを削除
   - グループ内のアイテムを未分類に移動
   - データを保存
3. キャンセルの場合：処理を中止

### 4.8. アイテムカード操作

アイテムカードには以下の機能があります：
- クリックで起動
- ダブルクリックで名前編集
- ×ボタンで削除
- マウスホバーで詳細表示

#### 4.8.1. アイテムをクリック

##### アクション
- アイテムカードをクリック

##### 処理フロー
1. アイテムを起動（開く）
2. アイテムの種別に応じて実行：
   - URL: デフォルトブラウザで開く
   - ファイル: 関連付けられたアプリで開く
   - フォルダ: エクスプローラーで開く
   - アプリケーション: 実行ファイルを起動
3. 実行履歴に記録（ExecutionHistoryItem）

#### 4.8.2. アイテム名をダブルクリック

##### アクション
- アイテムカードのアイテム名をダブルクリック

##### 処理フロー
1. アイテム名の編集モードに入る
2. テキスト入力フィールドに変更
3. 現在のアイテム名を選択状態で表示
4. フォーカスを入力フィールドに移動

#### 4.8.3. 削除ボタンをクリック

##### アクション
- アイテムカードの「×」ボタンをクリック（ホバー時に表示）

##### 処理フロー
1. アイテムをワークスペースから削除
2. データを保存

#### 4.8.4. アイテムにマウスホバー

##### アクション
- アイテムカードにマウスカーソルをホバー

##### 処理フロー
1. ツールチップを表示
2. ツールチップには以下の情報を表示：
   - パス
   - リンク先（ショートカットの場合）
   - 引数（設定されている場合）
   - 元の名前（変更している場合）
   - 追加日時

##### ツールチップ表示例

**通常のアイテム:**
```
C:\Users\Desktop\myapp.exe

追加日時: 2025-12-18 10:30:45
```

**名前変更済みアイテム:**
```
C:\Users\Desktop\myapp.exe

元の名前: My Application
追加日時: 2025-12-18 10:30:45
```

**引数付きアイテム:**
```
C:\Program Files\Code\Code.exe --new-window

追加日時: 2025-12-18 10:30:45
```

**ショートカットファイル:**
```
リンク先: C:\Program Files\App\app.exe

追加日時: 2025-12-18 10:30:45
```

### 4.9. 未分類セクション操作

#### アクション
- 未分類セクションヘッダーの「▼」または「▶」ボタンをクリック

#### 処理フロー
1. 未分類セクションの折りたたみ状態を切り替え
2. 折りたたみON時：
   - 未分類アイテムを非表示
   - ボタンを「▶」に変更
3. 折りたたみOFF時：
   - 未分類アイテムを表示
   - ボタンを「▼」に変更

#### 表示条件
- 未分類アイテムが存在する場合のみ表示

### 4.10. 実行履歴セクション操作

> **注意**: 実行履歴UIはワークスペースウィンドウには実装されていません（`WorkspaceExecutionHistoryCard` コンポーネントは存在しません）。実行履歴の表示機能は現在のバージョンでは提供されていません。

### 4.11. コンテキストメニュー操作

#### アクション
- アイテムを右クリック

#### 処理フロー
1. クリック位置（マウス座標）を取得
2. 画面端の場合は表示位置を自動調整
3. コンテキストメニューを表示
4. アイテムの種類に応じてメニュー項目を動的に生成

#### メニュー項目

| メニュー項目 | 説明 | 表示条件 |
|------------|------|----------|
| **✏️ 名前を変更** | アイテム名を編集モードに | 全アイテム |
| **🚀 起動** | アイテムを起動 | 全アイテム |
| **──────────────** | 区切り線 | 全アイテム |
| **📋 パスをコピー** | アイテムのパスをクリップボードにコピー | 全アイテム |
| **📁 親フォルダーのパスをコピー** | 親フォルダーのパスをコピー | ファイル・アプリ・フォルダ |
| **📂 親フォルダーを開く** | 親フォルダーをエクスプローラーで開く | ファイル・アプリ・フォルダ |
| **──────────────** | 区切り線 | .lnkファイルのみ |
| **📋 リンク先のパスをコピー** | ショートカットのリンク先パスをコピー | .lnkファイルのみ |
| **📁 リンク先の親フォルダーのパスをコピー** | リンク先の親フォルダーのパスをコピー | .lnkファイルのみ |
| **📂 リンク先の親フォルダーを開く** | リンク先の親フォルダーを開く | .lnkファイルのみ |
| **──────────────** | 区切り線 | グループ所属アイテムのみ |
| **📤 グループから削除** | グループから削除して未分類に移動 | グループ所属アイテムのみ |
| **──────────────** | 区切り線 | 全アイテム |
| **🗑️ ワークスペースから削除** | ワークスペースから完全に削除 | 全アイテム |

#### メニューを閉じる操作
- メニュー外をクリック
- Escapeキーを押下
- メニュー項目選択後は自動的に閉じる

#### 各メニュー項目の処理

**名前を変更:**
- アイテム名の編集モードに入る（4.8.2と同様）

**起動:**
- アイテムを起動（4.8.1と同様）

**パスをコピー:**
- アイテムのパス（引数含む）をクリップボードにコピー
- 成功通知を表示

**親フォルダーのパスをコピー:**
- 親ディレクトリパスをクリップボードにコピー
- 成功通知を表示

**親フォルダーを開く:**
- エクスプローラーで親フォルダーを開き、アイテムを選択状態で表示

**リンク先のパスをコピー (.lnkファイルのみ):**
- ショートカットのリンク先パスをクリップボードにコピー
- 成功通知を表示

**リンク先の親フォルダーのパスをコピー (.lnkファイルのみ):**
- リンク先の親ディレクトリパスをクリップボードにコピー
- 成功通知を表示

**リンク先の親フォルダーを開く (.lnkファイルのみ):**
- リンク先の親フォルダーをエクスプローラーで開き、リンク先ファイル/フォルダーを選択状態で表示

**グループから削除:**
- アイテムのgroupIdをnullに設定
- アイテムを未分類セクションに移動
- データを保存

**ワークスペースから削除:**
- アイテムをワークスペースから完全に削除（4.8.3と同様）

### 4.12. ドラッグ&ドロップ操作

ワークスペースウィンドウでは以下のドラッグ&ドロップ操作が可能です：
- アイテムの並び替え（同じグループ内）
- アイテムのグループ間移動
- グループの並び替え
- ネイティブファイル・フォルダ・URLの追加
- 実行履歴からワークスペースへコピー

#### 4.12.1. アイテムの並び替え（同じグループ内）

##### アクション
- 同じグループ内でアイテムをドラッグ&ドロップ

##### 処理フロー
1. アイテムをドラッグ開始
2. ドラッグ中の視覚的フィードバックを表示
3. ドロップ先のアイテムにホバー時、挿入位置を表示
4. ドロップ時：
   - アイテムの順序を変更
   - データを保存
5. ドラッグを終了

##### 制限
- 同じグループ内でのみ並び替えが可能
- 異なるグループ間での並び替えは不可（グループ間移動として扱われる）

#### 4.12.2. アイテムのグループ間移動

##### アクション
- アイテムを別のグループヘッダーまたはグループ内にドラッグ&ドロップ

##### 処理フロー
1. アイテムをドラッグ開始
2. ドラッグ中の視覚的フィードバックを表示
3. ドロップ先のグループにホバー時、グループをハイライト表示
4. ドロップ時：
   - アイテムのgroupIdを更新
   - ドロップ先のグループにアイテムを移動
   - データを保存
5. ドラッグを終了

##### ドロップ先の種類
- **グループヘッダー**: グループの末尾に追加
- **グループ内のアイテム**: そのアイテムの前に挿入
- **未分類セクションヘッダー**: 未分類に移動（groupIdをnullに設定）

#### 4.12.3. グループの並び替え

##### アクション
- グループヘッダー（名前部分以外）をドラッグ&ドロップ

##### 処理フロー
1. グループヘッダーをドラッグ開始
2. ドラッグ中の視覚的フィードバックを表示
3. ドロップ先のグループにホバー時、挿入位置を表示
4. ドロップ時：
   - グループの順序を変更
   - データを保存
5. ドラッグを終了

##### 注意
- グループ名部分をドラッグすると編集モードに入る可能性があるため、グループ名以外の部分をドラッグしてください

#### 4.12.4. ネイティブファイル・フォルダ・URLの追加

##### アクション
- エクスプローラーからファイル・フォルダをドラッグ&ドロップ
- ブラウザからURLをドラッグ&ドロップ

##### 処理フロー

**ドラッグ中（ドロップ前）:**
1. ドラッグ状態を更新
2. 半透明オーバーレイを表示
3. ドラッグ中の視覚効果を適用

**ドロップ時:**
1. ドロップされたファイル・フォルダ・URLを取得
2. ドロップ先を判定：
   - グループヘッダーまたはグループ内：そのグループに追加
   - 未分類セクション：未分類に追加
   - その他：未分類に追加
3. WorkspaceItemとして作成：
   - パス、名前、追加日時を設定
   - groupIdを設定（該当する場合）
4. ワークスペースに追加
5. データを保存
6. ドラッグ状態を解除してオーバーレイを非表示

##### 対応形式
- **ファイル**: .exe, .lnk, .pdf, .docx, など全てのファイル
- **フォルダ**: ディレクトリ
- **URL**: http://, https://, およびカスタムURIスキーマ（obsidian://, vscode://, など）

#### 4.12.5. 実行履歴からワークスペースへコピー

##### アクション
- 実行履歴アイテムをグループまたは未分類セクションにドラッグ&ドロップ

##### 処理フロー
1. 実行履歴アイテムをドラッグ開始
2. ドラッグ中の視覚的フィードバックを表示
3. ドロップ先のグループまたは未分類セクションにホバー時、ハイライト表示
4. ドロップ時：
   - ExecutionHistoryItemからWorkspaceItemを作成
   - ドロップ先のグループまたは未分類に追加
   - データを保存
5. ドラッグを終了

##### 注意
- 元の実行履歴アイテムは保持される（コピー操作）
- ドラッグエフェクトは「copy」

### 4.13. Ctrl+Vでペースト

#### アクション
- Ctrl+Vキーを押下（v0.5.1以降）

#### 処理フロー
1. クリップボードの内容を取得
2. クリップボードの種類を判定：
   - ファイル・フォルダパス
   - URL（テキスト形式）
3. WorkspaceItemとして作成：
   - パス、名前、追加日時を設定
   - groupIdはnull（未分類に追加）
4. ワークスペースに追加
5. データを保存

#### 対応形式
- **ファイル・フォルダ**: エクスプローラーでコピーしたファイル・フォルダ
- **URL**: ブラウザでコピーしたURL（テキスト形式）

#### 制限
- ペースト先は常に未分類セクション
- 特定のグループにペーストする場合は、ドラッグ&ドロップを使用してください

### 4.14. グループ名を編集

#### アクション
- 編集モード時にテキストを入力し、Enterキーを押下

#### 処理フロー
1. 入力されたグループ名を取得
2. バリデーション：
   - 空文字列の場合は元の名前を保持
3. グループ名を更新
4. データを保存
5. 編集モードを終了

### 4.15. アイテム名を編集

#### アクション
- 編集モード時にテキストを入力し、Enterキーを押下

#### 処理フロー
1. 入力されたアイテム名（displayName）を取得
2. バリデーション：
   - 空文字列の場合は元の名前を保持
3. アイテムのdisplayNameを更新
4. データを保存
5. 編集モードを終了

### 4.16. 編集モードでEscapeキー押下

#### アクション
- 編集モード時にEscapeキーを押下

#### 処理フロー
1. 入力内容を破棄
2. 編集モードを終了
3. 元の名前を表示

## 6. キーボード操作

| キー | 動作 |
|------|------|
| `Ctrl+W` | ワークスペースウィンドウの表示/非表示切り替え |
| `Ctrl+V` | クリップボードからファイル・フォルダ・URLをペーストして追加（v0.5.1以降） |
| `Enter` | 編集モードで名前を確定 |
| `Escape` | フィルタバー表示中: テキストをクリア（テキストなしの場合はフィルタバーを閉じる）。編集モード中: 編集をキャンセル |

## 7. スタイル

### 主要なCSSクラス

| クラス名 | 説明 |
|---------|------|
| `.workspace-window` | ウィンドウコンテナ |
| `.workspace-header` | ヘッダーエリア |
| `.workspace-header-controls` | ヘッダーのコントロールボタン群 |
| `.workspace-control-btn` | ヘッダーのコントロールボタン |
| `.workspace-control-btn.active` | アクティブ状態のコントロールボタン（フィルタ表示中など） |
| `.workspace-pin-btn` | ピン留めボタン |
| `.workspace-pin-btn.pinned` | ピン留め状態のピン留めボタン |
| `.workspace-close-btn` | 閉じるボタン |
| `.workspace-filter-bar` | フィルタバーエリア |
| `.workspace-filter-input` | フィルタキーワード入力欄 |
| `.workspace-filter-scope` | フィルタスコープ選択ドロップダウン |
| `.workspace-filter-close-btn` | フィルタバーを閉じるボタン |
| `.workspace-item-list` | アイテムリストエリア（スクロール対応） |
| `.workspace-group` | グループセクション |
| `.workspace-group-header` | グループヘッダー |
| `.workspace-group-collapse-icon` | 折りたたみアイコン（▼） |
| `.workspace-group-collapse-icon.collapsed` | 折りたたみ状態のアイコン |
| `.workspace-group-name` | グループ名テキスト |
| `.workspace-group-name-input` | グループ名編集入力欄 |
| `.workspace-group-badge` | アイテム数バッジ |
| `.workspace-item-card` | アイテムカード |
| `.workspace-item-delete-btn` | アイテム削除ボタン（×） |

### グループ色の適用方法

グループヘッダーの色は、グループごとのインラインスタイルで `--group-color` CSS変数を設定することで適用されます：

```tsx
// WorkspaceGroupHeader.tsx
<div
  className="workspace-group-header"
  style={{ '--group-color': group.color } as React.CSSProperties}
>
```

```css
/* WorkspaceWindow.css */
.workspace-group-header {
  border-left: 4px solid var(--group-color, var(--color-primary));
  background: linear-gradient(
    135deg,
    var(--group-color, var(--color-primary)),
    color-mix(in srgb, var(--group-color, var(--color-primary)) 70%, white)
  );
}
```

`group.color` には、色の値（HEX、RGB等）が直接格納されます。グローバルCSS変数（`--color-group-blue` 等）は使用しません。

詳細は **[CSSデザインシステム](../architecture/css-design.md)** を参照してください。

## 8. コンポーネント構成

ワークスペースウィンドウはカスタムフックとコンポーネント分離により、保守性と可読性を向上させています。

### 主要コンポーネント

| コンポーネント | ファイル | 役割 |
|--------------|---------|------|
| **WorkspaceApp** | `WorkspaceApp.tsx` | メインコンポーネント（データ・アクション・フィルタ・D&D の統合） |
| **WorkspaceHeader** | `components/WorkspaceHeader.tsx` | ヘッダー（タイトル、フィルタ、展開/折りたたみ、ピン留め、設定、アーカイブボタン） |
| **WorkspaceFilterBar** | `components/WorkspaceFilterBar.tsx` | フィルタバー（キーワード入力・スコープ選択） |
| **WorkspaceGroupedList** | `components/WorkspaceGroupedList.tsx` | グループ化アイテムリスト（グループ・未分類セクション管理） |
| **WorkspaceGroupHeader** | `components/WorkspaceGroupHeader.tsx` | グループヘッダー（折りたたみ・グループ名編集。操作は右クリックコンテキストメニュー経由） |
| **WorkspaceItemList** | `components/WorkspaceItemList.tsx` | グループ内アイテムリスト（並び替えD&D対応） |
| **WorkspaceItemCard** | `components/WorkspaceItemCard.tsx` | ワークスペースアイテムカード |
| **WorkspaceItemEditModal** | `components/WorkspaceItemEditModal.tsx` | アイテム編集モーダル |

### カスタムフック

| フック | ファイル | 責務 |
|-------|---------|------|
| **useWorkspaceData** | `hooks/workspace/useWorkspaceData.ts` | データ読み込みと状態管理 |
| **useWorkspaceActions** | `hooks/workspace/useWorkspaceActions.ts` | アクション処理の統合 |
| **useNativeDragDrop** | `hooks/useNativeDragDrop.ts` | ネイティブドラッグ&ドロップ処理 |
| **useClipboardPaste** | `hooks/useClipboardPaste.ts` | クリップボードペースト処理（Ctrl+V） |
| **useCollapsibleSections** | `hooks/useCollapsibleSections.ts` | 折りたたみ状態管理 |
| **useWorkspaceItemGroups** | `hooks/workspace/useWorkspaceItemGroups.ts` | アイテムグループ化ロジック |
| **useWorkspaceContextMenu** | `hooks/workspace/useWorkspaceContextMenu.ts` | コンテキストメニュー管理 |
| **useWorkspaceDragDrop** | `hooks/workspace/useWorkspaceDragDrop.ts` | 型安全なドラッグ&ドロップヘルパー |
| **useWorkspaceResize** | `hooks/workspace/useWorkspaceResize.ts` | ウィンドウのサイズ変更処理 |
| **useWorkspaceItemEditForm** | `hooks/workspace/useWorkspaceItemEditForm.ts` | アイテム編集フォーム |
| **useFileOperations** | `hooks/useFileOperations.ts` | ファイルとURL操作の共通ユーティリティ |

**リファクタリングの効果:**
- **WorkspaceApp.tsx**: 51%のコード削減（444行→216行）- 複雑なロジックをカスタムフックに分離
- **WorkspaceGroupedList.tsx**: 16%のコード削減（460行→385行）- Props構造を改善（24個→3つのオブジェクト）
- **useWorkspaceContextMenu**: 6つのパス操作ハンドラーを1つのジェネリック関数`handlePathOperation`に統合
- **重複コード削減**: useNativeDragDropとuseClipboardPasteの共通ロジックをuseFileOperationsに抽出
- 責務の明確化と再利用性の向上
- 型安全性の向上（DragItemData型による型安全なドラッグ&ドロップ）

## 9. データ保存

ワークスペースのデータは以下のファイルに保存されます：

| ファイル | 内容 | 形式 |
|---------|------|------|
| **workspace.json** | ワークスペースアイテムとグループ | JSON（electron-store） |
| **execution-history.json** | 実行履歴（最大10件） | JSON（electron-store） |
| **workspace-archive.json** | アーカイブされたグループとアイテム | JSON（electron-store） |

### 保存場所

```
%APPDATA%/quick-dash-launcher/config/
├── workspace.json
├── execution-history.json
└── workspace-archive.json
```

### データ形式

詳細なデータ形式は[データファイル形式](../architecture/file-formats/data-format.md#ワークスペースデータ)を参照してください。

### ウィンドウカスタマイズ関連のCSSクラス

| クラス名 | 説明 |
|---------|------|
| `.workspace-window` | ウィンドウコンテナ |
| `.workspace-header` | ヘッダーエリア |
| `.workspace-item-list` | アイテムリストエリア |
| `.workspace-group` | グループセクション |
| `.workspace-group-header` | グループヘッダー |
| `.workspace-item-card` | アイテムカード |
| `.workspace-item-delete-btn` | アイテム削除ボタン（×） |
| `.workspace-resize-handle` | サイズ変更ハンドル（8方向） |
| `.background-transparent` | 背景のみ透過モード |

## 9.1. ウィンドウカスタマイズ機能

### 透過機能

ワークスペースウィンドウの透過度を調整できます：

- **透過度**: 0-100%で調整（設定画面のスライダーで変更）
- **背景のみ透過**: チェックボックスで有効化すると、ウィンドウ背景のみが透過され、アイテムやボタンは不透明のまま表示
- **即座反映**: 設定変更は即座にワークスペースウィンドウに反映

**実装:**
- Electronの`setOpacity()`でウィンドウ全体の透過度を設定
- 背景のみ透過モードでは、`.background-transparent`クラスを追加し、アイテムとボタンに`opacity: 1`を設定

### サイズ変更ハンドル

8方向のカスタムハンドルでウィンドウを自由にリサイズ：

| ハンドル位置 | クラス名 | 動作 |
|------------|---------|------|
| 左上 | `.workspace-resize-handle.top-left` | 左辺+上辺を同時に移動 |
| 上 | `.workspace-resize-handle.top` | 上辺を移動 |
| 右上 | `.workspace-resize-handle.top-right` | 右辺+上辺を同時に移動 |
| 右 | `.workspace-resize-handle.right` | 右辺を移動 |
| 右下 | `.workspace-resize-handle.bottom-right` | 右辺+下辺を同時に移動 |
| 下 | `.workspace-resize-handle.bottom` | 下辺を移動 |
| 左下 | `.workspace-resize-handle.bottom-left` | 左辺+下辺を同時に移動 |
| 左 | `.workspace-resize-handle.left` | 左辺を移動 |

**最小サイズ制約:**
- 幅: 300px
- 高さ: 400px

**実装:**
- `onMouseDown`イベントでドラッグ開始
- `mousemove`イベントで座標差分を計算し、`workspace:set-position-and-size` IPCチャンネルでウィンドウサイズを更新
- `mouseup`イベントでドラッグ終了

### ウィンドウ制御ボタン

ヘッダーに配置された制御ボタン：

| ボタン | 機能 | IPCチャンネル |
|-------|------|-------------|
| 📌 | ピン留め（常に最前面）のトグル | `workspace:toggle-always-on-top` |
| × | ウィンドウを非表示 | `workspace:hide-window` |

### クリップボードペースト（Ctrl+V）

`useClipboardPaste`フックでクリップボードからアイテムを追加：

**対応形式:**
1. **テキスト**: URL、ファイルパス、カスタムURIスキーマ（`obsidian://`等）
2. **ファイルオブジェクト**: エクスプローラーからCtrl+Cでコピーしたファイル

**処理フロー:**
1. `keydown`イベント（Ctrl+V）または`paste`イベントを検出
2. テキストの場合: `navigator.clipboard.readText()`で取得 → `detectItemTypeSync()`で判定 → URLならファビコン取得 → `workspace:add-item` IPCで追加
3. ファイルオブジェクトの場合: `window.electronAPI.getPathForFile()`でパス取得 → `workspace:add-items-from-paths` IPCで追加
4. UI更新コールバックを実行

**注意:**
- Input/Textarea要素内でのペーストはスキップ（通常の入力として処理）
- テキストペーストの場合、最初の行のみを使用

## 10. 関連ドキュメント

- **[ワークスペース機能](../features/workspace.md)** - 機能の詳細な使い方
- **[データファイル形式](../architecture/file-formats/data-format.md)** - workspace.json/execution-history.json形式
- **[IPC通信](../architecture/ipc-channels.md)** - ワークスペース関連のIPCチャンネル
- **[キーボードショートカット](../features/keyboard-shortcuts.md)** - 全ショートカット一覧
- **[CSSデザインシステム](../architecture/css-design.md)** - スタイルガイドライン
- **[管理ウィンドウ仕様書](./admin-window.md)** - アーカイブタブの詳細
