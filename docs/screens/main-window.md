# メインウィンドウ仕様書

## 関連ドキュメント

- [画面一覧](./README.md) - 全画面構成の概要
- [アイテム登録・編集モーダル](./register-modal.md) - アイテムの新規登録・編集機能
- [右クリックメニュー](./context-menu.md) - コンテキストメニュー詳細
- [共通ダイアログ](./dialogs.md) - AlertDialog/ConfirmDialog/FilePickerDialog
- [アイコン取得進捗詳細モーダル](./icon-progress-detail-modal.md) - アイコン一括取得の結果表示
- [ブックマークインポートモーダル](./bookmark-import-modal.md) - インポート機能詳細
- [アイテム管理](./admin-window.md#6-アイテム管理の詳細) - 編集機能の詳細

## 1. 概要

メインウィンドウは、QuickDashLauncherの中核となる検索・ランチャー画面です。グローバルホットキー（Alt+Space）で呼び出され、アプリケーション、ファイル、フォルダ、URLに素早くアクセスできます。

**注意**: 初回起動時（`hotkey`が空文字列または未設定の場合）は、メインウィンドウの代わりに[初回設定画面](./first-launch-setup.md)が表示されます。初回設定完了後、このメインウィンドウが表示されるようになります。

**キーボードショートカット**:
- Alt+Space: ウィンドウ表示/非表示（デフォルト、設定で変更可能）
- Ctrl+E: アイテム管理ウィンドウへ切り替え
- Enter: 選択項目を開く
- Shift+Enter: 選択項目の親フォルダを開く
- Arrow Keys: 項目選択の移動
- Tab/Shift+Tab: タブ切り替え（タブ表示有効時、複数タブ存在時のみ）
- Escape: ウィンドウを非表示（一部の状態では無効、下記参照）

### 主要機能
- **リアルタイム検索**: 入力に応じてアイテムをリアルタイムフィルタリング
- **検索モード切り替え**: Shift+Tabで通常検索・ウィンドウ検索・実行履歴検索の3モードを切り替え
- **ウィンドウ検索**: 開いているウィンドウを検索・アクティブ化
- **実行履歴検索**: 過去に実行したアイテムを検索・再実行
- **キーボードナビゲーション**: 矢印キーとEnterキーでアイテム選択・実行
- **コンテキストメニュー**: 右クリックでアイテム操作メニューを表示
- **ドラッグ&ドロップ登録**: ファイルやフォルダをドロップして簡単登録
- **ウィンドウ固定化**: 📌ボタンでフォーカスアウト時も非表示にならない設定
- **アイコン管理**: ファビコン取得・アイコン抽出機能
- **進捗表示**: アイコン処理中の進捗バー表示
- **詳細情報表示**: アイテムにマウスホバーでパス、データファイル、ID、フォルダ取込情報をツールチップ表示

## 2. 基本情報

| 項目 | 内容 |
|------|------|
| **ファイル名** | `src/renderer/App.tsx` |
| **コンポーネント名** | `App` |
| **表示条件** | グローバルホットキー（Alt+Space、デフォルト）押下時 |
| **画面タイプ** | メインウィンドウ |
| **親画面** | なし（ルートコンポーネント） |

## 3. 画面項目一覧

| エリア | 項目名 | 内容・説明 | 表示条件 | 機能詳細 |
|--------|--------|------------|----------|----------|
| **タブバー** | データファイルタブ | データファイル切り替え用のタブボタン（ツールチップにファイルラベルとファイル名を表示） | タブ表示ON時 | [4.23](#423-データファイルタブをクリック) |
| **ヘッダー** | 検索入力欄 | アイテム検索用のテキスト入力欄、クリアボタン付き | 常時表示 | [4.1](#41-検索入力欄への文字入力) |
| **ヘッダー** | アイテム登録ボタン（➕） | アイテム登録モーダルを開く | 常時表示 | [4.22](#422-アイテム登録ボタン押下) |
| **ヘッダー** | 更新ボタン（🔄） | データ再読込・アイコン取得メニュー | 常時表示 | [4.3](#43-更新メニュー操作) |
| **ヘッダー** | └ 📋 データ再読込 | データファイルの再読み込み | ドロップダウン展開時 | [4.3](#43-更新メニュー操作) |
| **ヘッダー** | └ 🎨 アイコン取得（現在のタブ） | 現在のタブの未取得アイコンを取得 | ドロップダウン展開時 | [4.3](#43-更新メニュー操作) |
| **ヘッダー** | └ 🎨 アイコン取得（全タブ） | 全タブの未取得アイコンを取得 | ドロップダウン展開時 | [4.3](#43-更新メニュー操作) |
| **ヘッダー** | └ ──────────── | 区切り線 | ドロップダウン展開時 | - |
| **ヘッダー** | └ 🔄 完全リフレッシュ | データ再読込＋全アイコン強制取得 | ドロップダウン展開時 | [4.3](#43-更新メニュー操作) |
| **ヘッダー** | 固定ボタン（📌） | ウィンドウ固定状態の切り替え | 常時表示 | [4.4](#44-固定ボタン押下) |
| **ヘッダー** | 設定ボタン（⚙） | 設定・管理メニューへのアクセス | 常時表示 | [4.5](#45-設定メニュー操作) |
| **ヘッダー** | └ ⚙️ 基本設定 | 管理ウィンドウの設定タブを開く | ドロップダウン展開時 | [4.5](#45-設定メニュー操作) |
| **ヘッダー** | └ ✏️ アイテム管理 | 管理ウィンドウの編集タブを開く | ドロップダウン展開時 | [4.5](#45-設定メニュー操作) |
| **ヘッダー** | └ ──────────── | 区切り線 | ドロップダウン展開時 | - |
| **ヘッダー** | └ 🚪 アプリを終了 | アプリケーションを終了 | ドロップダウン展開時 | [4.5](#45-設定メニュー操作) |
| **メイン** | アイテムリスト | フィルタリングされたアイテム一覧表示 | 常時表示 | [4.6](#46-アイテムをクリック) |
| **メイン** | 選択ハイライト | 現在選択中のアイテムをハイライト表示 | アイテム存在時 | [4.7](#47-検索入力欄で-enter-キー押下) |
| **メイン** | 詳細ツールチップ | アイテムホバー時にパス、データファイル、ID、フォルダ取込情報を表示 | ホバー時 | [4.20](#420-アイテムにマウスホバー) |
| **メイン** | コンテキストメニュー | 右クリック時に表示されるアイテムメニュー（ツールチップ付き） | 右クリック時 | [4.10](#410-アイテムを右クリック) |
| **メイン** | 進捗バー | アイコン処理の進捗表示 | 処理実行中 | - |
| **オーバーレイ** | 登録モーダル | ドラッグ&ドロップ時の登録用モーダル | ドロップ時 | [4.18](#418-ドラッグドロップ操作) |
| **オーバーレイ** | ドラッグオーバーレイ | ドラッグ中の視覚的フィードバック | ドラッグ中 | [4.18](#418-ドラッグドロップ操作) |

## 4. アクション一覧

| No | アクション名 | トリガー | 主な処理内容 | 詳細 |
|----|------------|---------|------------|------|
| 4.1 | 検索入力欄への文字入力 | テキスト入力 | アイテムのリアルタイムフィルタリング | [詳細](#41-検索入力欄への文字入力) |
| 4.2 | 検索入力欄のクリアボタン押下 | クリアボタン（×）クリック | 入力内容をクリア、全アイテム表示 | [詳細](#42-検索入力欄のクリアボタン押下) |
| 4.3 | 更新メニュー操作 | 更新ボタン（🔄）クリック / メニュー選択 | データ再読込、アイコン取得、完全リフレッシュ | [詳細](#43-更新メニュー操作) |
| 4.4 | 固定ボタン押下 | 固定ボタン（📌）クリック | ウィンドウ固定状態の切り替え | [詳細](#44-固定ボタン押下) |
| 4.5 | 設定メニュー操作 | 設定ボタン（⚙）クリック / メニュー選択 / Ctrl+E | 基本設定、アイテム管理、JSON出力、終了 | [詳細](#45-設定メニュー操作) |
| 4.6 | アイテムをクリック | アイテムクリック | 選択アイテムの実行（開く） | [詳細](#46-アイテムをクリック) |
| 4.7 | 検索入力欄で Enter キー押下 | Enterキー | 選択中のアイテムを開く | [詳細](#47-検索入力欄で-enter-キー押下) |
| 4.8 | 検索入力欄で Shift+Enter キー押下 | Shift+Enterキー | 選択中のアイテムの親フォルダを開く | [詳細](#48-検索入力欄で-shiftenter-キー押下) |
| 4.9 | 検索入力欄で ArrowUp/ArrowDown キー押下 | ArrowUp/ArrowDownキー | アイテム選択の移動（循環） | [詳細](#49-検索入力欄で-arrowuparrowdown-キー押下) |
| 4.10 | アイテムを右クリック | アイテム右クリック | コンテキストメニュー表示 | [詳細](#410-アイテムを右クリック) |
| 4.11 | コンテキストメニューから「パスをコピー」選択 | メニュー項目選択 | アイテムパスをクリップボードにコピー | [詳細](#411-コンテキストメニューからパスをコピー選択) |
| 4.12 | コンテキストメニューから「親フォルダーのパスをコピー」選択 | メニュー項目選択 | アイテムの親フォルダーパスをクリップボードにコピー | [詳細](#412-コンテキストメニューから親フォルダーのパスをコピー選択) |
| 4.13 | コンテキストメニューから「親フォルダーを開く」選択 | メニュー項目選択 | エクスプローラーで親フォルダーを開く | [詳細](#413-コンテキストメニューから親フォルダーを開く選択) |
| 4.14 | コンテキストメニューから「リンク先のパスをコピー」選択 | メニュー項目選択 | .lnkファイルのリンク先パスをクリップボードにコピー | [詳細](#414-コンテキストメニューからリンク先のパスをコピー選択) |
| 4.15 | コンテキストメニューから「リンク先の親フォルダーのパスをコピー」選択 | メニュー項目選択 | .lnkファイルのリンク先の親フォルダーパスをクリップボードにコピー | [詳細](#415-コンテキストメニューからリンク先の親フォルダーのパスをコピー選択) |
| 4.16 | コンテキストメニューから「リンク先の親フォルダーを開く」選択 | メニュー項目選択 | .lnkファイルのリンク先の親フォルダーをエクスプローラーで開く | [詳細](#416-コンテキストメニューからリンク先の親フォルダーを開く選択) |
| 4.17 | コンテキストメニュー項目にマウスホバー | メニュー項目にホバー | 対象パスをツールチップ表示 | [詳細](#417-コンテキストメニュー項目にマウスホバー) |
| 4.18 | ドラッグ&ドロップ操作 | ドラッグ / ドロップ操作 | ファイル・フォルダの登録 | [詳細](#418-ドラッグドロップ操作) |
| 4.19 | ウィンドウ表示時の初期化 | グローバルホットキー（デフォルト: Alt+Space） | データ読み込み、アイコン適用、画面初期化 | [詳細](#419-ウィンドウ表示時の初期化) |
| 4.20 | アイテムにマウスホバー | アイテムにマウスカーソルをホバー | 実行パス（引数含む）をツールチップ表示 | [詳細](#420-アイテムにマウスホバー) |
| 4.21 | コンテキストメニューから「編集」選択 | メニュー項目選択 | アイテム編集モーダルを開く | [詳細](#421-コンテキストメニューから編集選択) |
| 4.22 | アイテム登録ボタン押下 | 登録ボタン（➕）クリック | アイテム登録モーダルを開く | [詳細](#422-アイテム登録ボタン押下) |
| 4.23 | データファイルタブをクリック | タブボタンクリック | アクティブなデータファイルを切り替え | [詳細](#423-データファイルタブをクリック) |
| 4.24 | Tab/Shift+Tabキー押下 | Tab/Shift+Tabキー | タブの切り替え | [詳細](#424-tabshifttabキー押下) |
| 4.25 | Escapeキー押下 | Escapeキー | ウィンドウを非表示（条件付き） | [詳細](#425-escapeキー押下) |
| 4.26 | ウィンドウ検索モード | 検索欄に `<` を入力 | ウィンドウ検索モードに切り替え、開いているウィンドウを検索 | [詳細](#426-ウィンドウ検索モード) |
| 4.27 | 検索モード切り替え | Shift+Tabキー押下 | 検索モードを順次切り替え（通常→ウィンドウ→実行履歴） | [詳細](#427-検索モード切り替え) |

## 5. 機能詳細

### 4.1. 検索入力欄への文字入力

#### アクション
- 検索入力欄に文字を入力

#### 処理フロー

**通常モード（検索欄の最初が `<` 以外の場合）:**
1. 入力値の変更を検知
2. アイテムをフィルタリング（アイテム名の部分一致、大文字小文字区別なし）
3. 選択を先頭にリセット（最初のアイテムを選択）
4. フィルタリングされたアイテムリストを表示

**ウィンドウ検索モード（検索欄の最初が `<` の場合）:**
1. 入力値の変更を検知
2. ウィンドウ検索モードに自動切り替え
3. タブバーを非表示（検索に集中しやすいUI）
4. システム内の開いているウィンドウを取得（QuickDashLauncher自身は除外）
   - 全仮想デスクトップのウィンドウを取得（`DWM_CLOAKED_SHELL`フラグ処理により実現）
   - システムウィンドウを除外（Windows入力エクスペリエンス、Program Manager等）
5. 各ウィンドウのアイコンを取得（Windows API使用）
6. `<` を除いた検索クエリでウィンドウタイトルをフィルタリング（スペース区切りでAND検索）
7. フィルタリングされたウィンドウリストを表示
8. ウィンドウアイテムには青い左境界線とウィンドウアイコン（または🪟絵文字）を表示

**実行履歴検索モード:**
1. 実行履歴をWorkspaceServiceから取得
2. ExecutionHistoryItemをAppItem形式に変換（グループアイテムは除外）
3. 入力クエリでアイテム名をフィルタリング（アイテム名の部分一致、大文字小文字区別なし）
4. フィルタリングされた履歴アイテムリストを表示
5. 履歴アイテムには元のアイコンが表示される

#### モード切り替え
- **Shift+Tab**キー押下: 検索モードを順次切り替え（通常→ウィンドウ→実行履歴→通常...）
- 検索欄の最初の文字が `<`: ウィンドウ検索モードに自動切り替え（タブバー非表示）
- `<` を削除: 通常モードに戻る（タブバー表示）
- ウィンドウを閉じる: 通常モードに自動リセット（次回表示時のラグ防止）

#### 関連アクション
- ウィンドウ表示時に検索入力欄に自動フォーカス
- ウィンドウ検索モードの詳細は[4.26](#426-ウィンドウ検索モード)を参照
- 検索モード切り替えの詳細は[4.27](#427-検索モード切り替え)を参照
- アイテム実行後に検索テキストを自動クリア

### 4.2. 検索入力欄のクリアボタン押下

#### アクション
- 検索入力欄の「×」ボタンをクリック

#### 処理フロー
1. 入力内容をクリア
2. 全アイテムを表示
3. 選択を先頭にリセット

#### 表示条件
- テキストが入力されている時のみ「×」ボタンを表示

### 4.3. 更新メニュー操作

#### アクション
- ヘッダーの更新ボタン（🔄）をクリックしてメニューを開き、メニュー項目を選択

#### メニュー項目と処理フロー

**📋 データ再読込:**
1. データファイル（data.json）を再読み込み
2. パースしてアイテム配列に変換
3. アイコンキャッシュを適用
4. アイテムリストを更新
5. メニューを閉じる

**🎨 アイコン取得（現在のタブ）:**
1. 現在アクティブなタブのアイコンが未取得のアイテムを検索
2. URLアイテムのファビコン取得を実行
3. 実行ファイル（.exe）のアイコン抽出を実行
4. 進捗バーで処理状況を表示
5. 完了後、メニューを閉じる
6. 詳細ボタンまたは進捗バーをクリックで[アイコン取得進捗詳細モーダル](./icon-progress-detail-modal.md)を表示

**🎨 アイコン取得（全タブ）:**
1. 全タブのアイコンが未取得のアイテムを検索
2. URLアイテムのファビコン取得を実行
3. 実行ファイル（.exe）のアイコン抽出を実行
4. 進捗バーで処理状況を表示
5. 完了後、メニューを閉じる
6. 詳細ボタンまたは進捗バーをクリックで[アイコン取得進捗詳細モーダル](./icon-progress-detail-modal.md)を表示

**🔄 完全リフレッシュ:**
1. データファイルを再読み込み
2. すべてのアイテムのアイコンを強制再取得（既存キャッシュを無視）
3. 進捗バーで処理状況を表示
4. 完了後、メニューを閉じる
5. 詳細ボタンまたは進捗バーをクリックで[アイコン取得進捗詳細モーダル](./icon-progress-detail-modal.md)を表示

#### 各メニュー項目の違い
- **データ再読込**: アイコンには影響せず、データファイルのみ再読み込み
- **アイコン取得（現在のタブ）**: 現在表示中のタブのみ対象、未取得アイコンのみ取得
- **アイコン取得（全タブ）**: 全タブ対象、未取得アイコンのみ取得
- **完全リフレッシュ**: データ再読込＋すべてのアイコンを強制再取得（最も包括的）

#### 共通動作
- メニュー外をクリックすると自動的にメニューを閉じる
- メニュー項目選択後は自動的にメニューを閉じる

### 4.4. 固定ボタン（📌）押下

#### アクション
- ヘッダーの固定ボタン（📌）をクリック

#### 処理フロー
1. 固定モードを次の状態に切り替える
2. 固定モードが順番に切り替わる（normal → alwaysOnTop → stayVisible → normal）
3. 新しいモードに応じてボタンの表示状態を更新
4. ツールチップを更新

#### 固定モードの種類
- **normal**: 通常モード - フォーカスアウトでウィンドウが自動的に非表示
- **alwaysOnTop**: 常に最前面 - フォーカスアウトでも表示を維持し、他ウィンドウの上に表示
- **stayVisible**: 常に表示 - フォーカスアウトでも表示を維持

### 4.5. 設定メニュー操作

#### アクション
- ヘッダーの設定ボタン（⚙）をクリックしてメニューを開き、メニュー項目を選択
- または、Ctrl+Eキーを押下（アイテム管理へのショートカット）

#### メニュー項目と処理フロー

**⚙️ 基本設定:**
1. 管理ウィンドウを「設定」タブで開く
2. メニューを閉じる

**✏️ アイテム管理:**
1. 管理ウィンドウを「編集」タブで開く
2. メニューを閉じる
- **ショートカット**: Ctrl+Eキーでも同じ動作

**🚪 アプリを終了:**
1. アプリケーションを終了

#### 各メニュー項目の違い
- **基本設定**: ホットキー、ウィンドウサイズ等の設定変更
- **アイテム管理**: data.jsonの内容を直接編集
- **アプリを終了**: アプリケーションの終了

#### 共通動作
- メニュー外をクリックすると自動的にメニューを閉じる
- メニュー項目選択後は自動的にメニューを閉じる（アプリ終了を除く）

### 4.6. アイテムをクリック

#### アクション
- アイテムリスト内のアイテムをクリック

#### 処理フロー
1. アイテムを実行（開く）
2. アイテムの種別に応じて実行：
   - URL: デフォルトブラウザで開く
   - ファイル: 関連付けられたアプリで開く
   - フォルダ: エクスプローラーで開く
   - アプリケーション: 実行ファイルを起動
3. ウィンドウを非表示（固定されていない場合）

### 4.7. 検索入力欄で Enter キー押下

#### アクション
- 検索入力欄でEnterキーを押下

#### 処理フロー

**通常モードの場合:**
1. 現在選択中のアイテムを取得
2. アイテムが存在する場合、アイテムを実行（開く）
3. アイテムの種別に応じて実行（4.6と同様）
4. 検索テキストをクリア（次回検索に備えて）
5. ウィンドウを非表示（固定されていない場合）

**ウィンドウ検索モードの場合:**
1. 現在選択中のウィンドウ情報を取得
2. ウィンドウが存在する場合：
   - 最小化されている場合は復元（ShowWindow SW_RESTORE）
   - ウィンドウをアクティブ化（SetForegroundWindow）
   - 検索テキストをクリア（次回検索に備えて）
   - normalモードの場合、ランチャーウィンドウを自動的に非表示
3. 選択されたウィンドウが前面に表示される

#### エラーハンドリング
- アイテムまたはウィンドウが存在しない場合は何も実行しない
- ウィンドウのアクティブ化に失敗した場合はエラーログを出力

### 4.8. 検索入力欄で Shift+Enter キー押下

#### アクション
- 検索入力欄でShift+Enterキーを押下

#### 処理フロー
1. 現在選択中のアイテムを取得
2. アイテムの親フォルダをエクスプローラーで開く
3. ウィンドウを非表示（固定されていない場合）

### 4.9. 検索入力欄で ArrowUp/ArrowDown キー押下

#### アクション
- 検索入力欄でArrowUpキーまたはArrowDownキーを押下

#### 処理フロー

**ArrowUpキー押下時:**
1. 選択を上に移動（1つ前のアイテムを選択）
2. 先頭の場合、末尾のアイテムにループ
3. 選択中のアイテムをハイライト表示
4. 必要に応じてスクロール

**ArrowDownキー押下時:**
1. 選択を下に移動（1つ次のアイテムを選択）
2. 末尾の場合、先頭のアイテムにループ
3. 選択中のアイテムをハイライト表示
4. 必要に応じてスクロール

#### 動作の違い
- **ArrowUp**: 選択を**上方向（前のアイテム）**に移動。先頭で押下すると末尾にループ
- **ArrowDown**: 選択を**下方向（次のアイテム）**に移動。末尾で押下すると先頭にループ

#### 共通動作
- どちらのキーも循環選択をサポート（リストの端に到達すると反対側にループ）
- 選択されたアイテムは自動的にビュー内にスクロール
- ハイライト表示により現在選択中のアイテムが視覚的に明確

### 4.10. アイテムを右クリック

#### アクション
- アイテムリスト内のアイテムを右クリック

#### 処理フロー
1. クリック位置（マウス座標）を取得
2. 画面端の場合は表示位置を自動調整
3. コンテキストメニューを表示（詳細は[右クリックメニュー仕様書](./context-menu.md)を参照）
4. 以下のメニュー項目を表示：
   - ✏️ 編集（常に表示）
   - ⭐ ワークスペースに追加（常に表示）
   - ──────────────── （区切り線、グループ以外）
   - 📋 パスをコピー（グループ以外）
   - 📋 親フォルダーのパスをコピー（ファイル・フォルダ・アプリのみ）
   - 📂 親フォルダーを開く（ファイル・フォルダ・アプリのみ）
   - ──────────────── （区切り線、.lnkファイルのみ）
   - 📋 リンク先のパスをコピー（.lnkファイルのみ）
   - 📋 リンク先の親フォルダーのパスをコピー（.lnkファイルのみ）
   - 📂 リンク先の親フォルダーを開く（.lnkファイルのみ）

#### メニュー項目
- **✏️ 編集**: アイテム編集モーダルを開く（すべてのアイテムタイプで表示）
- **⭐ ワークスペースに追加**: アイテムをワークスペースに追加（すべてのアイテムタイプで表示）

#### 表示条件
- **編集**: すべてのアイテムタイプで表示（LauncherItem、GroupItemともに対応）
- **ワークスペースに追加**: すべてのアイテムタイプで表示（LauncherItem、GroupItemともに対応）
- **グループアイテム**: 「編集」「ワークスペースに追加」のみ表示（パス関連メニューは非表示）
- **URL・カスタムURI**: 「編集」「ワークスペースに追加」「パスをコピー」を表示
- **ファイル・フォルダ・アプリ**: 「編集」「ワークスペースに追加」「パスをコピー」「親フォルダーのパスをコピー」「親フォルダーを開く」を表示
- **.lnkファイル**: 上記に加えて、区切り線の後にショートカット関連のメニュー（「リンク先のパスをコピー」「リンク先の親フォルダーのパスをコピー」「リンク先の親フォルダーを開く」）を表示

#### ツールチップ機能
- 各メニュー項目にマウスホバーすると、対象となるパスがツールチップで表示される
- 実際にコピーまたは開く対象のパスを事前確認できる

#### メニューを閉じる操作
- メニュー外をクリック
- Escapeキーを押下
- メニュー項目選択後は自動的に閉じる

### 4.11. コンテキストメニューから「パスをコピー」選択

#### アクション
- コンテキストメニューから「📋 パスをコピー」を選択

#### 処理フロー
1. 選択中のアイテムのパス（ファイルパス・URL等）を取得
2. 引数が設定されている場合は、パスと引数を結合して完全なコマンドラインを生成
3. クリップボードにコピー
4. 成功通知を表示
5. メニューを閉じる

#### コピー例
- **引数なし**: `C:\Windows\System32\notepad.exe`
- **引数あり**: `C:\Program Files\Microsoft VS Code\Code.exe --new-window`
  - パス: `C:\Program Files\Microsoft VS Code\Code.exe`
  - 引数: `--new-window`
  - コピー内容: `C:\Program Files\Microsoft VS Code\Code.exe --new-window`
- **ショートカットファイル**: `C:\Users\Username\Desktop\MyApp.lnk`
  - ショートカットファイル自身のパスをコピー

#### 動作の詳細
- 引数が設定されていないアイテムの場合は、パスのみをコピー
- 引数が設定されているアイテムの場合は、パスと引数をスペースで結合した完全なコマンドラインをコピー
- ショートカットファイルの場合は、ショートカットファイル自身のパス（.lnkファイル）をコピー
- ターミナルやバッチファイルなどにそのまま貼り付けて使用可能

#### エラーハンドリング
- コピー失敗時は[AlertDialog](./dialogs.md#2-alertdialog)でエラー表示

### 4.12. コンテキストメニューから「親フォルダーのパスをコピー」選択

#### アクション
- コンテキストメニューから「📁 親フォルダーのパスをコピー」を選択

#### 処理フロー
1. 選択中のアイテムのタイプを確認
2. URLまたはカスタムURIの場合はエラーアラートを表示（親フォルダーが存在しないため）
3. ファイル、フォルダ、アプリケーションの場合：
   - 親ディレクトリパスを抽出
   - クリップボードにコピー
   - 成功通知を表示
4. メニューを閉じる

#### 対応アイテムタイプ
- **対応**: ファイル、フォルダ、アプリケーション
- **非対応**: URL、カスタムURI（警告メッセージを表示）

#### コピー例
- `C:\Users\username\Documents\file.txt` → `C:\Users\username\Documents`
- `/home/user/files/app.exe` → `/home/user/files`

#### エラーハンドリング
- URLまたはカスタムURIの場合: [AlertDialog](./dialogs.md#2-alertdialog)で「URLおよびカスタムURIには親フォルダーがありません」と表示
- 親フォルダーパスの取得失敗時: [AlertDialog](./dialogs.md#2-alertdialog)で「親フォルダーのパスを取得できませんでした」と表示
- コピー失敗時: [AlertDialog](./dialogs.md#2-alertdialog)でエラー表示

### 4.13. コンテキストメニューから「親フォルダーを開く」選択

#### アクション
- コンテキストメニューから「📂 親フォルダーを開く」を選択

#### 処理フロー
1. 親フォルダーを開く処理を実行
2. エクスプローラーで親フォルダーを開き、アイテムを選択状態で表示
3. メニューを閉じる
4. ウィンドウを非表示（固定されていない場合）

#### 対応アイテムタイプ
- **対応**: ファイル、フォルダ、アプリケーション
- **非対応**: URL、カスタムURI（メニュー項目自体が表示されない）

#### 動作例
- `C:\Users\username\Documents\file.txt` → エクスプローラーで `C:\Users\username\Documents` を開き、`file.txt` を選択状態で表示
- `C:\Program Files\MyApp\app.exe` → エクスプローラーで `C:\Program Files\MyApp` を開き、`app.exe` を選択状態で表示

#### 用途
- アイテムの保存場所を素早く確認したい場合
- 同じフォルダ内の他のファイルを確認したい場合
- エクスプローラーでファイル操作を行いたい場合

#### Shift+Enterとの違い
- **Shift+Enter**: 選択中のアイテムに対して実行（キーボード操作）
- **右クリックメニュー**: 右クリックしたアイテムに対して実行（マウス操作）
- 両方とも同じ機能を使用

#### エラーハンドリング
- 親フォルダーを開くのに失敗した場合: [AlertDialog](./dialogs.md#2-alertdialog)でエラー表示

### 4.14. コンテキストメニューから「リンク先のパスをコピー」選択

#### アクション
- コンテキストメニューから「📋 リンク先のパスをコピー」を選択（.lnkファイルのみ）

#### 処理フロー
1. リンク先パスを確認
2. リンク先パスが存在しない場合はエラーメッセージを表示
3. リンク先パスをクリップボードにコピー
4. 成功通知を表示
5. メニューを閉じる

#### 対応アイテムタイプ
- **対応**: .lnkファイル（ショートカット）のみ
- **非対応**: 通常のファイル、フォルダ、URL、カスタムURI（メニュー項目自体が表示されない）

#### コピー例
- `.lnk` のリンク先: `C:\Program Files\Google\Chrome\Application\chrome.exe`
- `.lnk` のリンク先: `C:\Users\username\Documents\project`

#### 用途
- ショートカットファイルが指しているリンク先の実際のパスを取得したい場合
- スクリプトやバッチファイルでリンク先パスを使用したい場合

#### 「パスをコピー」との違い
- **パスをコピー**: .lnkファイル自体のパスをコピー（例: `C:\Users\username\Desktop\app.lnk`）
- **リンク先のパスをコピー**: リンク先の実際のパスをコピー（例: `C:\Program Files\App\app.exe`）

#### エラーハンドリング
- リンク先パスが存在しない場合: [AlertDialog](./dialogs.md#2-alertdialog)で「ショートカットのパスが見つかりません」と表示
- コピー失敗時: [AlertDialog](./dialogs.md#2-alertdialog)でエラー表示

### 4.15. コンテキストメニューから「リンク先の親フォルダーのパスをコピー」選択

#### アクション
- コンテキストメニューから「📋 リンク先の親フォルダーのパスをコピー」を選択（.lnkファイルのみ）

#### 処理フロー
1. リンク先パスを確認
2. リンク先パスが存在しない場合はエラーメッセージを表示
3. リンク先パスから親ディレクトリパスを抽出
4. クリップボードにコピー
5. 成功通知を表示
6. メニューを閉じる

#### 対応アイテムタイプ
- **対応**: .lnkファイル（ショートカット）のみ
- **非対応**: 通常のファイル、フォルダ、URL、カスタムURI（メニュー項目自体が表示されない）

#### コピー例
- リンク先: `C:\Program Files\Google\Chrome\Application\chrome.exe`
  → 親フォルダー: `C:\Program Files\Google\Chrome\Application`
- リンク先: `C:\Users\username\Documents\file.txt`
  → 親フォルダー: `C:\Users\username\Documents`

#### 用途
- ショートカットのリンク先ファイルが保存されているフォルダのパスを取得したい場合
- リンク先の周辺ファイルにアクセスしたい場合

#### 「親フォルダーのパスをコピー」との違い
- **親フォルダーのパスをコピー**: .lnkファイル自体の親フォルダーをコピー（例: `C:\Users\username\Desktop`）
- **リンク先の親フォルダーのパスをコピー**: リンク先の親フォルダーをコピー（例: `C:\Program Files\App`）

#### エラーハンドリング
- リンク先パスが存在しない場合: [AlertDialog](./dialogs.md#2-alertdialog)で「ショートカットのパスが見つかりません」と表示
- 親フォルダーパスの取得失敗時: [AlertDialog](./dialogs.md#2-alertdialog)で「ショートカットの親フォルダーのパスを取得できませんでした」と表示
- コピー失敗時: [AlertDialog](./dialogs.md#2-alertdialog)でエラー表示

### 4.16. コンテキストメニューから「リンク先の親フォルダーを開く」選択

#### アクション
- コンテキストメニューから「📂 リンク先の親フォルダーを開く」を選択（.lnkファイルのみ）

#### 処理フロー
1. リンク先パスを確認
2. リンク先パスが存在しない場合はエラーメッセージを表示
3. リンク先の親フォルダーを開く処理を実行
4. エクスプローラーでリンク先の親フォルダーを開き、リンク先ファイル/フォルダーを選択状態で表示
5. メニューを閉じる
6. ウィンドウを非表示（固定されていない場合）

#### 対応アイテムタイプ
- **対応**: .lnkファイル（ショートカット）のみ
- **非対応**: 通常のファイル、フォルダ、URL、カスタムURI（メニュー項目自体が表示されない）

#### 動作例
- リンク先: `C:\Program Files\App\app.exe`
  → エクスプローラーで `C:\Program Files\App` を開き、`app.exe` を選択状態で表示
- リンク先: `C:\Users\username\Documents\Project`
  → エクスプローラーで `C:\Users\username\Documents` を開き、`Project` フォルダーを選択状態で表示

#### 用途
- ショートカットのリンク先ファイルの実際の保存場所を確認したい場合
- リンク先ファイルと同じフォルダ内の他のファイルを確認したい場合
- エクスプローラーでリンク先ファイル/フォルダーを操作したい場合

#### 「親フォルダーを開く」との違い
- **親フォルダーを開く**: .lnkファイル自体の親フォルダーを開く（例: デスクトップ）
- **リンク先の親フォルダーを開く**: リンク先の親フォルダーを開く（例: `C:\Program Files\App`）

#### エラーハンドリング
- `originalPath` が存在しない場合: [AlertDialog](./dialogs.md#2-alertdialog)で「ショートカットのパスが見つかりません」と表示
- リンク先の親フォルダーを開くのに失敗した場合: [AlertDialog](./dialogs.md#2-alertdialog)でエラー表示

### 4.17. コンテキストメニュー項目にマウスホバー

#### アクション
- コンテキストメニューの各項目にマウスカーソルをホバー

#### 処理フロー
1. 対象パスがツールチップとして設定される
2. ブラウザのネイティブツールチップが自動的に表示される
3. ツールチップには以下の内容が表示される：

**パスをコピー:**
- 引数なし: アイテムのパス
- 引数あり: パスと引数を結合した完全なコマンドライン

**親フォルダーのパスをコピー / 親フォルダーを開く:**
- 親ディレクトリのパス

**リンク先のパスをコピー:**
- リンク先パス（.lnkファイルの場合）

**リンク先の親フォルダーのパスをコピー / リンク先の親フォルダーを開く:**
- リンク先の親ディレクトリパス

#### 表示例

**通常のファイル・フォルダ・アプリケーション:**
```
📋 パスをコピー
→ C:\Program Files\Microsoft VS Code\Code.exe --new-window

📋 親フォルダーのパスをコピー
→ C:\Program Files\Microsoft VS Code

📂 親フォルダーを開く
→ C:\Program Files\Microsoft VS Code
```

**ショートカットファイル（.lnk）:**
```
📋 パスをコピー
→ C:\Users\username\Desktop\MyApp.lnk

📋 親フォルダーのパスをコピー
→ C:\Users\username\Desktop

📂 親フォルダーを開く
→ C:\Users\username\Desktop
─────────────────
📋 リンク先のパスをコピー
→ C:\Program Files\MyApp\app.exe

📋 リンク先の親フォルダーのパスをコピー
→ C:\Program Files\MyApp

📂 リンク先の親フォルダーを開く
→ C:\Program Files\MyApp
```

#### 用途
- 実際にコピー/開く対象のパスを事前確認
- 長いパスや引数の内容を確認
- 操作ミスを防ぐ

#### 動作の詳細
- ホバー時に自動的に表示（マウスをメニュー項目上に置くだけで表示）
- ブラウザのネイティブツールチップを使用（OSの設定に従った表示タイミング）
- マウスを離すと自動的に非表示

### 4.18. ドラッグ&ドロップ操作

#### アクション
- ファイルまたはフォルダをウィンドウにドラッグ&ドロップしてアイテム登録

#### 処理フロー

**ドラッグ中（ドロップ前）:**
1. ドラッグ状態を更新
2. 半透明オーバーレイを表示
3. 「ファイルをドロップして登録」メッセージを表示
4. ドラッグ中の視覚効果を適用

**ドロップ時:**
1. ドロップされたファイルを取得
2. ファイルパスを取得
3. 複数ファイルの場合はパス配列を作成
4. 登録モーダルを開いて登録フローへ（詳細は[アイテム登録・編集モーダル仕様書](./register-modal.md)を参照）
5. 保存先選択肢を構築
6. ドラッグ状態を解除してオーバーレイを非表示

#### 保存先選択
- **選択肢**: `dataFileTabs`設定で定義されたタブ（データファイル）のリスト
- **デフォルト選択**: 現在開いているタブ（アクティブタブ）
- **ユーザー変更可能**: モーダル内で任意のタブに変更可能

#### 動作の違い
- **ドラッグ中**: 視覚的フィードバック（オーバーレイ・メッセージ）の表示
- **ドロップ時**: 実際の登録処理の開始

#### エラーハンドリング
- パス取得失敗時: [AlertDialog](./dialogs.md#2-alertdialog)で「ファイルパスを取得できませんでした」を表示

### 4.19. ウィンドウ表示時の初期化

#### アクション
- グローバルホットキー（Alt+Space、デフォルト）でウィンドウを表示

#### 処理フロー
1. データファイル（data.json）を読み込み
2. データを解析してアイテム配列に変換
3. アイコンキャッシュを適用
4. アイテムリストを表示
5. 検索入力欄に自動フォーカス
6. 固定モードを取得
7. 固定ボタンの状態を反映

### 4.20. アイテムにマウスホバー

#### アクション
- アイテムリスト内のアイテムにマウスカーソルをホバー

#### 処理フロー
1. ツールチップ情報が設定される
2. ブラウザのネイティブツールチップが自動的に表示される
3. ツールチップには以下の内容が表示される：

**通常のアイテムの場合:**
- **パス情報**（最初に表示）
  - 引数なし: パスのみ
  - 引数あり: パスと引数を結合した完全なコマンドライン
- **空行**
- **データファイル**: アイテムが定義されているファイル（data.json または data2.json）
- **ID**: アイテムの一意識別子
- **取込元**: フォルダ取込から展開されたアイテムの場合のみ、元ディレクトリパス
- **設定**: フォルダ取込から展開されたアイテムの場合のみ、フォルダ取込のオプション情報

**グループアイテムの場合:**
- **グループ情報**: `グループ: アイテム名1, アイテム名2, ...`
- **空行**
- **データファイル**: データファイル名
- **ID**: アイテムの一意識別子

**ウィンドウアイテムの場合（ウィンドウ検索モード）:**
- **タイトル**: ウィンドウのタイトル
- **位置**: `(x, y)`
- **サイズ**: `幅 x 高さ`
- **プロセスID**: ウィンドウのプロセスID

#### 表示例

**通常アイテム（引数なし）:**
```
C:\Users\Desktop\myapp.exe

データファイル: data.json
ID: abc123
```

**通常アイテム（引数あり）:**
```
C:\Program Files\Microsoft VS Code\Code.exe --new-window

データファイル: data.json
ID: def456
```

**フォルダ取込から展開されたアイテム:**
```
C:\Work\projects\myproject\readme.pdf

データファイル: data.json
ID: ghi789
取込元: C:\Work\projects
設定: 深さ:2, タイプ:ファイルのみ, フィルター:*.pdf
```

**グループアイテム:**
```
グループ: Google, GitHub, Qiita

データファイル: data.json
ID: jkl012
```

**ウィンドウアイテム（ウィンドウ検索モード）:**
```
Visual Studio Code - myproject
位置: (100, 200)
サイズ: 1920 x 1080
プロセスID: 12345
```

#### フォルダ取込オプション情報の表示形式

フォルダ取込から展開されたアイテムの場合、「設定」行に以下の形式でオプション情報が表示されます：

- **深さ**: `深さ:2` または `深さ:無制限`
- **タイプ**: `タイプ:ファイルのみ` / `タイプ:フォルダのみ` / `タイプ:ファイルとフォルダ`
- **フィルター**: `フィルター:*.pdf` （設定されている場合のみ）
- **除外**: `除外:*.tmp` （設定されている場合のみ）
- **接頭辞**: `接頭辞:Doc: ` （設定されている場合のみ）
- **接尾辞**: `接尾辞: (backup)` （設定されている場合のみ）

例：`深さ:2, タイプ:ファイルのみ, フィルター:*.{pdf,docx}, 除外:*.tmp, 接頭辞:Work: `

#### 用途
- アイテムの実行パスを確認したい場合
- 引数が設定されているか確認したい場合
- コマンドラインの完全な形式を知りたい場合
- アイテムがどのデータファイルに定義されているか確認したい場合
- フォルダ取込から展開されたアイテムの元ディレクトリや設定を確認したい場合
- グループに含まれるアイテムを確認したい場合

#### 動作の詳細
- ホバー時に自動的に表示（マウスをアイテム上に置くだけで表示）
- ブラウザのネイティブツールチップを使用（OSの設定に従った表示タイミング）
- マウスを離すと自動的に非表示
- 複数行の情報を見やすく整形して表示

### 4.21. コンテキストメニューから「編集」選択

#### アクション
- コンテキストメニューから「✏️ 編集」を選択

#### 処理フロー
1. 選択中のアイテムを編集用データ形式に変換
2. フォルダ取込から展開されたアイテムの場合:
   - 元のディレクティブ行を取得
   - 元のIDとデータファイル情報を保持
3. 編集モーダルを編集モードで開く（詳細は[アイテム登録・編集モーダル仕様書](./register-modal.md)を参照）
4. 保存先選択肢を構築
5. モーダル表示中はウィンドウが非表示にならない（モーダルモード）
6. メニューを閉じる

#### 動作の詳細
- **通常アイテム**: JSONフォーマットで編集可能
- **フォルダ取込ディレクティブ**: ディレクティブとして編集
  - 元のIDを保持して直接更新

#### モーダルでの編集内容
- **単一アイテム**: 名前、パス、引数、保存先、カスタムアイコンを編集可能
- **フォルダ取込ディレクティブ**:
  - パス、保存先、フォルダ取込オプション（深さ、タイプ、フィルター等）を編集可能
  - 名前フィールドは読み取り専用（ハイフン表示）
- **グループ**: グループ名、保存先、アイテム名リストを編集可能

#### 保存先選択
- **選択肢**: `dataFileTabs`設定で定義されたタブ（データファイル）のリスト
- **表示形式**: タブ名（`dataFileTabs[].name`）
- **編集時のデフォルト**: アイテムが現在保存されているデータファイル
- **動的更新**: 設定でタブが追加・削除されると、選択肢も自動的に更新される

#### 保存処理
- **保存先が変更された場合**: 元のタブから削除し、新しいタブに登録（タブ間移動）
  - 例：メインタブのアイテムを編集し、保存先を「サブ1」に変更すると、アイテムはメインタブから削除され、サブ1タブに追加される
- **保存先が変更されていない場合**: 従来の更新処理
  - **通常アイテム**: JSON形式で保存
  - **フォルダ取込ディレクティブ**: ディレクティブ行を直接保存
- バックアップ自動作成
- データ再読込で画面に反映

### 4.22. アイテム登録ボタン押下

#### アクション
- ヘッダーのアイテム登録ボタン（➕）をクリック

#### 処理フロー
1. 登録モーダルを新規登録モードで開く（詳細は[アイテム登録・編集モーダル仕様書](./register-modal.md)を参照）
2. 保存先選択肢を構築
3. モーダル表示中はウィンドウが非表示にならない（モーダルモード）
4. ユーザーがアイテム情報を入力して保存
5. 選択された保存先タブ（データファイル）に追加
6. データ再読込で画面に反映

#### 保存先選択
- **選択肢**: `dataFileTabs`設定で定義されたタブ（データファイル）のリスト
- **表示形式**: タブ名（`dataFileTabs[].name`）
- **デフォルト選択**: 現在開いているタブ（アクティブタブ）
- **動的更新**: 設定でタブが追加・削除されると、選択肢も自動的に更新される

#### ボタン配置
- ヘッダーの一番左（更新ボタンの前）

#### モーダルモード
- モーダル表示中はフォーカスアウトでもウィンドウが非表示にならない
- モーダルを閉じると通常のフォーカスアウト動作に戻る

### 4.23. データファイルタブをクリック

#### アクション
- タブバーのタブボタンをクリック

#### 処理フロー
1. クリックされたタブに対応するデータファイル名を取得
2. アクティブなタブを変更
3. アクティブなタブのデータファイルに含まれるアイテムのみを表示
4. 検索クエリはクリア
5. 選択を先頭にリセット

#### タブの表示条件
- **設定でタブ表示がON**: `showDataFileTabs: true`の場合のみタブバーが表示される
- **設定でタブ表示がOFF**: タブバーは非表示、data.jsonのみが表示される

#### タブの表示内容
- **タブラベル**: `dataFileTabs`配列の`name`フィールド、またはデフォルトタブ名、またはファイル名
  - `name`フィールドに値が設定されている場合は、その名前を表示
  - `name`フィールドが空文字列の場合は、デフォルトタブ名を表示（data.json → 「メイン」、data2.json → 「サブ1」）
  - デフォルトタブ名がない場合はファイル名を表示
- **アイテム数表示**: 各タブのラベル右側に、そのタブに含まれるアイテム数を「(件数)」形式で表示
  - 例: 「メイン (15)」「サブ1 (8)」
  - 検索クエリに基づいてフィルタリングされたアイテムの件数を表示
  - 検索入力欄が空の場合は、タブ内の全アイテム数を表示
- **アクティブ状態**: 現在選択中のタブは視覚的にハイライト表示
- **ツールチップ**: タブにホバーすると、ファイル情報が表示される
  - **ファイルラベルが設定されている場合**: 「ラベル名 (ファイル名)」形式（例: 「開発用 (data2.json)」）
  - **ラベルが未設定の場合**: ファイル名のみ（例: 「data.json」）
  - 複数ファイルタブの場合は、全ファイルの情報がカンマ区切りで表示される
- **リアルタイム更新**: 管理ウィンドウでタブ名やファイルラベルを変更すると、即座にメインウィンドウのタブ名とツールチップが更新される

#### アイテム数表示（タブ非表示時）
- タブ表示がOFF（`showDataFileTabs: false`）の場合、検索入力欄の下にアイテム数を表示
- 「ItemCountDisplay」コンポーネントを使用
- 検索・フィルタリング後の表示件数を表示

#### タブの表示順序
- **配列順序**: `dataFileTabs`配列の要素の順序がそのままタブの表示順序になります
- **順序変更**: 管理ウィンドウの▲▼ボタンで順序を変更可能
- **リアルタイム更新**: 順序変更も即座にメインウィンドウに反映されます

#### アクティブタブの初期化
- **アプリ起動時**: `defaultFileTab`設定で指定されたタブを表示
- **タブが存在しない場合**: 自動的にdata.jsonにフォールバック
- **ウィンドウ表示時**: 前回のアクティブタブを記憶して表示

#### データの自動フィルタリング
- アクティブなタブのデータファイル（`sourceFile`プロパティ）に一致するアイテムのみを表示
- フォルダ取込アイテムから展開されたアイテムも、元のディレクティブの`sourceFile`に基づいてフィルタリング

#### 関連設定
- **タブ表示設定**: `showDataFileTabs` - タブバーの表示/非表示
- **デフォルトタブ**: `defaultFileTab` - 起動時のアクティブタブ
- **タブ設定**: `dataFileTabs` - 各タブの名前と表示順序を管理する配列

詳細は **[アプリケーション設定](./admin-window.md#711-タブ表示設定)** を参照してください。

### 4.24. Tab/Shift+Tabキー押下

#### アクション
- 検索入力欄でTabキーまたはShift+Tabキーを押下

#### 処理フロー

**Tabキー押下時:**
1. タブ表示設定が有効で、複数のタブが存在するか確認
2. 現在のアクティブタブを取得
3. 次のタブに切り替え（末尾の場合は先頭にループ）
4. 選択を先頭にリセット

**Shift+Tabキー押下時:**
1. タブ表示設定が有効で、複数のタブが存在するか確認
2. 現在のアクティブタブを取得
3. 前のタブに切り替え（先頭の場合は末尾にループ）
4. 選択を先頭にリセット

#### 表示条件
- **タブ表示がON**: `showDataFileTabs: true`の場合のみ動作
- **複数タブが存在**: 2つ以上のタブが存在する場合のみ動作
- 条件を満たさない場合、Tabキーはブラウザのデフォルト動作（フォーカス移動）

#### タブの順序
- タブ順序設定（`tabOrder`）に従って循環
- カスタム順序が設定されていない場合は、ファイル名の自然順で循環

#### 動作の違い
- **Tab**: 次のタブへ移動（右方向）。末尾で押下すると先頭にループ
- **Shift+Tab**: 前のタブへ移動（左方向）。先頭で押下すると末尾にループ

#### 共通動作
- どちらのキーも循環選択をサポート（タブリストの端に到達すると反対側にループ）
- タブ切り替え時は選択を先頭にリセット（最初のアイテムを選択状態にする）
- タブ切り替え時も検索クエリは保持される

#### マウス操作との違い
- **Tabキー**: キーボードでの高速なタブ切り替え
- **タブクリック**: マウスでの直接的なタブ選択
- どちらも同じ結果（アクティブタブの変更）だが、操作方法が異なる

#### 関連設定
- **タブ表示設定**: `showDataFileTabs` - Tabキーによるタブ切り替えの有効/無効
- **タブ順序**: `tabOrder` - Tabキーでの循環順序

詳細は **[アプリケーション設定](./admin-window.md#711-タブ表示設定)** を参照してください。

### 4.25. Escapeキー押下

#### アクション
- メインウィンドウでEscapeキーを押下

#### 処理フロー
1. 現在のウィンドウ状態を確認
2. 以下のいずれかの条件を満たす場合、Escapeキーは無効（ウィンドウを閉じない）：
   - 初回起動モード（ホットキー未設定）
   - 編集モード（アイテムの登録・編集モーダルが開いている）
   - モーダルモード（各種ダイアログが表示されている）
   - ピン留めモードが`alwaysOnTop`または`stayVisible`
3. 上記の条件に該当しない場合：
   - メインウィンドウを非表示にする

#### Escapeキーが無効になる状態

**初回起動モード:**
- ホットキーが未設定の状態（初回起動セットアップ中）
- ユーザーがホットキーを設定するまでウィンドウを閉じられない

**編集モード:**
- [アイテム登録モーダル（RegisterModal）](./register-modal.md)が開いている
- アイテム編集モーダルが開いている
- [ブックマークインポートモーダル](./bookmark-import-modal.md)が開いている
- 誤操作でウィンドウが閉じるのを防止

**モーダルモード:**
- [AlertDialog](./dialogs.md#2-alertdialog)（通知ダイアログ）が表示されている
- [ConfirmDialog](./dialogs.md#3-confirmdialog)（確認ダイアログ）が表示されている
- その他のモーダルダイアログが表示されている
- ダイアログ内でのEscapeキー処理を優先

**ピン留めモード（一部）:**
- ピン留めモードが`alwaysOnTop`（常に最前面）の場合
- ピン留めモードが`stayVisible`（常に表示）の場合
- 注：ピン留めモードが`normal`（通常モード）の場合は、Escapeキーで閉じることができる

#### 関連する操作

Escapeキーでウィンドウを閉じられない状態でも、以下の方法でウィンドウを非表示にできます：
- グローバルホットキー（Alt+Space等）を再度押下
- ピン留めボタン（📌）を使って固定状態を変更してから閉じる

#### ホットキーとの違い

**グローバルホットキー（Alt+Space等）:**
- ウィンドウの表示/非表示をトグル
- 初回起動モード、編集モード、モーダルモード、ピン留めモード（一部）では非表示にならない
- Escapeキーと同じ条件で制限される

**Escapeキー:**
- ウィンドウを非表示にする（表示状態でのみ有効）
- グローバルホットキーと同じ条件で制限される
- コンテキストメニューやダイアログが開いている場合は、それらを閉じる動作を優先

#### 関連ドキュメント
- [ウィンドウ制御](../architecture/window-control.md) - ウィンドウの表示/非表示制御の詳細
- [初回設定画面](./first-launch-setup.md) - 初回起動モードの詳細

### 4.26. ウィンドウ検索モード

#### アクション
- 検索入力欄の最初に `<` を入力してウィンドウ検索モードに切り替え
- 設定画面で「ウィンドウ検索モード直接起動」のホットキーを設定している場合、そのホットキーで直接起動可能

#### 処理フロー

**直接起動（itemSearchHotkey設定時）:**
1. 設定されたホットキー（例: `Ctrl+Alt+W`）を押下
2. メインウィンドウが表示され、自動的にウィンドウ検索モードに切り替え
3. 検索入力欄に `<` は表示されない（内部的にモードのみ切り替え）
4. `window-shown-item-search`イベントがレンダラーに送信される

**モード切り替え（`<` 入力）:**
1. 検索入力欄の最初の文字が `<` であることを検知
2. ウィンドウ検索モードに自動切り替え
3. システム内の開いているウィンドウを取得（`get-all-windows-all-desktops` IPC）
   - 全仮想デスクトップのウィンドウを取得（`includeAllVirtualDesktops: true`パラメータ使用）
   - `DWM_CLOAKED_SHELL`以外のクローキングは除外（仮想デスクトップのウィンドウは含める）
4. QuickDashLauncher自身のウィンドウは除外される
5. システムウィンドウを除外（プロセス名とクラス名の組み合わせで判定）
   - Windows入力エクスペリエンス（TextInputHost.exe + Windows.UI.Core.CoreWindow）
   - Windowsシェルエクスペリエンス（ShellExperienceHost.exe + Windows.UI.Core.CoreWindow）
   - デスクトップ壁紙（explorer.exe + Progman）

**ウィンドウのフィルタリング:**
1. `<` を除いた検索クエリを取得
2. スペース区切りでAND検索を実行
3. ウィンドウタイトルで部分一致フィルタリング（大文字小文字区別なし）
4. フィルタリング結果をリスト表示

**ウィンドウアイテムの表示:**
- **アイコン**: ウィンドウから取得したアイコン（失敗時は🪟絵文字）
- **スタイル**: 左側に青い境界線（`.window-item`クラス）
- **名前**: ウィンドウのタイトル
- **ツールチップ**: タイトル、位置、サイズ、プロセスID、実行ファイルパスを表示

**ウィンドウの選択・アクティブ化:**
1. ウィンドウアイテムをクリック、またはEnterキーを押下
2. `activate-window` IPCで選択されたウィンドウをアクティブ化
3. 最小化されているウィンドウは自動的に復元（ShowWindow SW_RESTORE）
4. ウィンドウがフォーカスされ前面に表示される（SetForegroundWindow）
5. normalモードの場合、ランチャーウィンドウが自動的に非表示

**仮想デスクトップタブバー（v0.5.22以降）:**
- ウィンドウ検索モード時に、仮想デスクトップごとにウィンドウをフィルタリング可能
- タブ構成:
  - **「すべて」**: 全仮想デスクトップのウィンドウを表示
  - **「ピン止め」**: 全仮想デスクトップにピン止めされたウィンドウのみ表示（該当ウィンドウがある場合のみ表示）
  - **「1」「2」...**: 各仮想デスクトップのウィンドウを表示
  - 現在アクティブなデスクトップには「(現在)」ラベルを付与（例: 「1 (現在)」）
- 各タブにはウィンドウ件数を表示（例: 「すべて(12)」）
- コンポーネント: `LauncherDesktopTabBar`

**通常モードへの復帰:**
1. 検索欄の `<` を削除
2. 通常の検索モードに自動的に戻る
3. タブバーが再表示される（設定で有効な場合）
4. 通常のアイテムリストが再表示される

**ウィンドウを閉じる際の自動リセット:**
- ウィンドウ検索モード中にウィンドウを非表示にすると、自動的に通常モードに戻ります
- 次回ウィンドウを開いた際、モード切り替えによるラグを防止します
- `window-hidden`イベントで`setSearchMode('normal')`を実行

#### 技術的詳細

**Win32 API使用（koffi経由）:**
- `EnumWindows`: システム内のすべてのウィンドウを列挙
- `GetWindowTextW`: ウィンドウタイトルを取得
- `IsWindowVisible`: 表示されているウィンドウかを判定
- `GetWindowRect`: ウィンドウの位置とサイズを取得
- `GetWindowThreadProcessId`: プロセスIDを取得
- `ShowWindow`: ウィンドウの表示状態を変更（最小化解除）
- `SetForegroundWindow`: ウィンドウをアクティブ化

**データ型:**
```typescript
interface WindowInfo {
  hwnd: number | bigint;      // ウィンドウハンドル
  title: string;               // ウィンドウタイトル
  x: number;                   // X座標
  y: number;                   // Y座標
  width: number;               // 幅
  height: number;              // 高さ
  processId: number;           // プロセスID
  isVisible: boolean;          // 表示状態
  executablePath?: string;     // 実行ファイルパス（取得可能な場合）
  processName?: string;        // プロセス名（実行ファイル名）
  className?: string;          // ウィンドウクラス名（システムウィンドウ除外に使用）
  icon?: string;               // アイコン（base64エンコードされたデータURL）
  desktopNumber?: number;      // ウィンドウが存在する仮想デスクトップ番号
  isPinned?: boolean;          // 全仮想デスクトップにピン止めされているか
}
```

**SearchMode型:**
```typescript
type SearchMode = 'normal' | 'window' | 'history';
```

#### ピン留めモードとの連携
- **normal**: ウィンドウ選択時にランチャーウィンドウが自動的に非表示
- **alwaysOnTop**: ウィンドウ選択後もランチャーウィンドウは表示されたまま（最前面）
- **stayVisible**: ウィンドウ選択後もランチャーウィンドウは表示されたまま

#### ユースケース
- 多数のウィンドウが開いている状態で、特定のウィンドウに素早く切り替えたい
- 最小化されているウィンドウを探して復元したい
- ウィンドウタイトルの一部だけを覚えている状態で検索したい
- タスクバーやAlt+Tabよりも高速にウィンドウを切り替えたい

#### システムウィンドウの除外

ウィンドウ検索機能では、以下のシステムウィンドウを自動的に除外します：

| ウィンドウ | プロセス名 | クラス名 | 説明 |
|-----------|----------|---------|------|
| Windows入力エクスペリエンス | TextInputHost.exe | Windows.UI.Core.CoreWindow | IME・タッチキーボード等 |
| Windowsシェルエクスペリエンス | ShellExperienceHost.exe | Windows.UI.Core.CoreWindow | スタートメニュー・通知センター等 |
| デスクトップ壁紙 | explorer.exe | Progman | Program Manager（デスクトップ背景） |

**除外ルールの仕組み:**
- プロセス名とクラス名の**両方**が一致する場合にのみ除外（誤検知防止）
- 実装場所: `src/main/utils/nativeWindowControl.ts` の `EXCLUDED_WINDOWS` 配列
- デバッグ: `scripts/debug-windows.mjs` で除外動作を確認可能

#### 制限事項
- Windows専用機能（Win32 API使用）
- 一部のシステムウィンドウは除外ルールにより表示されない
- タイトルのないウィンドウは表示されない
- QuickDashLauncher自身のウィンドウは除外される
- 表示されていないウィンドウ（`IsWindowVisible = false`）は除外される

#### 関連ドキュメント
- [キーボードショートカット](../features/keyboard-shortcuts.md) - ウィンドウ検索モードの操作方法
- [IPCチャンネル](../architecture/ipc-channels.md) - `get-all-windows`、`activate-window` の詳細

### 4.27. 検索モード切り替え

#### アクション
- 検索入力欄でShift+Tabキーを押下して検索モードを切り替え

#### 処理フロー

**Shift+Tabキー押下時:**
1. 現在の検索モードを確認
2. 次のモードに切り替え（normal → window → history → normal...）
3. 各モードに応じた初期化処理を実行：
   - **通常モード**: データファイルタブのアイテムリストを表示
   - **ウィンドウ検索モード**: システム内の開いているウィンドウリストを取得
   - **実行履歴検索モード**: WorkspaceServiceから実行履歴を読み込み
4. 検索クエリをクリア
5. 選択インデックスを先頭にリセット
6. モードインジケーターを更新（検索欄左上に表示）

#### 各モードの特徴

**通常モード:**
- アイコン: なし（デフォルト）
- 対象: データファイル（data.json等）に登録されているアイテム
- フィルタリング: アイテム名の部分一致検索
- タブバー: 表示（設定で有効な場合）

**ウィンドウ検索モード:**
- アイコン: 🪟（ウィンドウ）
- 対象: システム内の開いているウィンドウ
- フィルタリング: ウィンドウタイトルの部分一致検索（スペース区切りでAND検索）
- タブバー: 非表示
- 詳細: [4.26](#426-ウィンドウ検索モード)を参照

**実行履歴検索モード:**
- アイコン: 📜（履歴）
- 対象: 過去に実行したアイテム（グループは除外）
- フィルタリング: アイテム名の部分一致検索
- タブバー: 表示（設定で有効な場合）
- データソース: WorkspaceServiceの実行履歴（executionHistory.json）

#### モードインジケーター

検索入力欄の左上に現在のモードが表示されます：
- **通常モード**: インジケーター非表示
- **ウィンドウ検索モード**: 「🪟 ウィンドウ」
- **実行履歴検索モード**: 「📜 履歴」

#### 実行履歴検索モードの動作

**履歴の追加:**
- アイテムを実行（Enterキー、クリック）すると自動的に履歴に追加される
- グループアイテムは履歴に追加されない（個別アイテムのみ）
- 同じアイテムを複数回実行すると、最新の実行日時が記録される

**履歴の表示:**
- 実行履歴は新しい順に表示される
- アイテム名、パス、引数、アイコンが保持される
- 削除されたアイテムも履歴に残る（再実行可能）

**履歴からの実行:**
- 履歴アイテムを選択してEnterキーまたはクリックで再実行
- 実行後、検索クエリは自動的にクリア
- normalモードの場合、ランチャーウィンドウが自動的に非表示

**履歴のクリア:**
- 管理ウィンドウから履歴をクリア可能
- executionHistory.jsonを削除することでもクリア可能

#### 注意事項

**Tab/Shift+Tabキーの動作:**
- タブ表示がONで複数のタブが存在する場合:
  - **Tabキー**: タブ切り替え（次のタブへ）
  - **Shift+Tab**: 検索モード切り替え
- タブ表示がOFFまたはタブが1つのみの場合:
  - **Shift+Tab**: 検索モード切り替え

**ウィンドウを閉じる際の自動リセット:**
- ウィンドウを非表示にすると、通常モードに自動的にリセットされる
- 次回表示時のモード切り替えによるラグを防止

#### ユースケース

**通常モード:**
- 登録済みアイテムを検索して実行したい
- 頻繁に使用するアプリやファイルにアクセスしたい

**ウィンドウ検索モード:**
- 多数のウィンドウが開いている状態で、特定のウィンドウに素早く切り替えたい
- 最小化されているウィンドウを探して復元したい

**実行履歴検索モード:**
- 最近使用したアイテムを再度実行したい
- アイテム名を思い出せないが、最近使ったことを覚えている
- 削除したアイテムを再度実行したい

#### データ型

**ExecutionHistoryItem型:**
```typescript
interface ExecutionHistoryItem {
  itemName: string;         // アイテム名
  itemPath: string;         // パス
  itemType: string;         // タイプ（url, file, folder, app, customUri, group）
  args?: string;            // 引数（オプション）
  icon?: string;            // アイコン（base64エンコードされたデータURL）
  executedAt: string;       // 実行日時（ISO形式）
}
```

#### 関連ドキュメント
- [キーボードショートカット](../features/keyboard-shortcuts.md) - 検索モード切り替えの詳細
- [アプリケーション設定](./admin-window.md#7-設定機能の詳細) - 実行履歴の管理
