# 右クリックメニュー仕様書

## 関連ドキュメント

- [画面一覧](./README.md) - 全画面構成の概要
- [メインウィンドウ](./main-window.md) - メイン画面の詳細仕様
- [キーボードショートカット](../features/keyboard-shortcuts.md) - ショートカット一覧

## 1. 概要

右クリックメニュー（ContextMenu）は、メインウィンドウのアイテムリストで右クリックしたときに表示されるコンテキストメニューです。アイテムのパス操作や編集機能を提供します。

**キーボードショートカット**: Escapeキーでメニューを閉じることができます。

### 主要機能
- **パスのコピー**: アイテムのパス、親フォルダーのパスをクリップボードにコピー
- **フォルダーを開く**: 親フォルダーをエクスプローラーで開く
- **ショートカット対応**: .lnkファイルの場合、リンク先のパス操作も提供
- **アイテム編集**: RegisterModalでアイテムを編集

## 2. 基本情報

| 項目 | 内容 |
|------|------|
| **ファイル名** | `src/renderer/components/ContextMenu.tsx` |
| **コンポーネント名** | `ContextMenu` |
| **表示条件** | メインウィンドウでアイテムを右クリック |
| **メニュータイプ** | フローティングメニュー |
| **親画面** | メインウィンドウ |

## 3. Props

| プロパティ | 型 | 必須 | 説明 |
|-----------|------|:----:|------|
| `isVisible` | `boolean` | ○ | メニューの表示状態 |
| `position` | `{ x: number; y: number }` | ○ | メニューの表示位置 |
| `item` | `AppItem \| null` | ○ | 対象アイテム |
| `onClose` | `() => void` | ○ | 閉じる時のコールバック |
| `onCopyPath` | `(item: LauncherItem) => void` | ○ | パスコピー時のコールバック |
| `onCopyParentPath` | `(item: LauncherItem) => void` | ○ | 親フォルダーパスコピー時のコールバック |
| `onOpenParentFolder` | `(item: LauncherItem) => void` | ○ | 親フォルダーを開く時のコールバック |
| `onCopyShortcutPath` | `(item: LauncherItem) => void` | - | リンク先パスコピー時のコールバック |
| `onCopyShortcutParentPath` | `(item: LauncherItem) => void` | - | リンク先の親フォルダーパスコピー時のコールバック |
| `onOpenShortcutParentFolder` | `(item: LauncherItem) => void` | - | リンク先の親フォルダーを開く時のコールバック |
| `onEditItem` | `(item: AppItem) => void \| Promise<void>` | - | アイテム編集時のコールバック |
| `onAddToWorkspace` | `(item: AppItem) => void \| Promise<void>` | - | ワークスペースに追加時のコールバック |

## 4. メニュー項目一覧

### 通常アイテム（ファイル、フォルダ、EXE）

| 項目名 | アイコン | 説明 | 表示条件 |
|--------|---------|------|----------|
| 編集 | ✏️ | RegisterModalでアイテムを編集 | `onEditItem`が指定された場合 |
| ワークスペースに追加 | ⭐ | アイテムをワークスペースに追加 | 常時表示 |
| パスをコピー | 📋 | アイテムのフルパスをコピー | 常時表示 |
| 親フォルダーのパスをコピー | 📋 | 親フォルダーのパスをコピー | 親フォルダーがある場合 |
| 親フォルダーを開く | 📂 | 親フォルダーをエクスプローラーで開く | 親フォルダーがある場合 |

### ショートカットアイテム（.lnk）

上記に加えて以下の項目が表示されます:

| 項目名 | アイコン | 説明 |
|--------|---------|------|
| リンク先のパスをコピー | 📋 | ショートカットが指すファイルのパスをコピー |
| リンク先の親フォルダーのパスをコピー | 📋 | リンク先ファイルの親フォルダーのパスをコピー |
| リンク先の親フォルダーを開く | 📂 | リンク先の親フォルダーをエクスプローラーで開く |

### URLアイテム

| 項目名 | アイコン | 説明 |
|--------|---------|------|
| 編集 | ✏️ | アイテムを編集 |
| ワークスペースに追加 | ⭐ | アイテムをワークスペースに追加 |
| パスをコピー | 📋 | URLをコピー |

※URLアイテムには親フォルダー関連の項目は表示されません。

### カスタムURIアイテム

| 項目名 | アイコン | 説明 |
|--------|---------|------|
| 編集 | ✏️ | アイテムを編集 |
| ワークスペースに追加 | ⭐ | アイテムをワークスペースに追加 |
| パスをコピー | 📋 | カスタムURIをコピー |

※カスタムURIアイテムには親フォルダー関連の項目は表示されません。

### グループアイテム

| 項目名 | アイコン | 説明 |
|--------|---------|------|
| 編集 | ✏️ | グループを編集 |
| ワークスペースに追加 | ⭐ | グループをワークスペースに追加 |

※グループアイテムにはパス関連の項目は表示されません。

## 5. 機能詳細

### 5.1. 編集

#### アクション
- 「✏️ 編集」をクリック

#### 処理フロー
1. メニューを閉じる
2. 登録・編集モーダルが開かれる

### 5.2. パスをコピー

#### アクション
- 「📋 パスをコピー」をクリック

#### 処理フロー
1. アイテムのフルパスを取得
2. クリップボードにコピー
3. メニューを閉じる

#### ツールチップ
- メニュー項目のtitle属性にフルパスを表示

### 5.3. 親フォルダーのパスをコピー

#### アクション
- 「📋 親フォルダーのパスをコピー」をクリック

#### 処理フロー
1. 親フォルダーのパスを取得
2. クリップボードにコピー
3. メニューを閉じる

#### 表示条件
- アイテムタイプが`url`、`customUri`、`group`でないこと

### 5.4. 親フォルダーを開く

#### アクション
- 「📂 親フォルダーを開く」をクリック

#### 処理フロー
1. 親フォルダーをエクスプローラーで開く
2. メニューを閉じる

### 5.5. リンク先のパスをコピー（ショートカット）

#### アクション
- 「📋 リンク先のパスをコピー」をクリック

#### 処理フロー
1. リンク先パスを取得
2. クリップボードにコピー
3. メニューを閉じる

#### 表示条件
- アイテムがショートカット（.lnk）であること
- `onCopyShortcutPath`が指定されていること

### 5.6. リンク先の親フォルダーのパスをコピー（ショートカット）

#### アクション
- 「📋 リンク先の親フォルダーのパスをコピー」をクリック

#### 処理フロー
1. リンク先の親フォルダーのパスを取得
2. クリップボードにコピー
3. メニューを閉じる

### 5.7. リンク先の親フォルダーを開く（ショートカット）

#### アクション
- 「📂 リンク先の親フォルダーを開く」をクリック

#### 処理フロー
1. リンク先の親フォルダーをエクスプローラーで開く
2. メニューを閉じる

## 6. 位置調整

メニューは画面からはみ出さないよう自動調整されます。

- 右端からはみ出す場合、左に移動
- 下端からはみ出す場合、上に移動

### メニューの高さ計算

| アイテムタイプ | 高さ（概算） |
|---------------|-------------|
| グループアイテム | 60px |
| 通常アイテム | 200px |
| ショートカットアイテム | 340px |

## 7. キーボード操作

| キー | 動作 |
|------|------|
| Escape | メニューを閉じる |

## 8. クリック操作

| 操作 | 動作 |
|------|------|
| メニュー項目クリック | アクションを実行してメニューを閉じる |
| メニュー外クリック | メニューを閉じる |

## 9. スタイル

### 主要なCSSクラス

| クラス名 | 説明 |
|---------|------|
| `.context-menu` | メニューコンテナ |
| `.context-menu-item` | メニュー項目 |
| `.context-menu-icon` | アイコン表示エリア |
| `.context-menu-divider` | 区切り線 |

### スタイル仕様

- 固定配置（`position: fixed`）
- z-index: 1000
- 背景: 白系（変数定義）
- 影: ドロップシャドウ

## 10. アイテムタイプ判定

### ショートカット判定

- アイテムの`path`（ファイルのパス）が`.lnk`拡張子で終わる場合、ショートカットと判定される
- 判定には`PathUtils.isShortcutFile(item.path)`を使用

### 親フォルダー有無判定

- 以下のタイプには親フォルダー関連の項目は表示されない:
  - URLアイテム
  - カスタムURIアイテム
  - グループアイテム

## 11. 区切り線の表示ルール

- 編集項目を表示し、かつパス関連項目も表示される場合：編集項目と基本操作項目の間に区切り線を表示
- ショートカット関連項目を表示する場合：ショートカット関連項目の前に区切り線を表示
- グループアイテムの場合：編集項目のみ表示されるため、区切り線は表示されない
