# 右クリックメニュー仕様書

## 関連ドキュメント

- [画面一覧](./README.md) - 全画面構成の概要
- [メインウィンドウ](./main-window.md) - メイン画面の詳細仕様
- [キーボードショートカット](../features/keyboard-shortcuts.md) - ショートカット一覧

## 1. 概要

右クリックメニュー（ContextMenu）は、メインウィンドウのアイテムリストで右クリックしたときに表示される**ネイティブElectronメニュー**です。アイテムのパス操作や編集機能を提供します。

**実装方式**: v0.5.20以降、ReactコンポーネントからElectronのネイティブメニュー（`Menu.buildFromTemplate`）に変更されました。これにより、ウィンドウ境界での切れ問題が解消され、OS標準のメニュー動作を実現しています。

**キーボードショートカット**: Escapeキーでメニューを閉じることができます。

### 主要機能
- **パスのコピー**: アイテムのパス、親フォルダーのパスをクリップボードにコピー
- **フォルダーを開く**: 親フォルダーをエクスプローラーで開く
- **ショートカット対応**: .lnkファイルの場合、リンク先のパス操作も提供
- **アイテム編集**: RegisterModalでアイテムを編集

## 2. 基本情報

| 項目 | 内容 |
|------|------|
| **実装ファイル** | `src/main/ipc/contextMenuHandlers.ts` |
| **ハンドラー名** | `setupLauncherContextMenuHandler` |
| **表示条件** | メインウィンドウでアイテムを右クリック |
| **メニュータイプ** | ネイティブElectronメニュー（`Menu.buildFromTemplate`） |
| **親画面** | メインウィンドウ |
| **IPCチャンネル** | `SHOW_LAUNCHER_CONTEXT_MENU` |

## 3. 呼び出しパラメータ

ネイティブメニューは、IPCハンドラーで以下のパラメータを受け取って動的に構築されます：

| パラメータ | 型 | 必須 | 説明 |
|-----------|------|:----:|------|
| `item` | `AppItem` | ○ | 対象アイテム（名前、パス、タイプ等） |

**メニュー構築ロジック**:
- アイテムのタイプ（`url`, `customUri`, `group`, `file`, `folder`, `app`）に応じて表示項目を動的に変更
- `.lnk`ファイルの場合、ショートカット関連の操作を追加表示
- メニュー項目クリック時は、レンダラープロセスへイベント送信（`EVENT_LAUNCHER_MENU_*`）

## 4. メニュー項目一覧

### 通常アイテム（ファイル、フォルダ、EXE）

| 項目名 | アイコン | 説明 | 表示条件 |
|--------|---------|------|----------|
| 編集 | ✏️ | RegisterModalでアイテムを編集 | 常時表示 |
| ワークスペースに追加 | ⭐ | アイテムをワークスペースに追加 | 常時表示 |
| パスをコピー | 📋 | アイテムのフルパスをコピー | 常時表示 |
| 親フォルダーのパスをコピー | 📋 | 親フォルダーのパスをコピー | 親フォルダーがある場合 |
| 親フォルダーを開く | 📂 | 親フォルダーをエクスプローラーで開く | 親フォルダーがある場合 |

### ショートカットアイテム（.lnk）

上記に加えて以下の項目が表示されます:

| 項目名 | アイコン | 説明 |
|--------|---------|------|
| リンク先のパスをコピー | 📋 | ショートカットが指すファイルのパスをコピー |
| リンク先の親フォルダーのパスをコピー | 📋 | リンク先ファイルの親フォルダーのパスをコピー |
| リンク先の親フォルダーを開く | 📂 | リンク先の親フォルダーをエクスプローラーで開く |

### URLアイテム

| 項目名 | アイコン | 説明 |
|--------|---------|------|
| 編集 | ✏️ | アイテムを編集 |
| ワークスペースに追加 | ⭐ | アイテムをワークスペースに追加 |
| パスをコピー | 📋 | URLをコピー |

※URLアイテムには親フォルダー関連の項目は表示されません。

### カスタムURIアイテム

| 項目名 | アイコン | 説明 |
|--------|---------|------|
| 編集 | ✏️ | アイテムを編集 |
| ワークスペースに追加 | ⭐ | アイテムをワークスペースに追加 |
| パスをコピー | 📋 | カスタムURIをコピー |

※カスタムURIアイテムには親フォルダー関連の項目は表示されません。

### グループアイテム

| 項目名 | アイコン | 説明 |
|--------|---------|------|
| 編集 | ✏️ | グループを編集 |
| ワークスペースに追加 | ⭐ | グループをワークスペースに追加 |

※グループアイテムにはパス関連の項目は表示されません。

## 5. 機能詳細

### 5.1. 編集

#### アクション
- 「✏️ 編集」をクリック

#### 処理フロー
1. メニューを閉じる
2. 登録・編集モーダルが開かれる

### 5.2. パスをコピー

#### アクション
- 「📋 パスをコピー」をクリック

#### 処理フロー
1. アイテムのフルパスを取得
2. クリップボードにコピー
3. メニューを閉じる

#### ツールチップ
- メニュー項目のtitle属性にフルパスを表示

### 5.3. 親フォルダーのパスをコピー

#### アクション
- 「📋 親フォルダーのパスをコピー」をクリック

#### 処理フロー
1. 親フォルダーのパスを取得
2. クリップボードにコピー
3. メニューを閉じる

#### 表示条件
- アイテムタイプが`url`、`customUri`、`group`でないこと

### 5.4. 親フォルダーを開く

#### アクション
- 「📂 親フォルダーを開く」をクリック

#### 処理フロー
1. 親フォルダーをエクスプローラーで開く
2. メニューを閉じる

### 5.5. リンク先のパスをコピー（ショートカット）

#### アクション
- 「📋 リンク先のパスをコピー」をクリック

#### 処理フロー
1. リンク先パスを取得
2. クリップボードにコピー
3. メニューを閉じる

#### 表示条件
- アイテムがショートカット（.lnk）であること
- `onCopyShortcutPath`が指定されていること

### 5.6. リンク先の親フォルダーのパスをコピー（ショートカット）

#### アクション
- 「📋 リンク先の親フォルダーのパスをコピー」をクリック

#### 処理フロー
1. リンク先の親フォルダーのパスを取得
2. クリップボードにコピー
3. メニューを閉じる

### 5.7. リンク先の親フォルダーを開く（ショートカット）

#### アクション
- 「📂 リンク先の親フォルダーを開く」をクリック

#### 処理フロー
1. リンク先の親フォルダーをエクスプローラーで開く
2. メニューを閉じる

## 6. 位置調整

ネイティブメニューは、OSが自動的にカーソル位置に表示します。

- 画面境界での切れ問題なし（OS標準動作）
- ウィンドウ外への表示も正しく処理される
- 位置調整ロジックは不要（Electronが自動処理）

## 7. キーボード操作

| キー | 動作 |
|------|------|
| Escape | メニューを閉じる |

## 8. クリック操作

| 操作 | 動作 |
|------|------|
| メニュー項目クリック | アクションを実行してメニューを閉じる |
| メニュー外クリック | メニューを閉じる |

## 9. スタイル

ネイティブメニューはOSの標準スタイルを使用します。

- **外観**: Windows標準のコンテキストメニュー
- **カスタマイズ**: OSテーマに従う（ライトモード/ダークモード対応）
- **CSS不要**: Electronが自動的にスタイル適用
- **一貫性**: 他のWindowsアプリケーションと同じ見た目

## 10. アイテムタイプ判定

### ショートカット判定

- アイテムの`path`（ファイルのパス）が`.lnk`拡張子で終わる場合、ショートカットと判定される
- 判定には`PathUtils.isShortcutFile(item.path)`を使用

### 親フォルダー有無判定

- 以下のタイプには親フォルダー関連の項目は表示されない:
  - URLアイテム
  - カスタムURIアイテム
  - グループアイテム

## 11. 区切り線の表示ルール

- 編集項目を表示し、かつパス関連項目も表示される場合：編集項目と基本操作項目の間に区切り線を表示
- ショートカット関連項目を表示する場合：ショートカット関連項目の前に区切り線を表示
- グループアイテムの場合：編集項目のみ表示されるため、区切り線は表示されない
