# 管理ウィンドウ仕様書

## 関連ドキュメント

- [画面一覧](./README.md) - 全画面構成の概要
- [メインウィンドウ仕様書](./main-window.md) - メイン画面の詳細な仕様

## 1. 概要

管理ウィンドウは、QuickDashLauncherの設定変更とデータ編集を行う管理画面です。「基本設定」「アイテム管理」「アーカイブ」「その他」の4つのタブで構成され、アプリケーションの動作をカスタマイズできます。

**キーボードショートカット**:
- Ctrl+E: メインウィンドウから管理ウィンドウを開く/閉じる（トグル）
- Ctrl+S: 変更を保存（アイテム管理タブ）
- Delete: 選択行を削除（アイテム管理タブ）

### 主要機能
- **基本設定タブ**: ホットキー、ウィンドウサイズ、ウィンドウ表示位置、自動起動、バックアップ設定、ワークスペースウィンドウ設定、タブ表示設定
- **アイテム管理タブ**: data.jsonの直接編集、アイテムの追加・削除・整列、ブックマークインポート
- **アーカイブタブ**: アーカイブされたワークスペースグループの一覧表示、復元、削除
- **その他タブ**: ファイル管理、システム情報表示、ショートカット一覧
- **設定の即座反映**: すべての設定変更が自動保存され、メインウィンドウに即座に反映される
- **リアルタイムバリデーション**: ホットキーの有効性をリアルタイムチェック

## 2. 基本情報

| 項目 | 内容 |
|------|------|
| **ファイル名** | `src/renderer/AdminApp.tsx` |
| **コンポーネント名** | `AdminApp` |
| **表示条件** | Ctrl+E、設定メニューから「⚙️ 基本設定」または「✏️ アイテム管理」を選択 |
| **画面タイプ** | ウィンドウ |
| **親画面** | メインウィンドウ |

## 3. 画面項目一覧

| エリア | 項目名 | 内容・説明 | 表示条件 | 機能詳細 |
|--------|--------|------------|----------|----------|
| **ヘッダー** | タブボタン（⚙️ 基本設定） | 基本設定タブへの切り替え | 常時表示 | [4.1](#41-タブボタンをクリック) |
| **ヘッダー** | タブボタン（✏️ アイテム管理） | アイテム管理タブへの切り替え | 常時表示 | [4.1](#41-タブボタンをクリック) |
| **ヘッダー** | タブボタン（📦 アーカイブ） | アーカイブタブへの切り替え | 常時表示 | [4.1](#41-タブボタンをクリック) |
| **ヘッダー** | タブボタン（📊 その他） | その他タブへの切り替え | 常時表示 | [4.1](#41-タブボタンをクリック) |
| **基本設定** | ホットキー入力欄 | グローバルホットキーの設定 | 基本設定タブ | [4.2](#42-ホットキー入力欄でキー押下) |
| **基本設定** | ウィンドウサイズ設定 | メイン画面と管理画面のサイズ設定 | 基本設定タブ | [4.3](#43-ウィンドウサイズを変更) |
| **基本設定** | 自動起動チェックボックス | 起動時に自動実行の設定 | 基本設定タブ | [4.4](#44-自動起動チェックボックスを変更) |
| **基本設定** | バックアップ設定 | バックアップ機能の詳細設定 | 基本設定タブ | [4.5](#45-バックアップ設定を変更) |
| **基本設定** | ウィンドウ表示位置設定 | ウィンドウ表示位置の選択（中央/カーソル位置/固定） | 基本設定タブ | [4.7](#47-ウィンドウ表示位置を変更) |
| **基本設定** | ワークスペース自動表示チェックボックス | メイン画面表示時にワークスペースを自動表示 | 基本設定タブ | [4.30](#430-ワークスペースウィンドウ設定を変更) |
| **基本設定** | ワークスペース表示位置設定 | ワークスペースの表示位置を選択（プライマリの左/右/固定） | 基本設定タブ | [4.30](#430-ワークスペースウィンドウ設定を変更) |
| **基本設定** | ワークスペースウィンドウ透過度 | ワークスペースウィンドウの透過度を設定（0-100%） | 基本設定タブ | [4.30](#430-ワークスペースウィンドウ設定を変更) |
| **基本設定** | ワークスペースウィンドウ背景透過 | 背景のみを透過するか設定 | 基本設定タブ | [4.30](#430-ワークスペースウィンドウ設定を変更) |
| **基本設定** | タブ表示設定 | 複数タブの表示設定 | 基本設定タブ | [4.23](#423-タブ表示設定を変更) |
| **基本設定** | タブ管理アコーディオン | タブの追加・削除・タブ名設定・順序変更・保存/キャンセル | 基本設定タブ、タブ表示ON時 | [4.24](#424-タブ管理操作) |
| **基本設定** | リセットボタン | 設定をデフォルト値にリセット | 基本設定タブ | [4.6](#46-リセットボタンをクリック) |
| **アイテム管理** | タブ選択ドロップダウン | 編集対象のタブを選択 | アイテム管理タブ | [4.25](#425-タブ選択ドロップダウンを変更) |
| **アイテム管理** | ファイル選択ドロップダウン | 編集対象のファイルを選択（複数ファイルタブの場合のみ表示） | アイテム管理タブ、複数ファイルタブ選択時 | [4.26](#426-ファイル選択ドロップダウンを変更) |
| **アイテム管理** | 検索入力欄 | 行の内容を検索してフィルタリング | アイテム管理タブ | [4.9](#49-検索入力欄に文字入力アイテム管理) |
| **アイテム管理** | 検索クリアボタン（×） | 検索クエリをクリア | アイテム管理タブ、検索文字入力時 | [4.10](#410-検索クリアボタンをクリック) |
| **アイテム管理** | ブックマークインポートボタン | ブラウザのブックマークをインポート | アイテム管理タブ | [4.11](#411-ブックマークインポートボタンをクリック) |
| **アイテム管理** | 変更を保存ボタン | データファイルへの書き込み | アイテム管理タブ、変更あり時 | [4.12](#412-変更を保存ボタンをクリック) |
| **アイテム管理** | ➕ 行を追加ボタン | 新規行を先頭に追加 | アイテム管理タブ | [4.13](#413-行を追加ボタンをクリック) |
| **アイテム管理** | 🗑️ 選択行を削除ボタン | 選択中の行を削除 | アイテム管理タブ、行選択時 | [4.14](#414-選択行を削除ボタンをクリック) |
| **アイテム管理** | 🔤 整列・重複削除ボタン | 現在のデータファイル内で行を整列して重複を削除 | アイテム管理タブ | [4.15](#415-整列重複削除ボタンをクリック) |
| **アイテム管理** | 行一覧テーブル | データファイルの全行を表示・編集（アイコン表示を含む） | アイテム管理タブ | [4.16](#416-行の内容を直接編集) |
| **アイテム管理** | 行選択チェックボックス | 各行の選択状態を管理 | アイテム管理タブ | [4.17](#417-行選択チェックボックスをクリック) |
| **アイテム管理** | 右クリックメニュー | 行を右クリックで表示（複製・詳細編集・削除） | アイテム管理タブ、行選択時 | [4.31](#431-右クリックメニューを表示) |
| **アイテム管理** | ✏️ 編集ボタン | RegisterModalで詳細編集 | アイテム管理タブ | [4.18](#418-編集ボタンをクリック) |
| **アイテム管理** | ステータスバー | 選択行数、合計行数、未保存状態の表示 | アイテム管理タブ | - |
| **アーカイブ** | アーカイブグループカード | アーカイブされたグループの情報を表示 | アーカイブタブ | - |
| **アーカイブ** | 復元ボタン | グループをワークスペースに復元 | アーカイブタブ | [4.28](#428-復元ボタンをクリック) |
| **アーカイブ** | 削除ボタン | グループをアーカイブから完全削除 | アーカイブタブ | [4.29](#429-削除ボタンをクリック) |
| **その他** | 📁 設定フォルダを開くボタン | 設定フォルダをエクスプローラーで開く | その他タブ | [4.19](#419-設定フォルダを開くボタンをクリック) |
| **その他** | アプリケーション情報 | バージョン、ライセンス情報を表示 | その他タブ | - |
| **その他** | 🔗 GitHubリポジトリボタン | GitHubリポジトリを開く | その他タブ | [4.23](#423-githubリポジトリボタンをクリック) |
| **その他** | ショートカット一覧 | 利用可能なキーボードショートカット | その他タブ | - |
| **その他** | 🚪 アプリケーションを終了ボタン | アプリケーションを終了 | その他タブ | [4.21](#421-アプリケーションを終了ボタンをクリック) |

## 4. アクション一覧

| No | アクション名 | トリガー | 主な処理内容 | 詳細 |
|----|------------|---------|------------|------|
| 4.1 | タブボタンをクリック | タブボタンクリック | タブ切り替え、未保存変更の確認 | [詳細](#41-タブボタンをクリック) |
| 4.2 | ホットキー入力欄でキー押下 | ホットキー入力欄でキー押下 | ホットキーの設定とバリデーション | [詳細](#42-ホットキー入力欄でキー押下) |
| 4.3 | ウィンドウサイズを変更 | 数値入力欄に入力 | ウィンドウサイズの変更 | [詳細](#43-ウィンドウサイズを変更) |
| 4.4 | 自動起動チェックボックスを変更 | チェックボックスクリック | 自動起動設定の変更（即座反映） | [詳細](#44-自動起動チェックボックスを変更) |
| 4.5 | バックアップ設定を変更 | チェックボックス・数値入力 | バックアップ設定の変更（即座反映） | [詳細](#45-バックアップ設定を変更) |
| 4.6 | リセットボタンをクリック | リセットボタンクリック | 設定をデフォルト値にリセット（即座反映） | [詳細](#46-リセットボタンをクリック) |
| 4.7 | ウィンドウ表示位置を変更 | ラジオボタン選択 | ウィンドウ表示位置の変更（即座反映） | [詳細](#47-ウィンドウ表示位置を変更) |
| 4.9 | 検索入力欄に文字入力（アイテム管理） | テキスト入力 | 行のフィルタリング | [詳細](#49-検索入力欄に文字入力アイテム管理) |
| 4.10 | 検索クリアボタンをクリック | クリアボタン（×）クリック | 検索クエリをクリア | [詳細](#410-検索クリアボタンをクリック) |
| 4.11 | ブックマークインポートボタンをクリック | ボタンクリック | ブックマークインポートモーダルを開く | [詳細](#411-ブックマークインポートボタンをクリック) |
| 4.12 | 変更を保存ボタンをクリック | 保存ボタンクリック / Ctrl+S | データファイルに書き込み | [詳細](#412-変更を保存ボタンをクリック) |
| 4.13 | 行を追加ボタンをクリック | ボタンクリック | 新規空行を先頭に追加 | [詳細](#413-行を追加ボタンをクリック) |
| 4.14 | 選択行を削除ボタンをクリック | ボタンクリック / Deleteキー | 選択中の行を削除 | [詳細](#414-選択行を削除ボタンをクリック) |
| 4.15 | 整列・重複削除ボタンをクリック | ボタンクリック | 行を整列して重複を削除 | [詳細](#415-整列重複削除ボタンをクリック) |
| 4.16 | 行の内容を直接編集 | テーブルセル編集 | 行の内容を変更 | [詳細](#416-行の内容を直接編集) |
| 4.17 | 行選択チェックボックスをクリック | チェックボックスクリック | 行の選択状態を変更 | [詳細](#417-行選択チェックボックスをクリック) |
| 4.18 | 編集ボタンをクリック | ✏️ボタンクリック | RegisterModalで詳細編集 | [詳細](#418-編集ボタンをクリック) |
| 4.19 | 設定フォルダを開くボタンをクリック | ボタンクリック | エクスプローラーで設定フォルダを開く | [詳細](#419-設定フォルダを開くボタンをクリック) |
| 4.21 | アプリケーションを終了ボタンをクリック | ボタンクリック | アプリケーションを終了 | [詳細](#421-アプリケーションを終了ボタンをクリック) |
| 4.22 | GitHubリポジトリボタンをクリック | ボタンクリック | ブラウザでGitHubリポジトリを開く | [詳細](#422-githubリポジトリボタンをクリック) |
| 4.23 | タブ表示設定を変更 | チェックボックスクリック | タブ表示のON/OFFを切り替え | [詳細](#423-タブ表示設定を変更) |
| 4.24 | タブ管理操作 | ボタンクリック・テキスト入力 | タブの追加・削除・タブ名設定・順序変更 | [詳細](#424-タブ管理操作) |
| 4.25 | タブ選択ドロップダウンを変更 | ドロップダウン選択 | 編集対象のタブを切り替え | [詳細](#425-タブ選択ドロップダウンを変更) |
| 4.26 | ファイル選択ドロップダウンを変更 | ドロップダウン選択 | 編集対象のファイルを切り替え（複数ファイルタブの場合のみ） | [詳細](#426-ファイル選択ドロップダウンを変更) |
| 4.27 | ウィンドウを閉じる操作 | ウィンドウ閉じるボタン / Ctrl+E | 未保存変更の確認後、ウィンドウを閉じる | [詳細](#427-ウィンドウを閉じる操作) |
| 4.28 | 復元ボタンをクリック | ボタンクリック | アーカイブされたグループを復元 | [詳細](#428-復元ボタンをクリック) |
| 4.29 | 削除ボタンをクリック | ボタンクリック | アーカイブされたグループを完全削除 | [詳細](#429-削除ボタンをクリック) |
| 4.30 | ワークスペースウィンドウ設定を変更 | スライダー・チェックボックス | ワークスペースウィンドウの透過度と背景透過設定の変更（即座反映） | [詳細](#430-ワークスペースウィンドウ設定を変更) |
| 4.31 | 右クリックメニューを表示 | テーブル行を右クリック | 行の複製・詳細編集・削除のメニューを表示 | [詳細](#431-右クリックメニューを表示) |

## 5. 機能詳細

### 4.1. タブボタンをクリック

#### アクション
- ヘッダーのタブボタン（⚙️ 基本設定、✏️ アイテム管理、📊 その他）をクリック

#### 処理フロー
1. 未保存の変更があるかチェック（アイテム管理タブとタブ管理）
2. 未保存の変更がある場合：
   - **アイテム管理タブ**: 「未保存の変更があります。タブを切り替えますか？」
   - **タブ管理（基本設定タブ内）**: 「未保存の変更があります。カテゴリを切り替えますか？
変更は破棄されます。」
   - OKの場合：未保存変更フラグをクリアしてタブを切り替え
   - キャンセルの場合：タブ切り替えを中止
3. 未保存の変更がない場合：
   - タブを切り替え
4. 選択されたタブのコンテンツを表示

#### タブ内容
- **⚙️ 基本設定**: AdminSettingsTabコンポーネントを表示（即座反映モード）
- **✏️ アイテム管理**: AdminItemManagerViewコンポーネントを表示（保存ボタンあり）
- **📦 アーカイブ**: AdminArchiveTabコンポーネントを表示（アーカイブされたワークスペースグループの管理）
- **📊 その他**: AdminOtherTabコンポーネントを表示

#### 注意
- **v1.0.0以降**: 基本設定タブのほとんどの項目は即座保存されますが、タブ管理セクションのみ保存/キャンセルボタンによる明示的な確定が必要です
- **タブ管理の未保存変更**: タブ管理で変更後に他のカテゴリに移動しようとすると、未保存変更の警告ダイアログが表示されます

### 4.2. ホットキー入力欄でキー押下

#### アクション
- ホットキー入力欄をクリックして、キーを押下

#### 処理フロー
1. ユーザーがキーを押下（例：Ctrl+Alt+Q）
2. HotkeyInputコンポーネントがキー組み合わせを検出
3. リアルタイムでバリデーションを実行：
   - 修飾キー（Ctrl、Alt、Shift）が含まれているか
   - 有効なキーの組み合わせか
4. バリデーション結果を表示：
   - 有効な場合：入力欄に表示
   - 無効な場合：エラーメッセージを表示
5. **即座保存**: バリデーション成功時、設定が自動的に保存され、`settings-changed`イベントが送信される

#### バリデーション条件
- 最低1つの修飾キー（Ctrl、Alt、Shift）が必要
- 単体のキーのみは不可
- Electronがサポートするキー組み合わせであること

#### 表示例
- **有効**: `Ctrl+Alt+Q`、`Ctrl+Shift+L`、`Alt+F1`
- **無効**: `Q`（修飾キーなし）、`Ctrl+Ctrl`（無効な組み合わせ）

### 4.3. ウィンドウサイズを変更

#### アクション
- ウィンドウサイズの数値入力欄に値を入力

#### 処理フロー
1. 入力値を取得
2. 範囲チェック：
   - メイン画面の幅: 400-2000px
   - メイン画面の高さ: 300-1200px
   - 管理画面の幅: 800-2000px
   - 管理画面の高さ: 600-1200px
3. **即座保存**: 設定が自動的に保存され、`settings-changed`イベントが送信される

#### 設定項目
- **windowWidth**: メイン画面の幅
- **windowHeight**: メイン画面の高さ
- **editModeWidth**: 管理画面の幅
- **editModeHeight**: 管理画面の高さ

### 4.4. 自動起動チェックボックスを変更

#### アクション
- 「起動時に自動実行」チェックボックスをクリック

#### 処理フロー
1. チェック状態を反転
2. **即座保存**: 設定が自動的に保存され、メインウィンドウに反映される
3. システム登録処理を実行（Windowsログイン時の自動起動を設定/解除）

#### 動作
- **有効**: Windowsログイン時にアプリケーションが自動起動
  - NSISインストーラー版: `Update.exe`経由で起動
  - ポータブル版: 実行ファイルを直接起動
  - Windowsレジストリに登録される
- **無効**: 手動で起動する必要がある
  - Windowsレジストリから登録解除される

#### システム登録の詳細
- **登録先**: `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run`
- **実装**: Electron標準API `app.setLoginItemSettings()`を使用
- **開発環境**: パッケージ化されていないため、設定は保存されますが実際の登録はスキップされます

#### 確認方法
- Windowsのタスクマネージャー → スタートアップタブで登録状態を確認できます
- 設定が正しく反映されているか確認する際に便利です

### 4.5. バックアップ設定を変更

#### アクション
- バックアップ関連のチェックボックス、または数値入力欄を変更

#### 処理フロー
1. 変更された項目の値を取得
2. **即座保存**: 設定が自動的に保存され、`settings-changed`イベントが送信される

#### 設定項目
- **backupEnabled**: バックアップ機能全体のON/OFF
- **backupOnStart**: アプリ起動時にバックアップを作成
- **backupOnEdit**: データ編集時にバックアップを作成
- **backupInterval**: 最小バックアップ間隔（1-60分）
- **backupRetention**: バックアップ保存件数（1-100件）

#### 表示条件
- `backupEnabled`が無効の場合、他のバックアップ設定は非表示

### 4.6. リセットボタンをクリック

#### アクション
- 「リセット」ボタンをクリック

#### 処理フロー
1. 確認ダイアログを表示：「設定をデフォルト値にリセットしますか？」
2. OKの場合：
   - 設定をデフォルト値にリセット
   - 全ウィンドウに反映
   - 画面表示を更新
3. キャンセルの場合：処理を中止

#### エラーハンドリング
- リセット失敗時：「設定のリセットに失敗しました。」というアラートを表示

#### 注意
**v1.0.0以降**: リセット処理も即座に反映され、「保存」ボタンは不要です。

### 4.7. ウィンドウ表示位置を変更

#### アクション
- ウィンドウ表示位置のラジオボタンを選択

#### 処理フロー
1. 選択した表示位置モードを取得
2. **即座保存**: 設定が自動的に保存され、メインウィンドウに反映される

#### 設定項目
- **windowPositionMode**: ウィンドウ表示位置モード

#### 選択肢
| モード | 説明 |
|--------|------|
| **center** | 画面中央（固定） - 常にプライマリモニターの中央にウィンドウを表示します |
| **cursorMonitorCenter** | 画面中央（自動切替） - マウスカーソルがあるモニターの中央にウィンドウを表示します（マルチモニター推奨） |
| **cursor** | カーソル付近 - マウスカーソルの近くにウィンドウを表示します（検索入力がしやすい位置） |
| **fixed** | 固定位置（手動設定） - ウィンドウを移動した位置を記憶して、次回も同じ位置に表示します |

#### 注意
- デフォルトは「center」（画面中央（固定））
- 「cursorMonitorCenter」モードは、マルチモニター環境で作業中のモニターにウィンドウを表示したい場合に便利です
- 「fixed」モードでは、ウィンドウを手動で移動した後の位置が記憶されます

### 4.9. 検索入力欄に文字入力（アイテム管理）

#### アクション
- アイテム管理タブの検索入力欄に文字を入力

#### 処理フロー
1. 入力値を取得
2. 入力値をスペースで分割してキーワード配列を作成
3. 各行の内容をキーワードでフィルタリング：
   - すべてのキーワードが含まれる行のみ表示
   - 大文字小文字を区別しない
4. フィルタリング結果を表示
5. 非表示になった行の選択状態をクリア

#### 検索例
- 入力: `chrome google` → "chrome" AND "google"を含む行のみ表示
- 入力: `data.json` → "data.json"を含む行のみ表示

### 4.10. 検索クリアボタンをクリック

#### アクション
- 検索入力欄の「×」ボタンをクリック

#### 処理フロー
1. 検索クエリをクリア
2. すべての行を表示

#### 表示条件
- 検索文字が入力されている時のみ「×」ボタンを表示

### 4.11. ブックマークインポートボタンをクリック

#### アクション
- 「ブックマークをインポート」ボタンをクリック

#### 処理フロー
1. BookmarkImportModalを開く
2. ユーザーがブックマークを選択してインポート
3. インポートされたブックマークを新規行として追加：
   - 各ブックマークを `名前,URL` 形式に変換
   - 先頭に追加
4. 行番号を振り直し
5. 未保存変更フラグをセット
6. モーダルを閉じる

#### 関連ドキュメント
- [ブックマークインポートモーダル仕様書](./bookmark-import-modal.md)

### 4.12. 変更を保存ボタンをクリック

#### アクション
- 「変更を保存」ボタンをクリック、またはCtrl+Sキーを押下

#### 処理フロー
1. 保存確認ダイアログを表示：
   - メッセージ: 「データを保存しますか？」
   - 確認ボタン: 「保存」
   - チェックボックス: 「整列・重複削除を実行」（**デフォルトでON**、保存ダイアログを開くたびにリセット）
2. チェックボックスがONの場合：
   - 整列・重複削除を実行してから保存
3. チェックボックスがOFFの場合：
   - そのまま保存
4. 編集内容を反映
5. 行番号を振り直し：
   - ファイル別にグループ化
   - 各ファイル内で1から連番を振り直し
6. データファイルに書き込み
7. 保存成功時：
   - 編集状態をクリア
   - 未保存変更フラグをクリア
8. メインウィンドウにデータ変更を通知
9. データを再読み込み

#### チェックボックスの動作
- 保存ダイアログを開くたびに**デフォルトでON**にリセット
- 前回の保存時にチェックを外していても、次回の保存時には再びONになる
- これにより、データの整合性を保ちやすくする

#### エラーハンドリング
- 保存失敗時：コンソールにエラーを出力

#### 表示条件
- 未保存の変更がある場合のみ有効

### 4.13. 行を追加ボタンをクリック

#### アクション
- 「➕ 行を追加」ボタンをクリック

#### 処理フロー
1. 空行を作成：
   - lineNumber: 1
   - content: ''
   - type: 'empty'
   - sourceFile: 'data.json'
2. 先頭に追加
3. 行番号を振り直し
4. 未保存変更フラグをセット

### 4.14. 選択行を削除ボタンをクリック

#### アクション
- 「🗑️ 選択行を削除」ボタンをクリック、またはDeleteキーを押下

#### 処理フロー
1. 選択中の行を取得
2. 確認ダイアログを表示：「{N}行を削除しますか？」
3. OKの場合：
   - 選択行をworkingLinesから削除
   - 行番号を振り直し
   - 選択状態をクリア
   - 未保存変更フラグをセット
4. キャンセルの場合：処理を中止

#### 表示条件
- 行が選択されている場合のみ有効
- ボタンには選択行数を表示（例：「選択行を削除 (3)」）

### 4.15. 整列・重複削除ボタンをクリック

#### アクション
- 「🔤 整列・重複削除」ボタンをクリック

#### 処理フロー
1. **現在選択中のデータファイルのみ**を対象に行を整列：
   - **第1ソート**: 行タイプ（directive → item → comment → empty）
   - **第2ソート**: パスと引数（アルファベット順）
   - **第3ソート**: 名前（アルファベット順、アイテム行のみ）
2. 重複行を検出（現在のデータファイル内のみ）：
   - 行タイプと内容が完全一致する行を重複と判定
3. 重複がある場合：
   - 確認ダイアログを表示：「整列処理が完了しました。\n\n{N}件の重複行が見つかりました。\n重複行を削除しますか？」
   - OKの場合：重複行を削除した結果を適用
   - キャンセルの場合：重複行を削除せず整列のみ適用
4. 重複がない場合：
   - 整列結果をそのまま適用
5. 未保存変更フラグをセット

#### 注意
- **他のデータファイルには影響しません**。整列・重複削除は現在選択中のデータファイルのみに適用されます。

#### 整列例
```
[変更前]
Google,https://google.com
# コメント
dir,C:\Projects

[変更後]
dir,C:\Projects
Google,https://google.com
# コメント
```

### 4.16. 行の内容を直接編集

#### テーブル構造

アイテム管理タブの行一覧テーブルは、以下のカラム構成で表示されます：

| カラム | 説明 |
|--------|------|
| **選択チェックボックス** | 行の選択状態を管理（ヘッダーで全選択/解除可能） |
| **#（行番号）** | データファイル内の行番号 |
| **種類** | アイテムタイプ（単一アイテム、フォルダ取込、グループ、コメント、空行） |
| **アイコン** | メインウィンドウと同じアイコン表示（単一アイテムのみ） |
| **名前** | アイテム名またはグループ名（クリックして編集可能） |
| **パスと引数** | パスと引数の組み合わせ（パスのみクリックして編集可能、引数編集は✏️から） |
| **操作** | ✏️ 詳細編集ボタン、🗑️ 削除ボタン |

#### アイコン列の表示

**単一アイテムのアイコン表示:**
- メインウィンドウと同じアイコン表示機能を使用
- ファビコン、自動取得アイコン、カスタムアイコンの順で表示
- `loadCachedIcons()` APIでアイコンデータを一括取得
- フォルダアイテムは📁絵文字で表示

**アイコン表示の対象:**
- **単一アイテムのみ**: `type='item'`の行でアイコンを表示
- **その他のタイプ**: フォルダ取込、グループ、コメント、空行はアイコンなし

**アイコンの種類:**
1. **カスタムアイコン**: ユーザーが設定した画像ファイル（最優先）
2. **自動取得アイコン**: アプリケーション実行ファイルから抽出したアイコン
3. **ファビコン**: WebサイトURLの場合、自動取得されたファビコン
4. **フォルダアイコン**: フォルダパスの場合、📁絵文字

#### アクション
- 行一覧テーブルのセルを編集

#### 処理フロー
1. セルの内容を編集
2. 編集内容をeditedLinesに記録
3. 未保存変更フラグをセット

#### 編集可能な項目
- 行の内容（content）
- 行全体を直接テキスト編集

### 4.17. 行選択チェックボックスをクリック

#### アクション
- 各行のチェックボックスをクリック、またはヘッダーの全選択チェックボックスをクリック

#### 処理フロー

**個別行のチェックボックス:**
1. チェック状態を取得
2. 行キー（`{sourceFile}_{lineNumber}`）を作成
3. selectedItemsに追加/削除
4. 選択行数を更新

**ヘッダーの全選択チェックボックス:**
1. チェック状態を取得
2. チェックON時：表示中のすべての行を選択
3. チェックOFF時：すべての選択を解除
4. 選択行数を更新

#### 表示
- ステータスバーに選択行数を表示（例：「3行を選択中」）

### 4.18. 編集ボタンをクリック

#### アクション
- 行の「✏️ 編集」ボタンをクリック

#### 処理フロー
1. 編集対象の行を取得
2. 登録・編集モーダルを開く
3. 設定からタブ情報を読み込み、保存先選択肢を構築
4. 行の内容を編集用フォーマットに変換してモーダルに渡す
5. ユーザーがモーダルで編集（保存先タブの変更も可能）
6. 保存時：
   - 編集内容を行データに変換
   - 編集済み行として記録
   - 未保存変更フラグをセット
7. モーダルを閉じる

#### 保存先タブの変更
管理ウィンドウの編集モーダルでは、保存先タブを変更することはできますが、実際の変更は保存ボタンをクリックするまで確定されません。

**注意**: 管理ウィンドウでは、メインウィンドウと異なり、タブ間のアイテム移動は自動的には行われません。保存先を変更する場合は、以下のいずれかの方法を使用してください：
- メインウィンドウの右クリックメニューから「✏️ 編集」を選択（保存先変更で自動的にタブ間移動）
- 管理ウィンドウで編集後、手動で元のファイルから削除して新しいファイルに追加

#### 編集用フォーマットへの変換
- **アイテム行**: 名前、パス、引数、カスタムアイコンに分割
- **フォルダ取込**: フォルダパスとオプションに分割
- **グループ**: グループ名と含まれるアイテムに分割

### 4.19. 設定フォルダを開くボタンをクリック

#### アクション
- 「📁 設定フォルダを開く」ボタンをクリック

#### 処理フロー
1. エクスプローラーで設定フォルダを開く

#### 対象フォルダ
- `%APPDATA%/quick-dash-launcher/config/`

### 4.21. アプリケーションを終了ボタンをクリック

#### アクション
- 「🚪 アプリケーションを終了」ボタンをクリック

#### 処理フロー
1. 確認ダイアログを表示：「アプリケーションを終了しますか？」
2. OKの場合：アプリケーションを終了
3. キャンセルの場合：処理を中止

### 4.22. GitHubリポジトリボタンをクリック

#### アクション
- 「🔗 GitHubリポジトリ」ボタンをクリック

#### 処理フロー
1. デフォルトブラウザでGitHubリポジトリページを開く

#### 対象URL
- `https://github.com/masaodev/quick-dash-launcher`

#### 表示条件
- アプリケーション情報の読み込みが完了するまでボタンは無効化

### 4.23. タブ表示設定を変更

#### アクション
- 「複数タブを表示」チェックボックスをクリック

#### 処理フロー
1. チェックボックスの状態を切り替え
2. **即座保存**: 設定が自動的に保存され、メインウィンドウに反映される
3. チェックON時：タブ管理テーブルとデフォルトタブの設定項目が表示される
4. チェックOFF時：タブ管理テーブルとデフォルトタブの設定項目が非表示になる

#### 設定の反映
- 設定が即座に保存され、メインウィンドウがある場合は自動的に反映される
- メインウィンドウにタブバーが表示/非表示される

#### UI変更の履歴
- **v1.0.0以降**: チェックボックスのラベルが「複数データファイルをタブで表示」から「複数タブを表示」に変更されました
- **v1.0.0以降**: セクション名が「データファイル管理」から「タブ管理」に変更されました
- **v1.0.0以降**: チェックボックスに説明文「有効にすると、メイン画面でタブを切り替えて異なるデータファイルを表示できます。」が追加されました
- **v1.0.0以降**: タブ管理UIがテーブル形式からアコーディオン形式に刷新され、保存/キャンセルボタンが追加されました

### 4.24. タブ管理操作

#### アクション
タブ管理アコーディオンでの各種操作（v1.0.0以降、セクション名が「データファイル管理」から「タブ管理」に変更、UI形式がテーブルからアコーディオンに刷新）

#### UI概要（アコーディオン形式）
- **折りたたみ表示**: デフォルトでタブは折りたたまれており、タブ名とファイル数（📄1）のみが表示される
- **展開ボタン**: ▶マークをクリックするとタブが展開され、▼マークで折りたたむことができる
- **タブ名表示**: 折りたたみ時は「タブ名:」ラベル付きでタブ名が表示され、クリックでも展開可能
- **展開時**: タブ名入力欄、データファイル一覧（各ファイルのラベルと物理名）、ファイル追加機能が表示される
- **保存/キャンセル**: 変更は保存ボタンをクリックするまで確定されず、未保存の変更がある場合はインジケーター（⚠️ 未保存の変更があります）が表示される
- **カテゴリ切り替え警告**: 未保存の変更がある状態で他のカテゴリに移動しようとすると確認ダイアログが表示される

#### 操作種別

##### ➕ 新規タブを追加ボタンをクリック
1. 次のファイル番号を自動決定（例: data2.json, data3.json...）
2. 新規データファイルを作成
3. ファイル作成成功時：
   - 物理ファイル（data2.json等）が作成される
   - 設定のタブ情報に新しいエントリが自動的に追加される
   - テーブルに新しい行が追加表示される
4. ファイル作成失敗時：
   - エラーメッセージをアラート表示

##### タブ名を入力・変更
1. タブを展開してタブ名入力欄にテキストを入力
2. 入力内容は即座に状態に反映される
3. 未保存の変更として記録される

**注意**: アコーディオン形式では、タブ名の変更も保存ボタンをクリックするまで確定されません。

##### デフォルトタブ名
タブ名が未設定の場合、わかりやすいデフォルト名が表示されます：
- `data.json` → 「メイン」
- `data2.json` → 「サブ1」
- `data3.json` → 「サブ2」
- `data4.txt` → 「サブ3」（以降同様）

**v1.0.0以降**: アイテム管理画面の「タブ名:」ドロップダウンでも、これらのデフォルトタブ名が表示されます（ファイル名は省略）

##### 🗑️削除ボタンをクリック
1. data.jsonを含むタブの場合：アラート表示「data.jsonを含むタブは削除できません。」
2. その他のタブの場合：
   - 確認ダイアログ表示：「タブ「{tabName}」を削除しますか？\nこのタブに含まれる全てのファイルも削除されます。」
   - OKの場合：
     - タブに含まれる全ファイルを削除
     - 設定からタブ情報を削除
     - 更新された設定を保存
   - 削除成功時：テーブルが更新される
   - 削除失敗時：エラーメッセージをアラート表示

##### タブ展開時のデータファイル管理
タブを展開すると、タブ内のデータファイル一覧が表示されます。

**データファイル一覧の表示:**
- **📄アイコン**: 各ファイルに📄アイコンが表示される
- **「データファイル:」ラベル**: 各ファイルのラベル入力欄に表示される
- **ファイルラベル入力欄**: データファイルに任意の名前（ラベル）を設定可能
  - プレースホルダー: 「{タブ名}用データファイル」形式のデフォルトラベル
  - 入力変更は即座に状態に反映される（保存ボタンで確定）
  - ラベルはグローバルで、全てのタブで共通
- **物理ファイル名**: ファイル名の下に物理ファイル名が表示される（例: data.json）
- **削除ボタン**: 各ファイルに削除ボタンあり（data.jsonは「既定」バッジで削除不可、最低1ファイル必要）

**データファイル追加:**
- **既存ファイル追加**: ドロップダウンから他のタブに含まれていないファイルを選択して追加
- **新規ファイル作成**: ボタンをクリックして新しいデータファイルを作成してタブに追加
- 追加されたファイルには自動的にデフォルトラベルが設定される

##### データファイル削除
1. **data.jsonの場合**:
   - 他のタブにもdata.jsonが存在する場合: 削除ボタンが表示され、タブから削除可能
   - 他のタブにdata.jsonが存在しない場合: AlertDialog表示「data.jsonは最低1つのタブに含まれている必要があります」（削除不可）
2. **最後の1ファイルの場合**: 削除ボタンは無効化され、「タブには最低1つのデータファイルが必要です」とツールチップ表示
3. **その他のファイルの場合**:
   - **他のタブでも使用されている場合**:
     - ConfirmDialog表示:
       - タイトル: 「タブから削除」
       - メッセージ: 「{fileName} をこのタブから削除しますか？\n\n他のタブでも使用されているため、ファイル自体は削除されません。」
     - OKの場合: タブからファイルを削除（物理ファイルは残る）
   - **他のタブで使用されていない場合**:
     - ConfirmDialog表示:
       - タイトル: 「データファイル削除の確認」（danger=true）
       - メッセージ: 「{fileName} を削除しますか？\n\n⚠️ 保存ボタンを押すと、データファイルはディスクから完全に削除されます。」
     - OKの場合: タブからファイルを削除し、保存ボタン押下時に物理ファイルも削除
   - いずれの場合も削除予定のファイルが未保存変更として記録される

##### 保存/キャンセルボタン
**保存ボタン:**
1. 未保存の変更がある場合のみ有効化
2. クリックすると以下の処理を順次実行：
   - 削除予定のファイルを物理削除
   - 作成予定のファイルを物理作成
   - 設定ファイル（dataFileTabs, dataFileLabels）を保存
3. 保存成功時: 成功メッセージを表示し、未保存インジケーターをクリア
4. 保存失敗時: エラーメッセージを表示

**キャンセルボタン:**
1. 未保存の変更がある場合のみ有効化
2. クリックすると確認ダイアログ表示：「未保存の変更を破棄しますか？」
3. OKの場合：
   - 保存済み状態に戻す
   - 保留中のファイル操作をクリア
   - 「変更を破棄しました。」メッセージを表示

#### アコーディオン構成
**タブヘッダー（折りたたみ時）:**
- **展開ボタン（▶/▼）**: タブの展開/折りたたみをトグル
- **「タブ名:」ラベル**: 常に表示
- **タブ名**: クリック可能で、クリックで展開（折りたたみ時）/入力欄（展開時）
- **ファイル数アイコン**: 📄{N} 形式で表示（折りたたみ時のみ）
- **▲▼ボタン**: タブの順序変更（最上位/最下位では無効化）
- **🗑️削除ボタン**: タブの削除（data.jsonを含むタブでは非表示）

**タブコンテンツ（展開時）:**
- **タブ名入力欄**: プレースホルダーは「メイン」「サブ1」等のデフォルトタブ名
- **データファイル一覧**: 上記「タブ展開時のデータファイル管理」参照
- **データファイル追加セクション**: ドロップダウン（既存ファイル）とボタン（新規作成）

#### 表示条件
- タブ表示がONの場合のみ表示される
- タブ表示がOFFの場合は非表示

#### 重要な仕様変更

**v1.0.0以降**: タブ表示は設定ファイルベースで動作します：

- **変更前**: 物理ファイル（data.json, data2.json等）の存在をベースにタブ表示
- **変更後**: 設定ファイル（settings.json）のタブ情報をベースにタブ表示
- **自動作成**: タブ情報に登録されているが物理ファイルが存在しない場合は、自動的にファイルを作成
- **削除時の挙動**: ファイル削除時は、物理ファイルとタブ情報の両方から削除
- **順序管理**: タブ情報の順序がそのままタブ表示順序

### 4.25. タブ選択ドロップダウンを変更

#### アクション
- アイテム管理タブのヘッダーにある「タブ:」ドロップダウンを変更

#### 処理フロー
1. ドロップダウンから編集したいタブを選択
2. 未保存の変更がある場合：
   - 確認ダイアログ表示：「未保存の変更があります。タブを切り替えると変更が失われます。続行しますか？」
   - OKの場合：処理を継続
   - キャンセルの場合：処理を中止、元のタブのまま
3. 選択したタブの最初のファイル（files[0]）が自動的に選択される
4. 選択したファイルの内容をテーブルに表示

#### 利用可能なタブ
- 設定に登録されているタブのみが選択肢に表示されます

#### 初期選択
- アイテム管理タブを開いた際は、最初のタブが初期選択される

#### ドロップダウン表示
- **ラベル**: 「タブ:」
- **表示形式**: タブ名を表示
  - **カスタムタブ名が設定されている場合**: タブ名のみ表示（例: `仕事用`、`プライベート`）
  - **カスタムタブ名がない場合**: デフォルトタブ名を表示（例: `メイン`、`サブ1`、`サブ2`）
- **表示例**:
  - data.json（タブ名「仕事用」設定時） → `仕事用`
  - data2.json（タブ名「プライベート」設定時） → `プライベート`
  - data3.json（タブ名未設定時） → `サブ2`（デフォルトタブ名）

#### UI構成
- **単一ファイルタブの場合**: タブ選択ドロップダウンのみ表示
- **複数ファイルタブの場合**: タブ選択 + ファイル選択の2段階ドロップダウンを表示

### 4.26. ファイル選択ドロップダウンを変更

#### アクション
- アイテム管理タブのヘッダーにある「データファイル:」ドロップダウンを変更（複数ファイルタブの場合のみ表示）

#### 処理フロー
1. ドロップダウンから編集したいファイルを選択
2. 未保存の変更がある場合：
   - 確認ダイアログ表示：「未保存の変更があります。ファイルを切り替えると変更が失われます。続行しますか？」
   - OKの場合：処理を継続
   - キャンセルの場合：処理を中止、元のファイルのまま
3. 選択したファイルの内容をテーブルに表示

#### 表示条件
- 現在選択されているタブが複数のファイルを持つ場合のみ表示されます
- 単一ファイルのタブの場合は、このドロップダウンは表示されません

#### ドロップダウン表示
- **ラベル**: 「データファイル:」
- **選択肢**: 現在のタブに属する全てのファイル
  - **データファイル名が設定されている場合**: データファイル名を表示（例: 「開発用」）
  - **データファイル名が未設定の場合**: 物理ファイル名を表示（例: 「data2.json」）
  - ツールチップには物理ファイル名が表示される

#### 自動選択
- タブ変更時に、そのタブの最初のファイル（files[0]）が自動的に選択されます

### 4.27. ウィンドウを閉じる操作

#### アクション
- ウィンドウの閉じるボタン（×）をクリック、またはCtrl+Eキーを押下

#### 処理フロー
1. 未保存の変更があるかチェック（アイテム管理タブのみ）
2. 未保存の変更がある場合：
   - 確認ダイアログを表示：「未保存の変更があります。アイテム管理を終了しますか？」
   - OKの場合：ウィンドウを閉じる
   - キャンセルの場合：処理を中止
3. 未保存の変更がない場合：ウィンドウを閉じる

#### 管理ウィンドウを閉じる方法

**ウィンドウ右上の閉じるボタン（×）:**
- すべてのタブで使用可能
- 未保存変更がある場合は確認ダイアログが表示される

**Ctrl+Eキー:**
- メインウィンドウから管理ウィンドウを開く/閉じるトグル操作
- 未保存変更がある場合は確認ダイアログが表示される

**設定メニューから「閉じる」:**
- 設定メニュー（⚙）から管理ウィンドウを閉じることも可能
- 未保存変更がある場合は確認ダイアログが表示される

#### Escapeキーについて

**重要**: 管理ウィンドウでは、Escapeキーでウィンドウを閉じる機能は**無効化されています**。

**理由:**
- アイテム管理中の誤操作防止
- 編集作業中に誤ってEscapeキーを押してウィンドウが閉じるのを防ぐ
- テキスト編集中のキャンセル操作との混同を防ぐ

**代替方法:**
- 上記の3つの方法（閉じるボタン、Ctrl+E、設定メニュー）のいずれかを使用してください

#### 未保存変更の扱い

**確認ダイアログの条件:**
- アイテム管理タブで編集内容が保存されていない場合のみ表示される
- 基本設定タブとその他タブでは、すべての変更が自動保存されるため確認ダイアログは表示されない

**確認ダイアログの動作:**
- OKを選択：未保存の変更を破棄してウィンドウを閉じる
- キャンセルを選択：ウィンドウを閉じずに編集を継続する

### 4.28. 復元ボタンをクリック

#### アクション
- アーカイブタブでアーカイブされたグループの「復元」ボタンをクリック

#### 処理フロー
1. グループIDを取得
2. IPCチャンネル `workspace:restore-group` でグループ復元を実行
3. 復元成功時：
   - アーカイブリストから該当グループを削除
   - グループとアイテムがワークスペースに復元される
   - 同名のグループが既に存在する場合、グループ名に「(復元)」サフィックスが自動付加される
4. 復元失敗時：エラーメッセージを表示

#### 復元処理の詳細
- **グループ**: アーカイブされたグループがワークスペースに再追加される
- **アイテム**: グループに属していたすべてのアイテムが復元される
- **重複名対策**: 同名グループが存在する場合、「(復元)」サフィックスが自動的に付加される
- **並び順**: 復元されたグループは既存グループの末尾に追加される

### 4.29. 削除ボタンをクリック

#### アクション
- アーカイブタブでアーカイブされたグループの「削除」ボタンをクリック

#### 処理フロー
1. 確認ダイアログを表示：「「{groupName}」をアーカイブから完全に削除しますか？\n\nこの操作は取り消せません。」
2. OKの場合：
   - IPCチャンネル `workspace:delete-archived-group` でグループ削除を実行
   - アーカイブリストから該当グループを削除
   - グループとアイテムが完全に削除される（復元不可）
3. キャンセルの場合：処理を中止

#### 注意
この操作は取り消しできません。削除されたグループとアイテムは復元できなくなります。

### 4.30. ワークスペースウィンドウ設定を変更

#### アクション
- ワークスペースの自動表示チェックボックスをクリック
- ワークスペースの表示位置ラジオボタンを選択
- ワークスペースウィンドウの透過度スライダーを変更、または背景透過チェックボックスをクリック

#### 処理フロー
1. 変更された項目の値を取得
2. **即座保存**: 設定が自動的に保存され、ワークスペースウィンドウに即座に反映される

#### 設定項目

**メイン画面表示時にワークスペースを自動表示（autoShowWorkspace）:**
- チェックボックスで有効/無効を切り替え
- 有効時: メイン画面を開いたときにワークスペースが非表示なら自動で表示
- 無効時: 手動で表示（デフォルト）

**表示位置（workspacePositionMode）:**
- ラジオボタンで以下の3モードから選択
- **プライマリディスプレイの左端（primaryLeft）**: プライマリモニターの左端にワークスペースを固定配置
- **プライマリディスプレイの右端（primaryRight）**: プライマリモニターの右端にワークスペースを固定配置（デフォルト）
- **固定位置（fixed）**: ワークスペースを移動した位置を記憶して、次回も同じ位置に表示
- マルチディスプレイ環境でモニター構成が変更された場合、自動的にプライマリモニターの右端にフォールバック

**透過度（workspaceOpacity）:**
- スライダーで0-100%を設定
- 0%: 完全透明
- 100%: 完全不透明（デフォルト）
- ワークスペースウィンドウ全体の透過度を制御

**背景のみを透過（workspaceBackgroundTransparent）:**
- チェックボックスで有効/無効を切り替え
- 有効時: 背景のみが透過され、アイテムやグループは通常通り表示される
- 無効時: ウィンドウ全体が透過度設定に従って透過される

### 4.31. 右クリックメニューを表示

#### アクション
- アイテム管理タブのテーブル行を右クリック

#### 処理フロー
1. 右クリックした行がチェックされていない場合、その行のみを選択
2. 右クリック位置にコンテキストメニューを表示
3. メニュー項目：
   - **📋 複製**: 選択した行を複製（選択行の直後に挿入）
   - **✏️ 詳細編集**: RegisterModalで詳細編集（単一行選択時のみ表示）
   - **🗑️ 削除**: 選択した行を削除

#### 複製処理の詳細
1. 選択した行をコピー
2. 新しい行番号を割り当て（ファイル内で連番）
3. 選択した行の直後に複製を挿入
4. 未保存変更フラグをセット
5. 保存ボタンで変更を確定

#### メニュー表示内容
- **単一行選択時**:
  - 📋 複製
  - ✏️ 詳細編集
  - 🗑️ 削除
- **複数行選択時**:
  - 📋 複製 (N行)
  - 🗑️ 削除 (N行)

#### メニューを閉じる操作
- Escapeキー
- メニュー外をクリック
- メニュー項目を選択

---

## 6. アイテム管理の詳細

アイテムはメインウィンドウまたは管理ウィンドウ（Ctrl+E）で編集・登録できます。

### 6.1. アイテム登録方法

QuickDashLauncherでは、以下の3つの方法でアイテムを登録できます:

#### 1. メインウィンドウから登録（➕ボタン）

メインウィンドウのヘッダーにある「➕」ボタンをクリックすると、アイテム登録モーダルが開きます。

- **登録内容**: 名前、パス、引数、アイテム種別（単一アイテム/フォルダ取込アイテム/グループ）、カスタムアイコンを入力
- **保存先選択**: 設定で定義されたタブ（データファイル）から保存先を選択
  - デフォルト選択: 現在開いているタブ（アクティブタブ）
  - 選択肢: `dataFileTabs`設定に基づいた全タブ
- **モーダルモード**: 登録中はウィンドウが非表示にならないため、参照しながら入力可能

#### 2. ドラッグ&ドロップで登録

ファイルやフォルダをメインウィンドウにドラッグ&ドロップすると、アイテム登録モーダルが開きます。

- **自動入力**: パス、ファイル名（デフォルト名）、アイテムタイプが自動的に設定される
- **保存先選択**: 手動で保存先タブ（データファイル）を変更可能
- **複数ファイル対応**: 複数ファイルを一度にドロップすると、まとめて登録可能

#### 3. 管理ウィンドウから登録（Ctrl+E）

Ctrl+Eでアイテム管理に切り替えて、データファイルに直接行を追加できます。

- **行を追加**: ➕行を追加ボタンで新しい空行を作成
- **種類選択**: 空行の種類列で「📄 単一アイテム」「🗂️ フォルダ取り込み」「📦 グループ」を選択
- **詳細編集**: ✏️ボタンでRegisterModalを使った包括的編集が可能

### 6.2. アイテム編集方法

QuickDashLauncherでは、以下の2つの方法でアイテムを編集できます:

#### 1. メインウィンドウから編集

メインウィンドウでアイテムを右クリックし、「✏️ 編集」を選択すると、アイテム登録モーダルが開いて編集できます。

- **対応アイテム**: 通常アイテム、フォルダ取込ディレクティブ、グループ
- **フォルダ取込展開アイテムの編集**: フォルダ取込から展開されたアイテムを編集する場合、元のディレクティブ行が自動的に読み込まれます
- **モーダルモード**: 編集中はウィンドウが非表示にならないため、参照しながら編集可能
- **保存先選択**: アイテムの保存先（データファイル）を変更可能。設定で定義されたすべてのタブから選択できます
- **保存先タブの変更**: 保存先を別のタブに変更して更新すると、アイテムが元のタブから削除され、新しいタブに移動します
  - 例：メインタブのアイテムを編集し、保存先を「サブ1」に変更すると、アイテムはメインタブから削除され、サブ1タブに追加されます
- **更新API**:
  - 保存先変更時: 元のタブから削除（`deleteItems`）→ 新しいタブに登録（`registerItems`）
  - 保存先が同じ場合: 通常アイテムは`updateItem` APIでCSV形式更新、フォルダ取込ディレクティブは`updateRawLine` APIで生データ行を直接更新

#### 2. 管理ウィンドウから編集（Ctrl+E）

Ctrl+Eでアイテム管理に切り替えて、データファイルを直接編集できます。

##### メインウィンドウへの自動反映

管理ウィンドウでアイテムを編集・削除すると、変更内容が**即座にメインウィンドウに自動反映**されます。

**自動反映される操作:**
- アイテムの更新（`update-item`）
- 生データ行の更新（`update-raw-line`）
- アイテムの削除（`delete-items`）
- 一括更新（`batch-update-items`）

手動でデータを再読み込みする必要はありません。編集後すぐにメインウィンドウに反映されるため、スムーズに作業を継続できます。

### 6.3. タブ（データファイル）の選択

管理ウィンドウでは、編集対象のタブ（データファイル）を選択できます。

#### 選択UI

編集対象の選択は、タブの構成によって以下のように表示されます：

##### 単一ファイルタブの場合

タブが単一ファイルのみで構成されている場合、**タブ選択ドロップダウンのみ**が表示されます。

- **タブ選択ドロップダウン**: ヘッダー部分に「タブ:」というラベルで表示
- **選択内容**: タブ名（例: `メイン`、`仕事用`、`プライベート`）
- **選択後の動作**: タブのデフォルトファイルまたは最初のファイルが自動的に選択され、内容がテーブルに表示されます

##### 複数ファイルタブの場合

タブが複数ファイルで構成されている場合、**タブ + ファイルの2段階ドロップダウン**が表示されます。

- **タブ選択ドロップダウン**: 「タブ:」ラベルで表示
  - 選択内容: タブ名（例: `メイン`、`サブ1`）
- **データファイル選択ドロップダウン**: 「データファイル:」ラベルで表示（タブ選択後に表示）
  - 選択内容: ファイル名（例: `data.json`、`data2.json`）
  - タブ内の全ファイルが選択肢として表示されます

#### 選択時の動作

- **利用可能なタブ**: `settings.json`の`dataFileTabs`配列に登録されているタブのみが選択肢に表示されます
- **タブ名表示形式（v1.0.0以降）**:
  - カスタムタブ名が設定されている場合: カスタム名を表示（例: `仕事用`、`プライベート`）
  - カスタムタブ名がない場合: デフォルトタブ名を表示（例: `メイン`、`サブ1`、`サブ2`）
  - ファイル名は省略されます（「タブ: メイン」「データファイル: data.json」のように分離表示）
- **タブ変更時の自動ファイル選択**: タブを変更すると、そのタブの最初のファイル（files[0]）が自動的に選択されます
- **未保存変更の警告**: タブまたはファイルを切り替える際、未保存の変更がある場合は確認ダイアログが表示されます

#### 補足

- **v1.0.0以降**: 物理ファイルベースではなく、設定ファイルの`dataFileTabs`配列ベースで選択肢が生成されます

### 6.4. 管理ウィンドウの特徴

- フォルダ取込アイテムを展開せずに生データのまま編集
- テーブル形式で行ごとに表示・編集（☑️ | # | 種類 | 名称 | 内容 | 操作）
- **2つの編集方法を提供**:
  - **セル編集**: セルを直接クリックして素早い修正
  - **詳細編集（✏️）**: ✏️ボタンでRegisterModalを使った包括的編集
  - **ユーザー選択式アイテム種別**: 従来の自動判定に代わり、ユーザーが「単一アイテム」「フォルダ取込アイテム」を明示的に選択
  - **アイテム種別の変更**: 既存アイテムをフォルダ取込アイテムに変更、またはその逆も可能
  - **フォルダ取込アイテム選択時の制限**: 名前フィールドは読み取り専用（ハイフン表示）、パスとフォルダ取込アイテムオプションのみ編集可能
- **アイテム表示名の個別編集**: 単一アイテムの名前のみ編集可能
- **フォルダ取込アイテムの制限**: 名前列は編集不可、パスと引数列は編集可能
- 行の追加、削除、内容編集が可能
- リアルタイム検索による行のフィルタリング
- 変更の一時保存と一括保存機能（全ての変更は保存ボタンクリックまで確定されない）
- ヘッダーに編集中のファイル名を表示
- **ウィンドウサイズ自動拡大**: 管理画面表示時に設定されたサイズ（デフォルト: 1200x1000px）に拡大、終了時に元のサイズに復元
- **フォーカスアウト無効化**: アイテム管理中はフォーカスアウトでもウィンドウが非表示にならない

### 6.5. 操作方法

#### 空行からのアイテム作成
- **行を追加**: ➕行を追加ボタンで新しい空行を作成
- **種類選択**: 空行の種類列に表示される3つのボタンから選択
  - 📄 単一アイテム: 通常のアイテムを作成
  - 🗂️ フォルダ取り込み: フォルダ取込アイテムを作成
  - 📦 グループ: グループアイテムを作成
- **編集制限**: 空行の状態では
  - パスと引数列は「(まず種類を選択してください)」と表示され編集不可
  - ✏️詳細編集ボタンは無効化
  - 🗑️削除ボタンのみ有効
- **種類選択後**: 名前やパスなどのフィールドが編集可能になる
  - パスが未設定の場合は「(パスなし)」または「(フォルダパスなし)」と表示

#### セル編集
- セルをクリックして即座に編集
- **編集確定**: Enter または フォーカス移動
- **編集キャンセル**: Escape
- **編集制限**:
  - 空行の場合はセル編集不可
  - **ウィンドウ操作アイテムの場合はセル編集不可**（v0.5.10以降）
    - JSON形式の破損を防ぐため、パス列（JSON文字列部分）はインライン編集できません
    - セル上に「✏️ボタンから詳細編集を開いてください」というツールチップが表示されます
    - 編集は✏️ボタンから詳細編集モーダル（RegisterModal）を使用してください

#### 詳細編集
✏️ボタンでRegisterModalを開いて包括的編集:
- **アイテム種別選択**: 画面上部でユーザーが「単一アイテム」「フォルダ取込アイテム」「グループ」を明示的に選択
- **単一アイテム選択時**: 単一アイテム登録（名前・パス・引数の編集が可能）
- **フォルダ取込アイテム選択時**: フォルダ取込アイテムとして処理
  - 名前フィールドは読み取り専用（ハイフン表示）
  - フォルダ取込アイテムオプション詳細設定（深度、タイプ、フィルター、除外、プレフィックス）
- **グループ選択時**: グループアイテムとして処理
  - グループ名フィールドで名前を編集
  - パスフィールドは非表示
  - 引数フィールドは非表示
  - アイテム名リストフィールド（テキストエリア）で既存アイテム名をカンマ区切りで入力
  - カンマを含むテキストの自由な入力が可能
- **種別変更**: 単一アイテム、フォルダ取込アイテム、グループの相互変換が可能
- **編集制限**: 空行の場合は詳細編集不可

#### 整列・重複削除機能

管理画面の「🔤 整列・重複削除」ボタンで、アイテムを整列し、重複を削除できます。

##### 動作仕様（v0.5.0以降）

- **対象範囲**: 現在選択中のデータファイルのみ
  - 例: data.jsonを選択している場合、data.jsonのデータのみが対象
  - 他のデータファイル（data2.json等）には影響しません
- **整列順序**: 種類 → パスと引数 → 名前
  - **第1ソートキー**: 種類（ディレクティブ（フォルダ取込、グループ） → 単一アイテム → コメント → 空行）
  - **第2ソートキー**: パスと引数（文字列の昇順、大文字小文字区別なし）
  - **第3ソートキー**: 名前（文字列の昇順、大文字小文字区別なし）
- **重複判定**: 行の種類（`type`）と内容（`content`）が完全一致する行を重複と判定

##### 使用方法

1. 管理画面で対象のデータファイルを選択
2. 「🔤 整列・重複削除」ボタンをクリック
3. 整列が実行され、重複が見つかった場合は確認ダイアログが表示されます
4. 「削除」をクリックすると重複行が削除されます

##### 注意事項

- **ファイル単位の処理**: 他のデータファイルには影響しません
- **元に戻せない**: 重複削除は元に戻せないため、事前にバックアップを推奨します
- **バックアップ設定**: 設定画面で「データ編集時にバックアップ」を有効にすることを推奨します
- **保存**: 整列後は未保存状態となり、保存ボタンで実際のファイルに反映

#### その他の操作
- **名前編集**: 単一アイテムとグループの名前列をクリック（フォルダ取込アイテムは編集不可）
- **行削除**: 選択後にDeleteキーまたは削除ボタン
- **行複製**: 右クリックメニューから「複製」を選択（複数行の一括複製にも対応）
- **一括操作**: チェックボックスによる複数選択
- **保存**: Ctrl+S または保存ボタン

#### 右クリックメニュー
管理ウィンドウのテーブル行を右クリックすると、コンテキストメニューが表示されます。

##### メニュー項目
- **📋 複製**: 選択した行を複製（選択行の直後に挿入）
  - 複数行選択時は「複製 (N行)」と表示
  - 複製後は未保存状態となり、保存ボタンで確定
- **✏️ 詳細編集**: RegisterModalで詳細編集（単一行選択時のみ表示）
- **🗑️ 削除**: 選択した行を削除（複数行選択時は「削除 (N行)」と表示）

##### 操作方法
1. 行のチェックボックスで複製したい行を選択（複数選択可能）
2. 選択した行を右クリック
3. メニューから「複製」を選択
4. 選択した行の直後に複製が挿入される
5. 保存ボタン（Ctrl+S）で変更を確定

### 6.6. テーブル構成

#### 列構成
- **☑️**: 行選択チェックボックス
- **#**: 行番号
- **種類**: アイテムタイプ（フォルダ取込アイテム/グループ/単一アイテム/コメント/空行）
- **名前**: アイテムの表示名（単一アイテムとグループは編集可能、フォルダ取込アイテムは編集不可）
- **パスと引数**: パスと引数の統合表示（全てのタイプで編集可能）
  - グループの場合はアイテム名のリスト（カンマ区切り）が表示される
- **操作**: 2つのボタン
  - **✏️**: 詳細編集ボタン（RegisterModal使用）
  - **🗑️**: 削除ボタン

---

## 7. 設定機能の詳細

QuickDashLauncherの動作をカスタマイズするための設定機能を説明します。

### 7.1. 設定ファイルの場所

| 項目 | 値 |
|------|-----|
| パス | `%APPDATA%/quick-dash-launcher/config/settings.json` |
| 形式 | JSON (UTF-8) |

設定変更は即座に反映されます（v1.0.0以降）。再起動は不要です。

---

### 7.2. 初回設定

アプリケーション初回起動時、または`hotkey`が未設定の場合、初回設定画面が自動表示されます。

#### 設定手順
1. 入力欄をクリックして、希望するキー組み合わせを押下（例: `Ctrl+Alt+Q`）
2. リアルタイムでバリデーションが実行されます
3. 「設定を完了」ボタンをクリック

**動作詳細:**
- ESCキーやフォーカス喪失では閉じません
- 後から設定画面で変更可能

**開発者向け:** 初回設定をスキップするには、`settings.json`の`hotkey`に任意の値を設定してください。

---

### 7.3. 設定画面へのアクセス

1. **基本設定タブ**: ⚙ボタン → 「⚙️ 基本設定」
2. **アイテム管理タブ**: ⚙ボタン → 「✏️ アイテム管理」
3. **その他タブ**: ⚙ボタン → 「📊 その他」

---

### 7.4. 設定項目一覧

#### クイックリファレンス

| キー | 型 | デフォルト | 説明 |
|------|-----|-----------|------|
| `createdWithVersion` | `string?` | `undefined` | 設定ファイルを作成したアプリバージョン（新規作成時のみ自動記録） |
| `updatedWithVersion` | `string?` | `undefined` | 設定ファイルを最後に更新したアプリバージョン（更新時に自動記録） |
| `hotkey` | `string` | `''` | グローバルホットキー |
| `windowWidth` | `number` | `600` | メイン画面のウィンドウ幅 |
| `windowHeight` | `number` | `400` | メイン画面のウィンドウ高さ |
| `editModeWidth` | `number` | `1200` | 管理画面の幅 |
| `editModeHeight` | `number` | `1000` | 管理画面の高さ |
| `autoLaunch` | `boolean` | `false` | Windows起動時に自動起動 |
| `windowPositionMode` | `string` | `'center'` | 表示位置モード |
| `showDataFileTabs` | `boolean` | `false` | タブ表示の有効/無効 |
| `dataFileLabels` | `object` | `{}` | データファイルのラベル定義 |
| `backupEnabled` | `boolean` | `false` | バックアップ機能 |
| `workspaceOpacity` | `number` | `100` | ワークスペースウィンドウの不透明度（0-100%） |
| `workspaceBackgroundTransparent` | `boolean` | `false` | 背景のみを透過するモード |

---

### 7.5. グローバルホットキー

アプリケーションを呼び出すためのキー組み合わせ（デフォルト: `Alt+Space`）。

**設定方法:**
1. 入力欄をクリック
2. 希望するキー組み合わせを押下
3. バリデーション後、自動保存

**設定例:**
```
Alt+Space
Ctrl+Alt+Q
Ctrl+Shift+L
Alt+F1
```

**対応キー:**
- 修飾キー: `Ctrl`, `Alt`, `Shift`, `CmdOrCtrl`
- 通常キー: `A-Z`, `0-9`, `F1-F12`

**バリデーション:**
- 最低1つの修飾キーが必要
- システム予約キー（`Ctrl+Alt+Del`等）は不可
- 他アプリと競合するキーは登録不可

---

### 7.6. ウィンドウサイズ

| 設定 | 幅範囲 | 高さ範囲 | デフォルト |
|------|-------|---------|-----------|
| メイン画面 | 400-2000px | 300-1200px | 600x400 |
| 管理画面 | 800-2000px | 600-1200px | 1200x1000 |

---

### 7.7. ウィンドウピン留めモード

📌ボタンをクリックして切り替え。

| モード | 最上面 | 自動非表示 | 用途 |
|-------|-------|----------|------|
| 通常（デフォルト） | × | ○ | ホットキーで素早く呼び出す |
| 常に最上面 | ○ | × | 常にアクセス可能にしたい |
| 表示固定 | × | × | 他ウィンドウと並べて使う |

---

### 7.8. ウィンドウ表示位置

| モード | 説明 |
|-------|------|
| `center`（画面中央（固定）） | 常にプライマリモニターの中央にウィンドウを表示します（デフォルト） |
| `cursorMonitorCenter`（画面中央（自動切替）） | マウスカーソルがあるモニターの中央にウィンドウを表示します（マルチモニター推奨） |
| `cursor`（カーソル付近） | マウスカーソルの近くにウィンドウを表示します（検索入力がしやすい位置） |
| `fixed`（固定位置（手動設定）） | ウィンドウを移動した位置を記憶して、次回も同じ位置に表示します |

**固定位置のリセット:** システムトレイメニュー →「画面中央に表示」

---

### 7.9. 自動起動

Windowsログイン時にアプリを自動起動（デフォルト: 無効）。

**実装:**
- レジストリ `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run` に登録
- 開発環境では設定変更しても実際の登録は行われません

---

### 7.10. バックアップ設定

| 設定 | デフォルト | 説明 |
|------|-----------|------|
| `backupEnabled` | `false` | バックアップ機能のON/OFF |
| `backupOnStart` | `false` | アプリ起動時にバックアップ |
| `backupOnEdit` | `false` | データ編集時にバックアップ |
| `backupInterval` | `5` | 最小バックアップ間隔（1-60分） |
| `backupRetention` | `20` | 保存件数上限（1-100件） |

**保存場所:** `%APPDATA%/quick-dash-launcher/config/backup/`

**ファイル名:** `data_2024-01-01T12-00-00.txt`

---

### 7.11. タブ表示設定

複数のデータファイルをタブで切り替え。

| 設定 | デフォルト | 説明 |
|------|-----------|------|
| `showDataFileTabs` | `false` | タブ表示のON/OFF |
| `defaultFileTab` | `'data.json'` | 起動時の表示タブ |
| `dataFileTabs` | `[{files:['data.json'],name:'メイン'}]` | タブ設定 |
| `dataFileLabels` | `{}` | データファイルのラベル定義（ファイル名→表示ラベル） |

**タブ管理機能:**
- **アコーディオン形式**: タブをクリックして展開/折りたたみで詳細を表示
- **タブ名表示**: 折りたたみ時もタブ名が見やすく表示され、ファイル数アイコン（📄1）も表示
- **➕新規タブを追加**: 新しいタブとデータファイルを作成
- **タブ名のカスタマイズ**: 展開時に任意の名前を設定（空欄時はデフォルト名）
- **複数ファイル統合**: 1つのタブに複数ファイルを関連付け
- **▲▼ボタン**: 表示順序の変更
- **🗑️ボタン**: タブとデータファイルをディスクから完全に削除（確認メッセージあり）
- **データファイル管理**: 展開時にタブ内のデータファイル一覧を表示
  - 「データファイル:」ラベルとファイル名（物理ファイル名）を表示
  - 各ファイルにラベル設定が可能
  - ファイルごとに削除ボタンあり（最低1ファイル必要）
  - **data.jsonの削除**: 他のタブにもdata.jsonが含まれている場合のみ削除可能（最低1つのタブにdata.jsonが必要）
  - **共有ファイルの削除**: 複数タブで共有されているファイルを削除する場合、タブからの削除のみ実行され、ファイル自体は残る
  - 既存ファイルの追加/新規ファイルの作成が可能
- **保存/キャンセルボタン**: 変更は保存ボタンを押すまで確定されない（未保存インジケーターで状態を表示）

**ファイルラベル機能:**
- データファイルに任意のラベル（別名）を設定可能
- ラベルはグローバルで、全てのタブで共通
- 設定方法: タブを展開して各ファイルの「データファイル:」入力欄に入力
- 表示: タブバーと編集モードでラベルが優先表示される（ラベルがない場合はファイル名）
- デフォルトラベル: 未設定時は「{タブ名}用データファイル」形式の名前が自動生成される

**デフォルトタブ名:**
- data.json → 「メイン」
- data2.json → 「サブ1」
- data3.json → 「サブ2」

**タブのデフォルト位置へのリセット:**
- メイン画面でタブを切り替えた後、ウィンドウを閉じると、次回開いた際には自動的にデフォルトタブに戻ります
- この処理はウィンドウ非表示時に実行されるため、次回表示時は既にリセット済みで、表示遅延が発生しません

---

### 7.12. ワークスペースウィンドウ

ワークスペースウィンドウの外観をカスタマイズできます。

| 設定 | デフォルト | 説明 |
|------|-----------|------|
| `workspaceOpacity` | `100` | ウィンドウの不透明度（0-100%） |
| `workspaceBackgroundTransparent` | `false` | 背景のみを透過するモード |

**透過度:**
- スライダーで0-100%の範囲で調整
- 0%: 完全に透明（ウィンドウが見えなくなるため非推奨）
- 100%: 完全に不透明（デフォルト）
- 設定変更は即座にワークスペースウィンドウに反映

**背景のみ透過:**
- チェックボックスで有効化
- 有効時: ウィンドウ背景のみが透過され、アイテム・ボタン・テキストは不透明のまま表示
- 無効時: ウィンドウ全体が透過度設定に従う
- デスクトップ背景を透かして見たい場合に便利

**サイズ変更:**
- ワークスペースウィンドウは8方向のカスタムハンドルでリサイズ可能
- 最小サイズ: 幅300px × 高さ400px
- ハンドル位置: 4隅（左上、右上、右下、左下）+ 4辺（上、右、下、左）

詳細は[ワークスペース機能 - ウィンドウのカスタマイズ](../features/workspace.md#ウィンドウのカスタマイズ)を参照してください。

---

### 7.13. システムトレイメニュー

タスクバー右下の通知領域にアイコンが常駐します。

#### メニュー項目

| 項目 | 説明 |
|------|------|
| バージョン情報 | 現在のバージョンを表示（選択不可） |
| 表示 (Alt+Space) | メインウィンドウを表示 |
| 画面中央に表示 | 強制的に画面中央に表示 |
| 設定... | 設定画面を開く |
| データフォルダを開く | 設定フォルダをエクスプローラーで開く |
| ヘルプ | GitHubリポジトリを開く |
| 再起動 | アプリケーションを再起動（開発モードでは警告ダイアログを表示） |
| 終了 | アプリケーションを終了 |

**ダブルクリック:** メインウィンドウを表示

**注意（開発モード）:**
- 開発モードで「再起動」を選択すると警告ダイアログが表示されます
- 開発モードでは自動再起動に対応していないため、手動で`npm run dev`を実行する必要があります
- 本番モードでは通常の再起動が実行されます

---

### 7.14. 詳細設定（設定フォルダのカスタマイズ）

環境変数 `QUICK_DASH_CONFIG_DIR` で設定フォルダの場所を変更できます。

#### 設定方法

**一時的（PowerShell）:**
```powershell
$env:QUICK_DASH_CONFIG_DIR = "D:\MyApps\quick-dash-config"
```

**永続的:**
1. Windowsの「環境変数」を検索
2. ユーザー環境変数に `QUICK_DASH_CONFIG_DIR` を追加

#### ユースケース

| 用途 | 設定例 |
|------|--------|
| ポータブル版 | `E:\PortableApps\QuickDash\config` |
| クラウド同期 | `$env:USERPROFILE\Dropbox\QuickDash\config` |
| 複数プロファイル | 仕事用/プライベート用で別パス |

#### 注意事項

- セキュリティ制限: `C:\Windows`, `C:\Program Files` 等は使用不可
- 既存データは自動移行されません（手動コピーが必要）

---

### 7.15. 設定ファイルのサンプル

```json
{
  "createdWithVersion": "0.4.3",
  "updatedWithVersion": "0.4.3",
  "hotkey": "Alt+Space",
  "windowWidth": 600,
  "windowHeight": 400,
  "editModeWidth": 1200,
  "editModeHeight": 700,
  "autoLaunch": false,
  "backupEnabled": false,
  "backupOnStart": false,
  "backupOnEdit": false,
  "backupInterval": 5,
  "backupRetention": 20,
  "showDataFileTabs": false,
  "defaultFileTab": "data.json",
  "dataFileTabs": [
    { "files": ["data.json"], "name": "仕事用" },
    { "files": ["data2.json", "data3.json"], "name": "プライベート" }
  ],
  "dataFileLabels": {
    "data.json": "メインリスト",
    "data2.json": "開発用"
  },
  "windowPositionMode": "center",
  "windowPositionX": 0,
  "windowPositionY": 0,
  "workspaceOpacity": 100,
  "workspaceBackgroundTransparent": false
}
```

---

### 7.16. トラブルシューティング

#### ホットキーが動作しない

1. **他アプリとの競合** → 別のキー組み合わせに変更
2. **管理者権限** → 管理者として実行
3. **設定破損** → リセットボタンでデフォルトに戻す

#### 自動起動が動作しない

- タスクマネージャー → スタートアップタブで確認
- 複数起動する場合: 一度無効化→再度有効化

#### 設定が保存されない

- 設定フォルダへの書き込み権限を確認
- ディスク容量を確認

#### 設定パスが認識されない

- 環境変数が正しく設定されているか確認
- アプリケーションを再起動
- パスの書き込み権限を確認
