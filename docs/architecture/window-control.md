# ウィンドウ制御システム

## ウィンドウ固定化機能

- **実装場所**: `src/main/windowManager.ts`
- **状態管理**: メインプロセスで`isPinned`フラグを管理
- **制御ロジック**: 固定中はウィンドウのblurイベントで非表示にならない
- **UI制御**: レンダラーで固定ボタン（📌）の状態を管理

## ウィンドウ表示制御

- **グローバルホットキー**: `Ctrl+Alt+W`でウィンドウ表示/非表示
- **フォーカスアウト**: 固定されていない場合、フォーカスを失うと自動的に非表示
- **編集モード時のフォーカス制御**: 編集モード中はフォーカスアウトでもウィンドウが非表示にならない
- **Escapeキー**: 固定状態に関係なく、Escapeキーで非表示可能
- **システムトレイ**: ダブルクリックでウィンドウ表示

## IPC通信フロー

1. レンダラーが固定ボタンクリック → `set-window-pin-state`
2. メインプロセスが固定状態を更新 → `windowManager.setWindowPinState()`
3. レンダラーが固定状態を取得 → `get-window-pin-state`
4. blur イベントで固定状態と編集モード状態をチェック → 非固定かつ非編集モード時のみ非表示

## 編集モードのウィンドウ制御

- **ウィンドウサイズ管理**: 通常モードのサイズを保存し、編集モード時に拡大
- **フォーカス制御**: 編集モード中は`isEditMode`フラグでフォーカスアウトを無効化
- **サイズ復元**: 編集モード終了時に保存した元のサイズに自動復元

### 編集モードのIPC通信フロー

1. レンダラーが編集モード切り替え → `set-edit-mode`
2. メインプロセスが編集モード状態を更新 → `windowManager.setEditMode()`
3. ウィンドウサイズとフォーカス制御を自動調整
4. レンダラーが編集モード状態を取得 → `get-edit-mode`

## 管理ウィンドウ制御

### 実装場所
- **メインプロセス**: `src/main/adminWindowManager.ts`
- **レンダラー**: `src/renderer/AdminApp.tsx`

### タブ指定での表示機能

1. **メニューからのタブ指定**
   - 「基本設定」メニュー → `openEditWindowWithTab('settings')`
   - 「アイテム管理」メニュー → `openEditWindowWithTab('edit')`

2. **タブ変更の通信フロー**
   - メインプロセスから`set-active-tab`イベントを送信
   - AdminAppがイベントを受信してタブを切り替え

3. **初期タブのリセット**
   - ウィンドウが非表示になるたびに初期タブをリセット
   - 次回開く際は指定されたタブが正しく表示される

### 管理ウィンドウのIPC通信

- `show-edit-window`: 管理ウィンドウを表示
- `hide-edit-window`: 管理ウィンドウを非表示
- `toggle-edit-window`: 表示/非表示を切り替え
- `open-edit-window-with-tab`: 指定タブで開く
- `get-initial-tab`: 初期タブを取得
- `set-active-tab`: アクティブタブを変更（イベント）

## 関連ドキュメント

- [アーキテクチャ概要](overview.md) - システム全体の構造
- [IPCチャンネル詳細](ipc-channels.md) - ウィンドウ制御関連のIPCチャンネル
- [アプリケーション設定](../features/app-settings.md) - 設定画面へのアクセス方法