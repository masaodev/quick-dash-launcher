# アイテム管理

アイテムはメインウィンドウまたは管理ウィンドウ（Ctrl+E）で編集・登録できます。

## アイテム登録方法

QuickDashLauncherでは、以下の3つの方法でアイテムを登録できます:

### 1. メインウィンドウから登録（➕ボタン）

メインウィンドウのヘッダーにある「➕」ボタンをクリックすると、アイテム登録モーダルが開きます。

- **登録内容**: 名前、パス、引数、アイテム種別（単一アイテム/フォルダ取込アイテム/グループ）、カスタムアイコンを入力
- **保存先選択**: 設定で定義されたタブ（データファイル）から保存先を選択
  - デフォルト選択: 現在開いているタブ（アクティブタブ）
  - 選択肢: `dataFileTabs`設定に基づいた全タブ
- **モーダルモード**: 登録中はウィンドウが非表示にならないため、参照しながら入力可能

### 2. ドラッグ&ドロップで登録

ファイルやフォルダをメインウィンドウにドラッグ&ドロップすると、アイテム登録モーダルが開きます。

- **自動入力**: パス、ファイル名（デフォルト名）、アイテムタイプが自動的に設定される
- **保存先選択**: 手動で保存先タブ（データファイル）を変更可能
- **複数ファイル対応**: 複数ファイルを一度にドロップすると、まとめて登録可能

### 3. 管理ウィンドウから登録（Ctrl+E）

Ctrl+Eでアイテム管理に切り替えて、データファイル（data.txt、data2.txt、data3.txt...）に直接行を追加できます。

- **行を追加**: ➕行を追加ボタンで新しい空行を作成
- **種類選択**: 空行の種類列で「📄 単一アイテム」「🗂️ フォルダ取り込み」「📦 グループ」を選択
- **詳細編集**: ✏️ボタンでRegisterModalを使った包括的編集が可能

## アイテム編集方法

QuickDashLauncherでは、以下の2つの方法でアイテムを編集できます:

### 1. メインウィンドウから編集

メインウィンドウでアイテムを右クリックし、「✏️ 編集」を選択すると、アイテム登録モーダルが開いて編集できます。

- **対応アイテム**: 通常アイテム、フォルダ取込ディレクティブ、グループ
- **フォルダ取込展開アイテムの編集**: フォルダ取込から展開されたアイテムを編集する場合、元のディレクティブ行が自動的に読み込まれます
- **モーダルモード**: 編集中はウィンドウが非表示にならないため、参照しながら編集可能
- **保存先選択**: アイテムの保存先（データファイル）を変更可能。設定で定義されたすべてのタブから選択できます
- **保存先タブの変更**: 保存先を別のタブに変更して更新すると、アイテムが元のタブから削除され、新しいタブに移動します
  - 例：メインタブのアイテムを編集し、保存先を「サブ1」に変更すると、アイテムはメインタブから削除され、サブ1タブに追加されます
- **更新API**:
  - 保存先変更時: 元のタブから削除（`deleteItems`）→ 新しいタブに登録（`registerItems`）
  - 保存先が同じ場合: 通常アイテムは`updateItem` APIでCSV形式更新、フォルダ取込ディレクティブは`updateRawLine` APIで生データ行を直接更新

### 2. 管理ウィンドウから編集（Ctrl+E）

Ctrl+Eでアイテム管理に切り替えて、データファイル（data.txt、data2.txt、data3.txt...）を直接編集できます。

#### メインウィンドウへの自動反映

管理ウィンドウでアイテムを編集・削除すると、変更内容が**即座にメインウィンドウに自動反映**されます。

**自動反映される操作:**
- アイテムの更新（`update-item`）
- 生データ行の更新（`update-raw-line`）
- アイテムの削除（`delete-items`）
- 一括更新（`batch-update-items`）

手動でデータを再読み込みする必要はありません。編集後すぐにメインウィンドウに反映されるため、スムーズに作業を継続できます。

## タブ（データファイル）の選択

管理ウィンドウでは、編集対象のタブ（データファイル）を選択できます。

### 選択UI

編集対象の選択は、タブの構成によって以下のように表示されます：

#### 単一ファイルタブの場合

タブが単一ファイルのみで構成されている場合、**タブ選択ドロップダウンのみ**が表示されます。

- **タブ選択ドロップダウン**: ヘッダー部分に「タブ:」というラベルで表示
- **選択内容**: タブ名（例: `メイン`、`仕事用`、`プライベート`）
- **選択後の動作**: タブのデフォルトファイルまたは最初のファイルが自動的に選択され、内容がテーブルに表示されます

#### 複数ファイルタブの場合

タブが複数ファイルで構成されている場合、**タブ + ファイルの2段階ドロップダウン**が表示されます。

- **タブ選択ドロップダウン**: 「タブ:」ラベルで表示
  - 選択内容: タブ名（例: `メイン`、`サブ1`）
- **ファイル選択ドロップダウン**: 「ファイル:」ラベルで表示（タブ選択後に表示）
  - 選択内容: ファイル名（例: `data.txt`、`data2.txt`）
  - タブ内の全ファイルが選択肢として表示されます

### 選択時の動作

- **利用可能なタブ**: `settings.json`の`dataFileTabs`配列に登録されているタブのみが選択肢に表示されます
- **タブ名表示形式（v1.0.0以降）**:
  - カスタムタブ名が設定されている場合: カスタム名を表示（例: `仕事用`、`プライベート`）
  - カスタムタブ名がない場合: デフォルトタブ名を表示（例: `メイン`、`サブ1`、`サブ2`）
  - ファイル名は省略されます（「タブ: メイン」「ファイル: data.txt」のように分離表示）
- **タブ変更時の自動ファイル選択**: タブを変更すると、そのタブの最初のファイル（files[0]）が自動的に選択されます
- **未保存変更の警告**: タブまたはファイルを切り替える際、未保存の変更がある場合は確認ダイアログが表示されます

### 補足

- tempdata.txtは自動生成される一時ファイルのため、選択肢には表示されません
- **v1.0.0以降**: 物理ファイルベースではなく、設定ファイルの`dataFileTabs`配列ベースで選択肢が生成されます

## アイテム管理（管理ウィンドウ）の特徴

- フォルダ取込アイテムを展開せずに生データのまま編集
- テーブル形式で行ごとに表示・編集（☑️ | # | 種類 | 名称 | 内容 | 操作）
- **2つの編集方法を提供**:
  - **セル編集**: セルを直接クリックして素早い修正
  - **詳細編集（✏️）**: ✏️ボタンでRegisterModalを使った包括的編集
  - **ユーザー選択式アイテム種別**: 従来の自動判定に代わり、ユーザーが「単一アイテム」「フォルダ取込アイテム」を明示的に選択
  - **アイテム種別の変更**: 既存アイテムをフォルダ取込アイテムに変更、またはその逆も可能
  - **フォルダ取込アイテム選択時の制限**: 名前フィールドは読み取り専用（ハイフン表示）、パスとフォルダ取込アイテムオプションのみ編集可能
- **アイテム表示名の個別編集**: 単一アイテムの名前のみ編集可能
- **フォルダ取込アイテムの制限**: 名前列は編集不可、パスと引数列は編集可能
- 行の追加、削除、内容編集が可能
- リアルタイム検索による行のフィルタリング
- 変更の一時保存と一括保存機能（全ての変更は保存ボタンクリックまで確定されない）
- ヘッダーに編集中のファイル名を表示
- **ウィンドウサイズ自動拡大**: アイテム管理時に1000x700pxに拡大、終了時に元のサイズに復元
- **フォーカスアウト無効化**: アイテム管理中はフォーカスアウトでもウィンドウが非表示にならない

## 操作方法

### 空行からのアイテム作成
- **行を追加**: ➕行を追加ボタンで新しい空行を作成
- **種類選択**: 空行の種類列に表示される3つのボタンから選択
  - 📄 単一アイテム: 通常のアイテムを作成
  - 🗂️ フォルダ取り込み: フォルダ取込アイテムを作成
  - 📦 グループ: グループアイテムを作成
- **編集制限**: 空行の状態では
  - パスと引数列は「(まず種類を選択してください)」と表示され編集不可
  - ✏️詳細編集ボタンは無効化
  - 🗑️削除ボタンのみ有効
- **種類選択後**: 名前やパスなどのフィールドが編集可能になる
  - パスが未設定の場合は「(パスなし)」または「(フォルダパスなし)」と表示

### セル編集
- セルをクリックして即座に編集
- **編集確定**: Enter または フォーカス移動
- **編集キャンセル**: Escape
- **編集制限**: 空行の場合はセル編集不可

### 詳細編集
✏️ボタンでRegisterModalを開いて包括的編集:
- **アイテム種別選択**: 画面上部でユーザーが「単一アイテム」「フォルダ取込アイテム」「グループ」を明示的に選択
- **単一アイテム選択時**: 単一アイテム登録（名前・パス・引数の編集が可能）
- **フォルダ取込アイテム選択時**: フォルダ取込アイテムとして処理
  - 名前フィールドは読み取り専用（ハイフン表示）
  - フォルダ取込アイテムオプション詳細設定（深度、タイプ、フィルター、除外、プレフィックス）
- **グループ選択時**: グループアイテムとして処理
  - グループ名フィールドで名前を編集
  - パスフィールドは非表示
  - 引数フィールドは非表示
  - アイテム名リストフィールド（テキストエリア）で既存アイテム名をカンマ区切りで入力
  - カンマを含むテキストの自由な入力が可能
- **種別変更**: 単一アイテム、フォルダ取込アイテム、グループの相互変換が可能
- **編集制限**: 空行の場合は詳細編集不可

### データ整列
🔤整列ボタンで表示データを自動整理:
- **第1ソートキー**: 種類（ディレクティブ（フォルダ取込、グループ） → 単一アイテム → コメント → 空行）
- **第2ソートキー**: パスと引数（文字列の昇順、大文字小文字区別なし）
  - グループの場合はアイテム名リストで整列
- **第3ソートキー**: 名前（文字列の昇順、大文字小文字区別なし）
- 整列後は未保存状態となり、保存ボタンで実際のファイルに反映

### その他の操作
- **名前編集**: 単一アイテムとグループの名前列をクリック（フォルダ取込アイテムは編集不可）
- **行削除**: 選択後にDeleteキーまたは削除ボタン
- **一括操作**: チェックボックスによる複数選択
- **保存**: Ctrl+S または保存ボタン

## テーブル構成

### 列構成
- **☑️**: 行選択チェックボックス
- **#**: 行番号
- **種類**: アイテムタイプ（フォルダ取込アイテム/グループ/単一アイテム/コメント/空行）
- **名前**: アイテムの表示名（単一アイテムとグループは編集可能、フォルダ取込アイテムは編集不可）
- **パスと引数**: パスと引数の統合表示（全てのタイプで編集可能）
  - グループの場合はアイテム名のリスト（カンマ区切り）が表示される
- **操作**: 2つのボタン
  - **✏️**: 詳細編集ボタン（RegisterModal使用）
  - **🗑️**: 削除ボタン

## 関連ドキュメント

- **[データファイル形式仕様](../reference/data-file-format.md)** - データファイルの詳細仕様
- **[フォルダ取込アイテム](folder-import-item.md)** - フォルダ内容インポート機能
- **[グループ起動機能](group-launch.md)** - グループ機能の詳細
- **[画面構成](../reference/screens/screen-list.md)** - アイテム管理画面の詳細仕様