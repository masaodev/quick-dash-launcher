# アイコン進捗表示

アイコン取得処理の進行状況をリアルタイムで確認できる統合進捗表示機能を提供します。

## 機能概要

- **統合進捗バー**: ファビコン取得とアイコン抽出の両フェーズを1つの進捗バーで表示
- **フェーズ管理**: 複数フェーズの進捗を一括管理し、全体の進行状況を可視化
- **詳細モーダル**: クリックで詳細情報とエラー一覧を表示
- **非モーダル設計**: メイン画面下部に表示され、他の操作を継続可能
- **リアルタイム更新**: 各アイテム処理完了時に即座に進捗を更新
- **自動非表示**: 処理完了後3秒で自動的に非表示

## 統合進捗バーの表示

### 基本情報
- **フェーズ表示**: 「フェーズ 1/2」のように現在のフェーズと総フェーズ数を表示
- **全体進捗**: 全フェーズを通した進捗パーセンテージ
- **現在フェーズ**: 実行中のフェーズ種別（ファビコン取得/アイコン抽出）と進捗数値
- **プログレスバー**: 視覚的な進捗状況

### 詳細モーダル
進捗バーをクリックすると、以下の詳細情報を含むモーダルを表示：

#### フェーズごとの進捗
- **ファビコン取得**: 処理済み数、総数、成功・失敗件数
- **アイコン抽出**: 処理済み数、総数、成功・失敗件数

#### エラー一覧
- **アイテム名/URL**: 失敗したアイテムの識別情報
- **エラーメッセージ**: 失敗原因の詳細
- **テキスト選択可能**: エラー情報をコピー可能

#### 全体情報
- **経過時間**: 処理開始からの経過時間
- **推定残り時間**: 処理速度に基づく残り時間の推定（完了時は非表示）

## 対象アイテム

### ファビコン取得フェーズ
メインタブ・一時タブから、以下の条件に該当するアイテムを処理対象とします：
- URLアイテム（`type === 'url'`）
- アイコン未取得（`!item.icon`）

### アイコン抽出フェーズ
メインタブ・一時タブから、以下の条件に該当するアイテムを処理対象とします：
- 非URLアイテム（アプリ、ファイル、カスタムURI）
- アイコン未取得（`!item.icon`）
- **除外**: フォルダとグループアイテム

## 処理方式

- **フェーズ管理**: ファビコン取得とアイコン抽出を順次実行し、進捗を統合管理
- **逐次処理**: メモリ効率とエラー耐性を向上
- **進捗通知**: 各アイテム処理時に進捗状況をリアルタイム更新
- **エラー記録**: 各フェーズで発生したエラーを詳細に記録
- **エラーハンドリング**: 単一アイテムの失敗では処理を継続し、エラー数をカウント

## 表示例

### 処理中（基本表示）
```
[▓▓▓▓▓▓░░░░] 60% - フェーズ 1/2
ファビコン取得中: 12/20
```

### 詳細モーダル（処理中）
```
アイコン取得の進捗

━━━ フェーズ 1: ファビコン取得
[▓▓▓▓▓▓░░░░] 12/20
成功: 10件 | 失敗: 2件

━━━ フェーズ 2: アイコン抽出
待機中...

エラー一覧 (2件)
• https://invalid-site.example.com
  エラー: getaddrinfo ENOTFOUND invalid-site.example.com
• https://blocked-site.example.net
  エラー: HTTP 403

経過: 45秒 | 残り: 約1分15秒
```

### 完了時（基本表示）
```
✓ アイコン取得完了
```

### 詳細モーダル（完了時）
```
アイコン取得の進捗

━━━ フェーズ 1: ファビコン取得
[▓▓▓▓▓▓▓▓▓▓] 20/20
成功: 18件 | 失敗: 2件

━━━ フェーズ 2: アイコン抽出
[▓▓▓▓▓▓▓▓▓▓] 15/15
成功: 15件 | 失敗: 0件

エラー一覧 (2件)
• https://invalid-site.example.com
  エラー: getaddrinfo ENOTFOUND invalid-site.example.com
• https://blocked-site.example.net
  エラー: HTTP 403

経過: 2分30秒
```

## 関連ドキュメント

- [アイコンシステム](icon-system.md) - アイコンシステム全体の概要
- [ファビコン取得システム](icon-favicon.md) - ファビコン取得の詳細仕様