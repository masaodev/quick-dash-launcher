# アプリケーション設定

QuickDashLauncherの動作をカスタマイズするための設定機能を説明します。

## 設定ファイルの場所

| 項目 | 値 |
|------|-----|
| パス | `%APPDATA%/quick-dash-launcher/config/settings.json` |
| 形式 | JSON (UTF-8) |

設定変更は即座に反映されます（v1.0.0以降）。再起動は不要です。

---

## 初回設定

アプリケーション初回起動時、または`hotkey`が未設定の場合、初回設定画面が自動表示されます。

### 設定手順
1. 入力欄をクリックして、希望するキー組み合わせを押下（例: `Ctrl+Alt+Q`）
2. リアルタイムでバリデーションが実行されます
3. 「設定を完了」ボタンをクリック

**動作詳細:**
- ESCキーやフォーカス喪失では閉じません
- 後から設定画面で変更可能

**開発者向け:** 初回設定をスキップするには、`settings.json`の`hotkey`に任意の値を設定してください。

---

## 設定画面へのアクセス

1. **基本設定タブ**: ⚙ボタン → 「⚙️ 基本設定」
2. **アイテム管理タブ**: ⚙ボタン → 「✏️ アイテム管理」
3. **その他タブ**: ⚙ボタン → 「📊 その他」

---

## 設定項目一覧

### クイックリファレンス

| キー | 型 | デフォルト | 説明 |
|------|-----|-----------|------|
| `createdWithVersion` | `string?` | `undefined` | 設定ファイルを作成したアプリバージョン（新規作成時のみ自動記録） |
| `updatedWithVersion` | `string?` | `undefined` | 設定ファイルを最後に更新したアプリバージョン（更新時に自動記録） |
| `hotkey` | `string` | `''` | グローバルホットキー |
| `windowWidth` | `number` | `600` | 通常時のウィンドウ幅 |
| `windowHeight` | `number` | `400` | 通常時のウィンドウ高さ |
| `editModeWidth` | `number` | `1200` | アイテム管理時の幅 |
| `editModeHeight` | `number` | `700` | アイテム管理時の高さ |
| `autoLaunch` | `boolean` | `false` | Windows起動時に自動起動 |
| `windowPositionMode` | `string` | `'center'` | 表示位置モード |
| `showDataFileTabs` | `boolean` | `false` | タブ表示の有効/無効 |
| `dataFileLabels` | `object` | `{}` | データファイルのラベル定義 |
| `backupEnabled` | `boolean` | `false` | バックアップ機能 |
| `workspaceOpacity` | `number` | `100` | ワークスペースウィンドウの不透明度（0-100%） |
| `workspaceBackgroundTransparent` | `boolean` | `false` | 背景のみを透過するモード |

---

### グローバルホットキー

アプリケーションを呼び出すためのキー組み合わせ（デフォルト: `Alt+Space`）。

**設定方法:**
1. 入力欄をクリック
2. 希望するキー組み合わせを押下
3. バリデーション後、自動保存

**設定例:**
```
Alt+Space
Ctrl+Alt+Q
Ctrl+Shift+L
Alt+F1
```

**対応キー:**
- 修飾キー: `Ctrl`, `Alt`, `Shift`, `CmdOrCtrl`
- 通常キー: `A-Z`, `0-9`, `F1-F12`

**バリデーション:**
- 最低1つの修飾キーが必要
- システム予約キー（`Ctrl+Alt+Del`等）は不可
- 他アプリと競合するキーは登録不可

---

### ウィンドウサイズ

| 設定 | 幅範囲 | 高さ範囲 | デフォルト |
|------|-------|---------|-----------|
| 通常時 | 400-2000px | 300-1200px | 600x400 |
| アイテム管理時 | 800-2000px | 600-1200px | 1200x700 |

---

### ウィンドウピン留めモード

📌ボタンをクリックして切り替え。

| モード | 最上面 | 自動非表示 | 用途 |
|-------|-------|----------|------|
| 通常（デフォルト） | × | ○ | ホットキーで素早く呼び出す |
| 常に最上面 | ○ | × | 常にアクセス可能にしたい |
| 表示固定 | × | × | 他ウィンドウと並べて使う |

---

### ウィンドウ表示位置

| モード | 説明 |
|-------|------|
| `center`（画面中央（固定）） | 常にプライマリモニターの中央にウィンドウを表示します（デフォルト） |
| `cursorMonitorCenter`（画面中央（自動切替）） | マウスカーソルがあるモニターの中央にウィンドウを表示します（マルチモニター推奨） |
| `cursor`（カーソル付近） | マウスカーソルの近くにウィンドウを表示します（検索入力がしやすい位置） |
| `fixed`（固定位置（手動設定）） | ウィンドウを移動した位置を記憶して、次回も同じ位置に表示します |

**固定位置のリセット:** システムトレイメニュー →「画面中央に表示」

---

### 自動起動

Windowsログイン時にアプリを自動起動（デフォルト: 無効）。

**実装:**
- レジストリ `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run` に登録
- 開発環境では設定変更しても実際の登録は行われません

---

### バックアップ設定

| 設定 | デフォルト | 説明 |
|------|-----------|------|
| `backupEnabled` | `false` | バックアップ機能のON/OFF |
| `backupOnStart` | `false` | アプリ起動時にバックアップ |
| `backupOnEdit` | `false` | データ編集時にバックアップ |
| `backupInterval` | `5` | 最小バックアップ間隔（1-60分） |
| `backupRetention` | `20` | 保存件数上限（1-100件） |

**保存場所:** `%APPDATA%/quick-dash-launcher/config/backup/`

**ファイル名:** `data_2024-01-01T12-00-00.txt`

---

### タブ表示設定

複数のデータファイルをタブで切り替え。

| 設定 | デフォルト | 説明 |
|------|-----------|------|
| `showDataFileTabs` | `false` | タブ表示のON/OFF |
| `defaultFileTab` | `'data.txt'` | 起動時の表示タブ |
| `dataFileTabs` | `[{files:['data.txt'],name:'メイン'}]` | タブ設定 |
| `dataFileLabels` | `{}` | データファイルのラベル定義（ファイル名→表示ラベル） |

**タブ管理機能:**
- **アコーディオン形式**: タブをクリックして展開/折りたたみで詳細を表示
- **タブ名表示**: 折りたたみ時もタブ名が見やすく表示され、ファイル数アイコン（📄1）も表示
- **➕新規タブを追加**: 新しいタブとデータファイルを作成
- **タブ名のカスタマイズ**: 展開時に任意の名前を設定（空欄時はデフォルト名）
- **複数ファイル統合**: 1つのタブに複数ファイルを関連付け
- **▲▼ボタン**: 表示順序の変更
- **🗑️ボタン**: タブとデータファイルをディスクから完全に削除（確認メッセージあり）
- **データファイル管理**: 展開時にタブ内のデータファイル一覧を表示
  - 「データファイル:」ラベルとファイル名（物理ファイル名）を表示
  - 各ファイルにラベル設定が可能
  - ファイルごとに削除ボタンあり（最低1ファイル必要）
  - **data.txtの削除**: 他のタブにもdata.txtが含まれている場合のみ削除可能（最低1つのタブにdata.txtが必要）
  - **共有ファイルの削除**: 複数タブで共有されているファイルを削除する場合、タブからの削除のみ実行され、ファイル自体は残る
  - 既存ファイルの追加/新規ファイルの作成が可能
- **保存/キャンセルボタン**: 変更は保存ボタンを押すまで確定されない（未保存インジケーターで状態を表示）

**ファイルラベル機能:**
- データファイルに任意のラベル（別名）を設定可能
- ラベルはグローバルで、全てのタブで共通
- 設定方法: タブを展開して各ファイルの「データファイル:」入力欄に入力
- 表示: タブバーと編集モードでラベルが優先表示される（ラベルがない場合はファイル名）
- デフォルトラベル: 未設定時は「{タブ名}用データファイル」形式の名前が自動生成される

**デフォルトタブ名:**
- data.txt → 「メイン」
- data2.txt → 「サブ1」
- data3.txt → 「サブ2」

**タブのデフォルト位置へのリセット:**
- メイン画面でタブを切り替えた後、ウィンドウを閉じると、次回開いた際には自動的にデフォルトタブに戻ります
- この処理はウィンドウ非表示時に実行されるため、次回表示時は既にリセット済みで、表示遅延が発生しません

---

### ワークスペースウィンドウ

ワークスペースウィンドウの外観をカスタマイズできます。

| 設定 | デフォルト | 説明 |
|------|-----------|------|
| `workspaceOpacity` | `100` | ウィンドウの不透明度（0-100%） |
| `workspaceBackgroundTransparent` | `false` | 背景のみを透過するモード |

**透過度:**
- スライダーで0-100%の範囲で調整
- 0%: 完全に透明（ウィンドウが見えなくなるため非推奨）
- 100%: 完全に不透明（デフォルト）
- 設定変更は即座にワークスペースウィンドウに反映

**背景のみ透過:**
- チェックボックスで有効化
- 有効時: ウィンドウ背景のみが透過され、アイテム・ボタン・テキストは不透明のまま表示
- 無効時: ウィンドウ全体が透過度設定に従う
- デスクトップ背景を透かして見たい場合に便利

**サイズ変更:**
- ワークスペースウィンドウは8方向のカスタムハンドルでリサイズ可能
- 最小サイズ: 幅300px × 高さ400px
- ハンドル位置: 4隅（左上、右上、右下、左下）+ 4辺（上、右、下、左）

詳細は[ワークスペース機能 - ウィンドウのカスタマイズ](workspace.md#ウィンドウのカスタマイズ)を参照してください。

---

## システムトレイメニュー

タスクバー右下の通知領域にアイコンが常駐します。

### メニュー項目

| 項目 | 説明 |
|------|------|
| バージョン情報 | 現在のバージョンを表示（選択不可） |
| 表示 (Alt+Space) | メインウィンドウを表示 |
| 画面中央に表示 | 強制的に画面中央に表示 |
| 設定... | 設定画面を開く |
| データフォルダを開く | 設定フォルダをエクスプローラーで開く |
| ヘルプ | GitHubリポジトリを開く |
| 終了 | アプリケーションを終了 |

**ダブルクリック:** メインウィンドウを表示

---

## 詳細設定（設定フォルダのカスタマイズ）

環境変数 `QUICK_DASH_CONFIG_DIR` で設定フォルダの場所を変更できます。

### 設定方法

**一時的（PowerShell）:**
```powershell
$env:QUICK_DASH_CONFIG_DIR = "D:\MyApps\quick-dash-config"
```

**永続的:**
1. Windowsの「環境変数」を検索
2. ユーザー環境変数に `QUICK_DASH_CONFIG_DIR` を追加

### ユースケース

| 用途 | 設定例 |
|------|--------|
| ポータブル版 | `E:\PortableApps\QuickDash\config` |
| クラウド同期 | `$env:USERPROFILE\Dropbox\QuickDash\config` |
| 複数プロファイル | 仕事用/プライベート用で別パス |

### 注意事項

- セキュリティ制限: `C:\Windows`, `C:\Program Files` 等は使用不可
- 既存データは自動移行されません（手動コピーが必要）

---

## 設定ファイルのサンプル

```json
{
  "createdWithVersion": "0.4.3",
  "updatedWithVersion": "0.4.3",
  "hotkey": "Alt+Space",
  "windowWidth": 600,
  "windowHeight": 400,
  "editModeWidth": 1200,
  "editModeHeight": 700,
  "autoLaunch": false,
  "backupEnabled": false,
  "backupOnStart": false,
  "backupOnEdit": false,
  "backupInterval": 5,
  "backupRetention": 20,
  "showDataFileTabs": false,
  "defaultFileTab": "data.txt",
  "dataFileTabs": [
    { "files": ["data.txt"], "name": "仕事用" },
    { "files": ["data2.txt", "data3.txt"], "name": "プライベート" }
  ],
  "dataFileLabels": {
    "data.txt": "メインリスト",
    "data2.txt": "開発用"
  },
  "windowPositionMode": "center",
  "windowPositionX": 0,
  "windowPositionY": 0,
  "workspaceOpacity": 100,
  "workspaceBackgroundTransparent": false
}
```

---

## トラブルシューティング

### ホットキーが動作しない

1. **他アプリとの競合** → 別のキー組み合わせに変更
2. **管理者権限** → 管理者として実行
3. **設定破損** → リセットボタンでデフォルトに戻す

### 自動起動が動作しない

- タスクマネージャー → スタートアップタブで確認
- 複数起動する場合: 一度無効化→再度有効化

### 設定が保存されない

- 設定フォルダへの書き込み権限を確認
- ディスク容量を確認

### 設定パスが認識されない

- 環境変数が正しく設定されているか確認
- アプリケーションを再起動
- パスの書き込み権限を確認
