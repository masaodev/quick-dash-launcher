# アイテム管理

Ctrl+Eでアイテム管理に切り替えて、データファイル（data.txt、data2.txt、tempdata.txt）を直接編集できます。

## アイテム管理の特徴

- フォルダ取込アイテムを展開せずに生データのまま編集
- テーブル形式で行ごとに表示・編集（☑️ | # | 種類 | 名称 | 内容 | 操作）
- **2つの編集方法を提供**:
  - **セル編集（📝）**: セルクリックまたは📝ボタンで素早い修正
  - **詳細編集（✏️）**: ✏️ボタンでRegisterModalを使った包括的編集
  - **ユーザー選択式アイテム種別**: 従来の自動判定に代わり、ユーザーが「アイテム」「フォルダ取込アイテム」を明示的に選択
  - **アイテム種別の変更**: 既存アイテムをフォルダ取込アイテムに変更、またはその逆も可能
  - **フォルダ取込アイテム選択時の制限**: 名前フィールドは読み取り専用（ハイフン表示）、パスとフォルダ取込アイテムオプションのみ編集可能
- **アイテム表示名の個別編集**: 単一アイテムの名前のみ編集可能
- **フォルダ取込アイテムの制限**: 名前列は編集不可、パスと引数列は編集可能
- 行の追加、削除、内容編集が可能
- リアルタイム検索による行のフィルタリング
- 変更の一時保存と一括保存機能（全ての変更は保存ボタンクリックまで確定されない）
- ヘッダーに編集中のファイル名を表示
- **ウィンドウサイズ自動拡大**: アイテム管理時に1000x700pxに拡大、終了時に元のサイズに復元
- **フォーカスアウト無効化**: アイテム管理中はフォーカスアウトでもウィンドウが非表示にならない

## 操作方法

### セル編集
- セルをクリックまたは📝ボタンで即座に編集
- **編集確定**: Enter または フォーカス移動
- **編集キャンセル**: Escape

### 詳細編集
✏️ボタンでRegisterModalを開いて包括的編集:
- **アイテム種別選択**: 画面上部でユーザーが「アイテム」「フォルダ取込アイテム」を明示的に選択
- **アイテム選択時**: 単一アイテム登録（名前・パス・引数の編集が可能）
- **フォルダ取込アイテム選択時**: フォルダ取込アイテムとして処理
  - 名前フィールドは読み取り専用（ハイフン表示）
  - フォルダ取込アイテムオプション詳細設定（深度、タイプ、フィルター、除外、プレフィックス）
- **種別変更**: 既存アイテムとフォルダ取込アイテムの相互変換が可能

### データ整列
🔤整列ボタンで表示データを自動整理:
- **第1ソートキー**: 種類（フォルダ取込アイテム → アイテム → コメント → 空行）
- **第2ソートキー**: パスと引数（文字列の昇順、大文字小文字区別なし）
- **第3ソートキー**: 名前（文字列の昇順、大文字小文字区別なし）
- 整列後は未保存状態となり、保存ボタンで実際のファイルに反映

### その他の操作
- **名前編集**: 単一アイテムの名前列をクリック（フォルダ取込アイテムは編集不可）
- **行削除**: 選択後にDeleteキーまたは削除ボタン
- **一括操作**: チェックボックスによる複数選択
- **保存**: Ctrl+S または保存ボタン

## テーブル構成

### 列構成
- **☑️**: 行選択チェックボックス
- **#**: 行番号
- **種類**: アイテムタイプ（フォルダ取込アイテム/アイテム/コメント/空行）
- **名前**: アイテムの表示名（単一アイテムのみ編集可能）
- **パスと引数**: パスと引数の統合表示（全てのタイプで編集可能）
- **操作**: 3つのボタン
  - **📝**: セル編集ボタン（素早い修正）
  - **✏️**: 詳細編集ボタン（RegisterModal使用）
  - **🗑️**: 削除ボタン

## 技術実装

### データ型とAPI
- **RawDataLine型**: 生データ行を表現する新しいデータ型
- **loadRawDataFiles/saveRawDataFiles**: 生データの読み込み・保存API

### 主要コンポーネント
- **EditableRawItemList**: 編集可能テーブルコンポーネント
  - `onEditClick`プロパティで詳細編集機能を実装
  - セル編集と詳細編集の2つの編集方法を並行提供
  - `onSort`プロパティで整列機能を実装（種類→パスと引数→名前の順）
- **EditModeView**: アイテム管理専用のビューコンポーネント
  - RegisterModalの状態管理（`isRegisterModalOpen`, `editingItem`）
  - RawDataLine ⇔ RegisterItem の相互変換処理
  - **workingLines状態**: 編集中の一時的なデータを保持（削除・追加・編集を即座に反映せずに管理）
  - **全件書き戻し方式**: 保存時にworkingLines全体をファイルに書き込み
  - **handleSort関数**: 整列処理でworkingLinesの順序を変更し、未保存状態フラグを設定
- **RegisterModal**: 単一アイテムモードとアイテム管理の両方に対応
  - `editingItem`プロパティでアイテム管理判定
  - 既存アイテムの事前入力機能
  - **itemCategoryプロパティ**: 'item' | 'dir' でアイテム種別を管理
  - **条件付きUI表示**: フォルダ取込アイテム選択時のみフォルダ取込オプション表示、名前フィールド制御
  - **動的種別変更**: アイテム種別変更時の自動フィールド初期化・クリア

## 関連ドキュメント

- [開発ガイド](../guides/development.md) - 基本的な開発情報
- [フォルダ取込アイテム](folder-import-item.md) - フォルダ内容インポート機能
- [画面構成](../reference/screen-list.md) - アイテム管理画面の詳細仕様